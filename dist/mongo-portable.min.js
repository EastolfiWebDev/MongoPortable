/**
 * MongoPortable - Solution for a MongoDB-like portable database.
 * version 1.1.7
 * 
 * made by Eduardo Astolfi <eastolfi91@gmail.com>
 * copyright 2016 Eduardo Astolfi <eastolfi91@gmail.com>
 * MIT Licensed
 */
require=function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}for(var e=a("./BinaryParserBuffer"),f=null,g=String.fromCharCode,h=[],i=0;i<64;i++)h[i]=Math.pow(2,i);var j=function a(b,c){d(this,a),f=Logger.instance,this.bigEndian=b,this.allowExceptions=c};j.decodeFloat=function(a,b,c){var d=new e(this.bigEndian,a);d.checkBuffer(b+c+1);var f=h[c-1]-1,g=d.readBits(b+c,1),i=d.readBits(b,c),j=0,k=2,l=d.buffer.length+(-b>>3)-1;do for(var m=d.buffer[++l],n=b%8||8,o=1<<n;o>>=1;m&o&&(j+=1/k),k*=2);while(b-=n);if(i==(f<<1)+1)return j?NaN:g?-(1/0):+(1/0);var p=0;return(i||j)&&(p=i?Math.pow(2,i-f)*(1+j):Math.pow(2,-f+1)*j),(1+g*-2)*p},j.decodeInt=function(a,b,c,d){var f=new e(this.bigEndian||d,a),g=f.readBits(0,b),i=h[b];return c&&g>=i/2?g-i:g},j.encodeFloat=function(a,b,c){var d,e,f,g,i,j=h[c-1]-1,k=-j+1,l=j,m=k-b,n=parseFloat(a),o=isNaN(n)||n==-(1/0)||n==+(1/0)?n:0,p=0,q=2*j+1+b+3,r=new Array(q),s=(n=0!==o?0:n)<0,t=Math.floor(n=Math.abs(n)),u=n-t;for(g=q;g;r[--g]=0);for(g=j+2;t&&g;r[--g]=t%2,t=Math.floor(t/2));for(g=j+1;u>0&&g;(r[++g]=((u*=2)>=1)-0)&&--u);for(g=-1;++g<q&&!r[g];);if(r[(d=b-1+(g=(p=j+1-g)>=k&&p<=l?g+1:j+1-(p=k-1)))+1]){if(!(e=r[d]))for(i=d+2;!e&&i<q;e=r[i++]);for(i=d+1;e&&--i>=0;(r[i]=!r[i]-0)&&(e=0));}for(g=g-2<0?-1:g-3;++g<q&&!r[g];);for((p=j+1-g)>=k&&p<=l?++g:p<k&&(p!=j+1-q&&p<m&&console.warn("encodeFloat::float underflow"),g=j+1-(p=k-1)),(t||0!==o)&&(console.warn(t?"encodeFloat::float overflow":"encodeFloat::"+o),p=l+1,g=j+2,o==-(1/0)?s=1:isNaN(o)&&(r[g]=1)),n=Math.abs(p+j),i=c+1,f="";--i;f=n%2+f,n=n>>=1);var v=[];for(n=0,i=0,g=(f=(s?"1":"0")+f+r.slice(g,g+b).join("")).length,v=[];g;i=(i+1)%8)n+=(1<<i)*f.charAt(--g),7==i&&(v[v.length]=String.fromCharCode(n),n=0);return v[v.length]=n?String.fromCharCode(n):"",(this.bigEndian?v.reverse():v).join("")},j.encodeInt=function(a,b,c,d){var e=h[b];(a>=e||a<-(e/2))&&(console.warn("encodeInt::overflow"),a=0),a<0&&(a+=e);for(var f=[];a;f[f.length]=String.fromCharCode(a%256),a=Math.floor(a/256));for(b=-(-b>>3)-f.length;b--;f[f.length]="\0");return(this.bigEndian||d?f.reverse():f).join("")},j.toSmall=function(a){return this.decodeInt(a,8,!0)},j.fromSmall=function(a){return this.encodeInt(a,8,!0)},j.toByte=function(a){return this.decodeInt(a,8,!1)},j.fromByte=function(a){return this.encodeInt(a,8,!1)},j.toShort=function(a){return this.decodeInt(a,16,!0)},j.fromShort=function(a){return this.encodeInt(a,16,!0)},j.toWord=function(a){return this.decodeInt(a,16,!1)},j.fromWord=function(a){return this.encodeInt(a,16,!1)},j.toInt=function(a){return this.decodeInt(a,32,!0)},j.fromInt=function(a){return this.encodeInt(a,32,!0)},j.toLong=function(a){return this.decodeInt(a,64,!0)},j.fromLong=function(a){return this.encodeInt(a,64,!0)},j.toDWord=function(a){return this.decodeInt(a,32,!1)},j.fromDWord=function(a){return this.encodeInt(a,32,!1)},j.toQWord=function(a){return this.decodeInt(a,64,!0)},j.fromQWord=function(a){return this.encodeInt(a,64,!0)},j.toFloat=function(a){return this.decodeFloat(a,23,8)},j.fromFloat=function(a){return this.encodeFloat(a,23,8)},j.toDouble=function(a){return this.decodeFloat(a,52,11)},j.fromDouble=function(a){return this.encodeFloat(a,52,11)},j.encode_int32=function(a,b){var c,d,e,f,h;return h=a<0?a+4294967296:a,c=Math.floor(h/16777215),h&=16777215,d=Math.floor(h/65535),h&=65535,e=Math.floor(h/255),h&=255,f=Math.floor(h),b?[g(c),g(d),g(e),g(f)]:g(c)+g(d)+g(e)+g(f)},j.encode_int64=function(a){var b,c,d,e,f,h,i,j,k;return k=a<0?a+0x10000000000000000:a,b=Math.floor(k/72057594037927940),k&=72057594037927940,c=Math.floor(k/0xffffffffffff),k&=0xffffffffffff,d=Math.floor(k/0xffffffffff),k&=0xffffffffff,e=Math.floor(k/4294967295),k&=4294967295,f=Math.floor(k/16777215),k&=16777215,h=Math.floor(k/65535),k&=65535,i=Math.floor(k/255),k&=255,j=Math.floor(k),g(b)+g(c)+g(d)+g(e)+g(f)+g(h)+g(i)+g(j)},j.decode_utf8=function(a){for(var b,c=a.length,d="",e=0,f=0,g=0;e<c;)f=a.charCodeAt(e),f<128?(d+=String.fromCharCode(f),e++):f>191&&f<224?(g=a.charCodeAt(e+1),d+=String.fromCharCode((31&f)<<6|63&g),e+=2):(g=a.charCodeAt(e+1),b=a.charCodeAt(e+2),d+=String.fromCharCode((15&f)<<12|(63&g)<<6|63&b),e+=3);return d},j.encode_cstring=function(a){return unescape(encodeURIComponent(a))+j.fromByte(0)},j.encode_utf8=function(a){for(var b,c="",d=0,e=a.length;d<e;d++)b=a.charCodeAt(d),b<128?c+=String.fromCharCode(b):b>127&&b<2048?(c+=String.fromCharCode(b>>6|192),c+=String.fromCharCode(63&b|128)):(c+=String.fromCharCode(b>>12|224),c+=String.fromCharCode(b>>6&63|128),c+=String.fromCharCode(63&b|128));return c},j.hprint=function(a){for(var b,d=0,e=a.length;d<e;d++)a.charCodeAt(d)<32?(b=a.charCodeAt(d)<=15?"0"+a.charCodeAt(d).toString(16):a.charCodeAt(d).toString(16),c.stdout.write(b+" ")):(b=a.charCodeAt(d)<=15?"0"+a.charCodeAt(d).toString(16):a.charCodeAt(d).toString(16),c.stdout.write(b+" "));return c.stdout.write("\n\n"),b},j.ilprint=function(a){for(var b,d=0,e=a.length;d<e;d++)a.charCodeAt(d)<32?(b=a.charCodeAt(d)<=15?"0"+a.charCodeAt(d).toString(10):a.charCodeAt(d).toString(10),c.stdout.write(b+" ")):(b=a.charCodeAt(d)<=15?"0"+a.charCodeAt(d).toString(10):a.charCodeAt(d).toString(10),c.stdout.write(b+" "));return c.stdout.write("\n\n"),b},j.hlprint=function(a){for(var b,d=0,e=a.length;d<e;d++)a.charCodeAt(d)<32?(b=a.charCodeAt(d)<=15?"0"+a.charCodeAt(d).toString(16):a.charCodeAt(d).toString(16),c.stdout.write(b+" ")):(b=a.charCodeAt(d)<=15?"0"+a.charCodeAt(d).toString(16):a.charCodeAt(d).toString(16),c.stdout.write(b+" "));return c.stdout.write("\n\n"),b},b.exports=j}).call(this,a("_process"))},{"./BinaryParserBuffer":2,_process:10}],2:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=null,g=function(){function a(b,c){d(this,a),f=Logger.instance,this.bigEndian=b||0,this.buffer=[],this.setBuffer(c)}return e(a,[{key:"setBuffer",value:function(a){var b,c,d;if(a){for(c=b=a.length,d=this.buffer=new Array(b);c;d[b-c]=a.charCodeAt(--c));this.bigEndian&&d.reverse()}}},{key:"hasNeededBits",value:function(a){return this.buffer.length>=-(-a>>3)}},{key:"checkBuffer",value:function(a){this.hasNeededBits(a)||f.throw("checkBuffer::missing bytes")}},{key:"readBits",value:function(a,b){function c(a,b){for(;b--;a=1073741824==(1073741824&(a%=2147483648))?2*a:2*(a-1073741824)+2147483647+1);return a}if(a<0||b<=0)return 0;this.checkBuffer(a+b);for(var d,e=a%8,f=this.buffer.length-(a>>3)-1,g=this.buffer.length+(-(a+b)>>3),h=f-g,i=(this.buffer[f]>>e&(1<<(h?8-e:b))-1)+(h&&(d=(a+b)%8)?(this.buffer[g++]&(1<<d)-1)<<(h--<<3)-e:0);h;i+=c(this.buffer[g++],(h--<<3)-e));return i}}]),a}();b.exports=g},{}],3:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},j=a("./utils/EventEmitter"),k=a("./Cursor"),l=a("./ObjectId"),m=a("./Selector"),n=a("./SelectorMatcher"),o=null,p=null,q=function(a){function b(a,c,f){var g;d(this,b);var h=e(this,Object.getPrototypeOf(b).call(this));return h instanceof b?(o=Logger.instance,_.isNil(a)&&o.throw("db parameter required"),_.isNil(c)&&o.throw("collectionName parameter required"),!_.isNil(f)&&_.isPlainObject(f)||(f={}),b.checkCollectionName(c),p=a,h.name=c,h.databaseName=a.databaseName,h.fullName=h.databaseName+"."+h.name,h.docs=[],h.doc_indexes={},h.snapshots=[],h.opts={},_.merge(h.opts,f),h):(g=new b(a,c,f),e(h,g))}return f(b,a),h(b,[{key:"emit",value:function(a,c,d){i(Object.getPrototypeOf(b.prototype),"emit",this).call(this,a,c,d,p._stores)}}]),b}(j);q.prototype.insert=function(a,b,c){_.isNil(a)&&o.throw("doc parameter required"),_.isPlainObject(a)||o.throw("doc must be an object"),_.isNil(b)&&(b={}),_.isFunction(b)&&(c=b,b={}),_.isNil(c)||_.isFunction(c)||o.throw("callback must be a function");var d=_.cloneDeep(a);return _.isNumber(d._id)&&(d._id=_.toString(d._id)),(_.isNil(d._id)||!d._id instanceof l&&(!_.isString(d._id)||!d._id.length))&&(d._id=new l),d.timestamp=(new l).generationTime,this.doc_indexes[_.toString(d._id)]=this.docs.length,this.docs.push(d),this.emit("insert",{collection:this,doc:d}),c&&c(null,d),b.chain?this:d},q.prototype.find=function(a,b,c,d){var e=u({selection:a,fields:b,options:c,callback:d});a=e.selection,b=e.fields,c=e.options,d=e.callback;var f=new k(this.db,this,a,b,c);return this.emit("find",{collection:this,selector:a,fields:b}),d&&d(null,f.fetch()),c.forceFetch?f.fetch():f},q.prototype.findOne=function(a,b,c,d){var e=u({selection:a,fields:b,options:c,callback:d});a=e.selection,b=e.fields,c=e.options,d=e.callback;var f=new k(this.db,this,a,b,c);this.emit("findOne",{collection:this,selector:a,fields:b});var g=null;return f.hasNext()&&(g=f.next()),d&&d(null,g),g},q.prototype.update=function(a,b,c,d){_.isNil(a)&&(a={}),_.isNil(b)&&o.throw("You must specify the update operation"),_.isNil(c)&&(c={skip:0,limit:15}),_.isFunction(a)&&o.throw("You must specify the update operation"),_.isFunction(b)&&o.throw("You must specify the update operation"),_.isFunction(c)&&(d=c,c={}),a instanceof l&&(a={_id:a}),_.isNil(d)||_.isFunction(d)||o.throw("callback must be a function");var e=null,f=null;if(f=c.multi?this.find(a,null,{forceFetch:!0}):this.findOne(a),_.isNil(f)&&(f=[]),_.isArray(f)||(f=[f]),0===f.length)if(c.upsert){var g=this.insert(b);e={updated:{documents:null,count:0},inserted:{documents:[g],count:1}}}else e={updated:{documents:null,count:0},inserted:{documents:null,count:0}};else{for(var h=[],i=0;i<f.length;i++){var j=f[i],k=null,m=!1;for(var n in b){var p="$"===n.substr(0,1);p&&(m=!0),c.updateAsMongo?(m&&!p&&o.throw("All update fields must be an update operator"),!m&&c.multi&&o.throw("You can not update several documents when no update operators are included"),m&&(k=!1),m||(k=!0)):k=!!c.override}var q=null;if(k){q={_id:j._id};for(var s in b)"$"===s.substr(0,1)||/\./g.test(s)?o.warn("The field "+s+" can not begin with '$' or contain '.'"):q[s]=b[s]}else{q=_.cloneDeep(j);for(var t in b){var u=b[t];"$"===t.substr(0,1)?q=r(q,t,u):_.isNil(q[t])?o.warn("The document does not contains the field "+t):"_id"!==t?q[t]=u:o.warn("The field '_id' can not be updated")}}h.push(q);var v=this.doc_indexes[q._id];this.docs[v]=q}this.emit("update",{collection:this,selector:a,modifier:b,docs:h}),e={updated:{documents:h,count:h.length},inserted:{documents:null,count:0}}}return d&&d(null,e),e};var r=function(a,b,c){var d=_.cloneDeep(a);t[b]||o.throw("Invalid modifier specified: "+b);for(var e in c){var f=c[e],g=e.split(".");s(d,g,f,b)}return d},s=function a(b,c,d,e){for(var f=arguments.length<=4||void 0===arguments[4]?0:arguments[4],g=f;g<c.length;g++){var h=c[g],i=/^[0-9]+$/.test(h),j=b[h],k=!_.hasIn(q._noCreateModifiers,e);if(k||_.isObject(b)&&!_.isNil(j)||o.throw('The element "'+h+'" must exists in "'+JSON.stringify(b)+'"'),_.isArray(b)){if("$rename"===e)return null;for(i?h=_.toNumber(h):o.throw('The field "'+h+'" can not be appended to an array');b.length<h;)b.push(null)}return g<c.length-1?(_.isNil(j)&&(j=_.isFinite(_.toNumber(c[g+1]))?[]:{}),b[h]=a(j,c,d,e,f+1),b):(t[e](b,h,d),b)}};q.prototype.remove=function(a,b,c){var d=this;if(_.isNil(a)&&(a={}),_.isFunction(a)&&(c=a,a={}),_.isFunction(b)&&(c=b,b={}),_.isNil(b)&&(b={justOne:!1}),0===Object.size(a)&&!b.justOne)return this.drop(b,c);a instanceof l&&(a={_id:a}),_.isNil(c)||_.isFunction(c)||o.throw("callback must be a function");var e=this.find(a),f=[];return e.forEach(function(a){var b=d.doc_indexes[a._id];delete d.doc_indexes[a._id],d.docs.splice(b,1),f.push(a)}),this.emit("remove",{collection:this,selector:a,docs:f}),c&&c(null,f),f},q.prototype.delete=function(a,b,c){return this.remove(a,b,c)},q.prototype.destroy=function(a,b,c){return this.remove(a,b,c)},q.prototype.drop=function(a,b){return _.isNil(a)&&(a={}),_.isFunction(a)&&(b=a,a={}),_.isNil(b)||_.isFunction(b)||o.throw("callback must be a function"),this.doc_indexes={},this.docs=[],a.dropIndexes,this.emit("dropCollection",{collection:this,indexes:!!a.dropIndexes}),b&&b(null,!0),!0},q.prototype.save=function(a,b,c){return(_.isNil(a)||_.isFunction(a))&&o.throw("You must pass a document"),_.isFunction(b)&&(c=b,b={}),_.hasIn(a,"_id")?(b.upsert=!0,this.update({_id:a._id},a,b,c)):this.insert(a,b,c)},q.prototype.ensureIndex=function(){o.throw("Collection#ensureIndex unimplemented by driver")},q.prototype.backup=function(a,b){_.isFunction(a)&&(b=a,a=(new l).toString()),_.isNil(b)||_.isFunction(b)||o.throw("callback must be a function"),this.snapshots[a]=_.cloneDeep(this.docs),this.emit("snapshot",{collection:this,backupID:a,documents:this.snapshots[a]});var c={backupID:a,documents:this.snapshots[a]};return b&&b(null,c),c},q.prototype.backups=function(a){_.isNil(a)||_.isFunction(a)||o.throw("callback must be a function");var b=[];for(var c in this.snapshots)b.push({id:c,documents:this.snapshots[c]});return a&&a(null,b),b},q.prototype.removeBackup=function(a,b){_.isFunction(a)&&(b=a,a=null),_.isNil(b)||_.isFunction(b)||o.throw("callback must be a function");var c=!1;return a?(delete this.snapshots[_.toString(a)],c=a):(this.snapshots={},c=!0),b&&b(null,c),c},q.prototype.restore=function(a,b){_.isFunction(a)&&(b=a,a=null),_.isNil(b)||_.isFunction(b)||o.throw("callback must be a function");var c=Object.size(this.snapshots),d=null;if(0===c)o.throw("There is no snapshots");else if(!a)if(1===c){o.info("No backupID passed. Restoring the only snapshot");for(var e in this.snapshots)a=e}else o.throw("The are several snapshots. Please specify one backupID");return d=this.snapshots[a],d||o.throw("Unknown Backup ID: "+a),this.docs=d,this.emit("restore",{collection:this,backupID:a}),b&&b(null),this},q._noCreateModifiers={$unset:!0,$pop:!0,$rename:!0,$pull:!0,$pullAll:!0};var t={$inc:function(a,b,c){_.isNumber(c)||o.throw("Modifier $inc allowed for numbers only"),b in a?(_.isNumber(a[b])||o.throw("Cannot apply $inc modifier to non-number"),a[b]+=c):a[b]=c},$set:function(a,b,c){a[b]=_.cloneDeep(c)},$unset:function(a,b,c){_.isNil(a)||(_.isArray(a)?b in a&&(a[b]=null):delete a[b])},$push:function(a,b,c){var d=a[b];_.isNil(d)?a[b]=[c]:_.isArray(d)?d.push(_.cloneDeep(c)):o.throw("Cannot apply $push modifier to non-array")},$pushAll:function(a,b,c){var d=a[b];if(_.isNil(d))a[b]=c;else if(_.isArray(d))for(var e=0;e<c.length;e++)d.push(c[e]);else o.throw("Modifier $pushAll/pullAll allowed for arrays only")},$addToSet:function(a,b,c){var d=a[b];if(_.isNil(d))a[b]=[c];else if(_.isArray(d)){var e=!1;if(_.isPlainObject(c))for(var f in c){"$each"===f&&(e=!0);break}var g=e?c.$each:[c];_.forEach(g,function(a){for(var b=0;b<d.length;b++)if(n.equal(a,d[b]))return;d.push(a)})}else o.throw("Cannot apply $addToSet modifier to non-array")},$pop:function(a,b,c){if(!_.isNil(a)&&!_.isNil(a[b])){var d=a[b];_.isArray(d)?_.isNumber(c)&&c<0?d.splice(0,1):d.pop():o.throw("Cannot apply $pop modifier to non-array")}},$pull:function(a,b,c){if(!_.isNil(a)&&!_.isNil(a[b])){var d=a[b];if(_.isArray(d)){var e=[];if("object"!==("undefined"==typeof c?"undefined":g(c))||c instanceof Array)for(var f=0;f<d.length;f++)n.equal(d[f],c)||e.push(d[f]);else for(var h=new m({__matching__:c}),f=0;f<d.length;f++){var i={__matching__:d[f]};h.test(i)||e.push(d[f])}a[b]=e}else o.throw("Cannot apply $pull/pullAll modifier to non-array")}},$pullAll:function(a,b,c){if(!_.isNil(a)&&!_.isNil(a[b])){var d=a[b];if(_.isNil(d)||_.isArray(d)){if(!_.isNil(d)){for(var e=[],f=0;f<d.length;f++){for(var g=!1,h=0;h<c.length;h++)if(n.equal(d[f],c[h])){g=!0;break}g||e.push(d[f])}a[b]=e}}else o.throw("Modifier $pushAll/pullAll allowed for arrays only")}},$rename:function(a,b,c){b===c&&o.throw("The new field name must be different"),_.isString(c)&&""!==c.trim()||o.throw("The new name must be a non-empty string"),a[c]=a[b],delete a[b]},$bit:function(a,b,c){o.throw("$bit is not supported")}};q.checkCollectionName=function(a){_.isString(a)||o.throw("collection name must be a String"),a&&a.indexOf("..")===-1||o.throw("collection names cannot be empty"),a.indexOf("$")!==-1&&null===a.match(/((^\$cmd)|(oplog\.\$main))/)&&o.throw("collection names must not contain '$'"),null!==a.match(/^system\./)&&o.throw("collection names must not start with 'system.' (reserved for internal use)"),null!==a.match(/^\.|\.$/)&&o.throw("collection names must not start or end with '.'")},q.prototype.rename=function(a){if(_.isString(a)&&this.name!==a){q.checkCollectionName(a);var b=this.name.split(".").length>1?this.name.split(".")[0]:"";return this.name=a,this.fullName=b+"."+this.name,this}},b.exports=q,Object.size=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c};var u=function(a){return _.isNil(a.selection)&&(a.selection={}),_.isNil(a.selection)&&(a.selection={}),_.isNil(a.fields)&&(a.fields=[]),_.isNil(a.options)&&(a.options={skip:0,limit:15}),_.isFunction(a.selection)&&(a.callback=a.selection,a.selection={}),_.isFunction(a.fields)&&(a.callback=a.fields,a.fields=[]),_.isFunction(a.options)&&(a.callback=a.options,a.options={}),a.selection instanceof l&&(a.selection={_id:a.selection}),_.isNil(a.callback)||_.isFunction(a.callback)||o.throw("callback must be a function"),a.options.fields&&(_.isNil(a.fields)||0===a.fields.length?a.fields=a.options.fields:o.warn("Fields already present. Ignoring 'options.fields'.")),a}},{"./Cursor":4,"./ObjectId":5,"./Selector":6,"./SelectorMatcher":7,"./utils/EventEmitter":9}],4:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=a("./Selector"),f=null,g=function a(b,c,g,h){var i=arguments.length<=4||void 0===arguments[4]?{}:arguments[4];d(this,a),this.db=b,this.collection=c,this.selector=g,this.skipValue=i.skip||0,this.limitValue=i.limit||15,this.sortValue=i.sort||null,this.sorted=!1,f=Logger.instance,e.isSelectorCompiled(this.selector)?this.selector_compiled=this.selector:this.selector_compiled=new e(this.selector,e.MATCH_SELECTOR);for(var j=0;j<this.selector_compiled.clauses.length;j++)"_id"===this.selector_compiled.clauses[j].key&&(this.selector_id=this.selector_compiled.clauses[j].value);for(var k=0;k<this.selector_compiled.clauses.length;k++)if("_id"===this.selector_compiled.clauses[k].key){var l=this.selector_compiled.clauses[k].value;(_.isString(l)||_.isNumber(l))&&(this.selector_id=l)}this.fields=new e(h,e.FIELD_SELECTOR),this.sort_compiled=new e(this.sortValue,e.SORT_SELECTOR),this.db_objects=null,this.cursor_pos=0};g.prototype.rewind=function(){this.db_objects=null,this.cursor_pos=0},g.prototype.forEach=function(a){for(var b=this.fetchAll(),c=0;c<b.length;c++)a(b[c])},g.prototype.map=function(a){var b=[];return this.forEach(function(c){b.push(a(c))}),b},g.prototype.hasNext=function(){return this.cursor_pos<this.collection.docs.length},g.prototype.next=function(){return this.fetchOne()},g.prototype.fetch=function(){return this.fetchAll()},g.prototype.fetchAll=function(){return i(this,!1)||[]},g.prototype.fetchOne=function(){return i(this,!0)};var h=function(a,b){var c=_.cloneDeep(a);if(!_.isNil(b)&&_.isPlainObject(b)&&!_.isEqual(b,{})){var d=!0,e=null;_.hasIn(b,"_id")&&b._id===-1&&(d=!1);var f=null;for(var g in b)"_id"!==g&&null===e&&(e=1===b[g]),null!=e&&(null===f&&(f=e?{}:_.cloneDeep(a)),e?f[g]=a[g]:delete f[g]);d?f._id=a._id:delete f._id,c=f}return c},i=function(a){var b=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];if(a.selector_id){if(_.hasIn(a.collection.doc_indexes,_.toString(a.selector_id))){var c=a.collection.doc_indexes[_.toString(a.selector_id)];return h(a.collection.docs[c],a.fields)}return b?null:[]}for(;a.cursor_pos<a.collection.docs.length;){var d=a.collection.docs[a.cursor_pos];if(a.cursor_pos++,a.selector_compiled.test(d)&&(_.isNil(a.db_objects)&&(a.db_objects=[]),d=h(d,a.fields),a.db_objects.push(d),b))return d}if(_.isNil(a.db_objects))return null;!a.sorted&&j(a)&&a.sort();var e=a.skipValue,f=a.limitValue!==-1?a.limitValue+e:a.db_objects.length;return a.db_objects.slice(e,f)};g.prototype.count=function(){return this.fetchAll().length},g.prototype.sort=function(a){var b=this.sort_compiled||null;return a&&(b=new e(a,e.SORT_SELECTOR)),b&&(a?(this.sortValue=a,this.sort_compiled=b):!_.isNil(this.db_objects)&&_.isArray(this.db_objects)&&(this.db_objects=this.db_objects.sort(b),this.sorted=!0)),this},g.prototype.skip=function(a){if(_.isNil(a)||_.isNaN(a))throw new Error("Must pass a number");return this.skipValue=a,this},g.prototype.limit=function(a){if(_.isNil(a)||_.isNaN(a))throw new Error("Must pass a number");return this.limitValue=a,this};var j=function(a){return!_.isNil(a.sortValue)};g.prototype.batchSize=function(){throw new Error("Not yet implemented")},g.prototype.close=function(){throw new Error("Not yet implemented")},g.prototype.comment=function(){throw new Error("Not yet implemented")},g.prototype.explain=function(){throw new Error("Not yet implemented")},g.prototype.hint=function(){throw new Error("Not yet implemented")},g.prototype.itcount=function(){throw new Error("Not yet implemented")},g.prototype.maxScan=function(){throw new Error("Not yet implemented")},g.prototype.maxTimeMS=function(){throw new Error("Not yet implemented")},g.prototype.max=function(){throw new Error("Not yet implemented")},g.prototype.min=function(){throw new Error("Not yet implemented")},g.prototype.noCursorTimeout=function(){throw new Error("Not yet implemented")},g.prototype.objsLeftInBatch=function(){throw new Error("Not yet implemented")},g.prototype.pretty=function(){throw new Error("Not yet implemented")},g.prototype.readConcern=function(){throw new Error("Not yet implemented")},g.prototype.readPref=function(){throw new Error("Not yet implemented")},g.prototype.returnKey=function(){throw new Error("Not yet implemented")},g.prototype.showRecordId=function(){throw new Error("Not yet implemented")},g.prototype.size=function(){throw new Error("Not yet implemented")},g.prototype.snapshot=function(){throw new Error("Not yet implemented")},g.prototype.tailable=function(){throw new Error("Not yet implemented")},g.prototype.toArray=function(){throw new Error("Not yet implemented")},b.exports=g},{"./Selector":6}],5:[function(a,b,c){(function(c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a("./BinaryParser"),g=null,h=parseInt(16777215*Math.random(),10),i=new RegExp("^[0-9a-fA-F]{24}$"),j=function(a){var b=arguments.length<=1||void 0===arguments[1]?24:arguments[1];return!(a.length!==b||!i.test(a))},k=function(){function a(b,c){if(d(this,a),g=Logger.instance,this._bsontype="ObjectId",_.isNil(b))this.id=this.generate(b);else if(_.isNumber(b))this.id=this.generate(b);else if(!_.isString(b)||12!==b.length&&24!==b.length)g.throw("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");else if(j(b)){var e=a.createFromHexString(b);this.id=e.id}else 12===b.length?this.id=b:g.throw("Value passed in is not a valid 24 character hex string");a.cacheHexString&&(this.__id=this.toHexString())}return e(a,[{key:"toHexString",value:function(){if(a.cacheHexString&&this.__id)return this.__id;for(var b,c,d="",e=0,g=this.id.length;e<g;e++)c=f.toByte(this.id[e]),b=c<=15?"0"+c.toString(16):c.toString(16),d+=b;return a.cacheHexString&&(this.__id=d),d}},{key:"toString",value:function(){return this.toHexString()}},{key:"toJSON",value:function(){return this.toHexString()}},{key:"getInc",value:function(){return a.index=(a.index+1)%16777215}},{key:"generate",value:function(a){!_.isNil(a)&&_.isNumber(a)||(a=parseInt(Date.now()/1e3,10));var b=f.encodeInt(a,32,!0,!0),d=f.encodeInt(h,24,!1),e=f.fromShort(_.isNil(c)?Math.floor(1e5*Math.random()):c.pid),g=f.encodeInt(this.getInc(),24,!1,!0);return b+d+e+g}},{key:"equals",value:function(b){var c=b instanceof a||b.toHexString?b.id:a.createFromHexString(b).id;return this.id===c}},{key:"getTimestamp",value:function(){var a=new Date;return a.setTime(1e3*Math.floor(f.decodeInt(this.id.substring(0,4),32,!0,!0))),a}},{key:"generationTime",get:function(){return Math.floor(f.decodeInt(this.id.substring(0,4),32,!0,!0))},set:function(a){a=f.encodeInt(a,32,!0,!0),this.id=a+this.id.substr(4),this.toHexString()}}],[{key:"createFromHexString",value:function(b){if(_.isNil(b)||24!=b.length)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");for(var c,d,e=b.length,g="",h=0;h<e;h+=2)c=b.substr(h,2),d=parseInt(c,16),g+=f.fromByte(d);return new a(g,b)}},{key:"createFromTime",value:function(b){var c=f.encodeInt(b,32,!0,!0)+f.encodeInt(0,64,!0,!0);return new a(c)}},{key:"createPk",value:function(){return new a}}]),a}();k.index=0,b.exports=k}).call(this,a("_process"))},{"./BinaryParser":1,_process:10}],6:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a("./SelectorMatcher"),g=null,h=function(){function a(b){var c=arguments.length<=1||void 0===arguments[1]?a.MATCH_SELECTOR:arguments[1];if(d(this,a),g=Logger.instance,this.selector_compiled=null,c===a.MATCH_SELECTOR)this.selector_compiled=this.compile(b);else{if(c===a.SORT_SELECTOR)return this.compileSort(b);if(c===a.FIELD_SELECTOR)return this.compileFields(b);g.throw("You need to specify the selector type")}}return e(a,[{key:"test",value:function(a){return this.selector_compiled.test(a)}},{key:"compile",value:function(a){_.isNil(a)?(g.debug("selector -> null"),a={}):(g.debug("selector -> not null"),(!a||_.hasIn(a,"_id")&&!a._id)&&(g.debug("selector -> false value || { _id: false value }"),a={_id:!1})),_.isFunction(a)?(g.debug("selector -> function(doc) { ... }"),this.clauses=[{kind:"function",value:a}],g.debug("clauses created: "+JSON.stringify(this.clauses))):_.isString(a)||_.isNumber(a)?(g.debug('selector -> "123456789" || 123456798'),a={_id:a},this.clauses=i(a),g.debug("clauses created: "+JSON.stringify(this.clauses))):(g.debug("selector -> { field: value }"),this.clauses=i(a),g.debug("clauses created: "+JSON.stringify(this.clauses)));var b=new f(this);return b}},{key:"compileSort",value:function(a){if(_.isNil(a))return function(){return 0};var b=[],c=[];if(!_.isString(a)){if(_.isArray(a))return this.compileSort(a.join(" "));if(_.isPlainObject(a)){var d=[];for(var e in a)_.hasIn(a,e)&&(d.push(e),d.push(a[e]));return this.compileSort(d)}throw Error("Bad sort specification: ",JSON.stringify(a))}if(a=a.replace(/( )+/gi," ").trim(),a.indexOf(",")!==-1)return this.compileSort(a.replace(/,/gi," "));if(a.indexOf(" ")!==-1)for(var g=a.split(" "),h=0;h<g.length;h++){var i=g[h].trim();if("desc"===i||"asc"===i||"-1"===i||"1"===i||"false"===i||"true"===i)throw Error("Bad sort specification: ",JSON.stringify(a));var j=_.toString(g[h+1]);"desc"===j||"asc"===j?(b.push(i),c.push("asc"===j),h++):"-1"===j||"1"===j?(b.push(i),c.push("1"===j),h++):"false"===j||"true"===j?(b.push(i),c.push("true"===j),h++):(b.push(i),c.push(!0))}else b.push(a),c.push(!0);return function(a,d){for(var e=0,g=0;g<b.length;g++){if(0!==g&&0!==e)return e;e=f.cmp(a[b[g]],d[b[g]]),c[g]||(e*=-1)}return e}}},{key:"compileFields",value:function(a){var b={};if(_.isNil(a))return b;if(!_.isString(a)){if(_.isArray(a))return this.compileFields(a.join(" "));if(_.isPlainObject(a)){var c=[];for(var d in a)_.hasIn(a,d)&&(c.push(d),c.push(a[d]));return this.compileFields(c)}throw Error("Bad fields specification: ",JSON.stringify(a))}if(a=a.replace(/( )+/gi," ").trim(),a.indexOf(",")!==-1)return this.compileFields(a.replace(/,/gi," "));if(a.indexOf(" ")!==-1)for(var e=a.split(" "),f=0;f<e.length;f++){var g=e[f].trim();if("-1"===g||"1"===g||"false"===g||"true"===g)throw Error("Bad fields specification: ",JSON.stringify(a));var h=_.toString(e[f+1]);if("-1"===h||"1"===h){if("-1"===h){for(var i in b)if("_id"!==g&&1===b[i])throw new Error("A projection cannot contain both include and exclude specifications");b[g]=-1}else b[g]=1;f++}else if("false"===h||"true"===h){if("false"===h){if("_id"!==g)throw new Error("A projection cannot contain both include and exclude specifications");b[g]=-1}else b[g]=1;f++}else b[g]=1}else a.length>0&&(b[a]=1);return b}}],[{key:"isSelectorCompiled",value:function(b){return!_.isNil(b)&&(b instanceof f||b instanceof a&&b.selector_compiled instanceof f)}},{key:"matches",value:function(b,c){return new a(b).test(c)}}]),a}(),i=function(a){g.debug("Called: _buildSelector");var b=[];for(var c in a){var d=a[c];"$"===c.charAt(0)?(g.debug("selector -> operator => { $and: [{...}, {...}] }"),b.push(j(c,d))):(g.debug("selector -> plain => { field1: <value> }"),b.push(k(c,d)))}return b},j=function(a,b){var c={};switch(a){case"$or":case"$and":case"$nor":c.key=a.replace(/\$/,"");case"_operator_":c.kind="operator",c.type="array",c.value=[];for(var d=0;d<b.length;d++)c.value=_.union(c.value,i(b[d]));break;default:throw Error("Unrecogized key in selector: ",a)}return g.debug("clause created: "+JSON.stringify(c)),c},k=function(a,b){g.debug("Called: _buildKeypathSelector");var c={};if(c.value=b,_.isNil(b))g.debug("clause of type null"),c.type="null";else if(_.isRegExp(b)){g.debug("clause of type RegExp"),c.type="regexp";var d=b.toString().split("/");c.value={$regex:d[1]},""!=d[2]&&(c.value.$options=d[2])}else if(_.isArray(b))g.debug("clause of type Array"),c.type="array";else if(_.isString(b))g.debug("clause of type String"),c.type="string";else if(_.isNumber(b))g.debug("clause of type Number"),c.type="number";else if(_.isBoolean(b))g.debug("clause of type Boolean"),c.type="boolean";else if(_.isFunction(b))g.debug("clause of type Function"),c.type="function";else if(_.isPlainObject(b)){var e=!0;for(var f in b)if("$"===f.charAt(0)){e=!1;break}e?(g.debug("clause of type Object => { field: { field_1: <value>, field_2: <value> } }"),c.type="literal_object"):(g.debug("clause of type Operator => { field: { $gt: 2, $lt 5 } }"),
c.type="operator_object")}else c.type="__invalid__";var h=a.split(".");return h.length>1?(g.debug('clause over Object field => { "field1.field1_2": <value> }'),c.kind="object",c.key=h):(g.debug('clause over Plain field => { "field": <value> }'),c.kind="plain",c.key=h[0]),g.debug("clause created: "+JSON.stringify(c)),c};h.MATCH_SELECTOR="match",h.SORT_SELECTOR="sort",h.FIELD_SELECTOR="field",b.exports=h},{"./SelectorMatcher":7}],7:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=null,g=function(){function a(b){d(this,a),this.clauses=b.clauses,f=Logger.instance}return e(a,[{key:"test",value:function(a){f.debug("Called SelectorMatcher->test");var b=!1;_.isNil(a)&&(f.debug("document -> null"),f.throw("Parameter 'document' required")),f.debug("document -> not null");for(var c=0;c<this.clauses.length;c++){var d=this.clauses[c];if("function"===d.kind?(f.debug("clause -> function"),b=d.value.call(null,a)):"plain"===d.kind?(f.debug('clause -> plain on field "'+d.key+'" and value = '+JSON.stringify(d.value)),b=h(d,a[d.key]),f.debug("clause result -> "+b)):"object"===d.kind?(f.debug('clause -> object on field "'+d.key.join(".")+'" and value = '+JSON.stringify(d.value)),b=i(d,a,_.clone(d.key).reverse()),f.debug("clause result -> "+b)):"operator"===d.kind&&(f.debug("clause -> operator '"+d.key+"'"),b=j(d,a,d.key),f.debug("clause result -> "+b)),b===!1||"false"===b)return f.debug("the document do not matches"),!1}return f.debug("the document matches"),!0}}],[{key:"all",value:function(a,b){if(!(a instanceof Array))return!1;var c={},d=0;_.forEach(b,function(a){var b=JSON.stringify(a);b in c||(c[b]=!0,d++)});for(var e=0;e<a.length;e++){var f=JSON.stringify(a[e]);if(c[f]&&(delete c[f],d--,0===d))return!0}return!1}},{key:"in",value:function(b,c){if(_.isObject(b)){for(var d=0;d<c.length;d++)if(a.equal(b,c[d]))return!0;return!1}for(var d=0;d<c.length;d++)if(b===c[d])return!0;return!1}},{key:"equal",value:function(a,b){var c=function a(b,c){if(_.isNumber(b)||_.isString(b)||_.isBoolean(b)||_.isNil(b))return b===c;if(_.isFunction(b))return!1;if(!_.isObject(c))return!1;if(_.isArray(b)){if(!_.isArray(c))return!1;if(b.length!==c.length)return!1;for(var d=0;d<b.length;d++)if(!a(b[d],c[d]))return!1;return!0}var e=[];for(var f in c)e.push(c[f]);var g=0;for(var h in b){if(g>=e.length)return!1;if(!a(b[h],e[g]))return!1;g++}return g===e.length};return c(a,b)}},{key:"matches",value:function(a,b){if(_.isArray(a)){for(var c=0;c<a.length;c++)if(b(a[c]))return!0;return!1}return b(a)}},{key:"matches_plus",value:function(b,c){return a.matches(b,c)||c(b)}},{key:"cmp",value:function(b,c){if(_.isUndefined(b))return void 0===c?0:-1;if(_.isUndefined(c))return 1;var d=m.getByValue(b),e=m.getByValue(c);if(d.order!==e.order)return d.order<e.order?-1:1;if(d.number!==e.number){if(_.isSymbol(b))return 1;if(_.isSymbol(c))return-1}if(_.isNumber(b))return b-c;if(_.isString(b))return b<c?-1:b===c?0:1;if(_.isBoolean(b))return b?c?0:1:c?-1:0;if(_.isArray(b))for(var f=0;;f++){if(f===b.length)return f===c.length?0:-1;if(f===c.length)return 1;if(b.length!==c.length)return b.length-c.length;var g=a.cmp(b[f],c[f]);if(0!==g)return g}if(_.isNull(b))return 0;if(_.isRegExp(b))throw Error("Sorting not supported on regular expression");if(_.isPlainObject(b)){var h=function(a){var b=[];for(var c in a)b.push(c),b.push(a[c]);return b};return a.cmp(h(b),h(c))}return _.isSymbol(b)?0:void 0}}]),a}(),h=function(a,b){return f.debug("Called _testClause"),g.matches_plus(b,function(b){switch(a.type){case"null":return f.debug("test Null equality"),!!_.isNil(b);case"regexp":return f.debug("test RegExp equality"),k(a,b);case"literal_object":return f.debug("test Literal Object equality"),g.equal(b,a.value);case"operator_object":return f.debug("test Operator Object equality"),k(a,b);case"string":return f.debug("test String equality"),_.toString(b)===_.toString(a.value);case"number":return f.debug("test Number equality"),_.toNumber(b)===_.toNumber(a.value);case"boolean":return f.debug("test Boolean equality"),_.isBoolean(b)&&_.isBoolean(a.value)&&b===a.value;case"array":if(f.debug("test Boolean equality"),_.isArray(b)&&_.isArray(a.value)){if(b.length===a.value.length){for(var c=0;c<b.length;c++)if(a.value.indexOf(b[c])===-1)return!1;return!0}return!1}return!1;case"function":throw f.debug("test Function equality"),Error("Bad value type in query");default:throw Error("Bad value type in query")}})},i=function a(b,c,d){f.debug("Called _testObjectClause");var e=null;if(!(d.length>0))return f.debug("lowest path: "+g),h(b,c);var g=d.pop();return e=c[g],f.debug("check on field "+g),e?(f.log(e),f.debug("going deeper"),a(b,e,d)):void 0},j=function(a,b,c){for(var d=null,e=0;e<a.value.length;e++){var f=new g({clauses:[a.value[e]]});switch(c){case"and":if(_.isNil(d)&&(d=!0),!f.test(b))return!1;break;case"or":if(_.isNil(d)&&(d=!1),f.test(b))return!0}}return d||!1},k=function(a,b){f.debug("Called _testOperatorClause");for(var c in a.value)if(!l(c,a.value[c],a.value,b,a))return!1;return!0},l=function(a,b,c,d,e){switch(f.debug("Called _testOperatorConstraint"),a){case"$gt":return f.debug("testing operator $gt"),g.cmp(d,b)>0;case"$lt":return f.debug("testing operator $lt"),g.cmp(d,b)<0;case"$gte":return f.debug("testing operator $gte"),g.cmp(d,b)>=0;case"$lte":return f.debug("testing operator $lte"),g.cmp(d,b)<=0;case"$eq":return f.debug("testing operator $eq"),g.equal(d,b);case"$ne":return f.debug("testing operator $ne"),!g.equal(d,b);case"$in":return f.debug("testing operator $in"),g.in(d,b);case"$nin":return f.debug("testing operator $nin"),!g.in(d,b);case"$not":throw f.debug("testing operator $not"),Error("$not unimplemented");case"$exists":return f.debug("testing operator $exists"),b?!_.isUndefined(d):_.isUndefined(d);case"$type":throw f.debug("testing operator $type"),Error("$type unimplemented");case"$mod":return f.debug("testing operator $mod"),d%b[0]===b[1];case"$options":return f.debug("testing operator $options (ignored)"),!0;case"$regex":f.debug("testing operator $regex");var h=null;if(_.hasIn(c,"$options")&&(h=c.$options,/[xs]/.test(h)))throw Error("Only the i, m, and g regexp options are supported");var i=b;return _.isRegExp(i)&&_.isNil(h)?i.test(d):(i=_.isNil(h)?new RegExp(i):_.isRegExp(i)?new RegExp(i.source,h):new RegExp(i,h),i.test(d));case"$text":throw f.debug("testing operator $text"),Error("$text unimplemented");case"$where":throw f.debug("testing operator $where"),Error("$where unimplemented");case"$all":return f.debug("testing operator $all"),g.all(b,d)>0;case"$elemMatch":throw f.debug("testing operator $elemMatch"),Error("$elemMatch unimplemented");case"$size":return f.debug("testing operator $size"),_.isArray(d)&&d.length===b;default:throw f.debug("testing operator "+a),Error("Unrecognized key in selector: "+a)}},m={_types:[{alias:"minKey",number:-1,order:1,isType:null},{alias:"null",number:10,order:2,isType:null},{alias:"int",number:16,order:3,isType:_.isInteger},{alias:"long",number:18,order:3,isType:_.isNumber},{alias:"double",number:1,order:3,isType:_.isNumber},{alias:"number",number:null,order:3,isType:_.isNumber},{alias:"string",number:2,order:4,isType:_.isString},{alias:"symbol",number:14,order:4,isType:_.isSymbol},{alias:"object",number:3,order:5,isType:_.isPlainObject},{alias:"array",number:4,order:6,isType:_.isArray},{alias:"binData",number:5,order:7,isType:null},{alias:"objectId",number:7,order:8,isTypefnc:null},{alias:"bool",number:8,order:9,isType:_.isBoolean},{alias:"date",number:9,order:10,isTypefnc:_.isDate},{alias:"timestamp",number:17,order:11,isType:_.isDate},{alias:"regex",number:11,order:12,isType:_.isRegExp},{alias:"maxKey",number:127,order:13,isType:null}],getByAlias:function(a){for(var b=0;b<this._types.length;b++)if(this._types[b].alias===a)return this._types[b]},getByValue:function(a){if(_.isNumber(a))return this.getByAlias("double");if(_.isString(a))return this.getByAlias("string");if(_.isBoolean(a))return this.getByAlias("bool");if(_.isArray(a))return this.getByAlias("array");if(_.isNull(a))return this.getByAlias("null");if(_.isRegExp(a))return this.getByAlias("regex");if(_.isPlainObject(a))return this.getByAlias("object");if(_.isSymbol(a))return this.getByAlias("symbol");throw Error("Unaccepted BSON type")}};b.exports=g},{}],8:[function(a,b,c){"use strict";b.exports=a("./MongoPortable")},{"./MongoPortable":"mongo-portable"}],9:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=null,g=function(){function a(){d(this,a),f=Logger.instance}return e(a,[{key:"emit",value:function(a,b,c,d){if(_.isNil(a)||!_.isString(a))throw new Error("Error on name");_.isNil(b)&&(b={},c=null),_.isNil(c)&&(c=null),_.isFunction(b)&&(c=b,b={}),!_.isNil(d)&&_.isArray(d)&&(this._stores=d);var e=a;f.info("Emitting store event "+a),f.debug(b),_.forEach(this._stores,function(a){_.isFunction(a[e])&&a[e](b,c)})}}]),a}();b.exports=g},{}],10:[function(a,b,c){function d(){m&&k&&(m=!1,k.length?l=k.concat(l):n=-1,l.length&&e())}function e(){if(!m){var a=h.call(null,d);m=!0;for(var b=l.length;b;){for(k=l,l=[];++n<b;)k&&k[n].run();n=-1,b=l.length}k=null,m=!1,i.call(null,a)}}function f(a,b){this.fun=a,this.array=b}function g(){}var h,i,j=b.exports={};!function(){try{h=setTimeout}catch(a){h=function(){throw new Error("setTimeout is not defined")}}try{i=clearTimeout}catch(a){i=function(){throw new Error("clearTimeout is not defined")}}}();var k,l=[],m=!1,n=-1;j.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];l.push(new f(a,b)),1!==l.length||m||h.call(null,e,0)},f.prototype.run=function(){this.fun.apply(null,this.array)},j.title="browser",j.browser=!0,j.env={},j.argv=[],j.version="",j.versions={},j.on=g,j.addListener=g,j.once=g,j.off=g,j.removeListener=g,j.removeAllListeners=g,j.emit=g,j.binding=function(a){throw new Error("process.binding is not supported")},j.cwd=function(){return"/"},j.chdir=function(a){throw new Error("process.chdir is not supported")},j.umask=function(){return 0}},{}],"mongo-portable":[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=a("./utils/EventEmitter"),h=a("./ObjectId"),i=a("./Collection"),j=null,k=function(a){function b(a){var c,f=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];d(this,b);var g=e(this,Object.getPrototypeOf(b).call(this));return g instanceof b?(j=f.log?Logger.getInstance(f.log):Logger.instance,g._collections={},g._stores=[],b.connections||(b.connections={}),l(a),b.connections[a]&&j.throw("db name already in use"),g.databaseName=a,b.connections[a]=new h,g):(c=new b(a),e(g,c))}return f(b,a),b}(g);k.connections={},k.version="0.0.1",k.prototype.use=function(a,b){switch(a){case"store":this._stores.push(b)}},k.prototype.addStore=function(a){return _.isNil(a)&&j.throw("store must be included"),_.isFunction(a)?this._stores.push(new a):_.isObject(a)?this._stores.push(a):j.throw("store must be a function or object"),this},k.prototype.collectionsInfo=function(a,b){j.throw("Not implemented yet")},k.prototype.fetchCollections=function(a,b){return this.collections(a,b)},k.prototype.collections=function(a,b){_.isNil(b)&&_.isFunction(a)&&(b=a),_.isNil(a)&&(a={});var c=this,d=[];for(var e in c._collections)a.collectionName?e.toLowerCase()===a.collectionName.toLowerCase()&&(a.namesOnly?d.push(e):d.push(c._collections[e])):a.namesOnly?d.push(e):d.push(c._collections[e]);return b&&b(d),d},k.prototype.collectionNames=function(a,b){return _.isNil(b)&&_.isFunction(a)&&(b=a),_.isNil(a)&&(a={}),a.namesOnly||(a.namesOnly=!0),this.collections(a,b)},k.prototype.collection=function(a,b,c){var d=this,e=!1;return _.isFunction(b)?(c=b,b={}):b=b||{},d._collections[a]?(d.emit("createCollection",{connection:d,collection:d._collections[a]}),e=!0):(d._collections[a]=new i(d,a,d.pkFactory,b),d.emit("createCollection",{connection:d,collection:d._collections[a]})),e||Object.defineProperty(k.prototype,a,{enumerable:!0,configurable:!0,writable:!1,value:d._collections[a]}),c&&c(d._collections[a]),d._collections[a]},k.prototype.createCollection=k.prototype.collection,k.prototype.dropCollection=function(a,b){var c=this;if(c._collections[a])return this.emit("dropCollection",{conn:this,collection:c._collections[a]}),delete c._collections[a],b&&_.isFunction(b)&&b(),!0;var d="No collection found";return j.error(d),b&&_.isFunction(b)&&b(new Error(d)),!1},k.prototype.renameCollection=function(a,b,c){var d=this;if(_.isString(a)&&_.isString(b)&&a!==b){if(i.checkCollectionName(b),d._collections[a]){this.emit("renameCollection",{conn:d,from:a,to:b});var e=d._collections[a].rename(b);return d._collections.renameProperty(a,b),d.renameProperty(a,b),c&&_.isFunction(c)&&c(null,e),e}var f="No collection found";return j.error(f),c&&_.isFunction(c)&&c(new Error(f),null),!1}var g="The params are invalid";return j.error(g),c&&_.isFunction(c)&&c(new Error(g),null),!1},k.prototype.createIndex=function(a,b,c,d){j.throw("Not implemented yet!")},k.prototype.ensureIndex=function(a,b,c,d){j.throw("Not implemented yet!")},k.prototype.dropIndex=function(a,b,c){j.throw("Not implemented yet!")},k.prototype.reIndex=function(a,b){j.throw("Not implemented yet!")},k.prototype.indexInformation=function(a,b,c){j.throw("Not implemented yet!")},k.prototype.dropDatabase=function(a){if(k.connections[this.databaseName])return this.emit("dropDatabase",{conn:this}),delete k.connections[this.databaseName],this._collections=[],this._stores=[],a&&_.isFunction(a)&&a(null,!0),!0;var b="That database no longer exists";return j.error(b),a&&_.isFunction(a)&&a(new Error(b),!1),!1},k.prototype.dereference=function(a,b){};var l=function(a){_.isString(a)||j.throw("database name must be a string"),0===a.length&&j.throw("database name cannot be the empty string");for(var b=[" ",".","$","/","\\"],c=0;c<b.length;c++)a.indexOf(b[c])!=-1&&j.throw('database names cannot contain the character "'+b[c]+'"');return!0};b.exports=k,Object.defineProperty(Object.prototype,"renameProperty",{writable:!1,enumerable:!1,configurable:!1,value:function(a,b){return _.isString(a)&&_.isString(b)?a==b?this:(this.hasOwnProperty(a)&&(this[b]=this[a],delete this[a]),this):this}})},{"./Collection":3,"./ObjectId":5,"./utils/EventEmitter":9}]},{},[8]);