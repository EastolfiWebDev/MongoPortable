"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * @file BinaryParser.js - based on ({@link http://jsfromhell.com/classes/binary-parser Binary Parser}) by Jonas Raoni Soares Silva
 * @version 1.0.0
 * @ignore
 * 
 * @author Eduardo Astolfi <eastolfi91@gmail.com>
 * @copyright 2016 Eduardo Astolfi <eastolfi91@gmail.com>
 * @license MIT Licensed
 */

var logger = null;

// Shorcut for String.fromCharCode
var chr = String.fromCharCode;

var maxBits = [];
for (var i = 0; i < 64; i++) {
    maxBits[i] = Math.pow(2, i);
}

module.exports = function (BinaryParserBuffer, Logger) {

    /**
     * BinaryParser
     * @ignore
     * 
     * @module Cursor
     * @constructor
     * @since 0.0.1
     * 
     * @classdesc Cursor class that maps a MongoDB-like cursor
     * 
     * @param {MongoPortable} db - Additional options
     * @param {Collection} collection - The collection instance
     * @param {Object|Array|String} [selection={}] - The selection for matching documents
     * @param {Object|Array|String} [fields={}] - The fields of the document to show
     * @param {Object} [options] - Database object
     * 
     * @param {Object} [options.pkFactory=null] - Object overriding the basic "ObjectId" primary key generation.
     * 
     */
    var BinaryParser = function BinaryParser(bigEndian, allowExceptions) {
        _classCallCheck(this, BinaryParser);

        logger = Logger.instance;

        this.bigEndian = bigEndian;
        this.allowExceptions = allowExceptions;
    };

    BinaryParser.decodeFloat = function (data, precisionBits, exponentBits) {
        var b = new BinaryParserBuffer(this.bigEndian, data);

        b.checkBuffer(precisionBits + exponentBits + 1);

        var bias = maxBits[exponentBits - 1] - 1,
            signal = b.readBits(precisionBits + exponentBits, 1),
            exponent = b.readBits(precisionBits, exponentBits),
            significand = 0,
            divisor = 2,
            curByte = b.buffer.length + (-precisionBits >> 3) - 1;

        do {
            for (var byteValue = b.buffer[++curByte], startBit = precisionBits % 8 || 8, mask = 1 << startBit; mask >>= 1; byteValue & mask && (significand += 1 / divisor), divisor *= 2) {}
        } while (precisionBits -= startBit);

        if (exponent == (bias << 1) + 1) {
            if (significand) {
                return NaN;
            } else {
                if (signal) {
                    return -Infinity;
                } else {
                    return +Infinity;
                }
            }
        } else {
            var _mod = 0;

            if (exponent || significand) {
                _mod = exponent ? Math.pow(2, exponent - bias) * (1 + significand) : Math.pow(2, -bias + 1) * significand;
            }

            return (1 + signal * -2) * _mod;
        }

        // return exponent == ( bias << 1 ) + 1 ? significand ? NaN : signal ? -Infinity : +Infinity : ( 1 + signal * -2 ) * ( exponent || significand ? !exponent ? Math.pow( 2, -bias + 1 ) * significand : Math.pow( 2, exponent - bias ) * ( 1 + significand ) : 0 );
    };

    BinaryParser.decodeInt = function (data, bits, signed, forceBigEndian) {
        var b = new BinaryParserBuffer(this.bigEndian || forceBigEndian, data),
            x = b.readBits(0, bits),
            max = maxBits[bits]; //max = Math.pow( 2, bits );

        return signed && x >= max / 2 ? x - max : x;
    };

    BinaryParser.encodeFloat = function (data, precisionBits, exponentBits) {
        var bias = maxBits[exponentBits - 1] - 1,
            minExp = -bias + 1,
            maxExp = bias,
            minUnnormExp = minExp - precisionBits,
            n = parseFloat(data),
            status = isNaN(n) || n == -Infinity || n == +Infinity ? n : 0,
            exp = 0,
            len = 2 * bias + 1 + precisionBits + 3,
            bin = new Array(len),
            signal = (n = status !== 0 ? 0 : n) < 0,
            intPart = Math.floor(n = Math.abs(n)),
            floatPart = n - intPart,
            lastBit,
            rounded,
            result,
            i,
            j;

        for (i = len; i; bin[--i] = 0) {}

        for (i = bias + 2; intPart && i; bin[--i] = intPart % 2, intPart = Math.floor(intPart / 2)) {}

        for (i = bias + 1; floatPart > 0 && i; (bin[++i] = ((floatPart *= 2) >= 1) - 0) && --floatPart) {}

        for (i = -1; ++i < len && !bin[i];) {}

        if (bin[(lastBit = precisionBits - 1 + (i = (exp = bias + 1 - i) >= minExp && exp <= maxExp ? i + 1 : bias + 1 - (exp = minExp - 1))) + 1]) {
            if (!(rounded = bin[lastBit])) {
                for (j = lastBit + 2; !rounded && j < len; rounded = bin[j++]) {}
            }

            for (j = lastBit + 1; rounded && --j >= 0; (bin[j] = !bin[j] - 0) && (rounded = 0)) {}
        }

        for (i = i - 2 < 0 ? -1 : i - 3; ++i < len && !bin[i];) {}

        if ((exp = bias + 1 - i) >= minExp && exp <= maxExp) {
            ++i;
        } else if (exp < minExp) {
            exp != bias + 1 - len && exp < minUnnormExp && console.warn("encodeFloat::float underflow"); // TODO logger
            i = bias + 1 - (exp = minExp - 1);
        }

        if (intPart || status !== 0) {
            console.warn(intPart ? "encodeFloat::float overflow" : "encodeFloat::" + status); // TODO logger
            exp = maxExp + 1;
            i = bias + 2;

            if (status == -Infinity) {
                signal = 1;
            } else if (isNaN(status)) {
                bin[i] = 1;
            }
        }

        for (n = Math.abs(exp + bias), j = exponentBits + 1, result = ""; --j; result = n % 2 + result, n = n >>= 1) {}

        var r = [];

        for (n = 0, j = 0, i = (result = (signal ? "1" : "0") + result + bin.slice(i, i + precisionBits).join("")).length, r = []; i; j = (j + 1) % 8) {
            n += (1 << j) * result.charAt(--i);

            if (j == 7) {
                r[r.length] = String.fromCharCode(n);
                n = 0;
            }
        }

        r[r.length] = n ? String.fromCharCode(n) : "";

        return (this.bigEndian ? r.reverse() : r).join("");
    };

    BinaryParser.encodeInt = function (data, bits, signed, forceBigEndian) {
        var max = maxBits[bits];

        if (data >= max || data < -(max / 2)) {
            console.warn("encodeInt::overflow"); // TODO logger
            data = 0;
        }

        if (data < 0) {
            data += max;
        }

        for (var r = []; data; r[r.length] = String.fromCharCode(data % 256), data = Math.floor(data / 256)) {}

        for (bits = -(-bits >> 3) - r.length; bits--; r[r.length] = "\0") {}

        return (this.bigEndian || forceBigEndian ? r.reverse() : r).join("");
    };

    BinaryParser.toSmall = function (data) {
        return this.decodeInt(data, 8, true);
    };
    BinaryParser.fromSmall = function (data) {
        return this.encodeInt(data, 8, true);
    };
    BinaryParser.toByte = function (data) {
        return this.decodeInt(data, 8, false);
    };
    BinaryParser.fromByte = function (data) {
        return this.encodeInt(data, 8, false);
    };
    BinaryParser.toShort = function (data) {
        return this.decodeInt(data, 16, true);
    };
    BinaryParser.fromShort = function (data) {
        return this.encodeInt(data, 16, true);
    };
    BinaryParser.toWord = function (data) {
        return this.decodeInt(data, 16, false);
    };
    BinaryParser.fromWord = function (data) {
        return this.encodeInt(data, 16, false);
    };
    BinaryParser.toInt = function (data) {
        return this.decodeInt(data, 32, true);
    };
    BinaryParser.fromInt = function (data) {
        return this.encodeInt(data, 32, true);
    };
    BinaryParser.toLong = function (data) {
        return this.decodeInt(data, 64, true);
    };
    BinaryParser.fromLong = function (data) {
        return this.encodeInt(data, 64, true);
    };
    BinaryParser.toDWord = function (data) {
        return this.decodeInt(data, 32, false);
    };
    BinaryParser.fromDWord = function (data) {
        return this.encodeInt(data, 32, false);
    };
    BinaryParser.toQWord = function (data) {
        return this.decodeInt(data, 64, true);
    };
    BinaryParser.fromQWord = function (data) {
        return this.encodeInt(data, 64, true);
    };
    BinaryParser.toFloat = function (data) {
        return this.decodeFloat(data, 23, 8);
    };
    BinaryParser.fromFloat = function (data) {
        return this.encodeFloat(data, 23, 8);
    };
    BinaryParser.toDouble = function (data) {
        return this.decodeFloat(data, 52, 11);
    };
    BinaryParser.fromDouble = function (data) {
        return this.encodeFloat(data, 52, 11);
    };

    // Factor out the encode so it can be shared by add_header and push_int32
    BinaryParser.encode_int32 = function (number, asArray) {
        var a, b, c, d, unsigned;

        unsigned = number < 0 ? number + 0x100000000 : number;
        a = Math.floor(unsigned / 0xffffff);

        unsigned &= 0xffffff;
        b = Math.floor(unsigned / 0xffff);

        unsigned &= 0xffff;
        c = Math.floor(unsigned / 0xff);

        unsigned &= 0xff;
        d = Math.floor(unsigned);

        return asArray ? [chr(a), chr(b), chr(c), chr(d)] : chr(a) + chr(b) + chr(c) + chr(d);
    };

    BinaryParser.encode_int64 = function (number) {
        var a, b, c, d, e, f, g, h, unsigned;

        unsigned = number < 0 ? number + 0x10000000000000000 : number;
        a = Math.floor(unsigned / 0xffffffffffffff);

        unsigned &= 0xffffffffffffff;
        b = Math.floor(unsigned / 0xffffffffffff);

        unsigned &= 0xffffffffffff;
        c = Math.floor(unsigned / 0xffffffffff);

        unsigned &= 0xffffffffff;
        d = Math.floor(unsigned / 0xffffffff);

        unsigned &= 0xffffffff;
        e = Math.floor(unsigned / 0xffffff);

        unsigned &= 0xffffff;
        f = Math.floor(unsigned / 0xffff);

        unsigned &= 0xffff;
        g = Math.floor(unsigned / 0xff);

        unsigned &= 0xff;
        h = Math.floor(unsigned);

        return chr(a) + chr(b) + chr(c) + chr(d) + chr(e) + chr(f) + chr(g) + chr(h);
    };

    /**
     * UTF8 methods
     */

    // Take a raw binary string and return a utf8 string
    BinaryParser.decode_utf8 = function (binaryStr) {
        var len = binaryStr.length,
            decoded = '',
            i = 0,
            c = 0,
            c1 = 0,
            c2 = 0,
            c3;

        while (i < len) {
            c = binaryStr.charCodeAt(i);

            if (c < 128) {
                decoded += String.fromCharCode(c);

                i++;
            } else if (c > 191 && c < 224) {
                c2 = binaryStr.charCodeAt(i + 1);
                decoded += String.fromCharCode((c & 31) << 6 | c2 & 63);

                i += 2;
            } else {
                c2 = binaryStr.charCodeAt(i + 1);
                c3 = binaryStr.charCodeAt(i + 2);
                decoded += String.fromCharCode((c & 15) << 12 | (c2 & 63) << 6 | c3 & 63);

                i += 3;
            }
        }

        return decoded;
    };

    // Encode a cstring
    BinaryParser.encode_cstring = function (s) {
        return unescape(encodeURIComponent(s)) + BinaryParser.fromByte(0);
    };

    // Take a utf8 string and return a binary string
    BinaryParser.encode_utf8 = function encode_utf8(s) {
        var a = "",
            c;

        for (var n = 0, len = s.length; n < len; n++) {
            c = s.charCodeAt(n);

            if (c < 128) {
                a += String.fromCharCode(c);
            } else if (c > 127 && c < 2048) {
                a += String.fromCharCode(c >> 6 | 192);
                a += String.fromCharCode(c & 63 | 128);
            } else {
                a += String.fromCharCode(c >> 12 | 224);
                a += String.fromCharCode(c >> 6 & 63 | 128);
                a += String.fromCharCode(c & 63 | 128);
            }
        }

        return a;
    };

    BinaryParser.hprint = function (s) {
        var number;

        for (var i = 0, len = s.length; i < len; i++) {
            if (s.charCodeAt(i) < 32) {
                number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

                process.stdout.write(number + " ");
            } else {
                number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

                process.stdout.write(number + " ");
            }
        }

        process.stdout.write("\n\n");

        return number;
    };

    BinaryParser.ilprint = function (s) {
        var number;

        for (var i = 0, len = s.length; i < len; i++) {
            if (s.charCodeAt(i) < 32) {
                number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(10) : s.charCodeAt(i).toString(10);

                process.stdout.write(number + " ");
            } else {
                number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(10) : s.charCodeAt(i).toString(10);

                process.stdout.write(number + " ");
            }
        }

        process.stdout.write("\n\n");

        return number;
    };

    BinaryParser.hlprint = function (s) {
        var number;

        for (var i = 0, len = s.length; i < len; i++) {
            if (s.charCodeAt(i) < 32) {
                number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

                process.stdout.write(number + " ");
            } else {
                number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

                process.stdout.write(number + " ");
            }
        }

        process.stdout.write("\n\n");

        return number;
    };

    return BinaryParser;
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkJpbmFyeVBhcnNlci5qcyJdLCJuYW1lcyI6WyJsb2dnZXIiLCJjaHIiLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJtYXhCaXRzIiwiaSIsIk1hdGgiLCJwb3ciLCJtb2R1bGUiLCJleHBvcnRzIiwiQmluYXJ5UGFyc2VyQnVmZmVyIiwiTG9nZ2VyIiwiQmluYXJ5UGFyc2VyIiwiYmlnRW5kaWFuIiwiYWxsb3dFeGNlcHRpb25zIiwiaW5zdGFuY2UiLCJkZWNvZGVGbG9hdCIsImRhdGEiLCJwcmVjaXNpb25CaXRzIiwiZXhwb25lbnRCaXRzIiwiYiIsImNoZWNrQnVmZmVyIiwiYmlhcyIsInNpZ25hbCIsInJlYWRCaXRzIiwiZXhwb25lbnQiLCJzaWduaWZpY2FuZCIsImRpdmlzb3IiLCJjdXJCeXRlIiwiYnVmZmVyIiwibGVuZ3RoIiwiYnl0ZVZhbHVlIiwic3RhcnRCaXQiLCJtYXNrIiwiTmFOIiwiSW5maW5pdHkiLCJfbW9kIiwiZGVjb2RlSW50IiwiYml0cyIsInNpZ25lZCIsImZvcmNlQmlnRW5kaWFuIiwieCIsIm1heCIsImVuY29kZUZsb2F0IiwibWluRXhwIiwibWF4RXhwIiwibWluVW5ub3JtRXhwIiwibiIsInBhcnNlRmxvYXQiLCJzdGF0dXMiLCJpc05hTiIsImV4cCIsImxlbiIsImJpbiIsIkFycmF5IiwiaW50UGFydCIsImZsb29yIiwiYWJzIiwiZmxvYXRQYXJ0IiwibGFzdEJpdCIsInJvdW5kZWQiLCJyZXN1bHQiLCJqIiwiY29uc29sZSIsIndhcm4iLCJyIiwic2xpY2UiLCJqb2luIiwiY2hhckF0IiwicmV2ZXJzZSIsImVuY29kZUludCIsInRvU21hbGwiLCJmcm9tU21hbGwiLCJ0b0J5dGUiLCJmcm9tQnl0ZSIsInRvU2hvcnQiLCJmcm9tU2hvcnQiLCJ0b1dvcmQiLCJmcm9tV29yZCIsInRvSW50IiwiZnJvbUludCIsInRvTG9uZyIsImZyb21Mb25nIiwidG9EV29yZCIsImZyb21EV29yZCIsInRvUVdvcmQiLCJmcm9tUVdvcmQiLCJ0b0Zsb2F0IiwiZnJvbUZsb2F0IiwidG9Eb3VibGUiLCJmcm9tRG91YmxlIiwiZW5jb2RlX2ludDMyIiwibnVtYmVyIiwiYXNBcnJheSIsImEiLCJjIiwiZCIsInVuc2lnbmVkIiwiZW5jb2RlX2ludDY0IiwiZSIsImYiLCJnIiwiaCIsImRlY29kZV91dGY4IiwiYmluYXJ5U3RyIiwiZGVjb2RlZCIsImMxIiwiYzIiLCJjMyIsImNoYXJDb2RlQXQiLCJlbmNvZGVfY3N0cmluZyIsInMiLCJ1bmVzY2FwZSIsImVuY29kZVVSSUNvbXBvbmVudCIsImVuY29kZV91dGY4IiwiaHByaW50IiwidG9TdHJpbmciLCJwcm9jZXNzIiwic3Rkb3V0Iiwid3JpdGUiLCJpbHByaW50IiwiaGxwcmludCJdLCJtYXBwaW5ncyI6Ijs7OztBQUFBOzs7Ozs7Ozs7O0FBVUEsSUFBSUEsU0FBUyxJQUFiOztBQUVBO0FBQ0EsSUFBSUMsTUFBTUMsT0FBT0MsWUFBakI7O0FBRUEsSUFBSUMsVUFBVSxFQUFkO0FBQ0EsS0FBSyxJQUFJQyxJQUFJLENBQWIsRUFBZ0JBLElBQUksRUFBcEIsRUFBd0JBLEdBQXhCLEVBQTZCO0FBQ3pCRCxZQUFRQyxDQUFSLElBQWFDLEtBQUtDLEdBQUwsQ0FBUyxDQUFULEVBQVlGLENBQVosQ0FBYjtBQUNIOztBQUVERyxPQUFPQyxPQUFQLEdBQWlCLFVBQVNDLGtCQUFULEVBQTZCQyxNQUE3QixFQUFxQzs7QUFFbEQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFGa0QsUUFxQjVDQyxZQXJCNEMsR0FzQjlDLHNCQUFZQyxTQUFaLEVBQXVCQyxlQUF2QixFQUF3QztBQUFBOztBQUNwQ2QsaUJBQVNXLE9BQU9JLFFBQWhCOztBQUVBLGFBQUtGLFNBQUwsR0FBaUJBLFNBQWpCO0FBQ0EsYUFBS0MsZUFBTCxHQUF1QkEsZUFBdkI7QUFDSCxLQTNCNkM7O0FBZ0NsREYsaUJBQWFJLFdBQWIsR0FBMkIsVUFBVUMsSUFBVixFQUFnQkMsYUFBaEIsRUFBK0JDLFlBQS9CLEVBQTZDO0FBQ3BFLFlBQUlDLElBQUks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O0FBb0JBLFdBQU9oRixZQUFQO0FBQ0gsQ0F6WEQiLCJmaWxlIjoiQmluYXJ5UGFyc2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBCaW5hcnlQYXJzZXIuanMgLSBiYXNlZCBvbiAoe0BsaW5rIGh0dHA6Ly9qc2Zyb21oZWxsLmNvbS9jbGFzc2VzL2JpbmFyeS1wYXJzZXIgQmluYXJ5IFBhcnNlcn0pIGJ5IEpvbmFzIFJhb25pIFNvYXJlcyBTaWx2YVxuICogQHZlcnNpb24gMS4wLjBcbiAqIEBpZ25vcmVcbiAqIFxuICogQGF1dGhvciBFZHVhcmRvIEFzdG9sZmkgPGVhc3RvbGZpOTFAZ21haWwuY29tPlxuICogQGNvcHlyaWdodCAyMDE2IEVkdWFyZG8gQXN0b2xmaSA8ZWFzdG9sZmk5MUBnbWFpbC5jb20+XG4gKiBAbGljZW5zZSBNSVQgTGljZW5zZWRcbiAqL1xuIFxudmFyIGxvZ2dlciA9IG51bGw7XG5cbi8vIFNob3JjdXQgZm9yIFN0cmluZy5mcm9tQ2hhckNvZGVcbnZhciBjaHIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlO1xuXG52YXIgbWF4Qml0cyA9IFtdO1xuZm9yICh2YXIgaSA9IDA7IGkgPCA2NDsgaSsrKSB7XG4gICAgbWF4Qml0c1tpXSA9IE1hdGgucG93KDIsIGkpO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKEJpbmFyeVBhcnNlckJ1ZmZlciwgTG9nZ2VyKSB7XG5cbiAgICAvKipcbiAgICAgKiBCaW5hcnlQYXJzZXJcbiAgICAgKiBAaWdub3JlXG4gICAgICogXG4gICAgICogQG1vZHVsZSBDdXJzb3JcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAc2luY2UgMC4wLjFcbiAgICAgKiBcbiAgICAgKiBAY2xhc3NkZXNjIEN1cnNvciBjbGFzcyB0aGF0IG1hcHMgYSBNb25nb0RCLWxpa2UgY3Vyc29yXG4gICAgICogXG4gICAgICogQHBhcmFtIHtNb25nb1BvcnRhYmxlfSBkYiAtIEFkZGl0aW9uYWwgb3B0aW9uc1xuICAgICAqIEBwYXJhbSB7Q29sbGVjdGlvbn0gY29sbGVjdGlvbiAtIFRoZSBjb2xsZWN0aW9uIGluc3RhbmNlXG4gICAgICogQHBhcmFtIHtPYmplY3R8QXJyYXl8U3RyaW5nfSBbc2VsZWN0aW9uPXt9XSAtIFRoZSBzZWxlY3Rpb24gZm9yIG1hdGNoaW5nIGRvY3VtZW50c1xuICAgICAqIEBwYXJhbSB7T2JqZWN0fEFycmF5fFN0cmluZ30gW2ZpZWxkcz17fV0gLSBUaGUgZmllbGRzIG9mIHRoZSBkb2N1bWVudCB0byBzaG93XG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAtIERhdGFiYXNlIG9iamVjdFxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucy5wa0ZhY3Rvcnk9bnVsbF0gLSBPYmplY3Qgb3ZlcnJpZGluZyB0aGUgYmFzaWMgXCJPYmplY3RJZFwiIHByaW1hcnkga2V5IGdlbmVyYXRpb24uXG4gICAgICogXG4gICAgICovXG4gICAgY2xhc3MgQmluYXJ5UGFyc2VyIHtcbiAgICAgICAgY29uc3RydWN0b3IoYmlnRW5kaWFuLCBhbGxvd0V4Y2VwdGlvbnMpIHtcbiAgICAgICAgICAgIGxvZ2dlciA9IExvZ2dlci5pbnN0YW5jZTtcbiAgICAgICAgXG4gICAgICAgICAgICB0aGlzLmJpZ0VuZGlhbiA9IGJpZ0VuZGlhbjtcbiAgICAgICAgICAgIHRoaXMuYWxsb3dFeGNlcHRpb25zID0gYWxsb3dFeGNlcHRpb25zO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBcbiAgICB9XG4gICAgXG4gICAgQmluYXJ5UGFyc2VyLmRlY29kZUZsb2F0ID0gZnVuY3Rpb24gKGRhdGEsIHByZWNpc2lvbkJpdHMsIGV4cG9uZW50Qml0cykge1xuICAgICAgICB2YXIgYiA9IG5ldyBCaW5hcnlQYXJzZXJCdWZmZXIodGhpcy5iaWdFbmRpYW4sIGRhdGEpO1xuICAgIFxuICAgICAgICBiLmNoZWNrQnVmZmVyKHByZWNpc2lvbkJpdHMgKyBleHBvbmVudEJpdHMgKyAxKTtcbiAgICBcbiAgICAgICAgdmFyIGJpYXMgPSBtYXhCaXRzW2V4cG9uZW50Qml0cyAtIDFdIC0gMSxcbiAgICAgICAgICAgIHNpZ25hbCA9IGIucmVhZEJpdHMocHJlY2lzaW9uQml0cyArIGV4cG9uZW50Qml0cywgMSksXG4gICAgICAgICAgICBleHBvbmVudCA9IGIucmVhZEJpdHMocHJlY2lzaW9uQml0cywgZXhwb25lbnRCaXRzKSxcbiAgICAgICAgICAgIHNpZ25pZmljYW5kID0gMCxcbiAgICAgICAgICAgIGRpdmlzb3IgPSAyLFxuICAgICAgICAgICAgY3VyQnl0ZSA9IGIuYnVmZmVyLmxlbmd0aCArICgtcHJlY2lzaW9uQml0cyA+PiAzKSAtIDE7XG4gICAgXG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIGZvciAoXG4gICAgICAgICAgICAgICAgdmFyIGJ5dGVWYWx1ZSA9IGIuYnVmZmVyWyArK2N1ckJ5dGUgXSwgc3RhcnRCaXQgPSBwcmVjaXNpb25CaXRzICUgOCB8fCA4LCBtYXNrID0gMSA8PCBzdGFydEJpdDtcbiAgICAgICAgICAgICAgICBtYXNrID4+PSAxOyBcbiAgICAgICAgICAgICAgICAoIGJ5dGVWYWx1ZSAmIG1hc2sgKSAmJiAoIHNpZ25pZmljYW5kICs9IDEgLyBkaXZpc29yICksIGRpdmlzb3IgKj0gMiBcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gd2hpbGUgKHByZWNpc2lvbkJpdHMgLT0gc3RhcnRCaXQpO1xuICAgICAgICBcbiAgICAgICAgXG4gICAgXG4gICAgICAgIGlmICggZXhwb25lbnQgPT0gKCBiaWFzIDw8IDEgKSArIDEgKSB7XG4gICAgICAgIFx0aWYgKHNpZ25pZmljYW5kKSB7XG4gICAgICAgIFx0XHRyZXR1cm4gTmFOO1xuICAgICAgICBcdH0gZWxzZSB7XG4gICAgICAgIFx0XHRpZiAoc2lnbmFsKSB7XG4gICAgICAgIFx0XHRcdHJldHVybiAtSW5maW5pdHk7XG4gICAgICAgIFx0XHR9IGVsc2Uge1xuICAgICAgICBcdFx0XHRyZXR1cm4gK0luZmluaXR5O1xuICAgICAgICBcdFx0fVxuICAgICAgICBcdH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgXHR2YXIgX21vZCA9IDA7XG4gICAgICAgIFx0XG4gICAgICAgIFx0aWYgKGV4cG9uZW50IHx8IHNpZ25pZmljYW5kKSB7XG4gICAgICAgIFx0ICAgIF9tb2QgPSBleHBvbmVudCA/IE1hdGgucG93KCAyLCBleHBvbmVudCAtIGJpYXMgKSAqICggMSArIHNpZ25pZmljYW5kICkgOiBNYXRoLnBvdyggMiwgLWJpYXMgKyAxICkgKiBzaWduaWZpY2FuZDtcbiAgICAgICAgXHR9XG4gICAgICAgIFx0XG4gICAgICAgIFx0cmV0dXJuICggMSArIHNpZ25hbCAqIC0yICkgKiAoX21vZCk7XG4gICAgICAgIH1cbiAgICBcbiAgICBcbiAgICAgICAgLy8gcmV0dXJuIGV4cG9uZW50ID09ICggYmlhcyA8PCAxICkgKyAxID8gc2lnbmlmaWNhbmQgPyBOYU4gOiBzaWduYWwgPyAtSW5maW5pdHkgOiArSW5maW5pdHkgOiAoIDEgKyBzaWduYWwgKiAtMiApICogKCBleHBvbmVudCB8fCBzaWduaWZpY2FuZCA/ICFleHBvbmVudCA/IE1hdGgucG93KCAyLCAtYmlhcyArIDEgKSAqIHNpZ25pZmljYW5kIDogTWF0aC5wb3coIDIsIGV4cG9uZW50IC0gYmlhcyApICogKCAxICsgc2lnbmlmaWNhbmQgKSA6IDAgKTtcbiAgICB9O1xuICAgIFxuICAgIEJpbmFyeVBhcnNlci5kZWNvZGVJbnQgPSBmdW5jdGlvbiAoZGF0YSwgYml0cywgc2lnbmVkLCBmb3JjZUJpZ0VuZGlhbikge1xuICAgICAgICB2YXIgYiA9IG5ldyBCaW5hcnlQYXJzZXJCdWZmZXIodGhpcy5iaWdFbmRpYW4gfHwgZm9yY2VCaWdFbmRpYW4sIGRhdGEpLFxuICAgICAgICAgICAgeCA9IGIucmVhZEJpdHMoMCwgYml0cyksXG4gICAgICAgICAgICBtYXggPSBtYXhCaXRzW2JpdHNdOyAvL21heCA9IE1hdGgucG93KCAyLCBiaXRzICk7XG4gICAgXG4gICAgICAgIHJldHVybiBzaWduZWQgJiYgeCA+PSBtYXggLyAyID8geCAtIG1heCA6IHg7XG4gICAgfTtcbiAgICBcbiAgICBCaW5hcnlQYXJzZXIuZW5jb2RlRmxvYXQgPSBmdW5jdGlvbiAoZGF0YSwgcHJlY2lzaW9uQml0cywgZXhwb25lbnRCaXRzKSB7XG4gICAgICAgIHZhciBiaWFzID0gbWF4Qml0c1tleHBvbmVudEJpdHMgLSAxXSAtIDEsXG4gICAgICAgICAgICBtaW5FeHAgPSAtYmlhcyArIDEsXG4gICAgICAgICAgICBtYXhFeHAgPSBiaWFzLFxuICAgICAgICAgICAgbWluVW5ub3JtRXhwID0gbWluRXhwIC0gcHJlY2lzaW9uQml0cyxcbiAgICAgICAgICAgIG4gPSBwYXJzZUZsb2F0KGRhdGEpLFxuICAgICAgICAgICAgc3RhdHVzID0gaXNOYU4obikgfHwgbiA9PSAtSW5maW5pdHkgfHwgbiA9PSArSW5maW5pdHkgPyBuIDogMCxcbiAgICAgICAgICAgIGV4cCA9IDAsXG4gICAgICAgICAgICBsZW4gPSAyICogYmlhcyArIDEgKyBwcmVjaXNpb25CaXRzICsgMyxcbiAgICAgICAgICAgIGJpbiA9IG5ldyBBcnJheShsZW4pLFxuICAgICAgICAgICAgc2lnbmFsID0gKG4gPSBzdGF0dXMgIT09IDAgPyAwIDogbikgPCAwLFxuICAgICAgICAgICAgaW50UGFydCA9IE1hdGguZmxvb3IobiA9IE1hdGguYWJzKG4pKSxcbiAgICAgICAgICAgIGZsb2F0UGFydCA9IG4gLSBpbnRQYXJ0LFxuICAgICAgICAgICAgbGFzdEJpdCxcbiAgICAgICAgICAgIHJvdW5kZWQsXG4gICAgICAgICAgICByZXN1bHQsXG4gICAgICAgICAgICBpLFxuICAgICAgICAgICAgajtcbiAgICBcbiAgICBcbiAgICAgICAgZm9yIChpID0gbGVuOyBpOyBiaW5bLS1pXSA9IDApO1xuICAgICAgICBcbiAgICAgICAgZm9yIChpID0gYmlhcyArIDI7IGludFBhcnQgJiYgaTsgYmluWy0taV0gPSBpbnRQYXJ0ICUgMiwgaW50UGFydCA9IE1hdGguZmxvb3IoaW50UGFydCAvIDIpKTtcbiAgICAgICAgXG4gICAgICAgIGZvciAoaSA9IGJpYXMgKyAxOyBmbG9hdFBhcnQgPiAwICYmIGk7IChiaW5bKytpXSA9ICgoZmxvYXRQYXJ0ICo9IDIpID49IDEpIC0gMCApICYmIC0tZmxvYXRQYXJ0KTtcbiAgICAgICAgXG4gICAgICAgIGZvciAoaSA9IC0xOyArK2kgPCBsZW4gJiYgIWJpbltpXTspO1xuICAgICAgXG4gICAgICAgIGlmIChiaW5bKGxhc3RCaXQgPSBwcmVjaXNpb25CaXRzIC0gMSArIChpID0gKGV4cCA9IGJpYXMgKyAxIC0gaSkgPj0gbWluRXhwICYmIGV4cCA8PSBtYXhFeHAgPyBpICsgMSA6IGJpYXMgKyAxIC0gKGV4cCA9IG1pbkV4cCAtIDEpKSkgKyAxXSkge1xuICAgICAgICAgICAgaWYgKCEocm91bmRlZCA9IGJpbltsYXN0Qml0XSkpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGogPSBsYXN0Qml0ICsgMjsgIXJvdW5kZWQgJiYgaiA8IGxlbjsgcm91bmRlZCA9IGJpbltqKytdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZm9yIChqID0gbGFzdEJpdCArIDE7IHJvdW5kZWQgJiYgLS1qID49IDA7IChiaW5bal0gPSAhYmluW2pdIC0gMCkgJiYgKHJvdW5kZWQgPSAwKSk7XG4gICAgICAgIH1cbiAgICAgIFxuICAgICAgICBmb3IgKGkgPSBpIC0gMiA8IDAgPyAtMSA6IGkgLSAzOyArK2kgPCBsZW4gJiYgIWJpbltpXTspO1xuICAgICAgICBcbiAgICAgICAgaWYgKChleHAgPSBiaWFzICsgMSAtIGkpID49IG1pbkV4cCAmJiBleHAgPD0gbWF4RXhwKSB7XG4gICAgICAgICAgICArK2k7XG4gICAgICAgIH0gZWxzZSBpZiAoZXhwIDwgbWluRXhwKSB7XG4gICAgICAgICAgICBleHAgIT0gYmlhcyArIDEgLSBsZW4gJiYgZXhwIDwgbWluVW5ub3JtRXhwICYmIGNvbnNvbGUud2FybihcImVuY29kZUZsb2F0OjpmbG9hdCB1bmRlcmZsb3dcIik7ICAgIC8vIFRPRE8gbG9nZ2VyXG4gICAgICAgICAgICBpID0gYmlhcyArIDEgLSAoZXhwID0gbWluRXhwIC0gMSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmIChpbnRQYXJ0IHx8IHN0YXR1cyAhPT0gMCkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKGludFBhcnQgPyBcImVuY29kZUZsb2F0OjpmbG9hdCBvdmVyZmxvd1wiIDogXCJlbmNvZGVGbG9hdDo6XCIgKyBzdGF0dXMpOyAgICAvLyBUT0RPIGxvZ2dlclxuICAgICAgICAgICAgZXhwID0gbWF4RXhwICsgMTtcbiAgICAgICAgICAgIGkgPSBiaWFzICsgMjtcbiAgICAgICAgXG4gICAgICAgICAgICBpZiAoc3RhdHVzID09IC1JbmZpbml0eSkge1xuICAgICAgICAgICAgICAgIHNpZ25hbCA9IDE7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzTmFOKHN0YXR1cykpIHtcbiAgICAgICAgICAgICAgICBiaW5baV0gPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICBcbiAgICAgICAgZm9yIChuID0gTWF0aC5hYnMoZXhwICsgYmlhcyksIGogPSBleHBvbmVudEJpdHMgKyAxLCByZXN1bHQgPSBcIlwiOyAtLWo7IHJlc3VsdCA9IChuICUgMikgKyByZXN1bHQsIG4gPSBuID4+PSAxKTtcbiAgICAgICAgXG4gICAgICAgIGxldCByID0gW107XG4gICAgICAgIFxuICAgICAgICBmb3IgKG4gPSAwLCBqID0gMCwgaSA9IChyZXN1bHQgPSAoc2lnbmFsID8gXCIxXCIgOiBcIjBcIikgKyByZXN1bHQgKyBiaW4uc2xpY2UoaSwgaSArIHByZWNpc2lvbkJpdHMpLmpvaW4oXCJcIikpLmxlbmd0aCwgciA9IFtdOyBpOyBqID0gKGogKyAxKSAlIDgpIHtcbiAgICAgICAgICAgIG4gKz0gKDEgPDwgaikgKiByZXN1bHQuY2hhckF0KC0taSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChqID09IDcpIHtcbiAgICAgICAgICAgICAgICByW3IubGVuZ3RoXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUobik7XG4gICAgICAgICAgICAgICAgbiA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIFxuICAgICAgICByW3IubGVuZ3RoXSA9IG4gPyBTdHJpbmcuZnJvbUNoYXJDb2RlKG4pIDogXCJcIjtcbiAgICAgIFxuICAgICAgICByZXR1cm4gKHRoaXMuYmlnRW5kaWFuID8gci5yZXZlcnNlKCkgOiByKS5qb2luKFwiXCIpO1xuICAgIH07XG4gICAgXG4gICAgQmluYXJ5UGFyc2VyLmVuY29kZUludCA9IGZ1bmN0aW9uIChkYXRhLCBiaXRzLCBzaWduZWQsIGZvcmNlQmlnRW5kaWFuKSB7XG4gICAgICAgIHZhciBtYXggPSBtYXhCaXRzW2JpdHNdO1xuICAgICAgICBcbiAgICAgICAgaWYgKGRhdGEgPj0gbWF4IHx8IGRhdGEgPCAtKG1heCAvIDIpKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXCJlbmNvZGVJbnQ6Om92ZXJmbG93XCIpOyAgICAvLyBUT0RPIGxvZ2dlclxuICAgICAgICAgICAgZGF0YSA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmIChkYXRhIDwgMCkge1xuICAgICAgICAgICAgZGF0YSArPSBtYXg7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGZvciAodmFyIHIgPSBbXTsgZGF0YTsgcltyLmxlbmd0aF0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGRhdGEgJSAyNTYpLCBkYXRhID0gTWF0aC5mbG9vcihkYXRhIC8gMjU2KSk7XG4gICAgICAgIFxuICAgICAgICBmb3IgKGJpdHMgPSAtKC1iaXRzID4+IDMpIC0gci5sZW5ndGg7IGJpdHMtLTsgcltyLmxlbmd0aF0gPSBcIlxcMFwiKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiAoKHRoaXMuYmlnRW5kaWFuIHx8IGZvcmNlQmlnRW5kaWFuKSA/IHIucmV2ZXJzZSgpIDogcikuam9pbihcIlwiKTtcbiAgICB9O1xuICAgIFxuICAgIEJpbmFyeVBhcnNlci50b1NtYWxsICAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZGVjb2RlSW50KCBkYXRhLCAgOCwgdHJ1ZSAgKTsgfTtcbiAgICBCaW5hcnlQYXJzZXIuZnJvbVNtYWxsICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgIDgsIHRydWUgICk7IH07XG4gICAgQmluYXJ5UGFyc2VyLnRvQnl0ZSAgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVJbnQoIGRhdGEsICA4LCBmYWxzZSApOyB9O1xuICAgIEJpbmFyeVBhcnNlci5mcm9tQnl0ZSAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlSW50KCBkYXRhLCAgOCwgZmFsc2UgKTsgfTtcbiAgICBCaW5hcnlQYXJzZXIudG9TaG9ydCAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgMTYsIHRydWUgICk7IH07XG4gICAgQmluYXJ5UGFyc2VyLmZyb21TaG9ydCAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVJbnQoIGRhdGEsIDE2LCB0cnVlICApOyB9O1xuICAgIEJpbmFyeVBhcnNlci50b1dvcmQgICAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZGVjb2RlSW50KCBkYXRhLCAxNiwgZmFsc2UgKTsgfTtcbiAgICBCaW5hcnlQYXJzZXIuZnJvbVdvcmQgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgMTYsIGZhbHNlICk7IH07XG4gICAgQmluYXJ5UGFyc2VyLnRvSW50ICAgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVJbnQoIGRhdGEsIDMyLCB0cnVlICApOyB9O1xuICAgIEJpbmFyeVBhcnNlci5mcm9tSW50ICAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlSW50KCBkYXRhLCAzMiwgdHJ1ZSAgKTsgfTtcbiAgICBCaW5hcnlQYXJzZXIudG9Mb25nICAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgNjQsIHRydWUgICk7IH07XG4gICAgQmluYXJ5UGFyc2VyLmZyb21Mb25nICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVJbnQoIGRhdGEsIDY0LCB0cnVlICApOyB9O1xuICAgIEJpbmFyeVBhcnNlci50b0RXb3JkICAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZGVjb2RlSW50KCBkYXRhLCAzMiwgZmFsc2UgKTsgfTtcbiAgICBCaW5hcnlQYXJzZXIuZnJvbURXb3JkICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgMzIsIGZhbHNlICk7IH07XG4gICAgQmluYXJ5UGFyc2VyLnRvUVdvcmQgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVJbnQoIGRhdGEsIDY0LCB0cnVlICk7IH07XG4gICAgQmluYXJ5UGFyc2VyLmZyb21RV29yZCAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVJbnQoIGRhdGEsIDY0LCB0cnVlICk7IH07XG4gICAgQmluYXJ5UGFyc2VyLnRvRmxvYXQgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVGbG9hdCggZGF0YSwgMjMsIDggICApOyB9O1xuICAgIEJpbmFyeVBhcnNlci5mcm9tRmxvYXQgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlRmxvYXQoIGRhdGEsIDIzLCA4ICAgKTsgfTtcbiAgICBCaW5hcnlQYXJzZXIudG9Eb3VibGUgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUZsb2F0KCBkYXRhLCA1MiwgMTEgICk7IH07XG4gICAgQmluYXJ5UGFyc2VyLmZyb21Eb3VibGUgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVGbG9hdCggZGF0YSwgNTIsIDExICApOyB9O1xuICAgIFxuICAgIC8vIEZhY3RvciBvdXQgdGhlIGVuY29kZSBzbyBpdCBjYW4gYmUgc2hhcmVkIGJ5IGFkZF9oZWFkZXIgYW5kIHB1c2hfaW50MzJcbiAgICBCaW5hcnlQYXJzZXIuZW5jb2RlX2ludDMyID0gZnVuY3Rpb24gKG51bWJlciwgYXNBcnJheSkge1xuICAgICAgICB2YXIgYSwgYiwgYywgZCwgdW5zaWduZWQ7XG4gICAgICAgIFxuICAgICAgICB1bnNpZ25lZCA9IChudW1iZXIgPCAwKSA/IChudW1iZXIgKyAweDEwMDAwMDAwMCkgOiBudW1iZXI7XG4gICAgICAgIGEgPSBNYXRoLmZsb29yKHVuc2lnbmVkIC8gMHhmZmZmZmYpO1xuICAgICAgICBcbiAgICAgICAgdW5zaWduZWQgJj0gMHhmZmZmZmY7XG4gICAgICAgIGIgPSBNYXRoLmZsb29yKHVuc2lnbmVkIC8gMHhmZmZmKTtcbiAgICAgICAgXG4gICAgICAgIHVuc2lnbmVkICY9IDB4ZmZmZjtcbiAgICAgICAgYyA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmKTtcbiAgICAgICAgXG4gICAgICAgIHVuc2lnbmVkICY9IDB4ZmY7XG4gICAgICAgIGQgPSBNYXRoLmZsb29yKHVuc2lnbmVkKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBhc0FycmF5ID8gW2NocihhKSwgY2hyKGIpLCBjaHIoYyksIGNocihkKV0gOiBjaHIoYSkgKyBjaHIoYikgKyBjaHIoYykgKyBjaHIoZCk7XG4gICAgfTtcbiAgICBcbiAgICBCaW5hcnlQYXJzZXIuZW5jb2RlX2ludDY0ID0gZnVuY3Rpb24gKG51bWJlcikge1xuICAgICAgICB2YXIgYSwgYiwgYywgZCwgZSwgZiwgZywgaCwgdW5zaWduZWQ7XG4gICAgICAgIFxuICAgICAgICB1bnNpZ25lZCA9IChudW1iZXIgPCAwKSA/IChudW1iZXIgKyAweDEwMDAwMDAwMDAwMDAwMDAwKSA6IG51bWJlcjtcbiAgICAgICAgYSA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmZmZmZmZmZmZmZmKTtcbiAgICAgICAgXG4gICAgICAgIHVuc2lnbmVkICY9IDB4ZmZmZmZmZmZmZmZmZmY7XG4gICAgICAgIGIgPSBNYXRoLmZsb29yKHVuc2lnbmVkIC8gMHhmZmZmZmZmZmZmZmYpO1xuICAgICAgICBcbiAgICAgICAgdW5zaWduZWQgJj0gMHhmZmZmZmZmZmZmZmY7XG4gICAgICAgIGMgPSBNYXRoLmZsb29yKHVuc2lnbmVkIC8gMHhmZmZmZmZmZmZmKTtcbiAgICAgICAgXG4gICAgICAgIHVuc2lnbmVkICY9IDB4ZmZmZmZmZmZmZjtcbiAgICAgICAgZCA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmZmZmZmKTtcbiAgICAgICAgXG4gICAgICAgIHVuc2lnbmVkICY9IDB4ZmZmZmZmZmY7XG4gICAgICAgIGUgPSBNYXRoLmZsb29yKHVuc2lnbmVkIC8gMHhmZmZmZmYpO1xuICAgICAgICBcbiAgICAgICAgdW5zaWduZWQgJj0gMHhmZmZmZmY7XG4gICAgICAgIGYgPSBNYXRoLmZsb29yKHVuc2lnbmVkIC8gMHhmZmZmKTtcbiAgICAgICAgXG4gICAgICAgIHVuc2lnbmVkICY9IDB4ZmZmZjtcbiAgICAgICAgZyA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmKTtcbiAgICAgICAgXG4gICAgICAgIHVuc2lnbmVkICY9IDB4ZmY7XG4gICAgICAgIGggPSBNYXRoLmZsb29yKHVuc2lnbmVkKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBjaHIoYSkgKyBjaHIoYikgKyBjaHIoYykgKyBjaHIoZCkgKyBjaHIoZSkgKyBjaHIoZikgKyBjaHIoZykgKyBjaHIoaCk7XG4gICAgfTtcbiAgICBcbiAgICAvKipcbiAgICAgKiBVVEY4IG1ldGhvZHNcbiAgICAgKi9cbiAgICBcbiAgICAvLyBUYWtlIGEgcmF3IGJpbmFyeSBzdHJpbmcgYW5kIHJldHVybiBhIHV0Zjggc3RyaW5nXG4gICAgQmluYXJ5UGFyc2VyLmRlY29kZV91dGY4ID0gZnVuY3Rpb24gKGJpbmFyeVN0cikge1xuICAgICAgICB2YXIgbGVuID0gYmluYXJ5U3RyLmxlbmd0aCxcbiAgICAgICAgICAgIGRlY29kZWQgPSAnJyxcbiAgICAgICAgICAgIGkgPSAwLFxuICAgICAgICAgICAgYyA9IDAsXG4gICAgICAgICAgICBjMSA9IDAsXG4gICAgICAgICAgICBjMiA9IDAsXG4gICAgICAgICAgICBjMztcbiAgICAgICAgXG4gICAgICAgIHdoaWxlIChpIDwgbGVuKSB7XG4gICAgICAgICAgICBjID0gYmluYXJ5U3RyLmNoYXJDb2RlQXQoaSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChjIDwgMTI4KSB7XG4gICAgICAgICAgICAgICAgZGVjb2RlZCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGMpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGkrKztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoKGMgPiAxOTEpICYmIChjIDwgMjI0KSkge1xuICAgICAgICAgICAgICAgIGMyID0gYmluYXJ5U3RyLmNoYXJDb2RlQXQoaSsxKTtcbiAgICAgICAgICAgICAgICBkZWNvZGVkICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKChjICYgMzEpIDw8IDYpIHwgKGMyICYgNjMpKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpICs9IDI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGMyID0gYmluYXJ5U3RyLmNoYXJDb2RlQXQoaSsxKTtcbiAgICAgICAgICAgICAgICBjMyA9IGJpbmFyeVN0ci5jaGFyQ29kZUF0KGkrMik7XG4gICAgICAgICAgICAgICAgZGVjb2RlZCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYyAmIDE1KSA8PCAxMikgfCAoKGMyICYgNjMpIDw8IDYpIHwgKGMzICYgNjMpKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpICs9IDM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBkZWNvZGVkO1xuICAgIH07XG4gICAgXG4gICAgLy8gRW5jb2RlIGEgY3N0cmluZ1xuICAgIEJpbmFyeVBhcnNlci5lbmNvZGVfY3N0cmluZyA9IGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHJldHVybiB1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQocykpICsgQmluYXJ5UGFyc2VyLmZyb21CeXRlKDApO1xuICAgIH07XG4gICAgXG4gICAgLy8gVGFrZSBhIHV0Zjggc3RyaW5nIGFuZCByZXR1cm4gYSBiaW5hcnkgc3RyaW5nXG4gICAgQmluYXJ5UGFyc2VyLmVuY29kZV91dGY4ID0gZnVuY3Rpb24gZW5jb2RlX3V0ZjggKHMpIHtcbiAgICAgICAgdmFyIGEgPSBcIlwiLFxuICAgICAgICAgICAgYztcbiAgICBcbiAgICAgICAgZm9yICh2YXIgbiA9IDAsIGxlbiA9IHMubGVuZ3RoOyBuIDwgbGVuOyBuKyspIHtcbiAgICAgICAgICAgIGMgPSBzLmNoYXJDb2RlQXQobik7XG4gICAgXG4gICAgICAgICAgICBpZiAoYyA8IDEyOCkge1xuICAgICAgICAgICAgICAgIGEgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoKGMgPiAxMjcpICYmIChjIDwgMjA0OCkpIHtcbiAgICAgICAgICAgICAgICBhICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGM+PjYpIHwgMTkyKSA7XG4gICAgICAgICAgICAgICAgYSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjJjYzKSB8IDEyOCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGEgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYz4+MTIpIHwgMjI0KTtcbiAgICAgICAgICAgICAgICBhICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKChjPj42KSAmIDYzKSB8IDEyOCk7XG4gICAgICAgICAgICAgICAgYSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjJjYzKSB8IDEyOCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBcbiAgICAgICAgcmV0dXJuIGE7XG4gICAgfTtcbiAgICBcbiAgICBCaW5hcnlQYXJzZXIuaHByaW50ID0gZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgdmFyIG51bWJlcjtcbiAgICBcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChzLmNoYXJDb2RlQXQoaSkgPCAzMikge1xuICAgICAgICAgICAgICAgIG51bWJlciA9IHMuY2hhckNvZGVBdChpKSA8PSAxNSA/IFwiMFwiICsgcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDE2KSA6IHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxNik7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUobnVtYmVyICsgXCIgXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBudW1iZXIgPSBzLmNoYXJDb2RlQXQoaSkgPD0gMTUgPyBcIjBcIiArIHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxNikgOiBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKG51bWJlciArIFwiIFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoXCJcXG5cXG5cIik7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gbnVtYmVyO1xuICAgIH07XG4gICAgXG4gICAgQmluYXJ5UGFyc2VyLmlscHJpbnQgPSBmdW5jdGlvbiAocykge1xuICAgICAgICB2YXIgbnVtYmVyO1xuICAgIFxuICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgaWYgKHMuY2hhckNvZGVBdChpKSA8IDMyKSB7XG4gICAgICAgICAgICAgICAgbnVtYmVyID0gcy5jaGFyQ29kZUF0KGkpIDw9IDE1ID8gXCIwXCIgKyBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTApIDogcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDEwKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShudW1iZXIgKyBcIiBcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG51bWJlciA9IHMuY2hhckNvZGVBdChpKSA8PSAxNSA/IFwiMFwiICsgcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDEwKSA6IHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxMCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUobnVtYmVyICsgXCIgXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShcIlxcblxcblwiKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBudW1iZXI7XG4gICAgfTtcbiAgICBcbiAgICBCaW5hcnlQYXJzZXIuaGxwcmludCA9IGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHZhciBudW1iZXI7XG4gICAgICAgIFxuICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgaWYgKHMuY2hhckNvZGVBdChpKSA8IDMyKSB7XG4gICAgICAgICAgICAgICAgbnVtYmVyID0gcy5jaGFyQ29kZUF0KGkpIDw9IDE1ID8gXCIwXCIgKyBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpIDogcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDE2KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShudW1iZXIgKyBcIiBcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG51bWJlciA9IHMuY2hhckNvZGVBdChpKSA8PSAxNSA/IFwiMFwiICsgcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDE2KSA6IHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxNik7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUobnVtYmVyICsgXCIgXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShcIlxcblxcblwiKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBudW1iZXI7XG4gICAgfTtcbiAgICBcbiAgICByZXR1cm4gQmluYXJ5UGFyc2VyO1xufTsiXX0=
