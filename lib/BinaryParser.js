"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * @file BinaryParser.js - based on ({@link http://jsfromhell.com/classes/binary-parser Binary Parser}) by Jonas Raoni Soares Silva
 * @version 1.0.0
 * @ignore
 * 
 * @author Eduardo Astolfi <eastolfi91@gmail.com>
 * @copyright 2016 Eduardo Astolfi <eastolfi91@gmail.com>
 * @license MIT Licensed
 */

var Logger = require("jsw-logger"),
    BinaryParserBuffer = require("./BinaryParserBuffer");

var logger = null;

// Shorcut for String.fromCharCode
var chr = String.fromCharCode;

var maxBits = [];
for (var i = 0; i < 64; i++) {
    maxBits[i] = Math.pow(2, i);
}

/**
 * BinaryParser
 * @ignore
 * 
 * @module Cursor
 * @constructor
 * @since 0.0.1
 * 
 * @classdesc Cursor class that maps a MongoDB-like cursor
 * 
 * @param {MongoPortable} db - Additional options
 * @param {Collection} collection - The collection instance
 * @param {Object|Array|String} [selection={}] - The selection for matching documents
 * @param {Object|Array|String} [fields={}] - The fields of the document to show
 * @param {Object} [options] - Database object
 * 
 * @param {Object} [options.pkFactory=null] - Object overriding the basic "ObjectId" primary key generation.
 * 
 */

var BinaryParser = function BinaryParser(bigEndian, allowExceptions) {
    _classCallCheck(this, BinaryParser);

    logger = Logger.instance;

    this.bigEndian = bigEndian;
    this.allowExceptions = allowExceptions;
};

BinaryParser.decodeFloat = function (data, precisionBits, exponentBits) {
    var b = new BinaryParserBuffer(this.bigEndian, data);

    b.checkBuffer(precisionBits + exponentBits + 1);

    var bias = maxBits[exponentBits - 1] - 1,
        signal = b.readBits(precisionBits + exponentBits, 1),
        exponent = b.readBits(precisionBits, exponentBits),
        significand = 0,
        divisor = 2,
        curByte = b.buffer.length + (-precisionBits >> 3) - 1;

    do {
        for (var byteValue = b.buffer[++curByte], startBit = precisionBits % 8 || 8, mask = 1 << startBit; mask >>= 1; byteValue & mask && (significand += 1 / divisor), divisor *= 2) {}
    } while (precisionBits -= startBit);

    if (exponent == (bias << 1) + 1) {
        if (significand) {
            return NaN;
        } else {
            if (signal) {
                return -Infinity;
            } else {
                return +Infinity;
            }
        }
    } else {
        var _mod = 0;

        if (exponent || significand) {
            _mod = exponent ? Math.pow(2, exponent - bias) * (1 + significand) : Math.pow(2, -bias + 1) * significand;
        }

        return (1 + signal * -2) * _mod;
    }

    // return exponent == ( bias << 1 ) + 1 ? significand ? NaN : signal ? -Infinity : +Infinity : ( 1 + signal * -2 ) * ( exponent || significand ? !exponent ? Math.pow( 2, -bias + 1 ) * significand : Math.pow( 2, exponent - bias ) * ( 1 + significand ) : 0 );
};

BinaryParser.decodeInt = function (data, bits, signed, forceBigEndian) {
    var b = new BinaryParserBuffer(this.bigEndian || forceBigEndian, data),
        x = b.readBits(0, bits),
        max = maxBits[bits]; //max = Math.pow( 2, bits );

    return signed && x >= max / 2 ? x - max : x;
};

BinaryParser.encodeFloat = function (data, precisionBits, exponentBits) {
    var bias = maxBits[exponentBits - 1] - 1,
        minExp = -bias + 1,
        maxExp = bias,
        minUnnormExp = minExp - precisionBits,
        n = parseFloat(data),
        status = isNaN(n) || n == -Infinity || n == +Infinity ? n : 0,
        exp = 0,
        len = 2 * bias + 1 + precisionBits + 3,
        bin = new Array(len),
        signal = (n = status !== 0 ? 0 : n) < 0,
        intPart = Math.floor(n = Math.abs(n)),
        floatPart = n - intPart,
        lastBit,
        rounded,
        result,
        i,
        j;

    for (i = len; i; bin[--i] = 0) {}

    for (i = bias + 2; intPart && i; bin[--i] = intPart % 2, intPart = Math.floor(intPart / 2)) {}

    for (i = bias + 1; floatPart > 0 && i; (bin[++i] = ((floatPart *= 2) >= 1) - 0) && --floatPart) {}

    for (i = -1; ++i < len && !bin[i];) {}

    if (bin[(lastBit = precisionBits - 1 + (i = (exp = bias + 1 - i) >= minExp && exp <= maxExp ? i + 1 : bias + 1 - (exp = minExp - 1))) + 1]) {
        if (!(rounded = bin[lastBit])) {
            for (j = lastBit + 2; !rounded && j < len; rounded = bin[j++]) {}
        }

        for (j = lastBit + 1; rounded && --j >= 0; (bin[j] = !bin[j] - 0) && (rounded = 0)) {}
    }

    for (i = i - 2 < 0 ? -1 : i - 3; ++i < len && !bin[i];) {}

    if ((exp = bias + 1 - i) >= minExp && exp <= maxExp) {
        ++i;
    } else if (exp < minExp) {
        exp != bias + 1 - len && exp < minUnnormExp && console.warn("encodeFloat::float underflow"); // TODO logger
        i = bias + 1 - (exp = minExp - 1);
    }

    if (intPart || status !== 0) {
        console.warn(intPart ? "encodeFloat::float overflow" : "encodeFloat::" + status); // TODO logger
        exp = maxExp + 1;
        i = bias + 2;

        if (status == -Infinity) {
            signal = 1;
        } else if (isNaN(status)) {
            bin[i] = 1;
        }
    }

    for (n = Math.abs(exp + bias), j = exponentBits + 1, result = ""; --j; result = n % 2 + result, n = n >>= 1) {}

    var r = [];

    for (n = 0, j = 0, i = (result = (signal ? "1" : "0") + result + bin.slice(i, i + precisionBits).join("")).length, r = []; i; j = (j + 1) % 8) {
        n += (1 << j) * result.charAt(--i);

        if (j == 7) {
            r[r.length] = String.fromCharCode(n);
            n = 0;
        }
    }

    r[r.length] = n ? String.fromCharCode(n) : "";

    return (this.bigEndian ? r.reverse() : r).join("");
};

BinaryParser.encodeInt = function (data, bits, signed, forceBigEndian) {
    var max = maxBits[bits];

    if (data >= max || data < -(max / 2)) {
        console.warn("encodeInt::overflow"); // TODO logger
        data = 0;
    }

    if (data < 0) {
        data += max;
    }

    for (var r = []; data; r[r.length] = String.fromCharCode(data % 256), data = Math.floor(data / 256)) {}

    for (bits = -(-bits >> 3) - r.length; bits--; r[r.length] = "\0") {}

    return (this.bigEndian || forceBigEndian ? r.reverse() : r).join("");
};

BinaryParser.toSmall = function (data) {
    return this.decodeInt(data, 8, true);
};
BinaryParser.fromSmall = function (data) {
    return this.encodeInt(data, 8, true);
};
BinaryParser.toByte = function (data) {
    return this.decodeInt(data, 8, false);
};
BinaryParser.fromByte = function (data) {
    return this.encodeInt(data, 8, false);
};
BinaryParser.toShort = function (data) {
    return this.decodeInt(data, 16, true);
};
BinaryParser.fromShort = function (data) {
    return this.encodeInt(data, 16, true);
};
BinaryParser.toWord = function (data) {
    return this.decodeInt(data, 16, false);
};
BinaryParser.fromWord = function (data) {
    return this.encodeInt(data, 16, false);
};
BinaryParser.toInt = function (data) {
    return this.decodeInt(data, 32, true);
};
BinaryParser.fromInt = function (data) {
    return this.encodeInt(data, 32, true);
};
BinaryParser.toLong = function (data) {
    return this.decodeInt(data, 64, true);
};
BinaryParser.fromLong = function (data) {
    return this.encodeInt(data, 64, true);
};
BinaryParser.toDWord = function (data) {
    return this.decodeInt(data, 32, false);
};
BinaryParser.fromDWord = function (data) {
    return this.encodeInt(data, 32, false);
};
BinaryParser.toQWord = function (data) {
    return this.decodeInt(data, 64, true);
};
BinaryParser.fromQWord = function (data) {
    return this.encodeInt(data, 64, true);
};
BinaryParser.toFloat = function (data) {
    return this.decodeFloat(data, 23, 8);
};
BinaryParser.fromFloat = function (data) {
    return this.encodeFloat(data, 23, 8);
};
BinaryParser.toDouble = function (data) {
    return this.decodeFloat(data, 52, 11);
};
BinaryParser.fromDouble = function (data) {
    return this.encodeFloat(data, 52, 11);
};

// Factor out the encode so it can be shared by add_header and push_int32
BinaryParser.encode_int32 = function (number, asArray) {
    var a, b, c, d, unsigned;

    unsigned = number < 0 ? number + 0x100000000 : number;
    a = Math.floor(unsigned / 0xffffff);

    unsigned &= 0xffffff;
    b = Math.floor(unsigned / 0xffff);

    unsigned &= 0xffff;
    c = Math.floor(unsigned / 0xff);

    unsigned &= 0xff;
    d = Math.floor(unsigned);

    return asArray ? [chr(a), chr(b), chr(c), chr(d)] : chr(a) + chr(b) + chr(c) + chr(d);
};

BinaryParser.encode_int64 = function (number) {
    var a, b, c, d, e, f, g, h, unsigned;

    unsigned = number < 0 ? number + 0x10000000000000000 : number;
    a = Math.floor(unsigned / 0xffffffffffffff);

    unsigned &= 0xffffffffffffff;
    b = Math.floor(unsigned / 0xffffffffffff);

    unsigned &= 0xffffffffffff;
    c = Math.floor(unsigned / 0xffffffffff);

    unsigned &= 0xffffffffff;
    d = Math.floor(unsigned / 0xffffffff);

    unsigned &= 0xffffffff;
    e = Math.floor(unsigned / 0xffffff);

    unsigned &= 0xffffff;
    f = Math.floor(unsigned / 0xffff);

    unsigned &= 0xffff;
    g = Math.floor(unsigned / 0xff);

    unsigned &= 0xff;
    h = Math.floor(unsigned);

    return chr(a) + chr(b) + chr(c) + chr(d) + chr(e) + chr(f) + chr(g) + chr(h);
};

/**
 * UTF8 methods
 */

// Take a raw binary string and return a utf8 string
BinaryParser.decode_utf8 = function (binaryStr) {
    var len = binaryStr.length,
        decoded = '',
        i = 0,
        c = 0,
        c1 = 0,
        c2 = 0,
        c3;

    while (i < len) {
        c = binaryStr.charCodeAt(i);

        if (c < 128) {
            decoded += String.fromCharCode(c);

            i++;
        } else if (c > 191 && c < 224) {
            c2 = binaryStr.charCodeAt(i + 1);
            decoded += String.fromCharCode((c & 31) << 6 | c2 & 63);

            i += 2;
        } else {
            c2 = binaryStr.charCodeAt(i + 1);
            c3 = binaryStr.charCodeAt(i + 2);
            decoded += String.fromCharCode((c & 15) << 12 | (c2 & 63) << 6 | c3 & 63);

            i += 3;
        }
    }

    return decoded;
};

// Encode a cstring
BinaryParser.encode_cstring = function (s) {
    return unescape(encodeURIComponent(s)) + BinaryParser.fromByte(0);
};

// Take a utf8 string and return a binary string
BinaryParser.encode_utf8 = function encode_utf8(s) {
    var a = "",
        c;

    for (var n = 0, len = s.length; n < len; n++) {
        c = s.charCodeAt(n);

        if (c < 128) {
            a += String.fromCharCode(c);
        } else if (c > 127 && c < 2048) {
            a += String.fromCharCode(c >> 6 | 192);
            a += String.fromCharCode(c & 63 | 128);
        } else {
            a += String.fromCharCode(c >> 12 | 224);
            a += String.fromCharCode(c >> 6 & 63 | 128);
            a += String.fromCharCode(c & 63 | 128);
        }
    }

    return a;
};

BinaryParser.hprint = function (s) {
    var number;

    for (var i = 0, len = s.length; i < len; i++) {
        if (s.charCodeAt(i) < 32) {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

            process.stdout.write(number + " ");
        } else {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

            process.stdout.write(number + " ");
        }
    }

    process.stdout.write("\n\n");

    return number;
};

BinaryParser.ilprint = function (s) {
    var number;

    for (var i = 0, len = s.length; i < len; i++) {
        if (s.charCodeAt(i) < 32) {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(10) : s.charCodeAt(i).toString(10);

            process.stdout.write(number + " ");
        } else {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(10) : s.charCodeAt(i).toString(10);

            process.stdout.write(number + " ");
        }
    }

    process.stdout.write("\n\n");

    return number;
};

BinaryParser.hlprint = function (s) {
    var number;

    for (var i = 0, len = s.length; i < len; i++) {
        if (s.charCodeAt(i) < 32) {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

            process.stdout.write(number + " ");
        } else {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

            process.stdout.write(number + " ");
        }
    }

    process.stdout.write("\n\n");

    return number;
};

module.exports = BinaryParser;
//# sourceMappingURL=data:application/json;base64,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QmluYXJ5UGFyc2VyLmpzIC0gYmFzZWQgb24gKHtAbGluayBodHRwOi8vanNmcm9taGVsbC5jb20vY2xhc3Nlcy9iaW5hcnktcGFyc2VyIEJpbmFyeSBQYXJzZXJ9KSBieSBKb25hcyBSYW9uaSBTb2FyZXMgU2lsdmFcbiAqIEB2ZXJzaW9uIDEuMC4wXG4gKiBAaWdub3JlXG4gKiBcbiAqIEBhdXRob3IgRWR1YXJkbyBBc3RvbGZpIDxlYXN0b2xmaTkxQGdtYWlsLmNvbT5cbiAqIEBjb3B5cmlnaHQgMjAxNiBFZHVhcmRvIEFzdG9sZmkgPGVhc3RvbGZpOTFAZ21haWwuY29tPlxuICogQGxpY2Vuc2UgTUlUIExpY2Vuc2VkXG4gKi9cbiBcbnZhciBMb2dnZXIgPSByZXF1aXJlKFwianN3LWxvZ2dlclwiKSxcbiAgICBCaW5hcnlQYXJzZXJCdWZmZXIgPSByZXF1aXJlKFwiLi9CaW5hcnlQYXJzZXJCdWZmZXJcIik7XG4gICAgXG52YXIgbG9nZ2VyID0gbnVsbDtcblxuLy8gU2hvcmN1dCBmb3IgU3RyaW5nLmZyb21DaGFyQ29kZVxudmFyIGNociA9IFN0cmluZy5mcm9tQ2hhckNvZGU7XG5cbnZhciBtYXhCaXRzID0gW107XG5mb3IgKHZhciBpID0gMDsgaSA8IDY0OyBpKyspIHtcbiAgICBtYXhCaXRzW2ldID0gTWF0aC5wb3coMiwgaSk7XG59XG5cbi8qKlxuICogQmluYXJ5UGFyc2VyXG4gKiBAaWdub3JlXG4gKiBcbiAqIEBtb2R1bGUgQ3Vyc29yXG4gKiBAY29uc3RydWN0b3JcbiAqIEBzaW5jZSAwLjAuMVxuICogXG4gKiBAY2xhc3NkZXNjIEN1cnNvciBjbGFzcyB0aGF0IG1hcHMgYSBNb25nb0RCLWxpa2UgY3Vyc29yXG4gKiBcbiAqIEBwYXJhbSB7TW9uZ29Qb3J0YWJsZX0gZGIgLSBBZGRpdGlvbmFsIG9wdGlvbnNcbiAqIEBwYXJhbSB7Q29sbGVjdGlvbn0gY29sbGVjdGlvbiAtIFRoZSBjb2xsZWN0aW9uIGluc3RhbmNlXG4gKiBAcGFyYW0ge09iamVjdHxBcnJheXxTdHJpbmd9IFtzZWxlY3Rpb249e31dIC0gVGhlIHNlbGVjdGlvbiBmb3IgbWF0Y2hpbmcgZG9jdW1lbnRzXG4gKiBAcGFyYW0ge09iamVjdHxBcnJheXxTdHJpbmd9IFtmaWVsZHM9e31dIC0gVGhlIGZpZWxkcyBvZiB0aGUgZG9jdW1lbnQgdG8gc2hvd1xuICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAtIERhdGFiYXNlIG9iamVjdFxuICogXG4gKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnMucGtGYWN0b3J5PW51bGxdIC0gT2JqZWN0IG92ZXJyaWRpbmcgdGhlIGJhc2ljIFwiT2JqZWN0SWRcIiBwcmltYXJ5IGtleSBnZW5lcmF0aW9uLlxuICogXG4gKi9cbmNsYXNzIEJpbmFyeVBhcnNlciB7XG4gICAgY29uc3RydWN0b3IoYmlnRW5kaWFuLCBhbGxvd0V4Y2VwdGlvbnMpIHtcbiAgICAgICAgbG9nZ2VyID0gTG9nZ2VyLmluc3RhbmNlO1xuICAgIFxuICAgICAgICB0aGlzLmJpZ0VuZGlhbiA9IGJpZ0VuZGlhbjtcbiAgICAgICAgdGhpcy5hbGxvd0V4Y2VwdGlvbnMgPSBhbGxvd0V4Y2VwdGlvbnM7XG4gICAgfVxuICAgIFxuICAgIFxufVxuXG5CaW5hcnlQYXJzZXIuZGVjb2RlRmxvYXQgPSBmdW5jdGlvbiAoZGF0YSwgcHJlY2lzaW9uQml0cywgZXhwb25lbnRCaXRzKSB7XG4gICAgdmFyIGIgPSBuZXcgQmluYXJ5UGFyc2VyQnVmZmVyKHRoaXMuYmlnRW5kaWFuLCBkYXRhKTtcblxuICAgIGIuY2hlY2tCdWZmZXIocHJlY2lzaW9uQml0cyArIGV4cG9uZW50Qml0cyArIDEpO1xuXG4gICAgdmFyIGJpYXMgPSBtYXhCaXRzW2V4cG9uZW50Qml0cyAtIDFdIC0gMSxcbiAgICAgICAgc2lnbmFsID0gYi5yZWFkQml0cyhwcmVjaXNpb25CaXRzICsgZXhwb25lbnRCaXRzLCAxKSxcbiAgICAgICAgZXhwb25lbnQgPSBiLnJlYWRCaXRzKHByZWNpc2lvbkJpdHMsIGV4cG9uZW50Qml0cyksXG4gICAgICAgIHNpZ25pZmljYW5kID0gMCxcbiAgICAgICAgZGl2aXNvciA9IDIsXG4gICAgICAgIGN1ckJ5dGUgPSBiLmJ1ZmZlci5sZW5ndGggKyAoLXByZWNpc2lvbkJpdHMgPj4gMykgLSAxO1xuXG4gICAgZG8ge1xuICAgICAgICBmb3IgKFxuICAgICAgICAgICAgdmFyIGJ5dGVWYWx1ZSA9IGIuYnVmZmVyWyArK2N1ckJ5dGUgXSwgc3RhcnRCaXQgPSBwcmVjaXNpb25CaXRzICUgOCB8fCA4LCBtYXNrID0gMSA8PCBzdGFydEJpdDtcbiAgICAgICAgICAgIG1hc2sgPj49IDE7IFxuICAgICAgICAgICAgKCBieXRlVmFsdWUgJiBtYXNrICkgJiYgKCBzaWduaWZpY2FuZCArPSAxIC8gZGl2aXNvciApLCBkaXZpc29yICo9IDIgXG4gICAgICAgICk7XG4gICAgfSB3aGlsZSAocHJlY2lzaW9uQml0cyAtPSBzdGFydEJpdCk7XG4gICAgXG4gICAgXG5cbiAgICBpZiAoIGV4cG9uZW50ID09ICggYmlhcyA8PCAxICkgKyAxICkge1xuICAgIFx0aWYgKHNpZ25pZmljYW5kKSB7XG4gICAgXHRcdHJldHVybiBOYU47XG4gICAgXHR9IGVsc2Uge1xuICAgIFx0XHRpZiAoc2lnbmFsKSB7XG4gICAgXHRcdFx0cmV0dXJuIC1JbmZpbml0eTtcbiAgICBcdFx0fSBlbHNlIHtcbiAgICBcdFx0XHRyZXR1cm4gK0luZmluaXR5O1xuICAgIFx0XHR9XG4gICAgXHR9XG4gICAgfSBlbHNlIHtcbiAgICBcdHZhciBfbW9kID0gMDtcbiAgICBcdFxuICAgIFx0aWYgKGV4cG9uZW50IHx8IHNpZ25pZmljYW5kKSB7XG4gICAgXHQgICAgX21vZCA9IGV4cG9uZW50ID8gTWF0aC5wb3coIDIsIGV4cG9uZW50IC0gYmlhcyApICogKCAxICsgc2lnbmlmaWNhbmQgKSA6IE1hdGgucG93KCAyLCAtYmlhcyArIDEgKSAqIHNpZ25pZmljYW5kO1xuICAgIFx0fVxuICAgIFx0XG4gICAgXHRyZXR1cm4gKCAxICsgc2lnbmFsICogLTIgKSAqIChfbW9kKTtcbiAgICB9XG5cblxuICAgIC8vIHJldHVybiBleHBvbmVudCA9PSAoIGJpYXMgPDwgMSApICsgMSA/IHNpZ25pZmljYW5kID8gTmFOIDogc2lnbmFsID8gLUluZmluaXR5IDogK0luZmluaXR5IDogKCAxICsgc2lnbmFsICogLTIgKSAqICggZXhwb25lbnQgfHwgc2lnbmlmaWNhbmQgPyAhZXhwb25lbnQgPyBNYXRoLnBvdyggMiwgLWJpYXMgKyAxICkgKiBzaWduaWZpY2FuZCA6IE1hdGgucG93KCAyLCBleHBvbmVudCAtIGJpYXMgKSAqICggMSArIHNpZ25pZmljYW5kICkgOiAwICk7XG59O1xuXG5CaW5hcnlQYXJzZXIuZGVjb2RlSW50ID0gZnVuY3Rpb24gKGRhdGEsIGJpdHMsIHNpZ25lZCwgZm9yY2VCaWdFbmRpYW4pIHtcbiAgICB2YXIgYiA9IG5ldyBCaW5hcnlQYXJzZXJCdWZmZXIodGhpcy5iaWdFbmRpYW4gfHwgZm9yY2VCaWdFbmRpYW4sIGRhdGEpLFxuICAgICAgICB4ID0gYi5yZWFkQml0cygwLCBiaXRzKSxcbiAgICAgICAgbWF4ID0gbWF4Qml0c1tiaXRzXTsgLy9tYXggPSBNYXRoLnBvdyggMiwgYml0cyApO1xuXG4gICAgcmV0dXJuIHNpZ25lZCAmJiB4ID49IG1heCAvIDIgPyB4IC0gbWF4IDogeDtcbn07XG5cbkJpbmFyeVBhcnNlci5lbmNvZGVGbG9hdCA9IGZ1bmN0aW9uIChkYXRhLCBwcmVjaXNpb25CaXRzLCBleHBvbmVudEJpdHMpIHtcbiAgICB2YXIgYmlhcyA9IG1heEJpdHNbZXhwb25lbnRCaXRzIC0gMV0gLSAxLFxuICAgICAgICBtaW5FeHAgPSAtYmlhcyArIDEsXG4gICAgICAgIG1heEV4cCA9IGJpYXMsXG4gICAgICAgIG1pblVubm9ybUV4cCA9IG1pbkV4cCAtIHByZWNpc2lvbkJpdHMsXG4gICAgICAgIG4gPSBwYXJzZUZsb2F0KGRhdGEpLFxuICAgICAgICBzdGF0dXMgPSBpc05hTihuKSB8fCBuID09IC1JbmZpbml0eSB8fCBuID09ICtJbmZpbml0eSA/IG4gOiAwLFxuICAgICAgICBleHAgPSAwLFxuICAgICAgICBsZW4gPSAyICogYmlhcyArIDEgKyBwcmVjaXNpb25CaXRzICsgMyxcbiAgICAgICAgYmluID0gbmV3IEFycmF5KGxlbiksXG4gICAgICAgIHNpZ25hbCA9IChuID0gc3RhdHVzICE9PSAwID8gMCA6IG4pIDwgMCxcbiAgICAgICAgaW50UGFydCA9IE1hdGguZmxvb3IobiA9IE1hdGguYWJzKG4pKSxcbiAgICAgICAgZmxvYXRQYXJ0ID0gbiAtIGludFBhcnQsXG4gICAgICAgIGxhc3RCaXQsXG4gICAgICAgIHJvdW5kZWQsXG4gICAgICAgIHJlc3VsdCxcbiAgICAgICAgaSxcbiAgICAgICAgajtcblxuXG4gICAgZm9yIChpID0gbGVuOyBpOyBiaW5bLS1pXSA9IDApO1xuICAgIFxuICAgIGZvciAoaSA9IGJpYXMgKyAyOyBpbnRQYXJ0ICYmIGk7IGJpblstLWldID0gaW50UGFydCAlIDIsIGludFBhcnQgPSBNYXRoLmZsb29yKGludFBhcnQgLyAyKSk7XG4gICAgXG4gICAgZm9yIChpID0gYmlhcyArIDE7IGZsb2F0UGFydCA+IDAgJiYgaTsgKGJpblsrK2ldID0gKChmbG9hdFBhcnQgKj0gMikgPj0gMSkgLSAwICkgJiYgLS1mbG9hdFBhcnQpO1xuICAgIFxuICAgIGZvciAoaSA9IC0xOyArK2kgPCBsZW4gJiYgIWJpbltpXTspO1xuICBcbiAgICBpZiAoYmluWyhsYXN0Qml0ID0gcHJlY2lzaW9uQml0cyAtIDEgKyAoaSA9IChleHAgPSBiaWFzICsgMSAtIGkpID49IG1pbkV4cCAmJiBleHAgPD0gbWF4RXhwID8gaSArIDEgOiBiaWFzICsgMSAtIChleHAgPSBtaW5FeHAgLSAxKSkpICsgMV0pIHtcbiAgICAgICAgaWYgKCEocm91bmRlZCA9IGJpbltsYXN0Qml0XSkpIHtcbiAgICAgICAgICAgIGZvciAoaiA9IGxhc3RCaXQgKyAyOyAhcm91bmRlZCAmJiBqIDwgbGVuOyByb3VuZGVkID0gYmluW2orK10pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBmb3IgKGogPSBsYXN0Qml0ICsgMTsgcm91bmRlZCAmJiAtLWogPj0gMDsgKGJpbltqXSA9ICFiaW5bal0gLSAwKSAmJiAocm91bmRlZCA9IDApKTtcbiAgICB9XG4gIFxuICAgIGZvciAoaSA9IGkgLSAyIDwgMCA/IC0xIDogaSAtIDM7ICsraSA8IGxlbiAmJiAhYmluW2ldOyk7XG4gICAgXG4gICAgaWYgKChleHAgPSBiaWFzICsgMSAtIGkpID49IG1pbkV4cCAmJiBleHAgPD0gbWF4RXhwKSB7XG4gICAgICAgICsraTtcbiAgICB9IGVsc2UgaWYgKGV4cCA8IG1pbkV4cCkge1xuICAgICAgICBleHAgIT0gYmlhcyArIDEgLSBsZW4gJiYgZXhwIDwgbWluVW5ub3JtRXhwICYmIGNvbnNvbGUud2FybihcImVuY29kZUZsb2F0OjpmbG9hdCB1bmRlcmZsb3dcIik7ICAgIC8vIFRPRE8gbG9nZ2VyXG4gICAgICAgIGkgPSBiaWFzICsgMSAtIChleHAgPSBtaW5FeHAgLSAxKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKGludFBhcnQgfHwgc3RhdHVzICE9PSAwKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihpbnRQYXJ0ID8gXCJlbmNvZGVGbG9hdDo6ZmxvYXQgb3ZlcmZsb3dcIiA6IFwiZW5jb2RlRmxvYXQ6OlwiICsgc3RhdHVzKTsgICAgLy8gVE9ETyBsb2dnZXJcbiAgICAgICAgZXhwID0gbWF4RXhwICsgMTtcbiAgICAgICAgaSA9IGJpYXMgKyAyO1xuICAgIFxuICAgICAgICBpZiAoc3RhdHVzID09IC1JbmZpbml0eSkge1xuICAgICAgICAgICAgc2lnbmFsID0gMTtcbiAgICAgICAgfSBlbHNlIGlmIChpc05hTihzdGF0dXMpKSB7XG4gICAgICAgICAgICBiaW5baV0gPSAxO1xuICAgICAgICB9XG4gICAgfVxuICBcbiAgICBmb3IgKG4gPSBNYXRoLmFicyhleHAgKyBiaWFzKSwgaiA9IGV4cG9uZW50Qml0cyArIDEsIHJlc3VsdCA9IFwiXCI7IC0tajsgcmVzdWx0ID0gKG4gJSAyKSArIHJlc3VsdCwgbiA9IG4gPj49IDEpO1xuICAgIFxuICAgIGxldCByID0gW107XG4gICAgXG4gICAgZm9yIChuID0gMCwgaiA9IDAsIGkgPSAocmVzdWx0ID0gKHNpZ25hbCA/IFwiMVwiIDogXCIwXCIpICsgcmVzdWx0ICsgYmluLnNsaWNlKGksIGkgKyBwcmVjaXNpb25CaXRzKS5qb2luKFwiXCIpKS5sZW5ndGgsIHIgPSBbXTsgaTsgaiA9IChqICsgMSkgJSA4KSB7XG4gICAgICAgIG4gKz0gKDEgPDwgaikgKiByZXN1bHQuY2hhckF0KC0taSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoaiA9PSA3KSB7XG4gICAgICAgICAgICByW3IubGVuZ3RoXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUobik7XG4gICAgICAgICAgICBuID0gMDtcbiAgICAgICAgfVxuICAgIH1cbiAgXG4gICAgcltyLmxlbmd0aF0gPSBuID8gU3RyaW5nLmZyb21DaGFyQ29kZShuKSA6IFwiXCI7XG4gIFxuICAgIHJldHVybiAodGhpcy5iaWdFbmRpYW4gPyByLnJldmVyc2UoKSA6IHIpLmpvaW4oXCJcIik7XG59O1xuXG5CaW5hcnlQYXJzZXIuZW5jb2RlSW50ID0gZnVuY3Rpb24gKGRhdGEsIGJpdHMsIHNpZ25lZCwgZm9yY2VCaWdFbmRpYW4pIHtcbiAgICB2YXIgbWF4ID0gbWF4Qml0c1tiaXRzXTtcbiAgICBcbiAgICBpZiAoZGF0YSA+PSBtYXggfHwgZGF0YSA8IC0obWF4IC8gMikpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwiZW5jb2RlSW50OjpvdmVyZmxvd1wiKTsgICAgLy8gVE9ETyBsb2dnZXJcbiAgICAgICAgZGF0YSA9IDA7XG4gICAgfVxuICAgIFxuICAgIGlmIChkYXRhIDwgMCkge1xuICAgICAgICBkYXRhICs9IG1heDtcbiAgICB9XG4gICAgXG4gICAgZm9yICh2YXIgciA9IFtdOyBkYXRhOyByW3IubGVuZ3RoXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoZGF0YSAlIDI1NiksIGRhdGEgPSBNYXRoLmZsb29yKGRhdGEgLyAyNTYpKTtcbiAgICBcbiAgICBmb3IgKGJpdHMgPSAtKC1iaXRzID4+IDMpIC0gci5sZW5ndGg7IGJpdHMtLTsgcltyLmxlbmd0aF0gPSBcIlxcMFwiKTtcbiAgICBcbiAgICByZXR1cm4gKCh0aGlzLmJpZ0VuZGlhbiB8fCBmb3JjZUJpZ0VuZGlhbikgPyByLnJldmVyc2UoKSA6IHIpLmpvaW4oXCJcIik7XG59O1xuXG5CaW5hcnlQYXJzZXIudG9TbWFsbCAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgIDgsIHRydWUgICk7IH07XG5CaW5hcnlQYXJzZXIuZnJvbVNtYWxsICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgIDgsIHRydWUgICk7IH07XG5CaW5hcnlQYXJzZXIudG9CeXRlICAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgIDgsIGZhbHNlICk7IH07XG5CaW5hcnlQYXJzZXIuZnJvbUJ5dGUgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgIDgsIGZhbHNlICk7IH07XG5CaW5hcnlQYXJzZXIudG9TaG9ydCAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgMTYsIHRydWUgICk7IH07XG5CaW5hcnlQYXJzZXIuZnJvbVNob3J0ICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgMTYsIHRydWUgICk7IH07XG5CaW5hcnlQYXJzZXIudG9Xb3JkICAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgMTYsIGZhbHNlICk7IH07XG5CaW5hcnlQYXJzZXIuZnJvbVdvcmQgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgMTYsIGZhbHNlICk7IH07XG5CaW5hcnlQYXJzZXIudG9JbnQgICAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgMzIsIHRydWUgICk7IH07XG5CaW5hcnlQYXJzZXIuZnJvbUludCAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgMzIsIHRydWUgICk7IH07XG5CaW5hcnlQYXJzZXIudG9Mb25nICAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgNjQsIHRydWUgICk7IH07XG5CaW5hcnlQYXJzZXIuZnJvbUxvbmcgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgNjQsIHRydWUgICk7IH07XG5CaW5hcnlQYXJzZXIudG9EV29yZCAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgMzIsIGZhbHNlICk7IH07XG5CaW5hcnlQYXJzZXIuZnJvbURXb3JkICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgMzIsIGZhbHNlICk7IH07XG5CaW5hcnlQYXJzZXIudG9RV29yZCAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgNjQsIHRydWUgKTsgfTtcbkJpbmFyeVBhcnNlci5mcm9tUVdvcmQgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlSW50KCBkYXRhLCA2NCwgdHJ1ZSApOyB9O1xuQmluYXJ5UGFyc2VyLnRvRmxvYXQgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVGbG9hdCggZGF0YSwgMjMsIDggICApOyB9O1xuQmluYXJ5UGFyc2VyLmZyb21GbG9hdCAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVGbG9hdCggZGF0YSwgMjMsIDggICApOyB9O1xuQmluYXJ5UGFyc2VyLnRvRG91YmxlICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVGbG9hdCggZGF0YSwgNTIsIDExICApOyB9O1xuQmluYXJ5UGFyc2VyLmZyb21Eb3VibGUgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVGbG9hdCggZGF0YSwgNTIsIDExICApOyB9O1xuXG4vLyBGYWN0b3Igb3V0IHRoZSBlbmNvZGUgc28gaXQgY2FuIGJlIHNoYXJlZCBieSBhZGRfaGVhZGVyIGFuZCBwdXNoX2ludDMyXG5CaW5hcnlQYXJzZXIuZW5jb2RlX2ludDMyID0gZnVuY3Rpb24gKG51bWJlciwgYXNBcnJheSkge1xuICAgIHZhciBhLCBiLCBjLCBkLCB1bnNpZ25lZDtcbiAgICBcbiAgICB1bnNpZ25lZCA9IChudW1iZXIgPCAwKSA/IChudW1iZXIgKyAweDEwMDAwMDAwMCkgOiBudW1iZXI7XG4gICAgYSA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmZmZik7XG4gICAgXG4gICAgdW5zaWduZWQgJj0gMHhmZmZmZmY7XG4gICAgYiA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmYpO1xuICAgIFxuICAgIHVuc2lnbmVkICY9IDB4ZmZmZjtcbiAgICBjID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmYpO1xuICAgIFxuICAgIHVuc2lnbmVkICY9IDB4ZmY7XG4gICAgZCA9IE1hdGguZmxvb3IodW5zaWduZWQpO1xuICAgIFxuICAgIHJldHVybiBhc0FycmF5ID8gW2NocihhKSwgY2hyKGIpLCBjaHIoYyksIGNocihkKV0gOiBjaHIoYSkgKyBjaHIoYikgKyBjaHIoYykgKyBjaHIoZCk7XG59O1xuXG5CaW5hcnlQYXJzZXIuZW5jb2RlX2ludDY0ID0gZnVuY3Rpb24gKG51bWJlcikge1xuICAgIHZhciBhLCBiLCBjLCBkLCBlLCBmLCBnLCBoLCB1bnNpZ25lZDtcbiAgICBcbiAgICB1bnNpZ25lZCA9IChudW1iZXIgPCAwKSA/IChudW1iZXIgKyAweDEwMDAwMDAwMDAwMDAwMDAwKSA6IG51bWJlcjtcbiAgICBhID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmZmZmZmZmZmZmZmZmYpO1xuICAgIFxuICAgIHVuc2lnbmVkICY9IDB4ZmZmZmZmZmZmZmZmZmY7XG4gICAgYiA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmZmZmZmZmZmZik7XG4gICAgXG4gICAgdW5zaWduZWQgJj0gMHhmZmZmZmZmZmZmZmY7XG4gICAgYyA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmZmZmZmZmYpO1xuICAgIFxuICAgIHVuc2lnbmVkICY9IDB4ZmZmZmZmZmZmZjtcbiAgICBkID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmZmZmZmZmYpO1xuICAgIFxuICAgIHVuc2lnbmVkICY9IDB4ZmZmZmZmZmY7XG4gICAgZSA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmZmZik7XG4gICAgXG4gICAgdW5zaWduZWQgJj0gMHhmZmZmZmY7XG4gICAgZiA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmYpO1xuICAgIFxuICAgIHVuc2lnbmVkICY9IDB4ZmZmZjtcbiAgICBnID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmYpO1xuICAgIFxuICAgIHVuc2lnbmVkICY9IDB4ZmY7XG4gICAgaCA9IE1hdGguZmxvb3IodW5zaWduZWQpO1xuICAgIFxuICAgIHJldHVybiBjaHIoYSkgKyBjaHIoYikgKyBjaHIoYykgKyBjaHIoZCkgKyBjaHIoZSkgKyBjaHIoZikgKyBjaHIoZykgKyBjaHIoaCk7XG59O1xuXG4vKipcbiAqIFVURjggbWV0aG9kc1xuICovXG5cbi8vIFRha2UgYSByYXcgYmluYXJ5IHN0cmluZyBhbmQgcmV0dXJuIGEgdXRmOCBzdHJpbmdcbkJpbmFyeVBhcnNlci5kZWNvZGVfdXRmOCA9IGZ1bmN0aW9uIChiaW5hcnlTdHIpIHtcbiAgICB2YXIgbGVuID0gYmluYXJ5U3RyLmxlbmd0aCxcbiAgICAgICAgZGVjb2RlZCA9ICcnLFxuICAgICAgICBpID0gMCxcbiAgICAgICAgYyA9IDAsXG4gICAgICAgIGMxID0gMCxcbiAgICAgICAgYzIgPSAwLFxuICAgICAgICBjMztcbiAgICBcbiAgICB3aGlsZSAoaSA8IGxlbikge1xuICAgICAgICBjID0gYmluYXJ5U3RyLmNoYXJDb2RlQXQoaSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoYyA8IDEyOCkge1xuICAgICAgICAgICAgZGVjb2RlZCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGMpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpKys7XG4gICAgICAgIH0gZWxzZSBpZiAoKGMgPiAxOTEpICYmIChjIDwgMjI0KSkge1xuICAgICAgICAgICAgYzIgPSBiaW5hcnlTdHIuY2hhckNvZGVBdChpKzEpO1xuICAgICAgICAgICAgZGVjb2RlZCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYyAmIDMxKSA8PCA2KSB8IChjMiAmIDYzKSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGkgKz0gMjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGMyID0gYmluYXJ5U3RyLmNoYXJDb2RlQXQoaSsxKTtcbiAgICAgICAgICAgIGMzID0gYmluYXJ5U3RyLmNoYXJDb2RlQXQoaSsyKTtcbiAgICAgICAgICAgIGRlY29kZWQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgJiAxNSkgPDwgMTIpIHwgKChjMiAmIDYzKSA8PCA2KSB8IChjMyAmIDYzKSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGkgKz0gMztcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZGVjb2RlZDtcbn07XG5cbi8vIEVuY29kZSBhIGNzdHJpbmdcbkJpbmFyeVBhcnNlci5lbmNvZGVfY3N0cmluZyA9IGZ1bmN0aW9uIChzKSB7XG4gICAgcmV0dXJuIHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChzKSkgKyBCaW5hcnlQYXJzZXIuZnJvbUJ5dGUoMCk7XG59O1xuXG4vLyBUYWtlIGEgdXRmOCBzdHJpbmcgYW5kIHJldHVybiBhIGJpbmFyeSBzdHJpbmdcbkJpbmFyeVBhcnNlci5lbmNvZGVfdXRmOCA9IGZ1bmN0aW9uIGVuY29kZV91dGY4IChzKSB7XG4gICAgdmFyIGEgPSBcIlwiLFxuICAgICAgICBjO1xuXG4gICAgZm9yICh2YXIgbiA9IDAsIGxlbiA9IHMubGVuZ3RoOyBuIDwgbGVuOyBuKyspIHtcbiAgICAgICAgYyA9IHMuY2hhckNvZGVBdChuKTtcblxuICAgICAgICBpZiAoYyA8IDEyOCkge1xuICAgICAgICAgICAgYSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGMpO1xuICAgICAgICB9IGVsc2UgaWYgKChjID4gMTI3KSAmJiAoYyA8IDIwNDgpKSB7XG4gICAgICAgICAgICBhICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGM+PjYpIHwgMTkyKSA7XG4gICAgICAgICAgICBhICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGMmNjMpIHwgMTI4KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGEgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYz4+MTIpIHwgMjI0KTtcbiAgICAgICAgICAgIGEgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGM+PjYpICYgNjMpIHwgMTI4KTtcbiAgICAgICAgICAgIGEgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyY2MykgfCAxMjgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGE7XG59O1xuXG5CaW5hcnlQYXJzZXIuaHByaW50ID0gZnVuY3Rpb24gKHMpIHtcbiAgICB2YXIgbnVtYmVyO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgaWYgKHMuY2hhckNvZGVBdChpKSA8IDMyKSB7XG4gICAgICAgICAgICBudW1iZXIgPSBzLmNoYXJDb2RlQXQoaSkgPD0gMTUgPyBcIjBcIiArIHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxNikgOiBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShudW1iZXIgKyBcIiBcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBudW1iZXIgPSBzLmNoYXJDb2RlQXQoaSkgPD0gMTUgPyBcIjBcIiArIHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxNikgOiBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShudW1iZXIgKyBcIiBcIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoXCJcXG5cXG5cIik7XG4gICAgXG4gICAgcmV0dXJuIG51bWJlcjtcbn07XG5cbkJpbmFyeVBhcnNlci5pbHByaW50ID0gZnVuY3Rpb24gKHMpIHtcbiAgICB2YXIgbnVtYmVyO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgaWYgKHMuY2hhckNvZGVBdChpKSA8IDMyKSB7XG4gICAgICAgICAgICBudW1iZXIgPSBzLmNoYXJDb2RlQXQoaSkgPD0gMTUgPyBcIjBcIiArIHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxMCkgOiBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShudW1iZXIgKyBcIiBcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBudW1iZXIgPSBzLmNoYXJDb2RlQXQoaSkgPD0gMTUgPyBcIjBcIiArIHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxMCkgOiBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShudW1iZXIgKyBcIiBcIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoXCJcXG5cXG5cIik7XG4gICAgXG4gICAgcmV0dXJuIG51bWJlcjtcbn07XG5cbkJpbmFyeVBhcnNlci5obHByaW50ID0gZnVuY3Rpb24gKHMpIHtcbiAgICB2YXIgbnVtYmVyO1xuICAgIFxuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIGlmIChzLmNoYXJDb2RlQXQoaSkgPCAzMikge1xuICAgICAgICAgICAgbnVtYmVyID0gcy5jaGFyQ29kZUF0KGkpIDw9IDE1ID8gXCIwXCIgKyBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpIDogcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDE2KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUobnVtYmVyICsgXCIgXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbnVtYmVyID0gcy5jaGFyQ29kZUF0KGkpIDw9IDE1ID8gXCIwXCIgKyBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpIDogcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDE2KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUobnVtYmVyICsgXCIgXCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKFwiXFxuXFxuXCIpO1xuICAgIFxuICAgIHJldHVybiBudW1iZXI7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJpbmFyeVBhcnNlcjsiXX0=
