"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * @file BinaryParser.js - based on ({@link http://jsfromhell.com/classes/binary-parser Binary Parser}) by Jonas Raoni Soares Silva
 * @version 1.0.0
 * @ignore
 * 
 * @author Eduardo Astolfi <eduardo.astolfi91@gmail.com>
 * @copyright 2016 Eduardo Astolfi <eduardo.astolfi91@gmail.com>
 * @license MIT Licensed
 */

var Logger = require("./utils/Logger"),
    BinaryParserBuffer = require("./BinaryParserBuffer");

var logger = null;

// Shorcut for String.fromCharCode
var chr = String.fromCharCode;

var maxBits = [];
for (var i = 0; i < 64; i++) {
    maxBits[i] = Math.pow(2, i);
}

/**
 * BinaryParser
 * @ignore
 * 
 * @module Cursor
 * @constructor
 * @since 0.0.1
 * 
 * @classdesc Cursor class that maps a MongoDB-like cursor
 * 
 * @param {MongoPortable} db - Additional options
 * @param {Collection} collection - The collection instance
 * @param {Object|Array|String} [selection={}] - The selection for matching documents
 * @param {Object|Array|String} [fields={}] - The fields of the document to show
 * @param {Object} [options] - Database object
 * 
 * @param {Object} [options.pkFactory=null] - Object overriding the basic "ObjectId" primary key generation.
 * 
 */

var BinaryParser = function BinaryParser(bigEndian, allowExceptions) {
    _classCallCheck(this, BinaryParser);

    logger = Logger.instance;

    this.bigEndian = bigEndian;
    this.allowExceptions = allowExceptions;
};

BinaryParser.warn = function (msg) {
    if (this.allowExceptions) {
        throw new Error(msg);
    }

    return 1;
};

BinaryParser.decodeFloat = function (data, precisionBits, exponentBits) {
    var b = new BinaryParserBuffer(this.bigEndian, data);

    b.checkBuffer(precisionBits + exponentBits + 1);

    var bias = maxBits[exponentBits - 1] - 1,
        signal = b.readBits(precisionBits + exponentBits, 1),
        exponent = b.readBits(precisionBits, exponentBits),
        significand = 0,
        divisor = 2,
        curByte = b.buffer.length + (-precisionBits >> 3) - 1;

    do {
        for (var byteValue = b.buffer[++curByte], startBit = precisionBits % 8 || 8, mask = 1 << startBit; mask >>= 1; byteValue & mask && (significand += 1 / divisor), divisor *= 2) {}
    } while (precisionBits -= startBit);

    if (exponent == (bias << 1) + 1) {
        if (significand) {
            return NaN;
        } else {
            if (signal) {
                return -Infinity;
            } else {
                return +Infinity;
            }
        }
    } else {
        var _mod = 0;

        if (exponent || significand) {
            if (!exponent) {
                _mod = Math.pow(2, -bias + 1) * significand;
            } else {
                _mod = Math.pow(2, exponent - bias) * (1 + significand);
            }
        }

        return (1 + signal * -2) * _mod;
    }

    // return exponent == ( bias << 1 ) + 1 ? significand ? NaN : signal ? -Infinity : +Infinity : ( 1 + signal * -2 ) * ( exponent || significand ? !exponent ? Math.pow( 2, -bias + 1 ) * significand : Math.pow( 2, exponent - bias ) * ( 1 + significand ) : 0 );
};

BinaryParser.decodeInt = function (data, bits, signed, forceBigEndian) {
    var b = new BinaryParserBuffer(this.bigEndian || forceBigEndian, data),
        x = b.readBits(0, bits),
        max = maxBits[bits]; //max = Math.pow( 2, bits );

    return signed && x >= max / 2 ? x - max : x;
};

BinaryParser.encodeFloat = function (data, precisionBits, exponentBits) {
    var bias = maxBits[exponentBits - 1] - 1,
        minExp = -bias + 1,
        maxExp = bias,
        minUnnormExp = minExp - precisionBits,
        n = parseFloat(data),
        status = isNaN(n) || n == -Infinity || n == +Infinity ? n : 0,
        exp = 0,
        len = 2 * bias + 1 + precisionBits + 3,
        bin = new Array(len),
        signal = (n = status !== 0 ? 0 : n) < 0,
        intPart = Math.floor(n = Math.abs(n)),
        floatPart = n - intPart,
        lastBit,
        rounded,
        result,
        i,
        j;

    // DAFUCK?

    for (i = len; i; bin[--i] = 0) {}

    for (i = bias + 2; intPart && i; bin[--i] = intPart % 2, intPart = Math.floor(intPart / 2)) {}

    for (i = bias + 1; floatPart > 0 && i; (bin[++i] = ((floatPart *= 2) >= 1) - 0) && --floatPart) {}

    for (i = -1; ++i < len && !bin[i];) {}

    if (bin[(lastBit = precisionBits - 1 + (i = (exp = bias + 1 - i) >= minExp && exp <= maxExp ? i + 1 : bias + 1 - (exp = minExp - 1))) + 1]) {
        if (!(rounded = bin[lastBit])) {
            for (j = lastBit + 2; !rounded && j < len; rounded = bin[j++]) {}
        }

        for (j = lastBit + 1; rounded && --j >= 0; (bin[j] = !bin[j] - 0) && (rounded = 0)) {}
    }

    for (i = i - 2 < 0 ? -1 : i - 3; ++i < len && !bin[i];) {}

    if ((exp = bias + 1 - i) >= minExp && exp <= maxExp) {
        ++i;
    } else if (exp < minExp) {
        exp != bias + 1 - len && exp < minUnnormExp && this.warn("encodeFloat::float underflow");
        i = bias + 1 - (exp = minExp - 1);
    }

    if (intPart || status !== 0) {
        this.warn(intPart ? "encodeFloat::float overflow" : "encodeFloat::" + status);
        exp = maxExp + 1;
        i = bias + 2;

        if (status == -Infinity) {
            signal = 1;
        } else if (isNaN(status)) {
            bin[i] = 1;
        }
    }

    for (n = Math.abs(exp + bias), j = exponentBits + 1, result = ""; --j; result = n % 2 + result, n = n >>= 1) {}

    for (n = 0, j = 0, i = (result = (signal ? "1" : "0") + result + bin.slice(i, i + precisionBits).join("")).length, r = []; i; j = (j + 1) % 8) {
        n += (1 << j) * result.charAt(--i);

        if (j == 7) {
            r[r.length] = String.fromCharCode(n);
            n = 0;
        }
    }

    r[r.length] = n ? String.fromCharCode(n) : "";

    return (this.bigEndian ? r.reverse() : r).join("");
};

BinaryParser.encodeInt = function (data, bits, signed, forceBigEndian) {
    var max = maxBits[bits];

    if (data >= max || data < -(max / 2)) {
        this.warn("encodeInt::overflow");
        data = 0;
    }

    if (data < 0) {
        data += max;
    }

    for (var r = []; data; r[r.length] = String.fromCharCode(data % 256), data = Math.floor(data / 256)) {}

    for (bits = -(-bits >> 3) - r.length; bits--; r[r.length] = "\0") {}

    return (this.bigEndian || forceBigEndian ? r.reverse() : r).join("");
};

BinaryParser.toSmall = function (data) {
    return this.decodeInt(data, 8, true);
};
BinaryParser.fromSmall = function (data) {
    return this.encodeInt(data, 8, true);
};
BinaryParser.toByte = function (data) {
    return this.decodeInt(data, 8, false);
};
BinaryParser.fromByte = function (data) {
    return this.encodeInt(data, 8, false);
};
BinaryParser.toShort = function (data) {
    return this.decodeInt(data, 16, true);
};
BinaryParser.fromShort = function (data) {
    return this.encodeInt(data, 16, true);
};
BinaryParser.toWord = function (data) {
    return this.decodeInt(data, 16, false);
};
BinaryParser.fromWord = function (data) {
    return this.encodeInt(data, 16, false);
};
BinaryParser.toInt = function (data) {
    return this.decodeInt(data, 32, true);
};
BinaryParser.fromInt = function (data) {
    return this.encodeInt(data, 32, true);
};
BinaryParser.toLong = function (data) {
    return this.decodeInt(data, 64, true);
};
BinaryParser.fromLong = function (data) {
    return this.encodeInt(data, 64, true);
};
BinaryParser.toDWord = function (data) {
    return this.decodeInt(data, 32, false);
};
BinaryParser.fromDWord = function (data) {
    return this.encodeInt(data, 32, false);
};
BinaryParser.toQWord = function (data) {
    return this.decodeInt(data, 64, true);
};
BinaryParser.fromQWord = function (data) {
    return this.encodeInt(data, 64, true);
};
BinaryParser.toFloat = function (data) {
    return this.decodeFloat(data, 23, 8);
};
BinaryParser.fromFloat = function (data) {
    return this.encodeFloat(data, 23, 8);
};
BinaryParser.toDouble = function (data) {
    return this.decodeFloat(data, 52, 11);
};
BinaryParser.fromDouble = function (data) {
    return this.encodeFloat(data, 52, 11);
};

// Factor out the encode so it can be shared by add_header and push_int32
BinaryParser.encode_int32 = function (number, asArray) {
    var a, b, c, d, unsigned;

    unsigned = number < 0 ? number + 0x100000000 : number;
    a = Math.floor(unsigned / 0xffffff);

    unsigned &= 0xffffff;
    b = Math.floor(unsigned / 0xffff);

    unsigned &= 0xffff;
    c = Math.floor(unsigned / 0xff);

    unsigned &= 0xff;
    d = Math.floor(unsigned);

    return asArray ? [chr(a), chr(b), chr(c), chr(d)] : chr(a) + chr(b) + chr(c) + chr(d);
};

BinaryParser.encode_int64 = function (number) {
    var a, b, c, d, e, f, g, h, unsigned;

    unsigned = number < 0 ? number + 0x10000000000000000 : number;
    a = Math.floor(unsigned / 0xffffffffffffff);

    unsigned &= 0xffffffffffffff;
    b = Math.floor(unsigned / 0xffffffffffff);

    unsigned &= 0xffffffffffff;
    c = Math.floor(unsigned / 0xffffffffff);

    unsigned &= 0xffffffffff;
    d = Math.floor(unsigned / 0xffffffff);

    unsigned &= 0xffffffff;
    e = Math.floor(unsigned / 0xffffff);

    unsigned &= 0xffffff;
    f = Math.floor(unsigned / 0xffff);

    unsigned &= 0xffff;
    g = Math.floor(unsigned / 0xff);

    unsigned &= 0xff;
    h = Math.floor(unsigned);

    return chr(a) + chr(b) + chr(c) + chr(d) + chr(e) + chr(f) + chr(g) + chr(h);
};

/**
 * UTF8 methods
 */

// Take a raw binary string and return a utf8 string
BinaryParser.decode_utf8 = function (binaryStr) {
    var len = binaryStr.length,
        decoded = '',
        i = 0,
        c = 0,
        c1 = 0,
        c2 = 0,
        c3;

    while (i < len) {
        c = binaryStr.charCodeAt(i);

        if (c < 128) {
            decoded += String.fromCharCode(c);

            i++;
        } else if (c > 191 && c < 224) {
            c2 = binaryStr.charCodeAt(i + 1);
            decoded += String.fromCharCode((c & 31) << 6 | c2 & 63);

            i += 2;
        } else {
            c2 = binaryStr.charCodeAt(i + 1);
            c3 = binaryStr.charCodeAt(i + 2);
            decoded += String.fromCharCode((c & 15) << 12 | (c2 & 63) << 6 | c3 & 63);

            i += 3;
        }
    }

    return decoded;
};

// Encode a cstring
BinaryParser.encode_cstring = function (s) {
    return unescape(encodeURIComponent(s)) + BinaryParser.fromByte(0);
};

// Take a utf8 string and return a binary string
BinaryParser.encode_utf8 = function encode_utf8(s) {
    var a = "",
        c;

    for (var n = 0, len = s.length; n < len; n++) {
        c = s.charCodeAt(n);

        if (c < 128) {
            a += String.fromCharCode(c);
        } else if (c > 127 && c < 2048) {
            a += String.fromCharCode(c >> 6 | 192);
            a += String.fromCharCode(c & 63 | 128);
        } else {
            a += String.fromCharCode(c >> 12 | 224);
            a += String.fromCharCode(c >> 6 & 63 | 128);
            a += String.fromCharCode(c & 63 | 128);
        }
    }

    return a;
};

BinaryParser.hprint = function (s) {
    var number;

    for (var i = 0, len = s.length; i < len; i++) {
        if (s.charCodeAt(i) < 32) {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

            process.stdout.write(number + " ");
        } else {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

            process.stdout.write(number + " ");
        }
    }

    process.stdout.write("\n\n");
};

BinaryParser.ilprint = function (s) {
    var number;

    for (var i = 0, len = s.length; i < len; i++) {
        if (s.charCodeAt(i) < 32) {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(10) : s.charCodeAt(i).toString(10);
        } else {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(10) : s.charCodeAt(i).toString(10);
        }
    }
};

BinaryParser.hlprint = function (s) {
    var number;

    for (var i = 0, len = s.length; i < len; i++) {
        if (s.charCodeAt(i) < 32) {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);
        } else {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);
        }
    }
};

module.exports = BinaryParser;
//# sourceMappingURL=data:application/json;base64,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QUFGLENBQWEsQ0FBYixFQUFnQixRQUFoQixDQUF5QixFQUF6QixDQUE5QixHQUE2RCxFQUFFLFVBQUYsQ0FBYSxDQUFiLEVBQWdCLFFBQWhCLENBQXlCLEVBQXpCLENBQXRFO0FBQ0g7QUFDSjtBQUNKLENBVkQ7O0FBWUEsYUFBYSxPQUFiLEdBQXVCLFVBQVUsQ0FBVixFQUFhO0FBQ2hDLFFBQUksTUFBSjs7QUFFQSxTQUFLLElBQUksSUFBSSxDQUFSLEVBQVcsTUFBTSxFQUFFLE1BQXhCLEVBQWdDLElBQUksR0FBcEMsRUFBeUMsR0FBekMsRUFBOEM7QUFDMUMsWUFBSSxFQUFFLFVBQUYsQ0FBYSxDQUFiLElBQWtCLEVBQXRCLEVBQTBCO0FBQ3RCLHFCQUFTLEVBQUUsVUFBRixDQUFhLENBQWIsS0FBbUIsRUFBbkIsR0FBd0IsTUFBTSxFQUFFLFVBQUYsQ0FBYSxDQUFiLEVBQWdCLFFBQWhCLENBQXlCLEVBQXpCLENBQTlCLEdBQTZELEVBQUUsVUFBRixDQUFhLENBQWIsRUFBZ0IsUUFBaEIsQ0FBeUIsRUFBekIsQ0FBdEU7QUFDSCxTQUZELE1BRU87QUFDSCxxQkFBUyxFQUFFLFVBQUYsQ0FBYSxDQUFiLEtBQW1CLEVBQW5CLEdBQXdCLE1BQU0sRUFBRSxVQUFGLENBQWEsQ0FBYixFQUFnQixRQUFoQixDQUF5QixFQUF6QixDQUE5QixHQUE2RCxFQUFFLFVBQUYsQ0FBYSxDQUFiLEVBQWdCLFFBQWhCLENBQXlCLEVBQXpCLENBQXRFO0FBQ0g7QUFDSjtBQUNKLENBVkQ7O0FBWUEsT0FBTyxPQUFQLEdBQWlCLFlBQWpCIiwiZmlsZSI6IkJpbmFyeVBhcnNlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgQmluYXJ5UGFyc2VyLmpzIC0gYmFzZWQgb24gKHtAbGluayBodHRwOi8vanNmcm9taGVsbC5jb20vY2xhc3Nlcy9iaW5hcnktcGFyc2VyIEJpbmFyeSBQYXJzZXJ9KSBieSBKb25hcyBSYW9uaSBTb2FyZXMgU2lsdmFcbiAqIEB2ZXJzaW9uIDEuMC4wXG4gKiBAaWdub3JlXG4gKiBcbiAqIEBhdXRob3IgRWR1YXJkbyBBc3RvbGZpIDxlZHVhcmRvLmFzdG9sZmk5MUBnbWFpbC5jb20+XG4gKiBAY29weXJpZ2h0IDIwMTYgRWR1YXJkbyBBc3RvbGZpIDxlZHVhcmRvLmFzdG9sZmk5MUBnbWFpbC5jb20+XG4gKiBAbGljZW5zZSBNSVQgTGljZW5zZWRcbiAqL1xuIFxudmFyIExvZ2dlciA9IHJlcXVpcmUoXCIuL3V0aWxzL0xvZ2dlclwiKSxcbiAgICBCaW5hcnlQYXJzZXJCdWZmZXIgPSByZXF1aXJlKFwiLi9CaW5hcnlQYXJzZXJCdWZmZXJcIik7XG4gICAgXG52YXIgbG9nZ2VyID0gbnVsbDtcblxuLy8gU2hvcmN1dCBmb3IgU3RyaW5nLmZyb21DaGFyQ29kZVxudmFyIGNociA9IFN0cmluZy5mcm9tQ2hhckNvZGU7XG5cbnZhciBtYXhCaXRzID0gW107XG5mb3IgKHZhciBpID0gMDsgaSA8IDY0OyBpKyspIHtcbiAgICBtYXhCaXRzW2ldID0gTWF0aC5wb3coMiwgaSk7XG59XG5cbi8qKlxuICogQmluYXJ5UGFyc2VyXG4gKiBAaWdub3JlXG4gKiBcbiAqIEBtb2R1bGUgQ3Vyc29yXG4gKiBAY29uc3RydWN0b3JcbiAqIEBzaW5jZSAwLjAuMVxuICogXG4gKiBAY2xhc3NkZXNjIEN1cnNvciBjbGFzcyB0aGF0IG1hcHMgYSBNb25nb0RCLWxpa2UgY3Vyc29yXG4gKiBcbiAqIEBwYXJhbSB7TW9uZ29Qb3J0YWJsZX0gZGIgLSBBZGRpdGlvbmFsIG9wdGlvbnNcbiAqIEBwYXJhbSB7Q29sbGVjdGlvbn0gY29sbGVjdGlvbiAtIFRoZSBjb2xsZWN0aW9uIGluc3RhbmNlXG4gKiBAcGFyYW0ge09iamVjdHxBcnJheXxTdHJpbmd9IFtzZWxlY3Rpb249e31dIC0gVGhlIHNlbGVjdGlvbiBmb3IgbWF0Y2hpbmcgZG9jdW1lbnRzXG4gKiBAcGFyYW0ge09iamVjdHxBcnJheXxTdHJpbmd9IFtmaWVsZHM9e31dIC0gVGhlIGZpZWxkcyBvZiB0aGUgZG9jdW1lbnQgdG8gc2hvd1xuICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAtIERhdGFiYXNlIG9iamVjdFxuICogXG4gKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnMucGtGYWN0b3J5PW51bGxdIC0gT2JqZWN0IG92ZXJyaWRpbmcgdGhlIGJhc2ljIFwiT2JqZWN0SWRcIiBwcmltYXJ5IGtleSBnZW5lcmF0aW9uLlxuICogXG4gKi9cbmNsYXNzIEJpbmFyeVBhcnNlciB7XG4gICAgY29uc3RydWN0b3IoYmlnRW5kaWFuLCBhbGxvd0V4Y2VwdGlvbnMpIHtcbiAgICAgICAgbG9nZ2VyID0gTG9nZ2VyLmluc3RhbmNlO1xuICAgIFxuICAgICAgICB0aGlzLmJpZ0VuZGlhbiA9IGJpZ0VuZGlhbjtcbiAgICAgICAgdGhpcy5hbGxvd0V4Y2VwdGlvbnMgPSBhbGxvd0V4Y2VwdGlvbnM7XG4gICAgfVxuICAgIFxuICAgIFxufVxuXG5CaW5hcnlQYXJzZXIud2FybiA9IGZ1bmN0aW9uIChtc2cpIHtcbiAgICBpZiAodGhpcy5hbGxvd0V4Y2VwdGlvbnMpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiAxO1xufTtcblxuQmluYXJ5UGFyc2VyLmRlY29kZUZsb2F0ID0gZnVuY3Rpb24gKGRhdGEsIHByZWNpc2lvbkJpdHMsIGV4cG9uZW50Qml0cykge1xuICAgIHZhciBiID0gbmV3IEJpbmFyeVBhcnNlckJ1ZmZlcih0aGlzLmJpZ0VuZGlhbiwgZGF0YSk7XG5cbiAgICBiLmNoZWNrQnVmZmVyKHByZWNpc2lvbkJpdHMgKyBleHBvbmVudEJpdHMgKyAxKTtcblxuICAgIHZhciBiaWFzID0gbWF4Qml0c1tleHBvbmVudEJpdHMgLSAxXSAtIDEsXG4gICAgICAgIHNpZ25hbCA9IGIucmVhZEJpdHMocHJlY2lzaW9uQml0cyArIGV4cG9uZW50Qml0cywgMSksXG4gICAgICAgIGV4cG9uZW50ID0gYi5yZWFkQml0cyhwcmVjaXNpb25CaXRzLCBleHBvbmVudEJpdHMpLFxuICAgICAgICBzaWduaWZpY2FuZCA9IDAsXG4gICAgICAgIGRpdmlzb3IgPSAyLFxuICAgICAgICBjdXJCeXRlID0gYi5idWZmZXIubGVuZ3RoICsgKC1wcmVjaXNpb25CaXRzID4+IDMpIC0gMTtcblxuICAgIGRvIHtcbiAgICAgICAgZm9yIChcbiAgICAgICAgICAgIHZhciBieXRlVmFsdWUgPSBiLmJ1ZmZlclsgKytjdXJCeXRlIF0sIHN0YXJ0Qml0ID0gcHJlY2lzaW9uQml0cyAlIDggfHwgOCwgbWFzayA9IDEgPDwgc3RhcnRCaXQ7XG4gICAgICAgICAgICBtYXNrID4+PSAxOyBcbiAgICAgICAgICAgICggYnl0ZVZhbHVlICYgbWFzayApICYmICggc2lnbmlmaWNhbmQgKz0gMSAvIGRpdmlzb3IgKSwgZGl2aXNvciAqPSAyIFxuICAgICAgICApO1xuICAgIH0gd2hpbGUgKHByZWNpc2lvbkJpdHMgLT0gc3RhcnRCaXQpO1xuICAgIFxuICAgIFxuXG4gICAgaWYgKCBleHBvbmVudCA9PSAoIGJpYXMgPDwgMSApICsgMSApIHtcbiAgICBcdGlmIChzaWduaWZpY2FuZCkge1xuICAgIFx0XHRyZXR1cm4gTmFOO1xuICAgIFx0fSBlbHNlIHtcbiAgICBcdFx0aWYgKHNpZ25hbCkge1xuICAgIFx0XHRcdHJldHVybiAtSW5maW5pdHk7XG4gICAgXHRcdH0gZWxzZSB7XG4gICAgXHRcdFx0cmV0dXJuICtJbmZpbml0eTtcbiAgICBcdFx0fVxuICAgIFx0fVxuICAgIH0gZWxzZSB7XG4gICAgXHR2YXIgX21vZCA9IDA7XG4gICAgXHRcbiAgICBcdGlmIChleHBvbmVudCB8fCBzaWduaWZpY2FuZCkge1xuICAgIFx0XHRpZiAoIWV4cG9uZW50KSB7XG4gICAgXHRcdFx0X21vZCA9IE1hdGgucG93KCAyLCAtYmlhcyArIDEgKSAqIHNpZ25pZmljYW5kO1xuICAgIFx0XHR9IGVsc2Uge1xuICAgIFx0XHRcdF9tb2QgPSBNYXRoLnBvdyggMiwgZXhwb25lbnQgLSBiaWFzICkgKiAoIDEgKyBzaWduaWZpY2FuZCApO1xuICAgIFx0XHR9XG4gICAgXHR9XG4gICAgXHRcbiAgICBcdHJldHVybiAoIDEgKyBzaWduYWwgKiAtMiApICogKF9tb2QpO1xuICAgIH1cblxuXG4gICAgLy8gcmV0dXJuIGV4cG9uZW50ID09ICggYmlhcyA8PCAxICkgKyAxID8gc2lnbmlmaWNhbmQgPyBOYU4gOiBzaWduYWwgPyAtSW5maW5pdHkgOiArSW5maW5pdHkgOiAoIDEgKyBzaWduYWwgKiAtMiApICogKCBleHBvbmVudCB8fCBzaWduaWZpY2FuZCA/ICFleHBvbmVudCA/IE1hdGgucG93KCAyLCAtYmlhcyArIDEgKSAqIHNpZ25pZmljYW5kIDogTWF0aC5wb3coIDIsIGV4cG9uZW50IC0gYmlhcyApICogKCAxICsgc2lnbmlmaWNhbmQgKSA6IDAgKTtcbn07XG5cbkJpbmFyeVBhcnNlci5kZWNvZGVJbnQgPSBmdW5jdGlvbiAoZGF0YSwgYml0cywgc2lnbmVkLCBmb3JjZUJpZ0VuZGlhbikge1xuICAgIHZhciBiID0gbmV3IEJpbmFyeVBhcnNlckJ1ZmZlcih0aGlzLmJpZ0VuZGlhbiB8fCBmb3JjZUJpZ0VuZGlhbiwgZGF0YSksXG4gICAgICAgIHggPSBiLnJlYWRCaXRzKDAsIGJpdHMpLFxuICAgICAgICBtYXggPSBtYXhCaXRzW2JpdHNdOyAvL21heCA9IE1hdGgucG93KCAyLCBiaXRzICk7XG5cbiAgICByZXR1cm4gc2lnbmVkICYmIHggPj0gbWF4IC8gMiA/IHggLSBtYXggOiB4O1xufTtcblxuQmluYXJ5UGFyc2VyLmVuY29kZUZsb2F0ID0gZnVuY3Rpb24gKGRhdGEsIHByZWNpc2lvbkJpdHMsIGV4cG9uZW50Qml0cykge1xuICAgIHZhciBiaWFzID0gbWF4Qml0c1tleHBvbmVudEJpdHMgLSAxXSAtIDEsXG4gICAgICAgIG1pbkV4cCA9IC1iaWFzICsgMSxcbiAgICAgICAgbWF4RXhwID0gYmlhcyxcbiAgICAgICAgbWluVW5ub3JtRXhwID0gbWluRXhwIC0gcHJlY2lzaW9uQml0cyxcbiAgICAgICAgbiA9IHBhcnNlRmxvYXQoZGF0YSksXG4gICAgICAgIHN0YXR1cyA9IGlzTmFOKG4pIHx8IG4gPT0gLUluZmluaXR5IHx8IG4gPT0gK0luZmluaXR5ID8gbiA6IDAsXG4gICAgICAgIGV4cCA9IDAsXG4gICAgICAgIGxlbiA9IDIgKiBiaWFzICsgMSArIHByZWNpc2lvbkJpdHMgKyAzLFxuICAgICAgICBiaW4gPSBuZXcgQXJyYXkobGVuKSxcbiAgICAgICAgc2lnbmFsID0gKG4gPSBzdGF0dXMgIT09IDAgPyAwIDogbikgPCAwLFxuICAgICAgICBpbnRQYXJ0ID0gTWF0aC5mbG9vcihuID0gTWF0aC5hYnMobikpLFxuICAgICAgICBmbG9hdFBhcnQgPSBuIC0gaW50UGFydCxcbiAgICAgICAgbGFzdEJpdCxcbiAgICAgICAgcm91bmRlZCxcbiAgICAgICAgcmVzdWx0LFxuICAgICAgICBpLFxuICAgICAgICBqO1xuXG5cbiAgICAvLyBEQUZVQ0s/XG4gIFxuICAgIGZvciAoaSA9IGxlbjsgaTsgYmluWy0taV0gPSAwKTtcbiAgICBcbiAgICBmb3IgKGkgPSBiaWFzICsgMjsgaW50UGFydCAmJiBpOyBiaW5bLS1pXSA9IGludFBhcnQgJSAyLCBpbnRQYXJ0ID0gTWF0aC5mbG9vcihpbnRQYXJ0IC8gMikpO1xuICAgIFxuICAgIGZvciAoaSA9IGJpYXMgKyAxOyBmbG9hdFBhcnQgPiAwICYmIGk7IChiaW5bKytpXSA9ICgoZmxvYXRQYXJ0ICo9IDIpID49IDEpIC0gMCApICYmIC0tZmxvYXRQYXJ0KTtcbiAgICBcbiAgICBmb3IgKGkgPSAtMTsgKytpIDwgbGVuICYmICFiaW5baV07KTtcbiAgXG4gICAgaWYgKGJpblsobGFzdEJpdCA9IHByZWNpc2lvbkJpdHMgLSAxICsgKGkgPSAoZXhwID0gYmlhcyArIDEgLSBpKSA+PSBtaW5FeHAgJiYgZXhwIDw9IG1heEV4cCA/IGkgKyAxIDogYmlhcyArIDEgLSAoZXhwID0gbWluRXhwIC0gMSkpKSArIDFdKSB7XG4gICAgICAgIGlmICghKHJvdW5kZWQgPSBiaW5bbGFzdEJpdF0pKSB7XG4gICAgICAgICAgICBmb3IgKGogPSBsYXN0Qml0ICsgMjsgIXJvdW5kZWQgJiYgaiA8IGxlbjsgcm91bmRlZCA9IGJpbltqKytdKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgZm9yIChqID0gbGFzdEJpdCArIDE7IHJvdW5kZWQgJiYgLS1qID49IDA7IChiaW5bal0gPSAhYmluW2pdIC0gMCkgJiYgKHJvdW5kZWQgPSAwKSk7XG4gICAgfVxuICBcbiAgICBmb3IgKGkgPSBpIC0gMiA8IDAgPyAtMSA6IGkgLSAzOyArK2kgPCBsZW4gJiYgIWJpbltpXTspO1xuICAgIFxuICAgIGlmICgoZXhwID0gYmlhcyArIDEgLSBpKSA+PSBtaW5FeHAgJiYgZXhwIDw9IG1heEV4cCkge1xuICAgICAgICArK2k7XG4gICAgfSBlbHNlIGlmIChleHAgPCBtaW5FeHApIHtcbiAgICAgICAgZXhwICE9IGJpYXMgKyAxIC0gbGVuICYmIGV4cCA8IG1pblVubm9ybUV4cCAmJiB0aGlzLndhcm4oXCJlbmNvZGVGbG9hdDo6ZmxvYXQgdW5kZXJmbG93XCIpO1xuICAgICAgICBpID0gYmlhcyArIDEgLSAoZXhwID0gbWluRXhwIC0gMSk7XG4gICAgfVxuICAgIFxuICAgIGlmIChpbnRQYXJ0IHx8IHN0YXR1cyAhPT0gMCkge1xuICAgICAgICB0aGlzLndhcm4oaW50UGFydCA/IFwiZW5jb2RlRmxvYXQ6OmZsb2F0IG92ZXJmbG93XCIgOiBcImVuY29kZUZsb2F0OjpcIiArIHN0YXR1cyk7XG4gICAgICAgIGV4cCA9IG1heEV4cCArIDE7XG4gICAgICAgIGkgPSBiaWFzICsgMjtcbiAgICBcbiAgICAgICAgaWYgKHN0YXR1cyA9PSAtSW5maW5pdHkpIHtcbiAgICAgICAgICAgIHNpZ25hbCA9IDE7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNOYU4oc3RhdHVzKSkge1xuICAgICAgICAgICAgYmluW2ldID0gMTtcbiAgICAgICAgfVxuICAgIH1cbiAgXG4gICAgZm9yIChuID0gTWF0aC5hYnMoZXhwICsgYmlhcyksIGogPSBleHBvbmVudEJpdHMgKyAxLCByZXN1bHQgPSBcIlwiOyAtLWo7IHJlc3VsdCA9IChuICUgMikgKyByZXN1bHQsIG4gPSBuID4+PSAxKTtcbiAgXG4gICAgZm9yIChuID0gMCwgaiA9IDAsIGkgPSAocmVzdWx0ID0gKHNpZ25hbCA/IFwiMVwiIDogXCIwXCIpICsgcmVzdWx0ICsgYmluLnNsaWNlKGksIGkgKyBwcmVjaXNpb25CaXRzKS5qb2luKFwiXCIpKS5sZW5ndGgsIHIgPSBbXTsgaTsgaiA9IChqICsgMSkgJSA4KSB7XG4gICAgICAgIG4gKz0gKDEgPDwgaikgKiByZXN1bHQuY2hhckF0KC0taSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoaiA9PSA3KSB7XG4gICAgICAgICAgICByW3IubGVuZ3RoXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUobik7XG4gICAgICAgICAgICBuID0gMDtcbiAgICAgICAgfVxuICAgIH1cbiAgXG4gICAgcltyLmxlbmd0aF0gPSBuID8gU3RyaW5nLmZyb21DaGFyQ29kZShuKSA6IFwiXCI7XG4gIFxuICAgIHJldHVybiAodGhpcy5iaWdFbmRpYW4gPyByLnJldmVyc2UoKSA6IHIpLmpvaW4oXCJcIik7XG59O1xuXG5CaW5hcnlQYXJzZXIuZW5jb2RlSW50ID0gZnVuY3Rpb24gKGRhdGEsIGJpdHMsIHNpZ25lZCwgZm9yY2VCaWdFbmRpYW4pIHtcbiAgICB2YXIgbWF4ID0gbWF4Qml0c1tiaXRzXTtcbiAgICBcbiAgICBpZiAoZGF0YSA+PSBtYXggfHwgZGF0YSA8IC0obWF4IC8gMikpIHtcbiAgICAgICAgdGhpcy53YXJuKFwiZW5jb2RlSW50OjpvdmVyZmxvd1wiKTtcbiAgICAgICAgZGF0YSA9IDA7XG4gICAgfVxuICAgIFxuICAgIGlmIChkYXRhIDwgMCkge1xuICAgICAgICBkYXRhICs9IG1heDtcbiAgICB9XG4gICAgXG4gICAgZm9yICh2YXIgciA9IFtdOyBkYXRhOyByW3IubGVuZ3RoXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoZGF0YSAlIDI1NiksIGRhdGEgPSBNYXRoLmZsb29yKGRhdGEgLyAyNTYpKTtcbiAgICBcbiAgICBmb3IgKGJpdHMgPSAtKC1iaXRzID4+IDMpIC0gci5sZW5ndGg7IGJpdHMtLTsgcltyLmxlbmd0aF0gPSBcIlxcMFwiKTtcbiAgICBcbiAgICByZXR1cm4gKCh0aGlzLmJpZ0VuZGlhbiB8fCBmb3JjZUJpZ0VuZGlhbikgPyByLnJldmVyc2UoKSA6IHIpLmpvaW4oXCJcIik7XG59O1xuXG5CaW5hcnlQYXJzZXIudG9TbWFsbCAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgIDgsIHRydWUgICk7IH07XG5CaW5hcnlQYXJzZXIuZnJvbVNtYWxsICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgIDgsIHRydWUgICk7IH07XG5CaW5hcnlQYXJzZXIudG9CeXRlICAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgIDgsIGZhbHNlICk7IH07XG5CaW5hcnlQYXJzZXIuZnJvbUJ5dGUgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgIDgsIGZhbHNlICk7IH07XG5CaW5hcnlQYXJzZXIudG9TaG9ydCAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgMTYsIHRydWUgICk7IH07XG5CaW5hcnlQYXJzZXIuZnJvbVNob3J0ICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgMTYsIHRydWUgICk7IH07XG5CaW5hcnlQYXJzZXIudG9Xb3JkICAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgMTYsIGZhbHNlICk7IH07XG5CaW5hcnlQYXJzZXIuZnJvbVdvcmQgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgMTYsIGZhbHNlICk7IH07XG5CaW5hcnlQYXJzZXIudG9JbnQgICAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgMzIsIHRydWUgICk7IH07XG5CaW5hcnlQYXJzZXIuZnJvbUludCAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgMzIsIHRydWUgICk7IH07XG5CaW5hcnlQYXJzZXIudG9Mb25nICAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgNjQsIHRydWUgICk7IH07XG5CaW5hcnlQYXJzZXIuZnJvbUxvbmcgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgNjQsIHRydWUgICk7IH07XG5CaW5hcnlQYXJzZXIudG9EV29yZCAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgMzIsIGZhbHNlICk7IH07XG5CaW5hcnlQYXJzZXIuZnJvbURXb3JkICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgMzIsIGZhbHNlICk7IH07XG5CaW5hcnlQYXJzZXIudG9RV29yZCAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgNjQsIHRydWUgKTsgfTtcbkJpbmFyeVBhcnNlci5mcm9tUVdvcmQgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlSW50KCBkYXRhLCA2NCwgdHJ1ZSApOyB9O1xuQmluYXJ5UGFyc2VyLnRvRmxvYXQgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVGbG9hdCggZGF0YSwgMjMsIDggICApOyB9O1xuQmluYXJ5UGFyc2VyLmZyb21GbG9hdCAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVGbG9hdCggZGF0YSwgMjMsIDggICApOyB9O1xuQmluYXJ5UGFyc2VyLnRvRG91YmxlICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVGbG9hdCggZGF0YSwgNTIsIDExICApOyB9O1xuQmluYXJ5UGFyc2VyLmZyb21Eb3VibGUgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVGbG9hdCggZGF0YSwgNTIsIDExICApOyB9O1xuXG4vLyBGYWN0b3Igb3V0IHRoZSBlbmNvZGUgc28gaXQgY2FuIGJlIHNoYXJlZCBieSBhZGRfaGVhZGVyIGFuZCBwdXNoX2ludDMyXG5CaW5hcnlQYXJzZXIuZW5jb2RlX2ludDMyID0gZnVuY3Rpb24gKG51bWJlciwgYXNBcnJheSkge1xuICAgIHZhciBhLCBiLCBjLCBkLCB1bnNpZ25lZDtcbiAgICBcbiAgICB1bnNpZ25lZCA9IChudW1iZXIgPCAwKSA/IChudW1iZXIgKyAweDEwMDAwMDAwMCkgOiBudW1iZXI7XG4gICAgYSA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmZmZik7XG4gICAgXG4gICAgdW5zaWduZWQgJj0gMHhmZmZmZmY7XG4gICAgYiA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmYpO1xuICAgIFxuICAgIHVuc2lnbmVkICY9IDB4ZmZmZjtcbiAgICBjID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmYpO1xuICAgIFxuICAgIHVuc2lnbmVkICY9IDB4ZmY7XG4gICAgZCA9IE1hdGguZmxvb3IodW5zaWduZWQpO1xuICAgIFxuICAgIHJldHVybiBhc0FycmF5ID8gW2NocihhKSwgY2hyKGIpLCBjaHIoYyksIGNocihkKV0gOiBjaHIoYSkgKyBjaHIoYikgKyBjaHIoYykgKyBjaHIoZCk7XG59O1xuXG5CaW5hcnlQYXJzZXIuZW5jb2RlX2ludDY0ID0gZnVuY3Rpb24gKG51bWJlcikge1xuICAgIHZhciBhLCBiLCBjLCBkLCBlLCBmLCBnLCBoLCB1bnNpZ25lZDtcbiAgICBcbiAgICB1bnNpZ25lZCA9IChudW1iZXIgPCAwKSA/IChudW1iZXIgKyAweDEwMDAwMDAwMDAwMDAwMDAwKSA6IG51bWJlcjtcbiAgICBhID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmZmZmZmZmZmZmZmZmYpO1xuICAgIFxuICAgIHVuc2lnbmVkICY9IDB4ZmZmZmZmZmZmZmZmZmY7XG4gICAgYiA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmZmZmZmZmZmZik7XG4gICAgXG4gICAgdW5zaWduZWQgJj0gMHhmZmZmZmZmZmZmZmY7XG4gICAgYyA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmZmZmZmZmYpO1xuICAgIFxuICAgIHVuc2lnbmVkICY9IDB4ZmZmZmZmZmZmZjtcbiAgICBkID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmZmZmZmZmYpO1xuICAgIFxuICAgIHVuc2lnbmVkICY9IDB4ZmZmZmZmZmY7XG4gICAgZSA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmZmZik7XG4gICAgXG4gICAgdW5zaWduZWQgJj0gMHhmZmZmZmY7XG4gICAgZiA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmYpO1xuICAgIFxuICAgIHVuc2lnbmVkICY9IDB4ZmZmZjtcbiAgICBnID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmYpO1xuICAgIFxuICAgIHVuc2lnbmVkICY9IDB4ZmY7XG4gICAgaCA9IE1hdGguZmxvb3IodW5zaWduZWQpO1xuICAgIFxuICAgIHJldHVybiBjaHIoYSkgKyBjaHIoYikgKyBjaHIoYykgKyBjaHIoZCkgKyBjaHIoZSkgKyBjaHIoZikgKyBjaHIoZykgKyBjaHIoaCk7XG59O1xuXG4vKipcbiAqIFVURjggbWV0aG9kc1xuICovXG5cbi8vIFRha2UgYSByYXcgYmluYXJ5IHN0cmluZyBhbmQgcmV0dXJuIGEgdXRmOCBzdHJpbmdcbkJpbmFyeVBhcnNlci5kZWNvZGVfdXRmOCA9IGZ1bmN0aW9uIChiaW5hcnlTdHIpIHtcbiAgICB2YXIgbGVuID0gYmluYXJ5U3RyLmxlbmd0aCxcbiAgICAgICAgZGVjb2RlZCA9ICcnLFxuICAgICAgICBpID0gMCxcbiAgICAgICAgYyA9IDAsXG4gICAgICAgIGMxID0gMCxcbiAgICAgICAgYzIgPSAwLFxuICAgICAgICBjMztcbiAgICBcbiAgICB3aGlsZSAoaSA8IGxlbikge1xuICAgICAgICBjID0gYmluYXJ5U3RyLmNoYXJDb2RlQXQoaSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoYyA8IDEyOCkge1xuICAgICAgICAgICAgZGVjb2RlZCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGMpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpKys7XG4gICAgICAgIH0gZWxzZSBpZiAoKGMgPiAxOTEpICYmIChjIDwgMjI0KSkge1xuICAgICAgICAgICAgYzIgPSBiaW5hcnlTdHIuY2hhckNvZGVBdChpKzEpO1xuICAgICAgICAgICAgZGVjb2RlZCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYyAmIDMxKSA8PCA2KSB8IChjMiAmIDYzKSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGkgKz0gMjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGMyID0gYmluYXJ5U3RyLmNoYXJDb2RlQXQoaSsxKTtcbiAgICAgICAgICAgIGMzID0gYmluYXJ5U3RyLmNoYXJDb2RlQXQoaSsyKTtcbiAgICAgICAgICAgIGRlY29kZWQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgJiAxNSkgPDwgMTIpIHwgKChjMiAmIDYzKSA8PCA2KSB8IChjMyAmIDYzKSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGkgKz0gMztcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZGVjb2RlZDtcbn07XG5cbi8vIEVuY29kZSBhIGNzdHJpbmdcbkJpbmFyeVBhcnNlci5lbmNvZGVfY3N0cmluZyA9IGZ1bmN0aW9uIChzKSB7XG4gICAgcmV0dXJuIHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChzKSkgKyBCaW5hcnlQYXJzZXIuZnJvbUJ5dGUoMCk7XG59O1xuXG4vLyBUYWtlIGEgdXRmOCBzdHJpbmcgYW5kIHJldHVybiBhIGJpbmFyeSBzdHJpbmdcbkJpbmFyeVBhcnNlci5lbmNvZGVfdXRmOCA9IGZ1bmN0aW9uIGVuY29kZV91dGY4IChzKSB7XG4gICAgdmFyIGEgPSBcIlwiLFxuICAgICAgICBjO1xuXG4gICAgZm9yICh2YXIgbiA9IDAsIGxlbiA9IHMubGVuZ3RoOyBuIDwgbGVuOyBuKyspIHtcbiAgICAgICAgYyA9IHMuY2hhckNvZGVBdChuKTtcblxuICAgICAgICBpZiAoYyA8IDEyOCkge1xuICAgICAgICAgICAgYSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGMpO1xuICAgICAgICB9IGVsc2UgaWYgKChjID4gMTI3KSAmJiAoYyA8IDIwNDgpKSB7XG4gICAgICAgICAgICBhICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGM+PjYpIHwgMTkyKSA7XG4gICAgICAgICAgICBhICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGMmNjMpIHwgMTI4KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGEgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYz4+MTIpIHwgMjI0KTtcbiAgICAgICAgICAgIGEgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGM+PjYpICYgNjMpIHwgMTI4KTtcbiAgICAgICAgICAgIGEgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyY2MykgfCAxMjgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGE7XG59O1xuXG5CaW5hcnlQYXJzZXIuaHByaW50ID0gZnVuY3Rpb24gKHMpIHtcbiAgICB2YXIgbnVtYmVyO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgaWYgKHMuY2hhckNvZGVBdChpKSA8IDMyKSB7XG4gICAgICAgICAgICBudW1iZXIgPSBzLmNoYXJDb2RlQXQoaSkgPD0gMTUgPyBcIjBcIiArIHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxNikgOiBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShudW1iZXIgKyBcIiBcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBudW1iZXIgPSBzLmNoYXJDb2RlQXQoaSkgPD0gMTUgPyBcIjBcIiArIHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxNikgOiBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShudW1iZXIgKyBcIiBcIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoXCJcXG5cXG5cIik7XG59O1xuXG5CaW5hcnlQYXJzZXIuaWxwcmludCA9IGZ1bmN0aW9uIChzKSB7XG4gICAgdmFyIG51bWJlcjtcblxuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIGlmIChzLmNoYXJDb2RlQXQoaSkgPCAzMikge1xuICAgICAgICAgICAgbnVtYmVyID0gcy5jaGFyQ29kZUF0KGkpIDw9IDE1ID8gXCIwXCIgKyBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTApIDogcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDEwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG51bWJlciA9IHMuY2hhckNvZGVBdChpKSA8PSAxNSA/IFwiMFwiICsgcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDEwKSA6IHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxMCk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5CaW5hcnlQYXJzZXIuaGxwcmludCA9IGZ1bmN0aW9uIChzKSB7XG4gICAgdmFyIG51bWJlcjtcbiAgICBcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICBpZiAocy5jaGFyQ29kZUF0KGkpIDwgMzIpIHtcbiAgICAgICAgICAgIG51bWJlciA9IHMuY2hhckNvZGVBdChpKSA8PSAxNSA/IFwiMFwiICsgcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDE2KSA6IHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxNik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBudW1iZXIgPSBzLmNoYXJDb2RlQXQoaSkgPD0gMTUgPyBcIjBcIiArIHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxNikgOiBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpO1xuICAgICAgICB9XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBCaW5hcnlQYXJzZXI7Il19
