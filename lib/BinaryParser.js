"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * @file BinaryParser.js - based on ({@link http://jsfromhell.com/classes/binary-parser Binary Parser}) by Jonas Raoni Soares Silva
 * @version 1.0.0
 * @ignore
 * 
 * @author Eduardo Astolfi <eastolfi91@gmail.com>
 * @copyright 2016 Eduardo Astolfi <eastolfi91@gmail.com>
 * @license MIT Licensed
 */

var logger = null;

// Shorcut for String.fromCharCode
var chr = String.fromCharCode;

var maxBits = [];
for (var i = 0; i < 64; i++) {
    maxBits[i] = Math.pow(2, i);
}

module.exports = function (BinaryParserBuffer, Logger) {

    /**
     * BinaryParser
     * @ignore
     * 
     * @module Cursor
     * @constructor
     * @since 0.0.1
     * 
     * @classdesc Cursor class that maps a MongoDB-like cursor
     * 
     * @param {MongoPortable} db - Additional options
     * @param {Collection} collection - The collection instance
     * @param {Object|Array|String} [selection={}] - The selection for matching documents
     * @param {Object|Array|String} [fields={}] - The fields of the document to show
     * @param {Object} [options] - Database object
     * 
     * @param {Object} [options.pkFactory=null] - Object overriding the basic "ObjectId" primary key generation.
     * 
     */

    var BinaryParser = function BinaryParser(bigEndian, allowExceptions) {
        _classCallCheck(this, BinaryParser);

        logger = Logger.instance;

        this.bigEndian = bigEndian;
        this.allowExceptions = allowExceptions;
    };

    BinaryParser.decodeFloat = function (data, precisionBits, exponentBits) {
        var b = new BinaryParserBuffer(this.bigEndian, data);

        b.checkBuffer(precisionBits + exponentBits + 1);

        var bias = maxBits[exponentBits - 1] - 1,
            signal = b.readBits(precisionBits + exponentBits, 1),
            exponent = b.readBits(precisionBits, exponentBits),
            significand = 0,
            divisor = 2,
            curByte = b.buffer.length + (-precisionBits >> 3) - 1;

        do {
            for (var byteValue = b.buffer[++curByte], startBit = precisionBits % 8 || 8, mask = 1 << startBit; mask >>= 1; byteValue & mask && (significand += 1 / divisor), divisor *= 2) {}
        } while (precisionBits -= startBit);

        if (exponent == (bias << 1) + 1) {
            if (significand) {
                return NaN;
            } else {
                if (signal) {
                    return -Infinity;
                } else {
                    return +Infinity;
                }
            }
        } else {
            var _mod = 0;

            if (exponent || significand) {
                _mod = exponent ? Math.pow(2, exponent - bias) * (1 + significand) : Math.pow(2, -bias + 1) * significand;
            }

            return (1 + signal * -2) * _mod;
        }

        // return exponent == ( bias << 1 ) + 1 ? significand ? NaN : signal ? -Infinity : +Infinity : ( 1 + signal * -2 ) * ( exponent || significand ? !exponent ? Math.pow( 2, -bias + 1 ) * significand : Math.pow( 2, exponent - bias ) * ( 1 + significand ) : 0 );
    };

    BinaryParser.decodeInt = function (data, bits, signed, forceBigEndian) {
        var b = new BinaryParserBuffer(this.bigEndian || forceBigEndian, data),
            x = b.readBits(0, bits),
            max = maxBits[bits]; //max = Math.pow( 2, bits );

        return signed && x >= max / 2 ? x - max : x;
    };

    BinaryParser.encodeFloat = function (data, precisionBits, exponentBits) {
        var bias = maxBits[exponentBits - 1] - 1,
            minExp = -bias + 1,
            maxExp = bias,
            minUnnormExp = minExp - precisionBits,
            n = parseFloat(data),
            status = isNaN(n) || n == -Infinity || n == +Infinity ? n : 0,
            exp = 0,
            len = 2 * bias + 1 + precisionBits + 3,
            bin = new Array(len),
            signal = (n = status !== 0 ? 0 : n) < 0,
            intPart = Math.floor(n = Math.abs(n)),
            floatPart = n - intPart,
            lastBit,
            rounded,
            result,
            i,
            j;

        for (i = len; i; bin[--i] = 0) {}

        for (i = bias + 2; intPart && i; bin[--i] = intPart % 2, intPart = Math.floor(intPart / 2)) {}

        for (i = bias + 1; floatPart > 0 && i; (bin[++i] = ((floatPart *= 2) >= 1) - 0) && --floatPart) {}

        for (i = -1; ++i < len && !bin[i];) {}

        if (bin[(lastBit = precisionBits - 1 + (i = (exp = bias + 1 - i) >= minExp && exp <= maxExp ? i + 1 : bias + 1 - (exp = minExp - 1))) + 1]) {
            if (!(rounded = bin[lastBit])) {
                for (j = lastBit + 2; !rounded && j < len; rounded = bin[j++]) {}
            }

            for (j = lastBit + 1; rounded && --j >= 0; (bin[j] = !bin[j] - 0) && (rounded = 0)) {}
        }

        for (i = i - 2 < 0 ? -1 : i - 3; ++i < len && !bin[i];) {}

        if ((exp = bias + 1 - i) >= minExp && exp <= maxExp) {
            ++i;
        } else if (exp < minExp) {
            exp != bias + 1 - len && exp < minUnnormExp && console.warn("encodeFloat::float underflow"); // TODO logger
            i = bias + 1 - (exp = minExp - 1);
        }

        if (intPart || status !== 0) {
            console.warn(intPart ? "encodeFloat::float overflow" : "encodeFloat::" + status); // TODO logger
            exp = maxExp + 1;
            i = bias + 2;

            if (status == -Infinity) {
                signal = 1;
            } else if (isNaN(status)) {
                bin[i] = 1;
            }
        }

        for (n = Math.abs(exp + bias), j = exponentBits + 1, result = ""; --j; result = n % 2 + result, n = n >>= 1) {}

        var r = [];

        for (n = 0, j = 0, i = (result = (signal ? "1" : "0") + result + bin.slice(i, i + precisionBits).join("")).length, r = []; i; j = (j + 1) % 8) {
            n += (1 << j) * result.charAt(--i);

            if (j == 7) {
                r[r.length] = String.fromCharCode(n);
                n = 0;
            }
        }

        r[r.length] = n ? String.fromCharCode(n) : "";

        return (this.bigEndian ? r.reverse() : r).join("");
    };

    BinaryParser.encodeInt = function (data, bits, signed, forceBigEndian) {
        var max = maxBits[bits];

        if (data >= max || data < -(max / 2)) {
            console.warn("encodeInt::overflow"); // TODO logger
            data = 0;
        }

        if (data < 0) {
            data += max;
        }

        for (var r = []; data; r[r.length] = String.fromCharCode(data % 256), data = Math.floor(data / 256)) {}

        for (bits = -(-bits >> 3) - r.length; bits--; r[r.length] = "\0") {}

        return (this.bigEndian || forceBigEndian ? r.reverse() : r).join("");
    };

    BinaryParser.toSmall = function (data) {
        return this.decodeInt(data, 8, true);
    };
    BinaryParser.fromSmall = function (data) {
        return this.encodeInt(data, 8, true);
    };
    BinaryParser.toByte = function (data) {
        return this.decodeInt(data, 8, false);
    };
    BinaryParser.fromByte = function (data) {
        return this.encodeInt(data, 8, false);
    };
    BinaryParser.toShort = function (data) {
        return this.decodeInt(data, 16, true);
    };
    BinaryParser.fromShort = function (data) {
        return this.encodeInt(data, 16, true);
    };
    BinaryParser.toWord = function (data) {
        return this.decodeInt(data, 16, false);
    };
    BinaryParser.fromWord = function (data) {
        return this.encodeInt(data, 16, false);
    };
    BinaryParser.toInt = function (data) {
        return this.decodeInt(data, 32, true);
    };
    BinaryParser.fromInt = function (data) {
        return this.encodeInt(data, 32, true);
    };
    BinaryParser.toLong = function (data) {
        return this.decodeInt(data, 64, true);
    };
    BinaryParser.fromLong = function (data) {
        return this.encodeInt(data, 64, true);
    };
    BinaryParser.toDWord = function (data) {
        return this.decodeInt(data, 32, false);
    };
    BinaryParser.fromDWord = function (data) {
        return this.encodeInt(data, 32, false);
    };
    BinaryParser.toQWord = function (data) {
        return this.decodeInt(data, 64, true);
    };
    BinaryParser.fromQWord = function (data) {
        return this.encodeInt(data, 64, true);
    };
    BinaryParser.toFloat = function (data) {
        return this.decodeFloat(data, 23, 8);
    };
    BinaryParser.fromFloat = function (data) {
        return this.encodeFloat(data, 23, 8);
    };
    BinaryParser.toDouble = function (data) {
        return this.decodeFloat(data, 52, 11);
    };
    BinaryParser.fromDouble = function (data) {
        return this.encodeFloat(data, 52, 11);
    };

    // Factor out the encode so it can be shared by add_header and push_int32
    BinaryParser.encode_int32 = function (number, asArray) {
        var a, b, c, d, unsigned;

        unsigned = number < 0 ? number + 0x100000000 : number;
        a = Math.floor(unsigned / 0xffffff);

        unsigned &= 0xffffff;
        b = Math.floor(unsigned / 0xffff);

        unsigned &= 0xffff;
        c = Math.floor(unsigned / 0xff);

        unsigned &= 0xff;
        d = Math.floor(unsigned);

        return asArray ? [chr(a), chr(b), chr(c), chr(d)] : chr(a) + chr(b) + chr(c) + chr(d);
    };

    BinaryParser.encode_int64 = function (number) {
        var a, b, c, d, e, f, g, h, unsigned;

        unsigned = number < 0 ? number + 0x10000000000000000 : number;
        a = Math.floor(unsigned / 0xffffffffffffff);

        unsigned &= 0xffffffffffffff;
        b = Math.floor(unsigned / 0xffffffffffff);

        unsigned &= 0xffffffffffff;
        c = Math.floor(unsigned / 0xffffffffff);

        unsigned &= 0xffffffffff;
        d = Math.floor(unsigned / 0xffffffff);

        unsigned &= 0xffffffff;
        e = Math.floor(unsigned / 0xffffff);

        unsigned &= 0xffffff;
        f = Math.floor(unsigned / 0xffff);

        unsigned &= 0xffff;
        g = Math.floor(unsigned / 0xff);

        unsigned &= 0xff;
        h = Math.floor(unsigned);

        return chr(a) + chr(b) + chr(c) + chr(d) + chr(e) + chr(f) + chr(g) + chr(h);
    };

    /**
     * UTF8 methods
     */

    // Take a raw binary string and return a utf8 string
    BinaryParser.decode_utf8 = function (binaryStr) {
        var len = binaryStr.length,
            decoded = '',
            i = 0,
            c = 0,
            c1 = 0,
            c2 = 0,
            c3;

        while (i < len) {
            c = binaryStr.charCodeAt(i);

            if (c < 128) {
                decoded += String.fromCharCode(c);

                i++;
            } else if (c > 191 && c < 224) {
                c2 = binaryStr.charCodeAt(i + 1);
                decoded += String.fromCharCode((c & 31) << 6 | c2 & 63);

                i += 2;
            } else {
                c2 = binaryStr.charCodeAt(i + 1);
                c3 = binaryStr.charCodeAt(i + 2);
                decoded += String.fromCharCode((c & 15) << 12 | (c2 & 63) << 6 | c3 & 63);

                i += 3;
            }
        }

        return decoded;
    };

    // Encode a cstring
    BinaryParser.encode_cstring = function (s) {
        return unescape(encodeURIComponent(s)) + BinaryParser.fromByte(0);
    };

    // Take a utf8 string and return a binary string
    BinaryParser.encode_utf8 = function encode_utf8(s) {
        var a = "",
            c;

        for (var n = 0, len = s.length; n < len; n++) {
            c = s.charCodeAt(n);

            if (c < 128) {
                a += String.fromCharCode(c);
            } else if (c > 127 && c < 2048) {
                a += String.fromCharCode(c >> 6 | 192);
                a += String.fromCharCode(c & 63 | 128);
            } else {
                a += String.fromCharCode(c >> 12 | 224);
                a += String.fromCharCode(c >> 6 & 63 | 128);
                a += String.fromCharCode(c & 63 | 128);
            }
        }

        return a;
    };

    BinaryParser.hprint = function (s) {
        var number;

        for (var i = 0, len = s.length; i < len; i++) {
            if (s.charCodeAt(i) < 32) {
                number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

                process.stdout.write(number + " ");
            } else {
                number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

                process.stdout.write(number + " ");
            }
        }

        process.stdout.write("\n\n");

        return number;
    };

    BinaryParser.ilprint = function (s) {
        var number;

        for (var i = 0, len = s.length; i < len; i++) {
            if (s.charCodeAt(i) < 32) {
                number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(10) : s.charCodeAt(i).toString(10);

                process.stdout.write(number + " ");
            } else {
                number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(10) : s.charCodeAt(i).toString(10);

                process.stdout.write(number + " ");
            }
        }

        process.stdout.write("\n\n");

        return number;
    };

    BinaryParser.hlprint = function (s) {
        var number;

        for (var i = 0, len = s.length; i < len; i++) {
            if (s.charCodeAt(i) < 32) {
                number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

                process.stdout.write(number + " ");
            } else {
                number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

                process.stdout.write(number + " ");
            }
        }

        process.stdout.write("\n\n");

        return number;
    };

    return BinaryParser;
};
//# sourceMappingURL=data:application/json;base64,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QkFBYSxLQUFiLEdBQTBCLFVBQVUsSUFBVixFQUFnQjtBQUFFLGVBQU8sS0FBSyxTQUFMLENBQWdCLElBQWhCLEVBQXNCLEVBQXRCLEVBQTBCLElBQTFCLENBQVA7QUFBMkMsS0FBdkY7QUFDQSxpQkFBYSxPQUFiLEdBQTBCLFVBQVUsSUFBVixFQUFnQjtBQUFFLGVBQU8sS0FBSyxTQUFMLENBQWdCLElBQWhCLEVBQXNCLEVBQXRCLEVBQTBCLElBQTFCLENBQVA7QUFBMkMsS0FBdkY7QUFDQSxpQkFBYSxNQUFiLEdBQTBCLFVBQVUsSUFBVixFQUFnQjtBQUFFLGVBQU8sS0FBSyxTQUFMLENBQWdCLElBQWhCLEVBQXNCLEVBQXRCLEVBQTBCLElBQTFCLENBQVA7QUFBMkMsS0FBdkY7QUFDQSxpQkFBYSxRQUFiLEdBQTBCLFVBQVUsSUFBVixFQUFnQjtBQUFFLGVBQU8sS0FBSyxTQUFMLENBQWdCLElBQWhCLEVBQXNCLEVBQXRCLEVBQTBCLElBQTFCLENBQVA7QUFBMkMsS0FBdkY7QUFDQSxpQkFBYSxPQUFiLEdBQTBCLFVBQVUsSUFBVixFQUFnQjtBQUFFLGVBQU8sS0FBSyxTQUFMLENBQWdCLElBQWhCLEVBQXNCLEVBQXRCLEVBQTBCLEtBQTFCLENBQVA7QUFBMkMsS0FBdkY7QUFDQSxpQkFBYSxTQUFiLEdBQTBCLFVBQVUsSUFBVixFQUFnQjtBQUFFLGVBQU8sS0FBSyxTQUFMLENBQWdCLElBQWhCLEVBQXNCLEVBQXRCLEVBQTBCLEtBQTFCLENBQVA7QUFBMkMsS0FBdkY7QUFDQSxpQkFBYSxPQUFiLEdBQTBCLFVBQVUsSUFBVixFQUFnQjtBQUFFLGVBQU8sS0FBSyxTQUFMLENBQWdCLElBQWhCLEVBQXNCLEVBQXRCLEVBQTBCLElBQTFCLENBQVA7QUFBMEMsS0FBdEY7QUFDQSxpQkFBYSxTQUFiLEdBQTBCLFVBQVUsSUFBVixFQUFnQjtBQUFFLGVBQU8sS0FBSyxTQUFMLENBQWdCLElBQWhCLEVBQXNCLEVBQXRCLEVBQTBCLElBQTFCLENBQVA7QUFBMEMsS0FBdEY7QUFDQSxpQkFBYSxPQUFiLEdB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UDtBQUNILENBelhEIiwiZmlsZSI6IkJpbmFyeVBhcnNlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgQmluYXJ5UGFyc2VyLmpzIC0gYmFzZWQgb24gKHtAbGluayBodHRwOi8vanNmcm9taGVsbC5jb20vY2xhc3Nlcy9iaW5hcnktcGFyc2VyIEJpbmFyeSBQYXJzZXJ9KSBieSBKb25hcyBSYW9uaSBTb2FyZXMgU2lsdmFcbiAqIEB2ZXJzaW9uIDEuMC4wXG4gKiBAaWdub3JlXG4gKiBcbiAqIEBhdXRob3IgRWR1YXJkbyBBc3RvbGZpIDxlYXN0b2xmaTkxQGdtYWlsLmNvbT5cbiAqIEBjb3B5cmlnaHQgMjAxNiBFZHVhcmRvIEFzdG9sZmkgPGVhc3RvbGZpOTFAZ21haWwuY29tPlxuICogQGxpY2Vuc2UgTUlUIExpY2Vuc2VkXG4gKi9cbiBcbnZhciBsb2dnZXIgPSBudWxsO1xuXG4vLyBTaG9yY3V0IGZvciBTdHJpbmcuZnJvbUNoYXJDb2RlXG52YXIgY2hyID0gU3RyaW5nLmZyb21DaGFyQ29kZTtcblxudmFyIG1heEJpdHMgPSBbXTtcbmZvciAodmFyIGkgPSAwOyBpIDwgNjQ7IGkrKykge1xuICAgIG1heEJpdHNbaV0gPSBNYXRoLnBvdygyLCBpKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihCaW5hcnlQYXJzZXJCdWZmZXIsIExvZ2dlcikge1xuXG4gICAgLyoqXG4gICAgICogQmluYXJ5UGFyc2VyXG4gICAgICogQGlnbm9yZVxuICAgICAqIFxuICAgICAqIEBtb2R1bGUgQ3Vyc29yXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQHNpbmNlIDAuMC4xXG4gICAgICogXG4gICAgICogQGNsYXNzZGVzYyBDdXJzb3IgY2xhc3MgdGhhdCBtYXBzIGEgTW9uZ29EQi1saWtlIGN1cnNvclxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7TW9uZ29Qb3J0YWJsZX0gZGIgLSBBZGRpdGlvbmFsIG9wdGlvbnNcbiAgICAgKiBAcGFyYW0ge0NvbGxlY3Rpb259IGNvbGxlY3Rpb24gLSBUaGUgY29sbGVjdGlvbiBpbnN0YW5jZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fEFycmF5fFN0cmluZ30gW3NlbGVjdGlvbj17fV0gLSBUaGUgc2VsZWN0aW9uIGZvciBtYXRjaGluZyBkb2N1bWVudHNcbiAgICAgKiBAcGFyYW0ge09iamVjdHxBcnJheXxTdHJpbmd9IFtmaWVsZHM9e31dIC0gVGhlIGZpZWxkcyBvZiB0aGUgZG9jdW1lbnQgdG8gc2hvd1xuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gLSBEYXRhYmFzZSBvYmplY3RcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnMucGtGYWN0b3J5PW51bGxdIC0gT2JqZWN0IG92ZXJyaWRpbmcgdGhlIGJhc2ljIFwiT2JqZWN0SWRcIiBwcmltYXJ5IGtleSBnZW5lcmF0aW9uLlxuICAgICAqIFxuICAgICAqL1xuICAgIGNsYXNzIEJpbmFyeVBhcnNlciB7XG4gICAgICAgIGNvbnN0cnVjdG9yKGJpZ0VuZGlhbiwgYWxsb3dFeGNlcHRpb25zKSB7XG4gICAgICAgICAgICBsb2dnZXIgPSBMb2dnZXIuaW5zdGFuY2U7XG4gICAgICAgIFxuICAgICAgICAgICAgdGhpcy5iaWdFbmRpYW4gPSBiaWdFbmRpYW47XG4gICAgICAgICAgICB0aGlzLmFsbG93RXhjZXB0aW9ucyA9IGFsbG93RXhjZXB0aW9ucztcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIEJpbmFyeVBhcnNlci5kZWNvZGVGbG9hdCA9IGZ1bmN0aW9uIChkYXRhLCBwcmVjaXNpb25CaXRzLCBleHBvbmVudEJpdHMpIHtcbiAgICAgICAgdmFyIGIgPSBuZXcgQmluYXJ5UGFyc2VyQnVmZmVyKHRoaXMuYmlnRW5kaWFuLCBkYXRhKTtcbiAgICBcbiAgICAgICAgYi5jaGVja0J1ZmZlcihwcmVjaXNpb25CaXRzICsgZXhwb25lbnRCaXRzICsgMSk7XG4gICAgXG4gICAgICAgIHZhciBiaWFzID0gbWF4Qml0c1tleHBvbmVudEJpdHMgLSAxXSAtIDEsXG4gICAgICAgICAgICBzaWduYWwgPSBiLnJlYWRCaXRzKHByZWNpc2lvbkJpdHMgKyBleHBvbmVudEJpdHMsIDEpLFxuICAgICAgICAgICAgZXhwb25lbnQgPSBiLnJlYWRCaXRzKHByZWNpc2lvbkJpdHMsIGV4cG9uZW50Qml0cyksXG4gICAgICAgICAgICBzaWduaWZpY2FuZCA9IDAsXG4gICAgICAgICAgICBkaXZpc29yID0gMixcbiAgICAgICAgICAgIGN1ckJ5dGUgPSBiLmJ1ZmZlci5sZW5ndGggKyAoLXByZWNpc2lvbkJpdHMgPj4gMykgLSAxO1xuICAgIFxuICAgICAgICBkbyB7XG4gICAgICAgICAgICBmb3IgKFxuICAgICAgICAgICAgICAgIHZhciBieXRlVmFsdWUgPSBiLmJ1ZmZlclsgKytjdXJCeXRlIF0sIHN0YXJ0Qml0ID0gcHJlY2lzaW9uQml0cyAlIDggfHwgOCwgbWFzayA9IDEgPDwgc3RhcnRCaXQ7XG4gICAgICAgICAgICAgICAgbWFzayA+Pj0gMTsgXG4gICAgICAgICAgICAgICAgKCBieXRlVmFsdWUgJiBtYXNrICkgJiYgKCBzaWduaWZpY2FuZCArPSAxIC8gZGl2aXNvciApLCBkaXZpc29yICo9IDIgXG4gICAgICAgICAgICApO1xuICAgICAgICB9IHdoaWxlIChwcmVjaXNpb25CaXRzIC09IHN0YXJ0Qml0KTtcbiAgICAgICAgXG4gICAgICAgIFxuICAgIFxuICAgICAgICBpZiAoIGV4cG9uZW50ID09ICggYmlhcyA8PCAxICkgKyAxICkge1xuICAgICAgICBcdGlmIChzaWduaWZpY2FuZCkge1xuICAgICAgICBcdFx0cmV0dXJuIE5hTjtcbiAgICAgICAgXHR9IGVsc2Uge1xuICAgICAgICBcdFx0aWYgKHNpZ25hbCkge1xuICAgICAgICBcdFx0XHRyZXR1cm4gLUluZmluaXR5O1xuICAgICAgICBcdFx0fSBlbHNlIHtcbiAgICAgICAgXHRcdFx0cmV0dXJuICtJbmZpbml0eTtcbiAgICAgICAgXHRcdH1cbiAgICAgICAgXHR9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgIFx0dmFyIF9tb2QgPSAwO1xuICAgICAgICBcdFxuICAgICAgICBcdGlmIChleHBvbmVudCB8fCBzaWduaWZpY2FuZCkge1xuICAgICAgICBcdCAgICBfbW9kID0gZXhwb25lbnQgPyBNYXRoLnBvdyggMiwgZXhwb25lbnQgLSBiaWFzICkgKiAoIDEgKyBzaWduaWZpY2FuZCApIDogTWF0aC5wb3coIDIsIC1iaWFzICsgMSApICogc2lnbmlmaWNhbmQ7XG4gICAgICAgIFx0fVxuICAgICAgICBcdFxuICAgICAgICBcdHJldHVybiAoIDEgKyBzaWduYWwgKiAtMiApICogKF9tb2QpO1xuICAgICAgICB9XG4gICAgXG4gICAgXG4gICAgICAgIC8vIHJldHVybiBleHBvbmVudCA9PSAoIGJpYXMgPDwgMSApICsgMSA/IHNpZ25pZmljYW5kID8gTmFOIDogc2lnbmFsID8gLUluZmluaXR5IDogK0luZmluaXR5IDogKCAxICsgc2lnbmFsICogLTIgKSAqICggZXhwb25lbnQgfHwgc2lnbmlmaWNhbmQgPyAhZXhwb25lbnQgPyBNYXRoLnBvdyggMiwgLWJpYXMgKyAxICkgKiBzaWduaWZpY2FuZCA6IE1hdGgucG93KCAyLCBleHBvbmVudCAtIGJpYXMgKSAqICggMSArIHNpZ25pZmljYW5kICkgOiAwICk7XG4gICAgfTtcbiAgICBcbiAgICBCaW5hcnlQYXJzZXIuZGVjb2RlSW50ID0gZnVuY3Rpb24gKGRhdGEsIGJpdHMsIHNpZ25lZCwgZm9yY2VCaWdFbmRpYW4pIHtcbiAgICAgICAgdmFyIGIgPSBuZXcgQmluYXJ5UGFyc2VyQnVmZmVyKHRoaXMuYmlnRW5kaWFuIHx8IGZvcmNlQmlnRW5kaWFuLCBkYXRhKSxcbiAgICAgICAgICAgIHggPSBiLnJlYWRCaXRzKDAsIGJpdHMpLFxuICAgICAgICAgICAgbWF4ID0gbWF4Qml0c1tiaXRzXTsgLy9tYXggPSBNYXRoLnBvdyggMiwgYml0cyApO1xuICAgIFxuICAgICAgICByZXR1cm4gc2lnbmVkICYmIHggPj0gbWF4IC8gMiA/IHggLSBtYXggOiB4O1xuICAgIH07XG4gICAgXG4gICAgQmluYXJ5UGFyc2VyLmVuY29kZUZsb2F0ID0gZnVuY3Rpb24gKGRhdGEsIHByZWNpc2lvbkJpdHMsIGV4cG9uZW50Qml0cykge1xuICAgICAgICB2YXIgYmlhcyA9IG1heEJpdHNbZXhwb25lbnRCaXRzIC0gMV0gLSAxLFxuICAgICAgICAgICAgbWluRXhwID0gLWJpYXMgKyAxLFxuICAgICAgICAgICAgbWF4RXhwID0gYmlhcyxcbiAgICAgICAgICAgIG1pblVubm9ybUV4cCA9IG1pbkV4cCAtIHByZWNpc2lvbkJpdHMsXG4gICAgICAgICAgICBuID0gcGFyc2VGbG9hdChkYXRhKSxcbiAgICAgICAgICAgIHN0YXR1cyA9IGlzTmFOKG4pIHx8IG4gPT0gLUluZmluaXR5IHx8IG4gPT0gK0luZmluaXR5ID8gbiA6IDAsXG4gICAgICAgICAgICBleHAgPSAwLFxuICAgICAgICAgICAgbGVuID0gMiAqIGJpYXMgKyAxICsgcHJlY2lzaW9uQml0cyArIDMsXG4gICAgICAgICAgICBiaW4gPSBuZXcgQXJyYXkobGVuKSxcbiAgICAgICAgICAgIHNpZ25hbCA9IChuID0gc3RhdHVzICE9PSAwID8gMCA6IG4pIDwgMCxcbiAgICAgICAgICAgIGludFBhcnQgPSBNYXRoLmZsb29yKG4gPSBNYXRoLmFicyhuKSksXG4gICAgICAgICAgICBmbG9hdFBhcnQgPSBuIC0gaW50UGFydCxcbiAgICAgICAgICAgIGxhc3RCaXQsXG4gICAgICAgICAgICByb3VuZGVkLFxuICAgICAgICAgICAgcmVzdWx0LFxuICAgICAgICAgICAgaSxcbiAgICAgICAgICAgIGo7XG4gICAgXG4gICAgXG4gICAgICAgIGZvciAoaSA9IGxlbjsgaTsgYmluWy0taV0gPSAwKTtcbiAgICAgICAgXG4gICAgICAgIGZvciAoaSA9IGJpYXMgKyAyOyBpbnRQYXJ0ICYmIGk7IGJpblstLWldID0gaW50UGFydCAlIDIsIGludFBhcnQgPSBNYXRoLmZsb29yKGludFBhcnQgLyAyKSk7XG4gICAgICAgIFxuICAgICAgICBmb3IgKGkgPSBiaWFzICsgMTsgZmxvYXRQYXJ0ID4gMCAmJiBpOyAoYmluWysraV0gPSAoKGZsb2F0UGFydCAqPSAyKSA+PSAxKSAtIDAgKSAmJiAtLWZsb2F0UGFydCk7XG4gICAgICAgIFxuICAgICAgICBmb3IgKGkgPSAtMTsgKytpIDwgbGVuICYmICFiaW5baV07KTtcbiAgICAgIFxuICAgICAgICBpZiAoYmluWyhsYXN0Qml0ID0gcHJlY2lzaW9uQml0cyAtIDEgKyAoaSA9IChleHAgPSBiaWFzICsgMSAtIGkpID49IG1pbkV4cCAmJiBleHAgPD0gbWF4RXhwID8gaSArIDEgOiBiaWFzICsgMSAtIChleHAgPSBtaW5FeHAgLSAxKSkpICsgMV0pIHtcbiAgICAgICAgICAgIGlmICghKHJvdW5kZWQgPSBiaW5bbGFzdEJpdF0pKSB7XG4gICAgICAgICAgICAgICAgZm9yIChqID0gbGFzdEJpdCArIDI7ICFyb3VuZGVkICYmIGogPCBsZW47IHJvdW5kZWQgPSBiaW5baisrXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGZvciAoaiA9IGxhc3RCaXQgKyAxOyByb3VuZGVkICYmIC0taiA+PSAwOyAoYmluW2pdID0gIWJpbltqXSAtIDApICYmIChyb3VuZGVkID0gMCkpO1xuICAgICAgICB9XG4gICAgICBcbiAgICAgICAgZm9yIChpID0gaSAtIDIgPCAwID8gLTEgOiBpIC0gMzsgKytpIDwgbGVuICYmICFiaW5baV07KTtcbiAgICAgICAgXG4gICAgICAgIGlmICgoZXhwID0gYmlhcyArIDEgLSBpKSA+PSBtaW5FeHAgJiYgZXhwIDw9IG1heEV4cCkge1xuICAgICAgICAgICAgKytpO1xuICAgICAgICB9IGVsc2UgaWYgKGV4cCA8IG1pbkV4cCkge1xuICAgICAgICAgICAgZXhwICE9IGJpYXMgKyAxIC0gbGVuICYmIGV4cCA8IG1pblVubm9ybUV4cCAmJiBjb25zb2xlLndhcm4oXCJlbmNvZGVGbG9hdDo6ZmxvYXQgdW5kZXJmbG93XCIpOyAgICAvLyBUT0RPIGxvZ2dlclxuICAgICAgICAgICAgaSA9IGJpYXMgKyAxIC0gKGV4cCA9IG1pbkV4cCAtIDEpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAoaW50UGFydCB8fCBzdGF0dXMgIT09IDApIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihpbnRQYXJ0ID8gXCJlbmNvZGVGbG9hdDo6ZmxvYXQgb3ZlcmZsb3dcIiA6IFwiZW5jb2RlRmxvYXQ6OlwiICsgc3RhdHVzKTsgICAgLy8gVE9ETyBsb2dnZXJcbiAgICAgICAgICAgIGV4cCA9IG1heEV4cCArIDE7XG4gICAgICAgICAgICBpID0gYmlhcyArIDI7XG4gICAgICAgIFxuICAgICAgICAgICAgaWYgKHN0YXR1cyA9PSAtSW5maW5pdHkpIHtcbiAgICAgICAgICAgICAgICBzaWduYWwgPSAxO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChpc05hTihzdGF0dXMpKSB7XG4gICAgICAgICAgICAgICAgYmluW2ldID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgXG4gICAgICAgIGZvciAobiA9IE1hdGguYWJzKGV4cCArIGJpYXMpLCBqID0gZXhwb25lbnRCaXRzICsgMSwgcmVzdWx0ID0gXCJcIjsgLS1qOyByZXN1bHQgPSAobiAlIDIpICsgcmVzdWx0LCBuID0gbiA+Pj0gMSk7XG4gICAgICAgIFxuICAgICAgICBsZXQgciA9IFtdO1xuICAgICAgICBcbiAgICAgICAgZm9yIChuID0gMCwgaiA9IDAsIGkgPSAocmVzdWx0ID0gKHNpZ25hbCA/IFwiMVwiIDogXCIwXCIpICsgcmVzdWx0ICsgYmluLnNsaWNlKGksIGkgKyBwcmVjaXNpb25CaXRzKS5qb2luKFwiXCIpKS5sZW5ndGgsIHIgPSBbXTsgaTsgaiA9IChqICsgMSkgJSA4KSB7XG4gICAgICAgICAgICBuICs9ICgxIDw8IGopICogcmVzdWx0LmNoYXJBdCgtLWkpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoaiA9PSA3KSB7XG4gICAgICAgICAgICAgICAgcltyLmxlbmd0aF0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKG4pO1xuICAgICAgICAgICAgICAgIG4gPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICBcbiAgICAgICAgcltyLmxlbmd0aF0gPSBuID8gU3RyaW5nLmZyb21DaGFyQ29kZShuKSA6IFwiXCI7XG4gICAgICBcbiAgICAgICAgcmV0dXJuICh0aGlzLmJpZ0VuZGlhbiA/IHIucmV2ZXJzZSgpIDogcikuam9pbihcIlwiKTtcbiAgICB9O1xuICAgIFxuICAgIEJpbmFyeVBhcnNlci5lbmNvZGVJbnQgPSBmdW5jdGlvbiAoZGF0YSwgYml0cywgc2lnbmVkLCBmb3JjZUJpZ0VuZGlhbikge1xuICAgICAgICB2YXIgbWF4ID0gbWF4Qml0c1tiaXRzXTtcbiAgICAgICAgXG4gICAgICAgIGlmIChkYXRhID49IG1heCB8fCBkYXRhIDwgLShtYXggLyAyKSkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFwiZW5jb2RlSW50OjpvdmVyZmxvd1wiKTsgICAgLy8gVE9ETyBsb2dnZXJcbiAgICAgICAgICAgIGRhdGEgPSAwO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAoZGF0YSA8IDApIHtcbiAgICAgICAgICAgIGRhdGEgKz0gbWF4O1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBmb3IgKHZhciByID0gW107IGRhdGE7IHJbci5sZW5ndGhdID0gU3RyaW5nLmZyb21DaGFyQ29kZShkYXRhICUgMjU2KSwgZGF0YSA9IE1hdGguZmxvb3IoZGF0YSAvIDI1NikpO1xuICAgICAgICBcbiAgICAgICAgZm9yIChiaXRzID0gLSgtYml0cyA+PiAzKSAtIHIubGVuZ3RoOyBiaXRzLS07IHJbci5sZW5ndGhdID0gXCJcXDBcIik7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gKCh0aGlzLmJpZ0VuZGlhbiB8fCBmb3JjZUJpZ0VuZGlhbikgPyByLnJldmVyc2UoKSA6IHIpLmpvaW4oXCJcIik7XG4gICAgfTtcbiAgICBcbiAgICBCaW5hcnlQYXJzZXIudG9TbWFsbCAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgIDgsIHRydWUgICk7IH07XG4gICAgQmluYXJ5UGFyc2VyLmZyb21TbWFsbCAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVJbnQoIGRhdGEsICA4LCB0cnVlICApOyB9O1xuICAgIEJpbmFyeVBhcnNlci50b0J5dGUgICAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZGVjb2RlSW50KCBkYXRhLCAgOCwgZmFsc2UgKTsgfTtcbiAgICBCaW5hcnlQYXJzZXIuZnJvbUJ5dGUgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgIDgsIGZhbHNlICk7IH07XG4gICAgQmluYXJ5UGFyc2VyLnRvU2hvcnQgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVJbnQoIGRhdGEsIDE2LCB0cnVlICApOyB9O1xuICAgIEJpbmFyeVBhcnNlci5mcm9tU2hvcnQgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlSW50KCBkYXRhLCAxNiwgdHJ1ZSAgKTsgfTtcbiAgICBCaW5hcnlQYXJzZXIudG9Xb3JkICAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgMTYsIGZhbHNlICk7IH07XG4gICAgQmluYXJ5UGFyc2VyLmZyb21Xb3JkICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVJbnQoIGRhdGEsIDE2LCBmYWxzZSApOyB9O1xuICAgIEJpbmFyeVBhcnNlci50b0ludCAgICAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZGVjb2RlSW50KCBkYXRhLCAzMiwgdHJ1ZSAgKTsgfTtcbiAgICBCaW5hcnlQYXJzZXIuZnJvbUludCAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgMzIsIHRydWUgICk7IH07XG4gICAgQmluYXJ5UGFyc2VyLnRvTG9uZyAgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVJbnQoIGRhdGEsIDY0LCB0cnVlICApOyB9O1xuICAgIEJpbmFyeVBhcnNlci5mcm9tTG9uZyAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlSW50KCBkYXRhLCA2NCwgdHJ1ZSAgKTsgfTtcbiAgICBCaW5hcnlQYXJzZXIudG9EV29yZCAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgMzIsIGZhbHNlICk7IH07XG4gICAgQmluYXJ5UGFyc2VyLmZyb21EV29yZCAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVJbnQoIGRhdGEsIDMyLCBmYWxzZSApOyB9O1xuICAgIEJpbmFyeVBhcnNlci50b1FXb3JkICAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZGVjb2RlSW50KCBkYXRhLCA2NCwgdHJ1ZSApOyB9O1xuICAgIEJpbmFyeVBhcnNlci5mcm9tUVdvcmQgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlSW50KCBkYXRhLCA2NCwgdHJ1ZSApOyB9O1xuICAgIEJpbmFyeVBhcnNlci50b0Zsb2F0ICAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZGVjb2RlRmxvYXQoIGRhdGEsIDIzLCA4ICAgKTsgfTtcbiAgICBCaW5hcnlQYXJzZXIuZnJvbUZsb2F0ICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUZsb2F0KCBkYXRhLCAyMywgOCAgICk7IH07XG4gICAgQmluYXJ5UGFyc2VyLnRvRG91YmxlICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVGbG9hdCggZGF0YSwgNTIsIDExICApOyB9O1xuICAgIEJpbmFyeVBhcnNlci5mcm9tRG91YmxlID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlRmxvYXQoIGRhdGEsIDUyLCAxMSAgKTsgfTtcbiAgICBcbiAgICAvLyBGYWN0b3Igb3V0IHRoZSBlbmNvZGUgc28gaXQgY2FuIGJlIHNoYXJlZCBieSBhZGRfaGVhZGVyIGFuZCBwdXNoX2ludDMyXG4gICAgQmluYXJ5UGFyc2VyLmVuY29kZV9pbnQzMiA9IGZ1bmN0aW9uIChudW1iZXIsIGFzQXJyYXkpIHtcbiAgICAgICAgdmFyIGEsIGIsIGMsIGQsIHVuc2lnbmVkO1xuICAgICAgICBcbiAgICAgICAgdW5zaWduZWQgPSAobnVtYmVyIDwgMCkgPyAobnVtYmVyICsgMHgxMDAwMDAwMDApIDogbnVtYmVyO1xuICAgICAgICBhID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmZmZmZmKTtcbiAgICAgICAgXG4gICAgICAgIHVuc2lnbmVkICY9IDB4ZmZmZmZmO1xuICAgICAgICBiID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmZmZik7XG4gICAgICAgIFxuICAgICAgICB1bnNpZ25lZCAmPSAweGZmZmY7XG4gICAgICAgIGMgPSBNYXRoLmZsb29yKHVuc2lnbmVkIC8gMHhmZik7XG4gICAgICAgIFxuICAgICAgICB1bnNpZ25lZCAmPSAweGZmO1xuICAgICAgICBkID0gTWF0aC5mbG9vcih1bnNpZ25lZCk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gYXNBcnJheSA/IFtjaHIoYSksIGNocihiKSwgY2hyKGMpLCBjaHIoZCldIDogY2hyKGEpICsgY2hyKGIpICsgY2hyKGMpICsgY2hyKGQpO1xuICAgIH07XG4gICAgXG4gICAgQmluYXJ5UGFyc2VyLmVuY29kZV9pbnQ2NCA9IGZ1bmN0aW9uIChudW1iZXIpIHtcbiAgICAgICAgdmFyIGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgsIHVuc2lnbmVkO1xuICAgICAgICBcbiAgICAgICAgdW5zaWduZWQgPSAobnVtYmVyIDwgMCkgPyAobnVtYmVyICsgMHgxMDAwMDAwMDAwMDAwMDAwMCkgOiBudW1iZXI7XG4gICAgICAgIGEgPSBNYXRoLmZsb29yKHVuc2lnbmVkIC8gMHhmZmZmZmZmZmZmZmZmZik7XG4gICAgICAgIFxuICAgICAgICB1bnNpZ25lZCAmPSAweGZmZmZmZmZmZmZmZmZmO1xuICAgICAgICBiID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmZmZmZmZmZmZmZmKTtcbiAgICAgICAgXG4gICAgICAgIHVuc2lnbmVkICY9IDB4ZmZmZmZmZmZmZmZmO1xuICAgICAgICBjID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmZmZmZmZmZmZik7XG4gICAgICAgIFxuICAgICAgICB1bnNpZ25lZCAmPSAweGZmZmZmZmZmZmY7XG4gICAgICAgIGQgPSBNYXRoLmZsb29yKHVuc2lnbmVkIC8gMHhmZmZmZmZmZik7XG4gICAgICAgIFxuICAgICAgICB1bnNpZ25lZCAmPSAweGZmZmZmZmZmO1xuICAgICAgICBlID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmZmZmZmKTtcbiAgICAgICAgXG4gICAgICAgIHVuc2lnbmVkICY9IDB4ZmZmZmZmO1xuICAgICAgICBmID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmZmZik7XG4gICAgICAgIFxuICAgICAgICB1bnNpZ25lZCAmPSAweGZmZmY7XG4gICAgICAgIGcgPSBNYXRoLmZsb29yKHVuc2lnbmVkIC8gMHhmZik7XG4gICAgICAgIFxuICAgICAgICB1bnNpZ25lZCAmPSAweGZmO1xuICAgICAgICBoID0gTWF0aC5mbG9vcih1bnNpZ25lZCk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gY2hyKGEpICsgY2hyKGIpICsgY2hyKGMpICsgY2hyKGQpICsgY2hyKGUpICsgY2hyKGYpICsgY2hyKGcpICsgY2hyKGgpO1xuICAgIH07XG4gICAgXG4gICAgLyoqXG4gICAgICogVVRGOCBtZXRob2RzXG4gICAgICovXG4gICAgXG4gICAgLy8gVGFrZSBhIHJhdyBiaW5hcnkgc3RyaW5nIGFuZCByZXR1cm4gYSB1dGY4IHN0cmluZ1xuICAgIEJpbmFyeVBhcnNlci5kZWNvZGVfdXRmOCA9IGZ1bmN0aW9uIChiaW5hcnlTdHIpIHtcbiAgICAgICAgdmFyIGxlbiA9IGJpbmFyeVN0ci5sZW5ndGgsXG4gICAgICAgICAgICBkZWNvZGVkID0gJycsXG4gICAgICAgICAgICBpID0gMCxcbiAgICAgICAgICAgIGMgPSAwLFxuICAgICAgICAgICAgYzEgPSAwLFxuICAgICAgICAgICAgYzIgPSAwLFxuICAgICAgICAgICAgYzM7XG4gICAgICAgIFxuICAgICAgICB3aGlsZSAoaSA8IGxlbikge1xuICAgICAgICAgICAgYyA9IGJpbmFyeVN0ci5jaGFyQ29kZUF0KGkpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoYyA8IDEyOCkge1xuICAgICAgICAgICAgICAgIGRlY29kZWQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpKys7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKChjID4gMTkxKSAmJiAoYyA8IDIyNCkpIHtcbiAgICAgICAgICAgICAgICBjMiA9IGJpbmFyeVN0ci5jaGFyQ29kZUF0KGkrMSk7XG4gICAgICAgICAgICAgICAgZGVjb2RlZCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYyAmIDMxKSA8PCA2KSB8IChjMiAmIDYzKSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaSArPSAyO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjMiA9IGJpbmFyeVN0ci5jaGFyQ29kZUF0KGkrMSk7XG4gICAgICAgICAgICAgICAgYzMgPSBiaW5hcnlTdHIuY2hhckNvZGVBdChpKzIpO1xuICAgICAgICAgICAgICAgIGRlY29kZWQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgJiAxNSkgPDwgMTIpIHwgKChjMiAmIDYzKSA8PCA2KSB8IChjMyAmIDYzKSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaSArPSAzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZGVjb2RlZDtcbiAgICB9O1xuICAgIFxuICAgIC8vIEVuY29kZSBhIGNzdHJpbmdcbiAgICBCaW5hcnlQYXJzZXIuZW5jb2RlX2NzdHJpbmcgPSBmdW5jdGlvbiAocykge1xuICAgICAgICByZXR1cm4gdW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHMpKSArIEJpbmFyeVBhcnNlci5mcm9tQnl0ZSgwKTtcbiAgICB9O1xuICAgIFxuICAgIC8vIFRha2UgYSB1dGY4IHN0cmluZyBhbmQgcmV0dXJuIGEgYmluYXJ5IHN0cmluZ1xuICAgIEJpbmFyeVBhcnNlci5lbmNvZGVfdXRmOCA9IGZ1bmN0aW9uIGVuY29kZV91dGY4IChzKSB7XG4gICAgICAgIHZhciBhID0gXCJcIixcbiAgICAgICAgICAgIGM7XG4gICAgXG4gICAgICAgIGZvciAodmFyIG4gPSAwLCBsZW4gPSBzLmxlbmd0aDsgbiA8IGxlbjsgbisrKSB7XG4gICAgICAgICAgICBjID0gcy5jaGFyQ29kZUF0KG4pO1xuICAgIFxuICAgICAgICAgICAgaWYgKGMgPCAxMjgpIHtcbiAgICAgICAgICAgICAgICBhICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKChjID4gMTI3KSAmJiAoYyA8IDIwNDgpKSB7XG4gICAgICAgICAgICAgICAgYSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjPj42KSB8IDE5MikgO1xuICAgICAgICAgICAgICAgIGEgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyY2MykgfCAxMjgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBhICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGM+PjEyKSB8IDIyNCk7XG4gICAgICAgICAgICAgICAgYSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYz4+NikgJiA2MykgfCAxMjgpO1xuICAgICAgICAgICAgICAgIGEgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyY2MykgfCAxMjgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXG4gICAgICAgIHJldHVybiBhO1xuICAgIH07XG4gICAgXG4gICAgQmluYXJ5UGFyc2VyLmhwcmludCA9IGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHZhciBudW1iZXI7XG4gICAgXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBpZiAocy5jaGFyQ29kZUF0KGkpIDwgMzIpIHtcbiAgICAgICAgICAgICAgICBudW1iZXIgPSBzLmNoYXJDb2RlQXQoaSkgPD0gMTUgPyBcIjBcIiArIHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxNikgOiBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKG51bWJlciArIFwiIFwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbnVtYmVyID0gcy5jaGFyQ29kZUF0KGkpIDw9IDE1ID8gXCIwXCIgKyBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpIDogcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDE2KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShudW1iZXIgKyBcIiBcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKFwiXFxuXFxuXCIpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIG51bWJlcjtcbiAgICB9O1xuICAgIFxuICAgIEJpbmFyeVBhcnNlci5pbHByaW50ID0gZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgdmFyIG51bWJlcjtcbiAgICBcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChzLmNoYXJDb2RlQXQoaSkgPCAzMikge1xuICAgICAgICAgICAgICAgIG51bWJlciA9IHMuY2hhckNvZGVBdChpKSA8PSAxNSA/IFwiMFwiICsgcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDEwKSA6IHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxMCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUobnVtYmVyICsgXCIgXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBudW1iZXIgPSBzLmNoYXJDb2RlQXQoaSkgPD0gMTUgPyBcIjBcIiArIHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxMCkgOiBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTApO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKG51bWJlciArIFwiIFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoXCJcXG5cXG5cIik7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gbnVtYmVyO1xuICAgIH07XG4gICAgXG4gICAgQmluYXJ5UGFyc2VyLmhscHJpbnQgPSBmdW5jdGlvbiAocykge1xuICAgICAgICB2YXIgbnVtYmVyO1xuICAgICAgICBcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChzLmNoYXJDb2RlQXQoaSkgPCAzMikge1xuICAgICAgICAgICAgICAgIG51bWJlciA9IHMuY2hhckNvZGVBdChpKSA8PSAxNSA/IFwiMFwiICsgcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDE2KSA6IHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxNik7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUobnVtYmVyICsgXCIgXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBudW1iZXIgPSBzLmNoYXJDb2RlQXQoaSkgPD0gMTUgPyBcIjBcIiArIHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxNikgOiBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKG51bWJlciArIFwiIFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoXCJcXG5cXG5cIik7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gbnVtYmVyO1xuICAgIH07XG4gICAgXG4gICAgcmV0dXJuIEJpbmFyeVBhcnNlcjtcbn07Il19
