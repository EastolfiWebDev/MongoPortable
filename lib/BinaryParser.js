"use strict";

/**
 * @file BinaryParser.js - based on ({@link http://jsfromhell.com/classes/binary-parser Binary Parser}) by Jonas Raoni Soares Silva
 * @version 0.0.1
 * @ignore
 * 
 * @author Eduardo Astolfi <eduardo.astolfi91@gmail.com>
 * @copyright 2016 Eduardo Astolfi <eduardo.astolfi91@gmail.com>
 * @license MIT Licensed
 */

var Logger = require("./utils/Logger"),
    BinaryParserBuffer = require("./BinaryParserBuffer");

// Shorcut for String.fromCharCode
var chr = String.fromCharCode;

var maxBits = [];
for (var i = 0; i < 64; i++) {
    maxBits[i] = Math.pow(2, i);
}

/**
 * BinaryParser
 * @ignore
 * 
 * @module Cursor
 * @constructor
 * @since 0.0.1
 * 
 * @classdesc Cursor class that maps a MongoDB-like cursor
 * 
 * @param {MongoPortable} db - Additional options
 * @param {Collection} collection - The collection instance
 * @param {Object|Array|String} [selection={}] - The selection for matching documents
 * @param {Object|Array|String} [fields={}] - The fields of the document to show
 * @param {Object} [options] - Database object
 * 
 * @param {Object} [options.pkFactory=null] - Object overriding the basic "ObjectId" primary key generation.
 * 
 */
function BinaryParser(bigEndian, allowExceptions) {
    if (!(this instanceof BinaryParser)) return new BinaryParser(bigEndian, allowExceptions);

    this.bigEndian = bigEndian;
    this.allowExceptions = allowExceptions;
}

BinaryParser.Buffer = BinaryParserBuffer;

BinaryParser.warn = function (msg) {
    if (this.allowExceptions) {
        throw new Error(msg);
    }

    return 1;
};

BinaryParser.decodeFloat = function (data, precisionBits, exponentBits) {
    var b = new this.Buffer(this.bigEndian, data);

    b.checkBuffer(precisionBits + exponentBits + 1);

    var bias = maxBits[exponentBits - 1] - 1,
        signal = b.readBits(precisionBits + exponentBits, 1),
        exponent = b.readBits(precisionBits, exponentBits),
        significand = 0,
        divisor = 2,
        curByte = b.buffer.length + (-precisionBits >> 3) - 1;

    do {
        for (var byteValue = b.buffer[++curByte], startBit = precisionBits % 8 || 8, mask = 1 << startBit; mask >>= 1; byteValue & mask && (significand += 1 / divisor), divisor *= 2) {}
    } while (precisionBits -= startBit);

    // if (exponent == ( bias << 1 ) + 1) {
    //     if (significand) {
    //         return NaN;
    //     } else {
    //         if (signal) {
    //             return -Infinity;
    //         } else {
    //             return +Infinity;
    //         }
    //     }
    // } else {
    //     var _a = ( 1 + signal * -2 );

    //     if (exponent || significand) {
    //         if (!exponent) {
    //             return _a * (Math.pow( 2, -bias + 1 ) * significand);
    //         } else {
    //             return _a * (Math.pow( 2, exponent - bias ) * ( 1 + significand ));
    //         }
    //     } else {
    //         return _a * 0;
    //     }
    // }

    return exponent == (bias << 1) + 1 ? significand ? NaN : signal ? -Infinity : +Infinity : (1 + signal * -2) * (exponent || significand ? !exponent ? Math.pow(2, -bias + 1) * significand : Math.pow(2, exponent - bias) * (1 + significand) : 0);
};

BinaryParser.decodeInt = function (data, bits, signed, forceBigEndian) {
    var b = new this.Buffer(this.bigEndian || forceBigEndian, data),
        x = b.readBits(0, bits),
        max = maxBits[bits]; //max = Math.pow( 2, bits );

    return signed && x >= max / 2 ? x - max : x;
};

BinaryParser.encodeFloat = function (data, precisionBits, exponentBits) {
    var bias = maxBits[exponentBits - 1] - 1,
        minExp = -bias + 1,
        maxExp = bias,
        minUnnormExp = minExp - precisionBits,
        n = parseFloat(data),
        status = isNaN(n) || n == -Infinity || n == +Infinity ? n : 0,
        exp = 0,
        len = 2 * bias + 1 + precisionBits + 3,
        bin = new Array(len),
        signal = (n = status !== 0 ? 0 : n) < 0,
        intPart = Math.floor(n = Math.abs(n)),
        floatPart = n - intPart,
        lastBit,
        rounded,
        result,
        i,
        j;

    // DAFUCK?

    for (i = len; i; bin[--i] = 0) {}

    for (i = bias + 2; intPart && i; bin[--i] = intPart % 2, intPart = Math.floor(intPart / 2)) {}

    for (i = bias + 1; floatPart > 0 && i; (bin[++i] = ((floatPart *= 2) >= 1) - 0) && --floatPart) {}

    for (i = -1; ++i < len && !bin[i];) {}

    if (bin[(lastBit = precisionBits - 1 + (i = (exp = bias + 1 - i) >= minExp && exp <= maxExp ? i + 1 : bias + 1 - (exp = minExp - 1))) + 1]) {
        if (!(rounded = bin[lastBit])) {
            for (j = lastBit + 2; !rounded && j < len; rounded = bin[j++]) {}
        }

        for (j = lastBit + 1; rounded && --j >= 0; (bin[j] = !bin[j] - 0) && (rounded = 0)) {}
    }

    for (i = i - 2 < 0 ? -1 : i - 3; ++i < len && !bin[i];) {}

    if ((exp = bias + 1 - i) >= minExp && exp <= maxExp) {
        ++i;
    } else if (exp < minExp) {
        exp != bias + 1 - len && exp < minUnnormExp && this.warn("encodeFloat::float underflow");
        i = bias + 1 - (exp = minExp - 1);
    }

    if (intPart || status !== 0) {
        this.warn(intPart ? "encodeFloat::float overflow" : "encodeFloat::" + status);
        exp = maxExp + 1;
        i = bias + 2;

        if (status == -Infinity) {
            signal = 1;
        } else if (isNaN(status)) {
            bin[i] = 1;
        }
    }

    for (n = Math.abs(exp + bias), j = exponentBits + 1, result = ""; --j; result = n % 2 + result, n = n >>= 1) {}

    for (n = 0, j = 0, i = (result = (signal ? "1" : "0") + result + bin.slice(i, i + precisionBits).join("")).length, r = []; i; j = (j + 1) % 8) {
        n += (1 << j) * result.charAt(--i);

        if (j == 7) {
            r[r.length] = String.fromCharCode(n);
            n = 0;
        }
    }

    r[r.length] = n ? String.fromCharCode(n) : "";

    return (this.bigEndian ? r.reverse() : r).join("");
};

BinaryParser.encodeInt = function (data, bits, signed, forceBigEndian) {
    var max = maxBits[bits];

    if (data >= max || data < -(max / 2)) {
        this.warn("encodeInt::overflow");
        data = 0;
    }

    if (data < 0) {
        data += max;
    }

    for (var r = []; data; r[r.length] = String.fromCharCode(data % 256), data = Math.floor(data / 256)) {}

    for (bits = -(-bits >> 3) - r.length; bits--; r[r.length] = "\0") {}

    return (this.bigEndian || forceBigEndian ? r.reverse() : r).join("");
};

BinaryParser.toSmall = function (data) {
    return this.decodeInt(data, 8, true);
};
BinaryParser.fromSmall = function (data) {
    return this.encodeInt(data, 8, true);
};
BinaryParser.toByte = function (data) {
    return this.decodeInt(data, 8, false);
};
BinaryParser.fromByte = function (data) {
    return this.encodeInt(data, 8, false);
};
BinaryParser.toShort = function (data) {
    return this.decodeInt(data, 16, true);
};
BinaryParser.fromShort = function (data) {
    return this.encodeInt(data, 16, true);
};
BinaryParser.toWord = function (data) {
    return this.decodeInt(data, 16, false);
};
BinaryParser.fromWord = function (data) {
    return this.encodeInt(data, 16, false);
};
BinaryParser.toInt = function (data) {
    return this.decodeInt(data, 32, true);
};
BinaryParser.fromInt = function (data) {
    return this.encodeInt(data, 32, true);
};
BinaryParser.toLong = function (data) {
    return this.decodeInt(data, 64, true);
};
BinaryParser.fromLong = function (data) {
    return this.encodeInt(data, 64, true);
};
BinaryParser.toDWord = function (data) {
    return this.decodeInt(data, 32, false);
};
BinaryParser.fromDWord = function (data) {
    return this.encodeInt(data, 32, false);
};
BinaryParser.toQWord = function (data) {
    return this.decodeInt(data, 64, true);
};
BinaryParser.fromQWord = function (data) {
    return this.encodeInt(data, 64, true);
};
BinaryParser.toFloat = function (data) {
    return this.decodeFloat(data, 23, 8);
};
BinaryParser.fromFloat = function (data) {
    return this.encodeFloat(data, 23, 8);
};
BinaryParser.toDouble = function (data) {
    return this.decodeFloat(data, 52, 11);
};
BinaryParser.fromDouble = function (data) {
    return this.encodeFloat(data, 52, 11);
};

// Factor out the encode so it can be shared by add_header and push_int32
BinaryParser.encode_int32 = function (number, asArray) {
    var a, b, c, d, unsigned;

    unsigned = number < 0 ? number + 0x100000000 : number;
    a = Math.floor(unsigned / 0xffffff);

    unsigned &= 0xffffff;
    b = Math.floor(unsigned / 0xffff);

    unsigned &= 0xffff;
    c = Math.floor(unsigned / 0xff);

    unsigned &= 0xff;
    d = Math.floor(unsigned);

    return asArray ? [chr(a), chr(b), chr(c), chr(d)] : chr(a) + chr(b) + chr(c) + chr(d);
};

BinaryParser.encode_int64 = function (number) {
    var a, b, c, d, e, f, g, h, unsigned;

    unsigned = number < 0 ? number + 0x10000000000000000 : number;
    a = Math.floor(unsigned / 0xffffffffffffff);

    unsigned &= 0xffffffffffffff;
    b = Math.floor(unsigned / 0xffffffffffff);

    unsigned &= 0xffffffffffff;
    c = Math.floor(unsigned / 0xffffffffff);

    unsigned &= 0xffffffffff;
    d = Math.floor(unsigned / 0xffffffff);

    unsigned &= 0xffffffff;
    e = Math.floor(unsigned / 0xffffff);

    unsigned &= 0xffffff;
    f = Math.floor(unsigned / 0xffff);

    unsigned &= 0xffff;
    g = Math.floor(unsigned / 0xff);

    unsigned &= 0xff;
    h = Math.floor(unsigned);

    return chr(a) + chr(b) + chr(c) + chr(d) + chr(e) + chr(f) + chr(g) + chr(h);
};

/**
 * UTF8 methods
 */

// Take a raw binary string and return a utf8 string
BinaryParser.decode_utf8 = function (binaryStr) {
    var len = binaryStr.length,
        decoded = '',
        i = 0,
        c = 0,
        c1 = 0,
        c2 = 0,
        c3;

    while (i < len) {
        c = binaryStr.charCodeAt(i);

        if (c < 128) {
            decoded += String.fromCharCode(c);

            i++;
        } else if (c > 191 && c < 224) {
            c2 = binaryStr.charCodeAt(i + 1);
            decoded += String.fromCharCode((c & 31) << 6 | c2 & 63);

            i += 2;
        } else {
            c2 = binaryStr.charCodeAt(i + 1);
            c3 = binaryStr.charCodeAt(i + 2);
            decoded += String.fromCharCode((c & 15) << 12 | (c2 & 63) << 6 | c3 & 63);

            i += 3;
        }
    }

    return decoded;
};

// Encode a cstring
BinaryParser.encode_cstring = function (s) {
    return unescape(encodeURIComponent(s)) + BinaryParser.fromByte(0);
};

// Take a utf8 string and return a binary string
BinaryParser.encode_utf8 = function encode_utf8(s) {
    var a = "",
        c;

    for (var n = 0, len = s.length; n < len; n++) {
        c = s.charCodeAt(n);

        if (c < 128) {
            a += String.fromCharCode(c);
        } else if (c > 127 && c < 2048) {
            a += String.fromCharCode(c >> 6 | 192);
            a += String.fromCharCode(c & 63 | 128);
        } else {
            a += String.fromCharCode(c >> 12 | 224);
            a += String.fromCharCode(c >> 6 & 63 | 128);
            a += String.fromCharCode(c & 63 | 128);
        }
    }

    return a;
};

BinaryParser.hprint = function (s) {
    var number;

    for (var i = 0, len = s.length; i < len; i++) {
        if (s.charCodeAt(i) < 32) {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

            process.stdout.write(number + " ");
        } else {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

            process.stdout.write(number + " ");
        }
    }

    process.stdout.write("\n\n");
};

BinaryParser.ilprint = function (s) {
    var number;

    for (var i = 0, len = s.length; i < len; i++) {
        if (s.charCodeAt(i) < 32) {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(10) : s.charCodeAt(i).toString(10);
        } else {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(10) : s.charCodeAt(i).toString(10);
        }
    }
};

BinaryParser.hlprint = function (s) {
    var number;

    for (var i = 0, len = s.length; i < len; i++) {
        if (s.charCodeAt(i) < 32) {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);
        } else {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);
        }
    }
};

module.exports = BinaryParser;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9CaW5hcnlQYXJzZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBVUEsSUFBSSxTQUFTLFFBQVEsZ0JBQVIsQ0FBYjtJQUNJLHFCQUFxQixRQUFRLHNCQUFSLENBRHpCOzs7QUFJQSxJQUFJLE1BQU0sT0FBTyxZQUFqQjs7QUFFQSxJQUFJLFVBQVUsRUFBZDtBQUNBLEtBQUssSUFBSSxJQUFJLENBQWIsRUFBZ0IsSUFBSSxFQUFwQixFQUF3QixHQUF4QixFQUE2QjtBQUN6QixZQUFRLENBQVIsSUFBYSxLQUFLLEdBQUwsQ0FBUyxDQUFULEVBQVksQ0FBWixDQUFiO0FBQ0g7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXFCRCxTQUFTLFlBQVQsQ0FBdUIsU0FBdkIsRUFBa0MsZUFBbEMsRUFBbUQ7QUFDL0MsUUFBSSxFQUFFLGdCQUFnQixZQUFsQixDQUFKLEVBQXFDLE9BQU8sSUFBSSxZQUFKLENBQWlCLFNBQWpCLEVBQTRCLGVBQTVCLENBQVA7O0FBRXJDLFNBQUssU0FBTCxHQUFpQixTQUFqQjtBQUNBLFNBQUssZUFBTCxHQUF1QixlQUF2QjtBQUNIOztBQUVELGFBQWEsTUFBYixHQUFzQixrQkFBdEI7O0FBRUEsYUFBYSxJQUFiLEdBQW9CLFVBQVUsR0FBVixFQUFlO0FBQy9CLFFBQUksS0FBSyxlQUFULEVBQTBCO0FBQ3RCLGNBQU0sSUFBSSxLQUFKLENBQVUsR0FBVixDQUFOO0FBQ0g7O0FBRUQsV0FBTyxDQUFQO0FBQ0gsQ0FORDs7QUFRQSxhQUFhLFdBQWIsR0FBMkIsVUFBVSxJQUFWLEVBQWdCLGFBQWhCLEVBQStCLFlBQS9CLEVBQTZDO0FBQ3BFLFFBQUksSUFBSSxJQUFJLEtBQUssTUFBVCxDQUFnQixLQUFLLFNBQXJCLEVBQWdDLElBQWhDLENBQVI7O0FBRUEsTUFBRSxXQUFGLENBQWMsZ0JBQWdCLFlBQWhCLEdBQStCLENBQTdDOztBQUVBLFFBQUksT0FBTyxRQUFRLGVBQWUsQ0FBdkIsSUFBNEIsQ0FBdkM7UUFDSSxTQUFTLEVBQUUsUUFBRixDQUFXLGdCQUFnQixZQUEzQixFQUF5QyxDQUF6QyxDQURiO1FBRUksV0FBVyxFQUFFLFFBQUYsQ0FBVyxhQUFYLEVBQTBCLFlBQTFCLENBRmY7UUFHSSxjQUFjLENBSGxCO1FBSUksVUFBVSxDQUpkO1FBS0ksVUFBVSxFQUFFLE1BQUYsQ0FBUyxNQUFULElBQW1CLENBQUMsYUFBRCxJQUFrQixDQUFyQyxJQUEwQyxDQUx4RDs7QUFPQSxPQUFHO0FBQ0MsYUFBSyxJQUFJLFlBQVksRUFBRSxNQUFGLENBQVUsRUFBRSxPQUFaLENBQWhCLEVBQXVDLFdBQVcsZ0JBQWdCLENBQWhCLElBQXFCLENBQXZFLEVBQTBFLE9BQU8sS0FBSyxRQUEzRixFQUFxRyxTQUFTLENBQTlHLEVBQW1ILFlBQVksSUFBZCxLQUEwQixlQUFlLElBQUksT0FBN0MsR0FBd0QsV0FBVyxDQUFwTDtBQUNILEtBRkQsUUFFUyxpQkFBaUIsUUFGMUI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNEJBLFdBQU8sWUFBWSxDQUFFLFFBQVEsQ0FBVixJQUFnQixDQUE1QixHQUFnQyxjQUFjLEdBQWQsR0FBb0IsU0FBUyxDQUFDLFFBQVYsR0FBcUIsQ0FBQyxRQUExRSxHQUFxRixDQUFFLElBQUksU0FBUyxDQUFDLENBQWhCLEtBQXdCLFlBQVksV0FBWixHQUEwQixDQUFDLFFBQUQsR0FBWSxLQUFLLEdBQUwsQ0FBVSxDQUFWLEVBQWEsQ0FBQyxJQUFELEdBQVEsQ0FBckIsSUFBMkIsV0FBdkMsR0FBcUQsS0FBSyxHQUFMLENBQVUsQ0FBVixFQUFhLFdBQVcsSUFBeEIsS0FBbUMsSUFBSSxXQUF2QyxDQUEvRSxHQUFzSSxDQUE5SixDQUE1RjtBQUNILENBekNEOztBQTJDQSxhQUFhLFNBQWIsR0FBeUIsVUFBVSxJQUFWLEVBQWdCLElBQWhCLEVBQXNCLE1BQXRCLEVBQThCLGNBQTlCLEVBQThDO0FBQ25FLFFBQUksSUFBSSxJQUFJLEtBQUssTUFBVCxDQUFnQixLQUFLLFNBQUwsSUFBa0IsY0FBbEMsRUFBa0QsSUFBbEQsQ0FBUjtRQUNJLElBQUksRUFBRSxRQUFGLENBQVcsQ0FBWCxFQUFjLElBQWQsQ0FEUjtRQUVJLE1BQU0sUUFBUSxJQUFSLENBRlYsQzs7QUFJQSxXQUFPLFVBQVUsS0FBSyxNQUFNLENBQXJCLEdBQXlCLElBQUksR0FBN0IsR0FBbUMsQ0FBMUM7QUFDSCxDQU5EOztBQVFBLGFBQWEsV0FBYixHQUEyQixVQUFVLElBQVYsRUFBZ0IsYUFBaEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFDcEUsUUFBSSxPQUFPLFFBQVEsZUFBZSxDQUF2QixJQUE0QixDQUF2QztRQUNJLFNBQVMsQ0FBQyxJQUFELEdBQVEsQ0FEckI7UUFFSSxTQUFTLElBRmI7UUFHSSxlQUFlLFNBQVMsYUFINUI7UUFJSSxJQUFJLFdBQVcsSUFBWCxDQUpSO1FBS0ksU0FBUyxNQUFNLENBQU4sS0FBWSxLQUFLLENBQUMsUUFBbEIsSUFBOEIsS0FBSyxDQUFDLFFBQXBDLEdBQStDLENBQS9DLEdBQW1ELENBTGhFO1FBTUksTUFBTSxDQU5WO1FBT0ksTUFBTSxJQUFJLElBQUosR0FBVyxDQUFYLEdBQWUsYUFBZixHQUErQixDQVB6QztRQVFJLE1BQU0sSUFBSSxLQUFKLENBQVUsR0FBVixDQVJWO1FBU0ksU0FBUyxDQUFDLElBQUksV0FBVyxDQUFYLEdBQWUsQ0FBZixHQUFtQixDQUF4QixJQUE2QixDQVQxQztRQVVJLFVBQVUsS0FBSyxLQUFMLENBQVcsSUFBSSxLQUFLLEdBQUwsQ0FBUyxDQUFULENBQWYsQ0FWZDtRQVdJLFlBQVksSUFBSSxPQVhwQjtRQVlJLE9BWko7UUFhSSxPQWJKO1FBY0ksTUFkSjtRQWVJLENBZko7UUFnQkksQ0FoQko7Ozs7QUFxQkEsU0FBSyxJQUFJLEdBQVQsRUFBYyxDQUFkLEVBQWlCLElBQUksRUFBRSxDQUFOLElBQVcsQ0FBNUI7O0FBRUEsU0FBSyxJQUFJLE9BQU8sQ0FBaEIsRUFBbUIsV0FBVyxDQUE5QixFQUFpQyxJQUFJLEVBQUUsQ0FBTixJQUFXLFVBQVUsQ0FBckIsRUFBd0IsVUFBVSxLQUFLLEtBQUwsQ0FBVyxVQUFVLENBQXJCLENBQW5FOztBQUVBLFNBQUssSUFBSSxPQUFPLENBQWhCLEVBQW1CLFlBQVksQ0FBWixJQUFpQixDQUFwQyxFQUF1QyxDQUFDLElBQUksRUFBRSxDQUFOLElBQVcsQ0FBQyxDQUFDLGFBQWEsQ0FBZCxLQUFvQixDQUFyQixJQUEwQixDQUF0QyxLQUE2QyxFQUFFLFNBQXRGOztBQUVBLFNBQUssSUFBSSxDQUFDLENBQVYsRUFBYSxFQUFFLENBQUYsR0FBTSxHQUFOLElBQWEsQ0FBQyxJQUFJLENBQUosQ0FBM0I7O0FBRUEsUUFBSSxJQUFJLENBQUMsVUFBVSxnQkFBZ0IsQ0FBaEIsSUFBcUIsSUFBSSxDQUFDLE1BQU0sT0FBTyxDQUFQLEdBQVcsQ0FBbEIsS0FBd0IsTUFBeEIsSUFBa0MsT0FBTyxNQUF6QyxHQUFrRCxJQUFJLENBQXRELEdBQTBELE9BQU8sQ0FBUCxJQUFZLE1BQU0sU0FBUyxDQUEzQixDQUFuRixDQUFYLElBQWdJLENBQXBJLENBQUosRUFBNEk7QUFDeEksWUFBSSxFQUFFLFVBQVUsSUFBSSxPQUFKLENBQVosQ0FBSixFQUErQjtBQUMzQixpQkFBSyxJQUFJLFVBQVUsQ0FBbkIsRUFBc0IsQ0FBQyxPQUFELElBQVksSUFBSSxHQUF0QyxFQUEyQyxVQUFVLElBQUksR0FBSixDQUFyRDtBQUNIOztBQUVELGFBQUssSUFBSSxVQUFVLENBQW5CLEVBQXNCLFdBQVcsRUFBRSxDQUFGLElBQU8sQ0FBeEMsRUFBMkMsQ0FBQyxJQUFJLENBQUosSUFBUyxDQUFDLElBQUksQ0FBSixDQUFELEdBQVUsQ0FBcEIsTUFBMkIsVUFBVSxDQUFyQyxDQUEzQztBQUNIOztBQUVELFNBQUssSUFBSSxJQUFJLENBQUosR0FBUSxDQUFSLEdBQVksQ0FBQyxDQUFiLEdBQWlCLElBQUksQ0FBOUIsRUFBaUMsRUFBRSxDQUFGLEdBQU0sR0FBTixJQUFhLENBQUMsSUFBSSxDQUFKLENBQS9DOztBQUVBLFFBQUksQ0FBQyxNQUFNLE9BQU8sQ0FBUCxHQUFXLENBQWxCLEtBQXdCLE1BQXhCLElBQWtDLE9BQU8sTUFBN0MsRUFBcUQ7QUFDakQsVUFBRSxDQUFGO0FBQ0gsS0FGRCxNQUVPLElBQUksTUFBTSxNQUFWLEVBQWtCO0FBQ3JCLGVBQU8sT0FBTyxDQUFQLEdBQVcsR0FBbEIsSUFBeUIsTUFBTSxZQUEvQixJQUErQyxLQUFLLElBQUwsQ0FBVSw4QkFBVixDQUEvQztBQUNBLFlBQUksT0FBTyxDQUFQLElBQVksTUFBTSxTQUFTLENBQTNCLENBQUo7QUFDSDs7QUFFRCxRQUFJLFdBQVcsV0FBVyxDQUExQixFQUE2QjtBQUN6QixhQUFLLElBQUwsQ0FBVSxVQUFVLDZCQUFWLEdBQTBDLGtCQUFrQixNQUF0RTtBQUNBLGNBQU0sU0FBUyxDQUFmO0FBQ0EsWUFBSSxPQUFPLENBQVg7O0FBRUEsWUFBSSxVQUFVLENBQUMsUUFBZixFQUF5QjtBQUNyQixxQkFBUyxDQUFUO0FBQ0gsU0FGRCxNQUVPLElBQUksTUFBTSxNQUFOLENBQUosRUFBbUI7QUFDdEIsZ0JBQUksQ0FBSixJQUFTLENBQVQ7QUFDSDtBQUNKOztBQUVELFNBQUssSUFBSSxLQUFLLEdBQUwsQ0FBUyxNQUFNLElBQWYsQ0FBSixFQUEwQixJQUFJLGVBQWUsQ0FBN0MsRUFBZ0QsU0FBUyxFQUE5RCxFQUFrRSxFQUFFLENBQXBFLEVBQXVFLFNBQVUsSUFBSSxDQUFMLEdBQVUsTUFBbkIsRUFBMkIsSUFBSSxNQUFNLENBQTVHOztBQUVBLFNBQUssSUFBSSxDQUFKLEVBQU8sSUFBSSxDQUFYLEVBQWMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLEdBQVQsR0FBZSxHQUFoQixJQUF1QixNQUF2QixHQUFnQyxJQUFJLEtBQUosQ0FBVSxDQUFWLEVBQWEsSUFBSSxhQUFqQixFQUFnQyxJQUFoQyxDQUFxQyxFQUFyQyxDQUExQyxFQUFvRixNQUF0RyxFQUE4RyxJQUFJLEVBQXZILEVBQTJILENBQTNILEVBQThILElBQUksQ0FBQyxJQUFJLENBQUwsSUFBVSxDQUE1SSxFQUErSTtBQUMzSSxhQUFLLENBQUMsS0FBSyxDQUFOLElBQVcsT0FBTyxNQUFQLENBQWMsRUFBRSxDQUFoQixDQUFoQjs7QUFFQSxZQUFJLEtBQUssQ0FBVCxFQUFZO0FBQ1IsY0FBRSxFQUFFLE1BQUosSUFBYyxPQUFPLFlBQVAsQ0FBb0IsQ0FBcEIsQ0FBZDtBQUNBLGdCQUFJLENBQUo7QUFDSDtBQUNKOztBQUVELE1BQUUsRUFBRSxNQUFKLElBQWMsSUFBSSxPQUFPLFlBQVAsQ0FBb0IsQ0FBcEIsQ0FBSixHQUE2QixFQUEzQzs7QUFFQSxXQUFPLENBQUMsS0FBSyxTQUFMLEdBQWlCLEVBQUUsT0FBRixFQUFqQixHQUErQixDQUFoQyxFQUFtQyxJQUFuQyxDQUF3QyxFQUF4QyxDQUFQO0FBQ0gsQ0F6RUQ7O0FBMkVBLGFBQWEsU0FBYixHQUF5QixVQUFVLElBQVYsRUFBZ0IsSUFBaEIsRUFBc0IsTUFBdEIsRUFBOEIsY0FBOUIsRUFBOEM7QUFDbkUsUUFBSSxNQUFNLFFBQVEsSUFBUixDQUFWOztBQUVBLFFBQUksUUFBUSxHQUFSLElBQWUsT0FBTyxFQUFFLE1BQU0sQ0FBUixDQUExQixFQUFzQztBQUNsQyxhQUFLLElBQUwsQ0FBVSxxQkFBVjtBQUNBLGVBQU8sQ0FBUDtBQUNIOztBQUVELFFBQUksT0FBTyxDQUFYLEVBQWM7QUFDVixnQkFBUSxHQUFSO0FBQ0g7O0FBRUQsU0FBSyxJQUFJLElBQUksRUFBYixFQUFpQixJQUFqQixFQUF1QixFQUFFLEVBQUUsTUFBSixJQUFjLE9BQU8sWUFBUCxDQUFvQixPQUFPLEdBQTNCLENBQWQsRUFBK0MsT0FBTyxLQUFLLEtBQUwsQ0FBVyxPQUFPLEdBQWxCLENBQTdFOztBQUVBLFNBQUssT0FBTyxFQUFFLENBQUMsSUFBRCxJQUFTLENBQVgsSUFBZ0IsRUFBRSxNQUE5QixFQUFzQyxNQUF0QyxFQUE4QyxFQUFFLEVBQUUsTUFBSixJQUFjLElBQTVEOztBQUVBLFdBQU8sQ0FBRSxLQUFLLFNBQUwsSUFBa0IsY0FBbkIsR0FBcUMsRUFBRSxPQUFGLEVBQXJDLEdBQW1ELENBQXBELEVBQXVELElBQXZELENBQTRELEVBQTVELENBQVA7QUFDSCxDQWpCRDs7QUFtQkEsYUFBYSxPQUFiLEdBQTBCLFVBQVUsSUFBVixFQUFnQjtBQUFFLFdBQU8sS0FBSyxTQUFMLENBQWdCLElBQWhCLEVBQXVCLENBQXZCLEVBQTBCLElBQTFCLENBQVA7QUFBMkMsQ0FBdkY7QUFDQSxhQUFhLFNBQWIsR0FBMEIsVUFBVSxJQUFWLEVBQWdCO0FBQUUsV0FBTyxLQUFLLFNBQUwsQ0FBZ0IsSUFBaEIsRUFBdUIsQ0FBdkIsRUFBMEIsSUFBMUIsQ0FBUDtBQUEyQyxDQUF2RjtBQUNBLGFBQWEsTUFBYixHQUEwQixVQUFVLElBQVYsRUFBZ0I7QUFBRSxXQUFPLEtBQUssU0FBTCxDQUFnQixJQUFoQixFQUF1QixDQUF2QixFQUEwQixLQUExQixDQUFQO0FBQTJDLENBQXZGO0FBQ0EsYUFBYSxRQUFiLEdBQTBCLFVBQVUsSUFBVixFQUFnQjtBQUFFLFdBQU8sS0FBSyxTQUFMLENBQWdCLElBQWhCLEVBQXVCLENBQXZCLEVBQTBCLEtBQTFCLENBQVA7QUFBMkMsQ0FBdkY7QUFDQSxhQUFhLE9BQWIsR0FBMEIsVUFBVSxJQUFWLEVBQWdCO0FBQUUsV0FBTyxLQUFLLFNBQUwsQ0FBZ0IsSUFBaEIsRUFBc0IsRUFBdEIsRUFBMEIsSUFBMUIsQ0FBUDtBQUEyQyxDQUF2RjtBQUNBLGFBQWEsU0FBYixHQUEwQixVQUFVLElBQVYsRUFBZ0I7QUFBRSxXQUFPLEtBQUssU0FBTCxDQUFnQixJQUFoQixFQUFzQixFQUF0QixFQUEwQixJQUExQixDQUFQO0FBQTJDLENBQXZGO0FBQ0EsYUFBYSxNQUFiLEdBQTBCLFVBQVUsSUFBVixFQUFnQjtBQUFFLFdBQU8sS0FBSyxTQUFMLENBQWdCLElBQWhCLEVBQXNCLEVBQXRCLEVBQTBCLEtBQTFCLENBQVA7QUFBMkMsQ0FBdkY7QUFDQSxhQUFhLFFBQWIsR0FBMEIsVUFBVSxJQUFWLEVBQWdCO0FBQUUsV0FBTyxLQUFLLFNBQUwsQ0FBZ0IsSUFBaEIsRUFBc0IsRUFBdEIsRUFBMEIsS0FBMUIsQ0FBUDtBQUEyQyxDQUF2RjtBQUNBLGFBQWEsS0FBYixHQUEwQixVQUFVLElBQVYsRUFBZ0I7QUFBRSxXQUFPLEtBQUssU0FBTCxDQUFnQixJQUFoQixFQUFzQixFQUF0QixFQUEwQixJQUExQixDQUFQO0FBQTJDLENBQXZGO0FBQ0EsYUFBYSxPQUFiLEdBQTBCLFVBQVUsSUFBVixFQUFnQjtBQUFFLFdBQU8sS0FBSyxTQUFMLENBQWdCLElBQWhCLEVBQXNCLEVBQXRCLEVBQTBCLElBQTFCLENBQVA7QUFBMkMsQ0FBdkY7QUFDQSxhQUFhLE1BQWIsR0FBMEIsVUFBVSxJQUFWLEVBQWdCO0FBQUUsV0FBTyxLQUFLLFNBQUwsQ0FBZ0IsSUFBaEIsRUFBc0IsRUFBdEIsRUFBMEIsSUFBMUIsQ0FBUDtBQUEyQyxDQUF2RjtBQUNBLGFBQWEsUUFBYixHQUEwQixVQUFVLElBQVYsRUFBZ0I7QUFBRSxXQUFPLEtBQUssU0FBTCxDQUFnQixJQUFoQixFQUFzQixFQUF0QixFQUEwQixJQUExQixDQUFQO0FBQTJDLENBQXZGO0FBQ0EsYUFBYSxPQUFiLEdBQTBCLFVBQVUsSUFBVixFQUFnQjtBQUFFLFdBQU8sS0FBSyxTQUFMLENBQWdCLElBQWhCLEVBQXNCLEVBQXRCLEVBQTBCLEtBQTFCLENBQVA7QUFBMkMsQ0FBdkY7QUFDQSxhQUFhLFNBQWIsR0FBMEIsVUFBVSxJQUFWLEVBQWdCO0FBQUUsV0FBTyxLQUFLLFNBQUwsQ0FBZ0IsSUFBaEIsRUFBc0IsRUFBdEIsRUFBMEIsS0FBMUIsQ0FBUDtBQUEyQyxDQUF2RjtBQUNBLGFBQWEsT0FBYixHQUEwQixVQUFVLElBQVYsRUFBZ0I7QUFBRSxXQUFPLEtBQUssU0FBTCxDQUFnQixJQUFoQixFQUFzQixFQUF0QixFQUEwQixJQUExQixDQUFQO0FBQTBDLENBQXRGO0FBQ0EsYUFBYSxTQUFiLEdBQTBCLFVBQVUsSUFBVixFQUFnQjtBQUFFLFdBQU8sS0FBSyxTQUFMLENBQWdCLElBQWhCLEVBQXNCLEVBQXRCLEVBQTBCLElBQTFCLENBQVA7QUFBMEMsQ0FBdEY7QUFDQSxhQUFhLE9BQWIsR0FBMEIsVUFBVSxJQUFWLEVBQWdCO0FBQUUsV0FBTyxLQUFLLFdBQUwsQ0FBa0IsSUFBbEIsRUFBd0IsRUFBeEIsRUFBNEIsQ0FBNUIsQ0FBUDtBQUEyQyxDQUF2RjtBQUNBLGFBQWEsU0FBYixHQUEwQixVQUFVLElBQVYsRUFBZ0I7QUFBRSxXQUFPLEtBQUssV0FBTCxDQUFrQixJQUFsQixFQUF3QixFQUF4QixFQUE0QixDQUE1QixDQUFQO0FBQTJDLENBQXZGO0FBQ0EsYUFBYSxRQUFiLEdBQTBCLFVBQVUsSUFBVixFQUFnQjtBQUFFLFdBQU8sS0FBSyxXQUFMLENBQWtCLElBQWxCLEVBQXdCLEVBQXhCLEVBQTRCLEVBQTVCLENBQVA7QUFBMkMsQ0FBdkY7QUFDQSxhQUFhLFVBQWIsR0FBMEIsVUFBVSxJQUFWLEVBQWdCO0FBQUUsV0FBTyxLQUFLLFdBQUwsQ0FBa0IsSUFBbEIsRUFBd0IsRUFBeEIsRUFBNEIsRUFBNUIsQ0FBUDtBQUEyQyxDQUF2Rjs7O0FBR0EsYUFBYSxZQUFiLEdBQTRCLFVBQVUsTUFBVixFQUFrQixPQUFsQixFQUEyQjtBQUNuRCxRQUFJLENBQUosRUFBTyxDQUFQLEVBQVUsQ0FBVixFQUFhLENBQWIsRUFBZ0IsUUFBaEI7O0FBRUEsZUFBWSxTQUFTLENBQVYsR0FBZ0IsU0FBUyxXQUF6QixHQUF3QyxNQUFuRDtBQUNBLFFBQUksS0FBSyxLQUFMLENBQVcsV0FBVyxRQUF0QixDQUFKOztBQUVBLGdCQUFZLFFBQVo7QUFDQSxRQUFJLEtBQUssS0FBTCxDQUFXLFdBQVcsTUFBdEIsQ0FBSjs7QUFFQSxnQkFBWSxNQUFaO0FBQ0EsUUFBSSxLQUFLLEtBQUwsQ0FBVyxXQUFXLElBQXRCLENBQUo7O0FBRUEsZ0JBQVksSUFBWjtBQUNBLFFBQUksS0FBSyxLQUFMLENBQVcsUUFBWCxDQUFKOztBQUVBLFdBQU8sVUFBVSxDQUFDLElBQUksQ0FBSixDQUFELEVBQVMsSUFBSSxDQUFKLENBQVQsRUFBaUIsSUFBSSxDQUFKLENBQWpCLEVBQXlCLElBQUksQ0FBSixDQUF6QixDQUFWLEdBQTZDLElBQUksQ0FBSixJQUFTLElBQUksQ0FBSixDQUFULEdBQWtCLElBQUksQ0FBSixDQUFsQixHQUEyQixJQUFJLENBQUosQ0FBL0U7QUFDSCxDQWhCRDs7QUFrQkEsYUFBYSxZQUFiLEdBQTRCLFVBQVUsTUFBVixFQUFrQjtBQUMxQyxRQUFJLENBQUosRUFBTyxDQUFQLEVBQVUsQ0FBVixFQUFhLENBQWIsRUFBZ0IsQ0FBaEIsRUFBbUIsQ0FBbkIsRUFBc0IsQ0FBdEIsRUFBeUIsQ0FBekIsRUFBNEIsUUFBNUI7O0FBRUEsZUFBWSxTQUFTLENBQVYsR0FBZ0IsU0FBUyxtQkFBekIsR0FBZ0QsTUFBM0Q7QUFDQSxRQUFJLEtBQUssS0FBTCxDQUFXLFdBQVcsZ0JBQXRCLENBQUo7O0FBRUEsZ0JBQVksZ0JBQVo7QUFDQSxRQUFJLEtBQUssS0FBTCxDQUFXLFdBQVcsY0FBdEIsQ0FBSjs7QUFFQSxnQkFBWSxjQUFaO0FBQ0EsUUFBSSxLQUFLLEtBQUwsQ0FBVyxXQUFXLFlBQXRCLENBQUo7O0FBRUEsZ0JBQVksWUFBWjtBQUNBLFFBQUksS0FBSyxLQUFMLENBQVcsV0FBVyxVQUF0QixDQUFKOztBQUVBLGdCQUFZLFVBQVo7QUFDQSxRQUFJLEtBQUssS0FBTCxDQUFXLFdBQVcsUUFBdEIsQ0FBSjs7QUFFQSxnQkFBWSxRQUFaO0FBQ0EsUUFBSSxLQUFLLEtBQUwsQ0FBVyxXQUFXLE1BQXRCLENBQUo7O0FBRUEsZ0JBQVksTUFBWjtBQUNBLFFBQUksS0FBSyxLQUFMLENBQVcsV0FBVyxJQUF0QixDQUFKOztBQUVBLGdCQUFZLElBQVo7QUFDQSxRQUFJLEtBQUssS0FBTCxDQUFXLFFBQVgsQ0FBSjs7QUFFQSxXQUFPLElBQUksQ0FBSixJQUFTLElBQUksQ0FBSixDQUFULEdBQWtCLElBQUksQ0FBSixDQUFsQixHQUEyQixJQUFJLENBQUosQ0FBM0IsR0FBb0MsSUFBSSxDQUFKLENBQXBDLEdBQTZDLElBQUksQ0FBSixDQUE3QyxHQUFzRCxJQUFJLENBQUosQ0FBdEQsR0FBK0QsSUFBSSxDQUFKLENBQXRFO0FBQ0gsQ0E1QkQ7Ozs7Ozs7QUFtQ0EsYUFBYSxXQUFiLEdBQTJCLFVBQVUsU0FBVixFQUFxQjtBQUM1QyxRQUFJLE1BQU0sVUFBVSxNQUFwQjtRQUNJLFVBQVUsRUFEZDtRQUVJLElBQUksQ0FGUjtRQUdJLElBQUksQ0FIUjtRQUlJLEtBQUssQ0FKVDtRQUtJLEtBQUssQ0FMVDtRQU1JLEVBTko7O0FBUUEsV0FBTyxJQUFJLEdBQVgsRUFBZ0I7QUFDWixZQUFJLFVBQVUsVUFBVixDQUFxQixDQUFyQixDQUFKOztBQUVBLFlBQUksSUFBSSxHQUFSLEVBQWE7QUFDVCx1QkFBVyxPQUFPLFlBQVAsQ0FBb0IsQ0FBcEIsQ0FBWDs7QUFFQTtBQUNILFNBSkQsTUFJTyxJQUFLLElBQUksR0FBTCxJQUFjLElBQUksR0FBdEIsRUFBNEI7QUFDL0IsaUJBQUssVUFBVSxVQUFWLENBQXFCLElBQUUsQ0FBdkIsQ0FBTDtBQUNBLHVCQUFXLE9BQU8sWUFBUCxDQUFxQixDQUFDLElBQUksRUFBTCxLQUFZLENBQWIsR0FBbUIsS0FBSyxFQUE1QyxDQUFYOztBQUVBLGlCQUFLLENBQUw7QUFDSCxTQUxNLE1BS0E7QUFDSCxpQkFBSyxVQUFVLFVBQVYsQ0FBcUIsSUFBRSxDQUF2QixDQUFMO0FBQ0EsaUJBQUssVUFBVSxVQUFWLENBQXFCLElBQUUsQ0FBdkIsQ0FBTDtBQUNBLHVCQUFXLE9BQU8sWUFBUCxDQUFxQixDQUFDLElBQUksRUFBTCxLQUFZLEVBQWIsR0FBb0IsQ0FBQyxLQUFLLEVBQU4sS0FBYSxDQUFqQyxHQUF1QyxLQUFLLEVBQWhFLENBQVg7O0FBRUEsaUJBQUssQ0FBTDtBQUNIO0FBQ0o7O0FBRUQsV0FBTyxPQUFQO0FBQ0gsQ0EvQkQ7OztBQWtDQSxhQUFhLGNBQWIsR0FBOEIsVUFBVSxDQUFWLEVBQWE7QUFDdkMsV0FBTyxTQUFTLG1CQUFtQixDQUFuQixDQUFULElBQWtDLGFBQWEsUUFBYixDQUFzQixDQUF0QixDQUF6QztBQUNILENBRkQ7OztBQUtBLGFBQWEsV0FBYixHQUEyQixTQUFTLFdBQVQsQ0FBc0IsQ0FBdEIsRUFBeUI7QUFDaEQsUUFBSSxJQUFJLEVBQVI7UUFDSSxDQURKOztBQUdBLFNBQUssSUFBSSxJQUFJLENBQVIsRUFBVyxNQUFNLEVBQUUsTUFBeEIsRUFBZ0MsSUFBSSxHQUFwQyxFQUF5QyxHQUF6QyxFQUE4QztBQUMxQyxZQUFJLEVBQUUsVUFBRixDQUFhLENBQWIsQ0FBSjs7QUFFQSxZQUFJLElBQUksR0FBUixFQUFhO0FBQ1QsaUJBQUssT0FBTyxZQUFQLENBQW9CLENBQXBCLENBQUw7QUFDSCxTQUZELE1BRU8sSUFBSyxJQUFJLEdBQUwsSUFBYyxJQUFJLElBQXRCLEVBQTZCO0FBQ2hDLGlCQUFLLE9BQU8sWUFBUCxDQUFxQixLQUFHLENBQUosR0FBUyxHQUE3QixDQUFMO0FBQ0EsaUJBQUssT0FBTyxZQUFQLENBQXFCLElBQUUsRUFBSCxHQUFTLEdBQTdCLENBQUw7QUFDSCxTQUhNLE1BR0E7QUFDSCxpQkFBSyxPQUFPLFlBQVAsQ0FBcUIsS0FBRyxFQUFKLEdBQVUsR0FBOUIsQ0FBTDtBQUNBLGlCQUFLLE9BQU8sWUFBUCxDQUFzQixLQUFHLENBQUosR0FBUyxFQUFWLEdBQWdCLEdBQXBDLENBQUw7QUFDQSxpQkFBSyxPQUFPLFlBQVAsQ0FBcUIsSUFBRSxFQUFILEdBQVMsR0FBN0IsQ0FBTDtBQUNIO0FBQ0o7O0FBRUQsV0FBTyxDQUFQO0FBQ0gsQ0FwQkQ7O0FBc0JBLGFBQWEsTUFBYixHQUFzQixVQUFVLENBQVYsRUFBYTtBQUMvQixRQUFJLE1BQUo7O0FBRUEsU0FBSyxJQUFJLElBQUksQ0FBUixFQUFXLE1BQU0sRUFBRSxNQUF4QixFQUFnQyxJQUFJLEdBQXBDLEVBQXlDLEdBQXpDLEVBQThDO0FBQzFDLFlBQUksRUFBRSxVQUFGLENBQWEsQ0FBYixJQUFrQixFQUF0QixFQUEwQjtBQUN0QixxQkFBUyxFQUFFLFVBQUYsQ0FBYSxDQUFiLEtBQW1CLEVBQW5CLEdBQXdCLE1BQU0sRUFBRSxVQUFGLENBQWEsQ0FBYixFQUFnQixRQUFoQixDQUF5QixFQUF6QixDQUE5QixHQUE2RCxFQUFFLFVBQUYsQ0FBYSxDQUFiLEVBQWdCLFFBQWhCLENBQXlCLEVBQXpCLENBQXRFOztBQUVBLG9CQUFRLE1BQVIsQ0FBZSxLQUFmLENBQXFCLFNBQVMsR0FBOUI7QUFDSCxTQUpELE1BSU87QUFDSCxxQkFBUyxFQUFFLFVBQUYsQ0FBYSxDQUFiLEtBQW1CLEVBQW5CLEdBQXdCLE1BQU0sRUFBRSxVQUFGLENBQWEsQ0FBYixFQUFnQixRQUFoQixDQUF5QixFQUF6QixDQUE5QixHQUE2RCxFQUFFLFVBQUYsQ0FBYSxDQUFiLEVBQWdCLFFBQWhCLENBQXlCLEVBQXpCLENBQXRFOztBQUVBLG9CQUFRLE1BQVIsQ0FBZSxLQUFmLENBQXFCLFNBQVMsR0FBOUI7QUFDSDtBQUNKOztBQUVELFlBQVEsTUFBUixDQUFlLEtBQWYsQ0FBcUIsTUFBckI7QUFDSCxDQWhCRDs7QUFrQkEsYUFBYSxPQUFiLEdBQXVCLFVBQVUsQ0FBVixFQUFhO0FBQ2hDLFFBQUksTUFBSjs7QUFFQSxTQUFLLElBQUksSUFBSSxDQUFSLEVBQVcsTUFBTSxFQUFFLE1BQXhCLEVBQWdDLElBQUksR0FBcEMsRUFBeUMsR0FBekMsRUFBOEM7QUFDMUMsWUFBSSxFQUFFLFVBQUYsQ0FBYSxDQUFiLElBQWtCLEVBQXRCLEVBQTBCO0FBQ3RCLHFCQUFTLEVBQUUsVUFBRixDQUFhLENBQWIsS0FBbUIsRUFBbkIsR0FBd0IsTUFBTSxFQUFFLFVBQUYsQ0FBYSxDQUFiLEVBQWdCLFFBQWhCLENBQXlCLEVBQXpCLENBQTlCLEdBQTZELEVBQUUsVUFBRixDQUFhLENBQWIsRUFBZ0IsUUFBaEIsQ0FBeUIsRUFBekIsQ0FBdEU7QUFDSCxTQUZELE1BRU87QUFDSCxxQkFBUyxFQUFFLFVBQUYsQ0FBYSxDQUFiLEtBQW1CLEVBQW5CLEdBQXdCLE1BQU0sRUFBRSxVQUFGLENBQWEsQ0FBYixFQUFnQixRQUFoQixDQUF5QixFQUF6QixDQUE5QixHQUE2RCxFQUFFLFVBQUYsQ0FBYSxDQUFiLEVBQWdCLFFBQWhCLENBQXlCLEVBQXpCLENBQXRFO0FBQ0g7QUFDSjtBQUNKLENBVkQ7O0FBWUEsYUFBYSxPQUFiLEdBQXVCLFVBQVUsQ0FBVixFQUFhO0FBQ2hDLFFBQUksTUFBSjs7QUFFQSxTQUFLLElBQUksSUFBSSxDQUFSLEVBQVcsTUFBTSxFQUFFLE1BQXhCLEVBQWdDLElBQUksR0FBcEMsRUFBeUMsR0FBekMsRUFBOEM7QUFDMUMsWUFBSSxFQUFFLFVBQUYsQ0FBYSxDQUFiLElBQWtCLEVBQXRCLEVBQTBCO0FBQ3RCLHFCQUFTLEVBQUUsVUFBRixDQUFhLENBQWIsS0FBbUIsRUFBbkIsR0FBd0IsTUFBTSxFQUFFLFVBQUYsQ0FBYSxDQUFiLEVBQWdCLFFBQWhCLENBQXlCLEVBQXpCLENBQTlCLEdBQTZELEVBQUUsVUFBRixDQUFhLENBQWIsRUFBZ0IsUUFBaEIsQ0FBeUIsRUFBekIsQ0FBdEU7QUFDSCxTQUZELE1BRU87QUFDSCxxQkFBUyxFQUFFLFVBQUYsQ0FBYSxDQUFiLEtBQW1CLEVBQW5CLEdBQXdCLE1BQU0sRUFBRSxVQUFGLENBQWEsQ0FBYixFQUFnQixRQUFoQixDQUF5QixFQUF6QixDQUE5QixHQUE2RCxFQUFFLFVBQUYsQ0FBYSxDQUFiLEVBQWdCLFFBQWhCLENBQXlCLEVBQXpCLENBQXRFO0FBQ0g7QUFDSjtBQUNKLENBVkQ7O0FBWUEsT0FBTyxPQUFQLEdBQWlCLFlBQWpCIiwiZmlsZSI6IkJpbmFyeVBhcnNlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgQmluYXJ5UGFyc2VyLmpzIC0gYmFzZWQgb24gKHtAbGluayBodHRwOi8vanNmcm9taGVsbC5jb20vY2xhc3Nlcy9iaW5hcnktcGFyc2VyIEJpbmFyeSBQYXJzZXJ9KSBieSBKb25hcyBSYW9uaSBTb2FyZXMgU2lsdmFcbiAqIEB2ZXJzaW9uIDAuMC4xXG4gKiBAaWdub3JlXG4gKiBcbiAqIEBhdXRob3IgRWR1YXJkbyBBc3RvbGZpIDxlZHVhcmRvLmFzdG9sZmk5MUBnbWFpbC5jb20+XG4gKiBAY29weXJpZ2h0IDIwMTYgRWR1YXJkbyBBc3RvbGZpIDxlZHVhcmRvLmFzdG9sZmk5MUBnbWFpbC5jb20+XG4gKiBAbGljZW5zZSBNSVQgTGljZW5zZWRcbiAqL1xuIFxudmFyIExvZ2dlciA9IHJlcXVpcmUoXCIuL3V0aWxzL0xvZ2dlclwiKSxcbiAgICBCaW5hcnlQYXJzZXJCdWZmZXIgPSByZXF1aXJlKFwiLi9CaW5hcnlQYXJzZXJCdWZmZXJcIik7XG5cbi8vIFNob3JjdXQgZm9yIFN0cmluZy5mcm9tQ2hhckNvZGVcbnZhciBjaHIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlO1xuXG52YXIgbWF4Qml0cyA9IFtdO1xuZm9yICh2YXIgaSA9IDA7IGkgPCA2NDsgaSsrKSB7XG4gICAgbWF4Qml0c1tpXSA9IE1hdGgucG93KDIsIGkpO1xufVxuXG4vKipcbiAqIEJpbmFyeVBhcnNlclxuICogQGlnbm9yZVxuICogXG4gKiBAbW9kdWxlIEN1cnNvclxuICogQGNvbnN0cnVjdG9yXG4gKiBAc2luY2UgMC4wLjFcbiAqIFxuICogQGNsYXNzZGVzYyBDdXJzb3IgY2xhc3MgdGhhdCBtYXBzIGEgTW9uZ29EQi1saWtlIGN1cnNvclxuICogXG4gKiBAcGFyYW0ge01vbmdvUG9ydGFibGV9IGRiIC0gQWRkaXRpb25hbCBvcHRpb25zXG4gKiBAcGFyYW0ge0NvbGxlY3Rpb259IGNvbGxlY3Rpb24gLSBUaGUgY29sbGVjdGlvbiBpbnN0YW5jZVxuICogQHBhcmFtIHtPYmplY3R8QXJyYXl8U3RyaW5nfSBbc2VsZWN0aW9uPXt9XSAtIFRoZSBzZWxlY3Rpb24gZm9yIG1hdGNoaW5nIGRvY3VtZW50c1xuICogQHBhcmFtIHtPYmplY3R8QXJyYXl8U3RyaW5nfSBbZmllbGRzPXt9XSAtIFRoZSBmaWVsZHMgb2YgdGhlIGRvY3VtZW50IHRvIHNob3dcbiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gLSBEYXRhYmFzZSBvYmplY3RcbiAqIFxuICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zLnBrRmFjdG9yeT1udWxsXSAtIE9iamVjdCBvdmVycmlkaW5nIHRoZSBiYXNpYyBcIk9iamVjdElkXCIgcHJpbWFyeSBrZXkgZ2VuZXJhdGlvbi5cbiAqIFxuICovXG5mdW5jdGlvbiBCaW5hcnlQYXJzZXIgKGJpZ0VuZGlhbiwgYWxsb3dFeGNlcHRpb25zKSB7XG4gICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIEJpbmFyeVBhcnNlcikpIHJldHVybiBuZXcgQmluYXJ5UGFyc2VyKGJpZ0VuZGlhbiwgYWxsb3dFeGNlcHRpb25zKTtcblxuICAgIHRoaXMuYmlnRW5kaWFuID0gYmlnRW5kaWFuO1xuICAgIHRoaXMuYWxsb3dFeGNlcHRpb25zID0gYWxsb3dFeGNlcHRpb25zO1xufVxuXG5CaW5hcnlQYXJzZXIuQnVmZmVyID0gQmluYXJ5UGFyc2VyQnVmZmVyO1xuXG5CaW5hcnlQYXJzZXIud2FybiA9IGZ1bmN0aW9uIChtc2cpIHtcbiAgICBpZiAodGhpcy5hbGxvd0V4Y2VwdGlvbnMpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiAxO1xufTtcblxuQmluYXJ5UGFyc2VyLmRlY29kZUZsb2F0ID0gZnVuY3Rpb24gKGRhdGEsIHByZWNpc2lvbkJpdHMsIGV4cG9uZW50Qml0cykge1xuICAgIHZhciBiID0gbmV3IHRoaXMuQnVmZmVyKHRoaXMuYmlnRW5kaWFuLCBkYXRhKTtcblxuICAgIGIuY2hlY2tCdWZmZXIocHJlY2lzaW9uQml0cyArIGV4cG9uZW50Qml0cyArIDEpO1xuXG4gICAgdmFyIGJpYXMgPSBtYXhCaXRzW2V4cG9uZW50Qml0cyAtIDFdIC0gMSxcbiAgICAgICAgc2lnbmFsID0gYi5yZWFkQml0cyhwcmVjaXNpb25CaXRzICsgZXhwb25lbnRCaXRzLCAxKSxcbiAgICAgICAgZXhwb25lbnQgPSBiLnJlYWRCaXRzKHByZWNpc2lvbkJpdHMsIGV4cG9uZW50Qml0cyksXG4gICAgICAgIHNpZ25pZmljYW5kID0gMCxcbiAgICAgICAgZGl2aXNvciA9IDIsXG4gICAgICAgIGN1ckJ5dGUgPSBiLmJ1ZmZlci5sZW5ndGggKyAoLXByZWNpc2lvbkJpdHMgPj4gMykgLSAxO1xuXG4gICAgZG8ge1xuICAgICAgICBmb3IgKHZhciBieXRlVmFsdWUgPSBiLmJ1ZmZlclsgKytjdXJCeXRlIF0sIHN0YXJ0Qml0ID0gcHJlY2lzaW9uQml0cyAlIDggfHwgOCwgbWFzayA9IDEgPDwgc3RhcnRCaXQ7IG1hc2sgPj49IDE7ICggYnl0ZVZhbHVlICYgbWFzayApICYmICggc2lnbmlmaWNhbmQgKz0gMSAvIGRpdmlzb3IgKSwgZGl2aXNvciAqPSAyICk7XG4gICAgfSB3aGlsZSAocHJlY2lzaW9uQml0cyAtPSBzdGFydEJpdCk7XG5cbiAgICAvLyBpZiAoZXhwb25lbnQgPT0gKCBiaWFzIDw8IDEgKSArIDEpIHtcbiAgICAvLyAgICAgaWYgKHNpZ25pZmljYW5kKSB7XG4gICAgLy8gICAgICAgICByZXR1cm4gTmFOO1xuICAgIC8vICAgICB9IGVsc2Uge1xuICAgIC8vICAgICAgICAgaWYgKHNpZ25hbCkge1xuICAgIC8vICAgICAgICAgICAgIHJldHVybiAtSW5maW5pdHk7XG4gICAgLy8gICAgICAgICB9IGVsc2Uge1xuICAgIC8vICAgICAgICAgICAgIHJldHVybiArSW5maW5pdHk7XG4gICAgLy8gICAgICAgICB9XG4gICAgLy8gICAgIH1cbiAgICAvLyB9IGVsc2Uge1xuICAgIC8vICAgICB2YXIgX2EgPSAoIDEgKyBzaWduYWwgKiAtMiApO1xuICAgICAgICBcbiAgICAvLyAgICAgaWYgKGV4cG9uZW50IHx8IHNpZ25pZmljYW5kKSB7XG4gICAgLy8gICAgICAgICBpZiAoIWV4cG9uZW50KSB7XG4gICAgLy8gICAgICAgICAgICAgcmV0dXJuIF9hICogKE1hdGgucG93KCAyLCAtYmlhcyArIDEgKSAqIHNpZ25pZmljYW5kKTtcbiAgICAvLyAgICAgICAgIH0gZWxzZSB7XG4gICAgLy8gICAgICAgICAgICAgcmV0dXJuIF9hICogKE1hdGgucG93KCAyLCBleHBvbmVudCAtIGJpYXMgKSAqICggMSArIHNpZ25pZmljYW5kICkpO1xuICAgIC8vICAgICAgICAgfVxuICAgIC8vICAgICB9IGVsc2Uge1xuICAgIC8vICAgICAgICAgcmV0dXJuIF9hICogMDtcbiAgICAvLyAgICAgfVxuICAgIC8vIH1cbiAgICBcbiAgICByZXR1cm4gZXhwb25lbnQgPT0gKCBiaWFzIDw8IDEgKSArIDEgPyBzaWduaWZpY2FuZCA/IE5hTiA6IHNpZ25hbCA/IC1JbmZpbml0eSA6ICtJbmZpbml0eSA6ICggMSArIHNpZ25hbCAqIC0yICkgKiAoIGV4cG9uZW50IHx8IHNpZ25pZmljYW5kID8gIWV4cG9uZW50ID8gTWF0aC5wb3coIDIsIC1iaWFzICsgMSApICogc2lnbmlmaWNhbmQgOiBNYXRoLnBvdyggMiwgZXhwb25lbnQgLSBiaWFzICkgKiAoIDEgKyBzaWduaWZpY2FuZCApIDogMCApO1xufTtcblxuQmluYXJ5UGFyc2VyLmRlY29kZUludCA9IGZ1bmN0aW9uIChkYXRhLCBiaXRzLCBzaWduZWQsIGZvcmNlQmlnRW5kaWFuKSB7XG4gICAgdmFyIGIgPSBuZXcgdGhpcy5CdWZmZXIodGhpcy5iaWdFbmRpYW4gfHwgZm9yY2VCaWdFbmRpYW4sIGRhdGEpLFxuICAgICAgICB4ID0gYi5yZWFkQml0cygwLCBiaXRzKSxcbiAgICAgICAgbWF4ID0gbWF4Qml0c1tiaXRzXTsgLy9tYXggPSBNYXRoLnBvdyggMiwgYml0cyApO1xuXG4gICAgcmV0dXJuIHNpZ25lZCAmJiB4ID49IG1heCAvIDIgPyB4IC0gbWF4IDogeDtcbn07XG5cbkJpbmFyeVBhcnNlci5lbmNvZGVGbG9hdCA9IGZ1bmN0aW9uIChkYXRhLCBwcmVjaXNpb25CaXRzLCBleHBvbmVudEJpdHMpIHtcbiAgICB2YXIgYmlhcyA9IG1heEJpdHNbZXhwb25lbnRCaXRzIC0gMV0gLSAxLFxuICAgICAgICBtaW5FeHAgPSAtYmlhcyArIDEsXG4gICAgICAgIG1heEV4cCA9IGJpYXMsXG4gICAgICAgIG1pblVubm9ybUV4cCA9IG1pbkV4cCAtIHByZWNpc2lvbkJpdHMsXG4gICAgICAgIG4gPSBwYXJzZUZsb2F0KGRhdGEpLFxuICAgICAgICBzdGF0dXMgPSBpc05hTihuKSB8fCBuID09IC1JbmZpbml0eSB8fCBuID09ICtJbmZpbml0eSA/IG4gOiAwLFxuICAgICAgICBleHAgPSAwLFxuICAgICAgICBsZW4gPSAyICogYmlhcyArIDEgKyBwcmVjaXNpb25CaXRzICsgMyxcbiAgICAgICAgYmluID0gbmV3IEFycmF5KGxlbiksXG4gICAgICAgIHNpZ25hbCA9IChuID0gc3RhdHVzICE9PSAwID8gMCA6IG4pIDwgMCxcbiAgICAgICAgaW50UGFydCA9IE1hdGguZmxvb3IobiA9IE1hdGguYWJzKG4pKSxcbiAgICAgICAgZmxvYXRQYXJ0ID0gbiAtIGludFBhcnQsXG4gICAgICAgIGxhc3RCaXQsXG4gICAgICAgIHJvdW5kZWQsXG4gICAgICAgIHJlc3VsdCxcbiAgICAgICAgaSxcbiAgICAgICAgajtcblxuXG4gICAgLy8gREFGVUNLP1xuICBcbiAgICBmb3IgKGkgPSBsZW47IGk7IGJpblstLWldID0gMCk7XG4gICAgXG4gICAgZm9yIChpID0gYmlhcyArIDI7IGludFBhcnQgJiYgaTsgYmluWy0taV0gPSBpbnRQYXJ0ICUgMiwgaW50UGFydCA9IE1hdGguZmxvb3IoaW50UGFydCAvIDIpKTtcbiAgICBcbiAgICBmb3IgKGkgPSBiaWFzICsgMTsgZmxvYXRQYXJ0ID4gMCAmJiBpOyAoYmluWysraV0gPSAoKGZsb2F0UGFydCAqPSAyKSA+PSAxKSAtIDAgKSAmJiAtLWZsb2F0UGFydCk7XG4gICAgXG4gICAgZm9yIChpID0gLTE7ICsraSA8IGxlbiAmJiAhYmluW2ldOyk7XG4gIFxuICAgIGlmIChiaW5bKGxhc3RCaXQgPSBwcmVjaXNpb25CaXRzIC0gMSArIChpID0gKGV4cCA9IGJpYXMgKyAxIC0gaSkgPj0gbWluRXhwICYmIGV4cCA8PSBtYXhFeHAgPyBpICsgMSA6IGJpYXMgKyAxIC0gKGV4cCA9IG1pbkV4cCAtIDEpKSkgKyAxXSkge1xuICAgICAgICBpZiAoIShyb3VuZGVkID0gYmluW2xhc3RCaXRdKSkge1xuICAgICAgICAgICAgZm9yIChqID0gbGFzdEJpdCArIDI7ICFyb3VuZGVkICYmIGogPCBsZW47IHJvdW5kZWQgPSBiaW5baisrXSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGZvciAoaiA9IGxhc3RCaXQgKyAxOyByb3VuZGVkICYmIC0taiA+PSAwOyAoYmluW2pdID0gIWJpbltqXSAtIDApICYmIChyb3VuZGVkID0gMCkpO1xuICAgIH1cbiAgXG4gICAgZm9yIChpID0gaSAtIDIgPCAwID8gLTEgOiBpIC0gMzsgKytpIDwgbGVuICYmICFiaW5baV07KTtcbiAgICBcbiAgICBpZiAoKGV4cCA9IGJpYXMgKyAxIC0gaSkgPj0gbWluRXhwICYmIGV4cCA8PSBtYXhFeHApIHtcbiAgICAgICAgKytpO1xuICAgIH0gZWxzZSBpZiAoZXhwIDwgbWluRXhwKSB7XG4gICAgICAgIGV4cCAhPSBiaWFzICsgMSAtIGxlbiAmJiBleHAgPCBtaW5Vbm5vcm1FeHAgJiYgdGhpcy53YXJuKFwiZW5jb2RlRmxvYXQ6OmZsb2F0IHVuZGVyZmxvd1wiKTtcbiAgICAgICAgaSA9IGJpYXMgKyAxIC0gKGV4cCA9IG1pbkV4cCAtIDEpO1xuICAgIH1cbiAgICBcbiAgICBpZiAoaW50UGFydCB8fCBzdGF0dXMgIT09IDApIHtcbiAgICAgICAgdGhpcy53YXJuKGludFBhcnQgPyBcImVuY29kZUZsb2F0OjpmbG9hdCBvdmVyZmxvd1wiIDogXCJlbmNvZGVGbG9hdDo6XCIgKyBzdGF0dXMpO1xuICAgICAgICBleHAgPSBtYXhFeHAgKyAxO1xuICAgICAgICBpID0gYmlhcyArIDI7XG4gICAgXG4gICAgICAgIGlmIChzdGF0dXMgPT0gLUluZmluaXR5KSB7XG4gICAgICAgICAgICBzaWduYWwgPSAxO1xuICAgICAgICB9IGVsc2UgaWYgKGlzTmFOKHN0YXR1cykpIHtcbiAgICAgICAgICAgIGJpbltpXSA9IDE7XG4gICAgICAgIH1cbiAgICB9XG4gIFxuICAgIGZvciAobiA9IE1hdGguYWJzKGV4cCArIGJpYXMpLCBqID0gZXhwb25lbnRCaXRzICsgMSwgcmVzdWx0ID0gXCJcIjsgLS1qOyByZXN1bHQgPSAobiAlIDIpICsgcmVzdWx0LCBuID0gbiA+Pj0gMSk7XG4gIFxuICAgIGZvciAobiA9IDAsIGogPSAwLCBpID0gKHJlc3VsdCA9IChzaWduYWwgPyBcIjFcIiA6IFwiMFwiKSArIHJlc3VsdCArIGJpbi5zbGljZShpLCBpICsgcHJlY2lzaW9uQml0cykuam9pbihcIlwiKSkubGVuZ3RoLCByID0gW107IGk7IGogPSAoaiArIDEpICUgOCkge1xuICAgICAgICBuICs9ICgxIDw8IGopICogcmVzdWx0LmNoYXJBdCgtLWkpO1xuICAgICAgICBcbiAgICAgICAgaWYgKGogPT0gNykge1xuICAgICAgICAgICAgcltyLmxlbmd0aF0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKG4pO1xuICAgICAgICAgICAgbiA9IDA7XG4gICAgICAgIH1cbiAgICB9XG4gIFxuICAgIHJbci5sZW5ndGhdID0gbiA/IFN0cmluZy5mcm9tQ2hhckNvZGUobikgOiBcIlwiO1xuICBcbiAgICByZXR1cm4gKHRoaXMuYmlnRW5kaWFuID8gci5yZXZlcnNlKCkgOiByKS5qb2luKFwiXCIpO1xufTtcblxuQmluYXJ5UGFyc2VyLmVuY29kZUludCA9IGZ1bmN0aW9uIChkYXRhLCBiaXRzLCBzaWduZWQsIGZvcmNlQmlnRW5kaWFuKSB7XG4gICAgdmFyIG1heCA9IG1heEJpdHNbYml0c107XG4gICAgXG4gICAgaWYgKGRhdGEgPj0gbWF4IHx8IGRhdGEgPCAtKG1heCAvIDIpKSB7XG4gICAgICAgIHRoaXMud2FybihcImVuY29kZUludDo6b3ZlcmZsb3dcIik7XG4gICAgICAgIGRhdGEgPSAwO1xuICAgIH1cbiAgICBcbiAgICBpZiAoZGF0YSA8IDApIHtcbiAgICAgICAgZGF0YSArPSBtYXg7XG4gICAgfVxuICAgIFxuICAgIGZvciAodmFyIHIgPSBbXTsgZGF0YTsgcltyLmxlbmd0aF0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGRhdGEgJSAyNTYpLCBkYXRhID0gTWF0aC5mbG9vcihkYXRhIC8gMjU2KSk7XG4gICAgXG4gICAgZm9yIChiaXRzID0gLSgtYml0cyA+PiAzKSAtIHIubGVuZ3RoOyBiaXRzLS07IHJbci5sZW5ndGhdID0gXCJcXDBcIik7XG4gICAgXG4gICAgcmV0dXJuICgodGhpcy5iaWdFbmRpYW4gfHwgZm9yY2VCaWdFbmRpYW4pID8gci5yZXZlcnNlKCkgOiByKS5qb2luKFwiXCIpO1xufTtcblxuQmluYXJ5UGFyc2VyLnRvU21hbGwgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVJbnQoIGRhdGEsICA4LCB0cnVlICApOyB9O1xuQmluYXJ5UGFyc2VyLmZyb21TbWFsbCAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVJbnQoIGRhdGEsICA4LCB0cnVlICApOyB9O1xuQmluYXJ5UGFyc2VyLnRvQnl0ZSAgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVJbnQoIGRhdGEsICA4LCBmYWxzZSApOyB9O1xuQmluYXJ5UGFyc2VyLmZyb21CeXRlICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVJbnQoIGRhdGEsICA4LCBmYWxzZSApOyB9O1xuQmluYXJ5UGFyc2VyLnRvU2hvcnQgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVJbnQoIGRhdGEsIDE2LCB0cnVlICApOyB9O1xuQmluYXJ5UGFyc2VyLmZyb21TaG9ydCAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVJbnQoIGRhdGEsIDE2LCB0cnVlICApOyB9O1xuQmluYXJ5UGFyc2VyLnRvV29yZCAgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVJbnQoIGRhdGEsIDE2LCBmYWxzZSApOyB9O1xuQmluYXJ5UGFyc2VyLmZyb21Xb3JkICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVJbnQoIGRhdGEsIDE2LCBmYWxzZSApOyB9O1xuQmluYXJ5UGFyc2VyLnRvSW50ICAgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVJbnQoIGRhdGEsIDMyLCB0cnVlICApOyB9O1xuQmluYXJ5UGFyc2VyLmZyb21JbnQgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVJbnQoIGRhdGEsIDMyLCB0cnVlICApOyB9O1xuQmluYXJ5UGFyc2VyLnRvTG9uZyAgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVJbnQoIGRhdGEsIDY0LCB0cnVlICApOyB9O1xuQmluYXJ5UGFyc2VyLmZyb21Mb25nICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVJbnQoIGRhdGEsIDY0LCB0cnVlICApOyB9O1xuQmluYXJ5UGFyc2VyLnRvRFdvcmQgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVJbnQoIGRhdGEsIDMyLCBmYWxzZSApOyB9O1xuQmluYXJ5UGFyc2VyLmZyb21EV29yZCAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVJbnQoIGRhdGEsIDMyLCBmYWxzZSApOyB9O1xuQmluYXJ5UGFyc2VyLnRvUVdvcmQgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVJbnQoIGRhdGEsIDY0LCB0cnVlICk7IH07XG5CaW5hcnlQYXJzZXIuZnJvbVFXb3JkICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgNjQsIHRydWUgKTsgfTtcbkJpbmFyeVBhcnNlci50b0Zsb2F0ICAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZGVjb2RlRmxvYXQoIGRhdGEsIDIzLCA4ICAgKTsgfTtcbkJpbmFyeVBhcnNlci5mcm9tRmxvYXQgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlRmxvYXQoIGRhdGEsIDIzLCA4ICAgKTsgfTtcbkJpbmFyeVBhcnNlci50b0RvdWJsZSAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZGVjb2RlRmxvYXQoIGRhdGEsIDUyLCAxMSAgKTsgfTtcbkJpbmFyeVBhcnNlci5mcm9tRG91YmxlID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlRmxvYXQoIGRhdGEsIDUyLCAxMSAgKTsgfTtcblxuLy8gRmFjdG9yIG91dCB0aGUgZW5jb2RlIHNvIGl0IGNhbiBiZSBzaGFyZWQgYnkgYWRkX2hlYWRlciBhbmQgcHVzaF9pbnQzMlxuQmluYXJ5UGFyc2VyLmVuY29kZV9pbnQzMiA9IGZ1bmN0aW9uIChudW1iZXIsIGFzQXJyYXkpIHtcbiAgICB2YXIgYSwgYiwgYywgZCwgdW5zaWduZWQ7XG4gICAgXG4gICAgdW5zaWduZWQgPSAobnVtYmVyIDwgMCkgPyAobnVtYmVyICsgMHgxMDAwMDAwMDApIDogbnVtYmVyO1xuICAgIGEgPSBNYXRoLmZsb29yKHVuc2lnbmVkIC8gMHhmZmZmZmYpO1xuICAgIFxuICAgIHVuc2lnbmVkICY9IDB4ZmZmZmZmO1xuICAgIGIgPSBNYXRoLmZsb29yKHVuc2lnbmVkIC8gMHhmZmZmKTtcbiAgICBcbiAgICB1bnNpZ25lZCAmPSAweGZmZmY7XG4gICAgYyA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmKTtcbiAgICBcbiAgICB1bnNpZ25lZCAmPSAweGZmO1xuICAgIGQgPSBNYXRoLmZsb29yKHVuc2lnbmVkKTtcbiAgICBcbiAgICByZXR1cm4gYXNBcnJheSA/IFtjaHIoYSksIGNocihiKSwgY2hyKGMpLCBjaHIoZCldIDogY2hyKGEpICsgY2hyKGIpICsgY2hyKGMpICsgY2hyKGQpO1xufTtcblxuQmluYXJ5UGFyc2VyLmVuY29kZV9pbnQ2NCA9IGZ1bmN0aW9uIChudW1iZXIpIHtcbiAgICB2YXIgYSwgYiwgYywgZCwgZSwgZiwgZywgaCwgdW5zaWduZWQ7XG4gICAgXG4gICAgdW5zaWduZWQgPSAobnVtYmVyIDwgMCkgPyAobnVtYmVyICsgMHgxMDAwMDAwMDAwMDAwMDAwMCkgOiBudW1iZXI7XG4gICAgYSA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmZmZmZmZmZmZmZmKTtcbiAgICBcbiAgICB1bnNpZ25lZCAmPSAweGZmZmZmZmZmZmZmZmZmO1xuICAgIGIgPSBNYXRoLmZsb29yKHVuc2lnbmVkIC8gMHhmZmZmZmZmZmZmZmYpO1xuICAgIFxuICAgIHVuc2lnbmVkICY9IDB4ZmZmZmZmZmZmZmZmO1xuICAgIGMgPSBNYXRoLmZsb29yKHVuc2lnbmVkIC8gMHhmZmZmZmZmZmZmKTtcbiAgICBcbiAgICB1bnNpZ25lZCAmPSAweGZmZmZmZmZmZmY7XG4gICAgZCA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmZmZmZmKTtcbiAgICBcbiAgICB1bnNpZ25lZCAmPSAweGZmZmZmZmZmO1xuICAgIGUgPSBNYXRoLmZsb29yKHVuc2lnbmVkIC8gMHhmZmZmZmYpO1xuICAgIFxuICAgIHVuc2lnbmVkICY9IDB4ZmZmZmZmO1xuICAgIGYgPSBNYXRoLmZsb29yKHVuc2lnbmVkIC8gMHhmZmZmKTtcbiAgICBcbiAgICB1bnNpZ25lZCAmPSAweGZmZmY7XG4gICAgZyA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmKTtcbiAgICBcbiAgICB1bnNpZ25lZCAmPSAweGZmO1xuICAgIGggPSBNYXRoLmZsb29yKHVuc2lnbmVkKTtcbiAgICBcbiAgICByZXR1cm4gY2hyKGEpICsgY2hyKGIpICsgY2hyKGMpICsgY2hyKGQpICsgY2hyKGUpICsgY2hyKGYpICsgY2hyKGcpICsgY2hyKGgpO1xufTtcblxuLyoqXG4gKiBVVEY4IG1ldGhvZHNcbiAqL1xuXG4vLyBUYWtlIGEgcmF3IGJpbmFyeSBzdHJpbmcgYW5kIHJldHVybiBhIHV0Zjggc3RyaW5nXG5CaW5hcnlQYXJzZXIuZGVjb2RlX3V0ZjggPSBmdW5jdGlvbiAoYmluYXJ5U3RyKSB7XG4gICAgdmFyIGxlbiA9IGJpbmFyeVN0ci5sZW5ndGgsXG4gICAgICAgIGRlY29kZWQgPSAnJyxcbiAgICAgICAgaSA9IDAsXG4gICAgICAgIGMgPSAwLFxuICAgICAgICBjMSA9IDAsXG4gICAgICAgIGMyID0gMCxcbiAgICAgICAgYzM7XG4gICAgXG4gICAgd2hpbGUgKGkgPCBsZW4pIHtcbiAgICAgICAgYyA9IGJpbmFyeVN0ci5jaGFyQ29kZUF0KGkpO1xuICAgICAgICBcbiAgICAgICAgaWYgKGMgPCAxMjgpIHtcbiAgICAgICAgICAgIGRlY29kZWQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaSsrO1xuICAgICAgICB9IGVsc2UgaWYgKChjID4gMTkxKSAmJiAoYyA8IDIyNCkpIHtcbiAgICAgICAgICAgIGMyID0gYmluYXJ5U3RyLmNoYXJDb2RlQXQoaSsxKTtcbiAgICAgICAgICAgIGRlY29kZWQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgJiAzMSkgPDwgNikgfCAoYzIgJiA2MykpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpICs9IDI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjMiA9IGJpbmFyeVN0ci5jaGFyQ29kZUF0KGkrMSk7XG4gICAgICAgICAgICBjMyA9IGJpbmFyeVN0ci5jaGFyQ29kZUF0KGkrMik7XG4gICAgICAgICAgICBkZWNvZGVkICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKChjICYgMTUpIDw8IDEyKSB8ICgoYzIgJiA2MykgPDwgNikgfCAoYzMgJiA2MykpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpICs9IDM7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGRlY29kZWQ7XG59O1xuXG4vLyBFbmNvZGUgYSBjc3RyaW5nXG5CaW5hcnlQYXJzZXIuZW5jb2RlX2NzdHJpbmcgPSBmdW5jdGlvbiAocykge1xuICAgIHJldHVybiB1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQocykpICsgQmluYXJ5UGFyc2VyLmZyb21CeXRlKDApO1xufTtcblxuLy8gVGFrZSBhIHV0Zjggc3RyaW5nIGFuZCByZXR1cm4gYSBiaW5hcnkgc3RyaW5nXG5CaW5hcnlQYXJzZXIuZW5jb2RlX3V0ZjggPSBmdW5jdGlvbiBlbmNvZGVfdXRmOCAocykge1xuICAgIHZhciBhID0gXCJcIixcbiAgICAgICAgYztcblxuICAgIGZvciAodmFyIG4gPSAwLCBsZW4gPSBzLmxlbmd0aDsgbiA8IGxlbjsgbisrKSB7XG4gICAgICAgIGMgPSBzLmNoYXJDb2RlQXQobik7XG5cbiAgICAgICAgaWYgKGMgPCAxMjgpIHtcbiAgICAgICAgICAgIGEgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjKTtcbiAgICAgICAgfSBlbHNlIGlmICgoYyA+IDEyNykgJiYgKGMgPCAyMDQ4KSkge1xuICAgICAgICAgICAgYSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjPj42KSB8IDE5MikgO1xuICAgICAgICAgICAgYSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjJjYzKSB8IDEyOCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGM+PjEyKSB8IDIyNCk7XG4gICAgICAgICAgICBhICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKChjPj42KSAmIDYzKSB8IDEyOCk7XG4gICAgICAgICAgICBhICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGMmNjMpIHwgMTI4KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBhO1xufTtcblxuQmluYXJ5UGFyc2VyLmhwcmludCA9IGZ1bmN0aW9uIChzKSB7XG4gICAgdmFyIG51bWJlcjtcblxuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIGlmIChzLmNoYXJDb2RlQXQoaSkgPCAzMikge1xuICAgICAgICAgICAgbnVtYmVyID0gcy5jaGFyQ29kZUF0KGkpIDw9IDE1ID8gXCIwXCIgKyBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpIDogcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDE2KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUobnVtYmVyICsgXCIgXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbnVtYmVyID0gcy5jaGFyQ29kZUF0KGkpIDw9IDE1ID8gXCIwXCIgKyBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpIDogcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDE2KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUobnVtYmVyICsgXCIgXCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKFwiXFxuXFxuXCIpO1xufTtcblxuQmluYXJ5UGFyc2VyLmlscHJpbnQgPSBmdW5jdGlvbiAocykge1xuICAgIHZhciBudW1iZXI7XG5cbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICBpZiAocy5jaGFyQ29kZUF0KGkpIDwgMzIpIHtcbiAgICAgICAgICAgIG51bWJlciA9IHMuY2hhckNvZGVBdChpKSA8PSAxNSA/IFwiMFwiICsgcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDEwKSA6IHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBudW1iZXIgPSBzLmNoYXJDb2RlQXQoaSkgPD0gMTUgPyBcIjBcIiArIHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxMCkgOiBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTApO1xuICAgICAgICB9XG4gICAgfVxufTtcblxuQmluYXJ5UGFyc2VyLmhscHJpbnQgPSBmdW5jdGlvbiAocykge1xuICAgIHZhciBudW1iZXI7XG4gICAgXG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgaWYgKHMuY2hhckNvZGVBdChpKSA8IDMyKSB7XG4gICAgICAgICAgICBudW1iZXIgPSBzLmNoYXJDb2RlQXQoaSkgPD0gMTUgPyBcIjBcIiArIHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxNikgOiBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbnVtYmVyID0gcy5jaGFyQ29kZUF0KGkpIDw9IDE1ID8gXCIwXCIgKyBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpIDogcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDE2KTtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQmluYXJ5UGFyc2VyOyJdfQ==
