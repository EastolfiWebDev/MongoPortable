"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * @file BinaryParser.js - based on ({@link http://jsfromhell.com/classes/binary-parser Binary Parser}) by Jonas Raoni Soares Silva
 * @version 1.0.0
 * @ignore
 * 
 * @author Eduardo Astolfi <eduardo.astolfi91@gmail.com>
 * @copyright 2016 Eduardo Astolfi <eduardo.astolfi91@gmail.com>
 * @license MIT Licensed
 */

var Logger = require("./utils/Logger"),
    BinaryParserBuffer = require("./BinaryParserBuffer");

var logger = null;

// Shorcut for String.fromCharCode
var chr = String.fromCharCode;

var maxBits = [];
for (var i = 0; i < 64; i++) {
    maxBits[i] = Math.pow(2, i);
}

/**
 * BinaryParser
 * @ignore
 * 
 * @module Cursor
 * @constructor
 * @since 0.0.1
 * 
 * @classdesc Cursor class that maps a MongoDB-like cursor
 * 
 * @param {MongoPortable} db - Additional options
 * @param {Collection} collection - The collection instance
 * @param {Object|Array|String} [selection={}] - The selection for matching documents
 * @param {Object|Array|String} [fields={}] - The fields of the document to show
 * @param {Object} [options] - Database object
 * 
 * @param {Object} [options.pkFactory=null] - Object overriding the basic "ObjectId" primary key generation.
 * 
 */

var BinaryParser = function BinaryParser(bigEndian, allowExceptions) {
    _classCallCheck(this, BinaryParser);

    logger = Logger.instance;

    this.bigEndian = bigEndian;
    this.allowExceptions = allowExceptions;
};

BinaryParser.decodeFloat = function (data, precisionBits, exponentBits) {
    var b = new BinaryParserBuffer(this.bigEndian, data);

    b.checkBuffer(precisionBits + exponentBits + 1);

    var bias = maxBits[exponentBits - 1] - 1,
        signal = b.readBits(precisionBits + exponentBits, 1),
        exponent = b.readBits(precisionBits, exponentBits),
        significand = 0,
        divisor = 2,
        curByte = b.buffer.length + (-precisionBits >> 3) - 1;

    do {
        for (var byteValue = b.buffer[++curByte], startBit = precisionBits % 8 || 8, mask = 1 << startBit; mask >>= 1; byteValue & mask && (significand += 1 / divisor), divisor *= 2) {}
    } while (precisionBits -= startBit);

    if (exponent == (bias << 1) + 1) {
        if (significand) {
            return NaN;
        } else {
            if (signal) {
                return -Infinity;
            } else {
                return +Infinity;
            }
        }
    } else {
        var _mod = 0;

        if (exponent || significand) {
            if (!exponent) {
                _mod = Math.pow(2, -bias + 1) * significand;
            } else {
                _mod = Math.pow(2, exponent - bias) * (1 + significand);
            }
        }

        return (1 + signal * -2) * _mod;
    }

    // return exponent == ( bias << 1 ) + 1 ? significand ? NaN : signal ? -Infinity : +Infinity : ( 1 + signal * -2 ) * ( exponent || significand ? !exponent ? Math.pow( 2, -bias + 1 ) * significand : Math.pow( 2, exponent - bias ) * ( 1 + significand ) : 0 );
};

BinaryParser.decodeInt = function (data, bits, signed, forceBigEndian) {
    var b = new BinaryParserBuffer(this.bigEndian || forceBigEndian, data),
        x = b.readBits(0, bits),
        max = maxBits[bits]; //max = Math.pow( 2, bits );

    return signed && x >= max / 2 ? x - max : x;
};

BinaryParser.encodeFloat = function (data, precisionBits, exponentBits) {
    var bias = maxBits[exponentBits - 1] - 1,
        minExp = -bias + 1,
        maxExp = bias,
        minUnnormExp = minExp - precisionBits,
        n = parseFloat(data),
        status = isNaN(n) || n == -Infinity || n == +Infinity ? n : 0,
        exp = 0,
        len = 2 * bias + 1 + precisionBits + 3,
        bin = new Array(len),
        signal = (n = status !== 0 ? 0 : n) < 0,
        intPart = Math.floor(n = Math.abs(n)),
        floatPart = n - intPart,
        lastBit,
        rounded,
        result,
        i,
        j;

    for (i = len; i; bin[--i] = 0) {}

    for (i = bias + 2; intPart && i; bin[--i] = intPart % 2, intPart = Math.floor(intPart / 2)) {}

    for (i = bias + 1; floatPart > 0 && i; (bin[++i] = ((floatPart *= 2) >= 1) - 0) && --floatPart) {}

    for (i = -1; ++i < len && !bin[i];) {}

    if (bin[(lastBit = precisionBits - 1 + (i = (exp = bias + 1 - i) >= minExp && exp <= maxExp ? i + 1 : bias + 1 - (exp = minExp - 1))) + 1]) {
        if (!(rounded = bin[lastBit])) {
            for (j = lastBit + 2; !rounded && j < len; rounded = bin[j++]) {}
        }

        for (j = lastBit + 1; rounded && --j >= 0; (bin[j] = !bin[j] - 0) && (rounded = 0)) {}
    }

    for (i = i - 2 < 0 ? -1 : i - 3; ++i < len && !bin[i];) {}

    if ((exp = bias + 1 - i) >= minExp && exp <= maxExp) {
        ++i;
    } else if (exp < minExp) {
        exp != bias + 1 - len && exp < minUnnormExp && console.warn("encodeFloat::float underflow"); // TODO logger
        i = bias + 1 - (exp = minExp - 1);
    }

    if (intPart || status !== 0) {
        console.warn(intPart ? "encodeFloat::float overflow" : "encodeFloat::" + status); // TODO logger
        exp = maxExp + 1;
        i = bias + 2;

        if (status == -Infinity) {
            signal = 1;
        } else if (isNaN(status)) {
            bin[i] = 1;
        }
    }

    for (n = Math.abs(exp + bias), j = exponentBits + 1, result = ""; --j; result = n % 2 + result, n = n >>= 1) {}

    var r = [];

    for (n = 0, j = 0, i = (result = (signal ? "1" : "0") + result + bin.slice(i, i + precisionBits).join("")).length, r = []; i; j = (j + 1) % 8) {
        n += (1 << j) * result.charAt(--i);

        if (j == 7) {
            r[r.length] = String.fromCharCode(n);
            n = 0;
        }
    }

    r[r.length] = n ? String.fromCharCode(n) : "";

    return (this.bigEndian ? r.reverse() : r).join("");
};

BinaryParser.encodeInt = function (data, bits, signed, forceBigEndian) {
    var max = maxBits[bits];

    if (data >= max || data < -(max / 2)) {
        console.warn("encodeInt::overflow"); // TODO logger
        data = 0;
    }

    if (data < 0) {
        data += max;
    }

    for (var r = []; data; r[r.length] = String.fromCharCode(data % 256), data = Math.floor(data / 256)) {}

    for (bits = -(-bits >> 3) - r.length; bits--; r[r.length] = "\0") {}

    return (this.bigEndian || forceBigEndian ? r.reverse() : r).join("");
};

BinaryParser.toSmall = function (data) {
    return this.decodeInt(data, 8, true);
};
BinaryParser.fromSmall = function (data) {
    return this.encodeInt(data, 8, true);
};
BinaryParser.toByte = function (data) {
    return this.decodeInt(data, 8, false);
};
BinaryParser.fromByte = function (data) {
    return this.encodeInt(data, 8, false);
};
BinaryParser.toShort = function (data) {
    return this.decodeInt(data, 16, true);
};
BinaryParser.fromShort = function (data) {
    return this.encodeInt(data, 16, true);
};
BinaryParser.toWord = function (data) {
    return this.decodeInt(data, 16, false);
};
BinaryParser.fromWord = function (data) {
    return this.encodeInt(data, 16, false);
};
BinaryParser.toInt = function (data) {
    return this.decodeInt(data, 32, true);
};
BinaryParser.fromInt = function (data) {
    return this.encodeInt(data, 32, true);
};
BinaryParser.toLong = function (data) {
    return this.decodeInt(data, 64, true);
};
BinaryParser.fromLong = function (data) {
    return this.encodeInt(data, 64, true);
};
BinaryParser.toDWord = function (data) {
    return this.decodeInt(data, 32, false);
};
BinaryParser.fromDWord = function (data) {
    return this.encodeInt(data, 32, false);
};
BinaryParser.toQWord = function (data) {
    return this.decodeInt(data, 64, true);
};
BinaryParser.fromQWord = function (data) {
    return this.encodeInt(data, 64, true);
};
BinaryParser.toFloat = function (data) {
    return this.decodeFloat(data, 23, 8);
};
BinaryParser.fromFloat = function (data) {
    return this.encodeFloat(data, 23, 8);
};
BinaryParser.toDouble = function (data) {
    return this.decodeFloat(data, 52, 11);
};
BinaryParser.fromDouble = function (data) {
    return this.encodeFloat(data, 52, 11);
};

// Factor out the encode so it can be shared by add_header and push_int32
BinaryParser.encode_int32 = function (number, asArray) {
    var a, b, c, d, unsigned;

    unsigned = number < 0 ? number + 0x100000000 : number;
    a = Math.floor(unsigned / 0xffffff);

    unsigned &= 0xffffff;
    b = Math.floor(unsigned / 0xffff);

    unsigned &= 0xffff;
    c = Math.floor(unsigned / 0xff);

    unsigned &= 0xff;
    d = Math.floor(unsigned);

    return asArray ? [chr(a), chr(b), chr(c), chr(d)] : chr(a) + chr(b) + chr(c) + chr(d);
};

BinaryParser.encode_int64 = function (number) {
    var a, b, c, d, e, f, g, h, unsigned;

    unsigned = number < 0 ? number + 0x10000000000000000 : number;
    a = Math.floor(unsigned / 0xffffffffffffff);

    unsigned &= 0xffffffffffffff;
    b = Math.floor(unsigned / 0xffffffffffff);

    unsigned &= 0xffffffffffff;
    c = Math.floor(unsigned / 0xffffffffff);

    unsigned &= 0xffffffffff;
    d = Math.floor(unsigned / 0xffffffff);

    unsigned &= 0xffffffff;
    e = Math.floor(unsigned / 0xffffff);

    unsigned &= 0xffffff;
    f = Math.floor(unsigned / 0xffff);

    unsigned &= 0xffff;
    g = Math.floor(unsigned / 0xff);

    unsigned &= 0xff;
    h = Math.floor(unsigned);

    return chr(a) + chr(b) + chr(c) + chr(d) + chr(e) + chr(f) + chr(g) + chr(h);
};

/**
 * UTF8 methods
 */

// Take a raw binary string and return a utf8 string
BinaryParser.decode_utf8 = function (binaryStr) {
    var len = binaryStr.length,
        decoded = '',
        i = 0,
        c = 0,
        c1 = 0,
        c2 = 0,
        c3;

    while (i < len) {
        c = binaryStr.charCodeAt(i);

        if (c < 128) {
            decoded += String.fromCharCode(c);

            i++;
        } else if (c > 191 && c < 224) {
            c2 = binaryStr.charCodeAt(i + 1);
            decoded += String.fromCharCode((c & 31) << 6 | c2 & 63);

            i += 2;
        } else {
            c2 = binaryStr.charCodeAt(i + 1);
            c3 = binaryStr.charCodeAt(i + 2);
            decoded += String.fromCharCode((c & 15) << 12 | (c2 & 63) << 6 | c3 & 63);

            i += 3;
        }
    }

    return decoded;
};

// Encode a cstring
BinaryParser.encode_cstring = function (s) {
    return unescape(encodeURIComponent(s)) + BinaryParser.fromByte(0);
};

// Take a utf8 string and return a binary string
BinaryParser.encode_utf8 = function encode_utf8(s) {
    var a = "",
        c;

    for (var n = 0, len = s.length; n < len; n++) {
        c = s.charCodeAt(n);

        if (c < 128) {
            a += String.fromCharCode(c);
        } else if (c > 127 && c < 2048) {
            a += String.fromCharCode(c >> 6 | 192);
            a += String.fromCharCode(c & 63 | 128);
        } else {
            a += String.fromCharCode(c >> 12 | 224);
            a += String.fromCharCode(c >> 6 & 63 | 128);
            a += String.fromCharCode(c & 63 | 128);
        }
    }

    return a;
};

BinaryParser.hprint = function (s) {
    var number;

    for (var i = 0, len = s.length; i < len; i++) {
        if (s.charCodeAt(i) < 32) {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

            process.stdout.write(number + " ");
        } else {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

            process.stdout.write(number + " ");
        }
    }

    process.stdout.write("\n\n");
};

BinaryParser.ilprint = function (s) {
    var number;

    for (var i = 0, len = s.length; i < len; i++) {
        if (s.charCodeAt(i) < 32) {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(10) : s.charCodeAt(i).toString(10);
        } else {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(10) : s.charCodeAt(i).toString(10);
        }
    }
};

BinaryParser.hlprint = function (s) {
    var number;

    for (var i = 0, len = s.length; i < len; i++) {
        if (s.charCodeAt(i) < 32) {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);
        } else {
            number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);
        }
    }
};

module.exports = BinaryParser;
//# sourceMappingURL=data:application/json;base64,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O0FBQ0o7QUFDSixDQVZEOztBQVlBLGFBQWEsT0FBYixHQUF1QixVQUFVLENBQVYsRUFBYTtBQUNoQyxRQUFJLE1BQUo7O0FBRUEsU0FBSyxJQUFJLElBQUksQ0FBUixFQUFXLE1BQU0sRUFBRSxNQUF4QixFQUFnQyxJQUFJLEdBQXBDLEVBQXlDLEdBQXpDLEVBQThDO0FBQzFDLFlBQUksRUFBRSxVQUFGLENBQWEsQ0FBYixJQUFrQixFQUF0QixFQUEwQjtBQUN0QixxQkFBUyxFQUFFLFVBQUYsQ0FBYSxDQUFiLEtBQW1CLEVBQW5CLEdBQXdCLE1BQU0sRUFBRSxVQUFGLENBQWEsQ0FBYixFQUFnQixRQUFoQixDQUF5QixFQUF6QixDQUE5QixHQUE2RCxFQUFFLFVBQUYsQ0FBYSxDQUFiLEVBQWdCLFFBQWhCLENBQXlCLEVBQXpCLENBQXRFO0FBQ0gsU0FGRCxNQUVPO0FBQ0gscUJBQVMsRUFBRSxVQUFGLENBQWEsQ0FBYixLQUFtQixFQUFuQixHQUF3QixNQUFNLEVBQUUsVUFBRixDQUFhLENBQWIsRUFBZ0IsUUFBaEIsQ0FBeUIsRUFBekIsQ0FBOUIsR0FBNkQsRUFBRSxVQUFGLENBQWEsQ0FBYixFQUFnQixRQUFoQixDQUF5QixFQUF6QixDQUF0RTtBQUNIO0FBQ0o7QUFDSixDQVZEOztBQVlBLE9BQU8sT0FBUCxHQUFpQixZQUFqQiIsImZpbGUiOiJCaW5hcnlQYXJzZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEJpbmFyeVBhcnNlci5qcyAtIGJhc2VkIG9uICh7QGxpbmsgaHR0cDovL2pzZnJvbWhlbGwuY29tL2NsYXNzZXMvYmluYXJ5LXBhcnNlciBCaW5hcnkgUGFyc2VyfSkgYnkgSm9uYXMgUmFvbmkgU29hcmVzIFNpbHZhXG4gKiBAdmVyc2lvbiAxLjAuMFxuICogQGlnbm9yZVxuICogXG4gKiBAYXV0aG9yIEVkdWFyZG8gQXN0b2xmaSA8ZWR1YXJkby5hc3RvbGZpOTFAZ21haWwuY29tPlxuICogQGNvcHlyaWdodCAyMDE2IEVkdWFyZG8gQXN0b2xmaSA8ZWR1YXJkby5hc3RvbGZpOTFAZ21haWwuY29tPlxuICogQGxpY2Vuc2UgTUlUIExpY2Vuc2VkXG4gKi9cbiBcbnZhciBMb2dnZXIgPSByZXF1aXJlKFwiLi91dGlscy9Mb2dnZXJcIiksXG4gICAgQmluYXJ5UGFyc2VyQnVmZmVyID0gcmVxdWlyZShcIi4vQmluYXJ5UGFyc2VyQnVmZmVyXCIpO1xuICAgIFxudmFyIGxvZ2dlciA9IG51bGw7XG5cbi8vIFNob3JjdXQgZm9yIFN0cmluZy5mcm9tQ2hhckNvZGVcbnZhciBjaHIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlO1xuXG52YXIgbWF4Qml0cyA9IFtdO1xuZm9yICh2YXIgaSA9IDA7IGkgPCA2NDsgaSsrKSB7XG4gICAgbWF4Qml0c1tpXSA9IE1hdGgucG93KDIsIGkpO1xufVxuXG4vKipcbiAqIEJpbmFyeVBhcnNlclxuICogQGlnbm9yZVxuICogXG4gKiBAbW9kdWxlIEN1cnNvclxuICogQGNvbnN0cnVjdG9yXG4gKiBAc2luY2UgMC4wLjFcbiAqIFxuICogQGNsYXNzZGVzYyBDdXJzb3IgY2xhc3MgdGhhdCBtYXBzIGEgTW9uZ29EQi1saWtlIGN1cnNvclxuICogXG4gKiBAcGFyYW0ge01vbmdvUG9ydGFibGV9IGRiIC0gQWRkaXRpb25hbCBvcHRpb25zXG4gKiBAcGFyYW0ge0NvbGxlY3Rpb259IGNvbGxlY3Rpb24gLSBUaGUgY29sbGVjdGlvbiBpbnN0YW5jZVxuICogQHBhcmFtIHtPYmplY3R8QXJyYXl8U3RyaW5nfSBbc2VsZWN0aW9uPXt9XSAtIFRoZSBzZWxlY3Rpb24gZm9yIG1hdGNoaW5nIGRvY3VtZW50c1xuICogQHBhcmFtIHtPYmplY3R8QXJyYXl8U3RyaW5nfSBbZmllbGRzPXt9XSAtIFRoZSBmaWVsZHMgb2YgdGhlIGRvY3VtZW50IHRvIHNob3dcbiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gLSBEYXRhYmFzZSBvYmplY3RcbiAqIFxuICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zLnBrRmFjdG9yeT1udWxsXSAtIE9iamVjdCBvdmVycmlkaW5nIHRoZSBiYXNpYyBcIk9iamVjdElkXCIgcHJpbWFyeSBrZXkgZ2VuZXJhdGlvbi5cbiAqIFxuICovXG5jbGFzcyBCaW5hcnlQYXJzZXIge1xuICAgIGNvbnN0cnVjdG9yKGJpZ0VuZGlhbiwgYWxsb3dFeGNlcHRpb25zKSB7XG4gICAgICAgIGxvZ2dlciA9IExvZ2dlci5pbnN0YW5jZTtcbiAgICBcbiAgICAgICAgdGhpcy5iaWdFbmRpYW4gPSBiaWdFbmRpYW47XG4gICAgICAgIHRoaXMuYWxsb3dFeGNlcHRpb25zID0gYWxsb3dFeGNlcHRpb25zO1xuICAgIH1cbiAgICBcbiAgICBcbn1cblxuQmluYXJ5UGFyc2VyLmRlY29kZUZsb2F0ID0gZnVuY3Rpb24gKGRhdGEsIHByZWNpc2lvbkJpdHMsIGV4cG9uZW50Qml0cykge1xuICAgIHZhciBiID0gbmV3IEJpbmFyeVBhcnNlckJ1ZmZlcih0aGlzLmJpZ0VuZGlhbiwgZGF0YSk7XG5cbiAgICBiLmNoZWNrQnVmZmVyKHByZWNpc2lvbkJpdHMgKyBleHBvbmVudEJpdHMgKyAxKTtcblxuICAgIHZhciBiaWFzID0gbWF4Qml0c1tleHBvbmVudEJpdHMgLSAxXSAtIDEsXG4gICAgICAgIHNpZ25hbCA9IGIucmVhZEJpdHMocHJlY2lzaW9uQml0cyArIGV4cG9uZW50Qml0cywgMSksXG4gICAgICAgIGV4cG9uZW50ID0gYi5yZWFkQml0cyhwcmVjaXNpb25CaXRzLCBleHBvbmVudEJpdHMpLFxuICAgICAgICBzaWduaWZpY2FuZCA9IDAsXG4gICAgICAgIGRpdmlzb3IgPSAyLFxuICAgICAgICBjdXJCeXRlID0gYi5idWZmZXIubGVuZ3RoICsgKC1wcmVjaXNpb25CaXRzID4+IDMpIC0gMTtcblxuICAgIGRvIHtcbiAgICAgICAgZm9yIChcbiAgICAgICAgICAgIHZhciBieXRlVmFsdWUgPSBiLmJ1ZmZlclsgKytjdXJCeXRlIF0sIHN0YXJ0Qml0ID0gcHJlY2lzaW9uQml0cyAlIDggfHwgOCwgbWFzayA9IDEgPDwgc3RhcnRCaXQ7XG4gICAgICAgICAgICBtYXNrID4+PSAxOyBcbiAgICAgICAgICAgICggYnl0ZVZhbHVlICYgbWFzayApICYmICggc2lnbmlmaWNhbmQgKz0gMSAvIGRpdmlzb3IgKSwgZGl2aXNvciAqPSAyIFxuICAgICAgICApO1xuICAgIH0gd2hpbGUgKHByZWNpc2lvbkJpdHMgLT0gc3RhcnRCaXQpO1xuICAgIFxuICAgIFxuXG4gICAgaWYgKCBleHBvbmVudCA9PSAoIGJpYXMgPDwgMSApICsgMSApIHtcbiAgICBcdGlmIChzaWduaWZpY2FuZCkge1xuICAgIFx0XHRyZXR1cm4gTmFOO1xuICAgIFx0fSBlbHNlIHtcbiAgICBcdFx0aWYgKHNpZ25hbCkge1xuICAgIFx0XHRcdHJldHVybiAtSW5maW5pdHk7XG4gICAgXHRcdH0gZWxzZSB7XG4gICAgXHRcdFx0cmV0dXJuICtJbmZpbml0eTtcbiAgICBcdFx0fVxuICAgIFx0fVxuICAgIH0gZWxzZSB7XG4gICAgXHR2YXIgX21vZCA9IDA7XG4gICAgXHRcbiAgICBcdGlmIChleHBvbmVudCB8fCBzaWduaWZpY2FuZCkge1xuICAgIFx0XHRpZiAoIWV4cG9uZW50KSB7XG4gICAgXHRcdFx0X21vZCA9IE1hdGgucG93KCAyLCAtYmlhcyArIDEgKSAqIHNpZ25pZmljYW5kO1xuICAgIFx0XHR9IGVsc2Uge1xuICAgIFx0XHRcdF9tb2QgPSBNYXRoLnBvdyggMiwgZXhwb25lbnQgLSBiaWFzICkgKiAoIDEgKyBzaWduaWZpY2FuZCApO1xuICAgIFx0XHR9XG4gICAgXHR9XG4gICAgXHRcbiAgICBcdHJldHVybiAoIDEgKyBzaWduYWwgKiAtMiApICogKF9tb2QpO1xuICAgIH1cblxuXG4gICAgLy8gcmV0dXJuIGV4cG9uZW50ID09ICggYmlhcyA8PCAxICkgKyAxID8gc2lnbmlmaWNhbmQgPyBOYU4gOiBzaWduYWwgPyAtSW5maW5pdHkgOiArSW5maW5pdHkgOiAoIDEgKyBzaWduYWwgKiAtMiApICogKCBleHBvbmVudCB8fCBzaWduaWZpY2FuZCA/ICFleHBvbmVudCA/IE1hdGgucG93KCAyLCAtYmlhcyArIDEgKSAqIHNpZ25pZmljYW5kIDogTWF0aC5wb3coIDIsIGV4cG9uZW50IC0gYmlhcyApICogKCAxICsgc2lnbmlmaWNhbmQgKSA6IDAgKTtcbn07XG5cbkJpbmFyeVBhcnNlci5kZWNvZGVJbnQgPSBmdW5jdGlvbiAoZGF0YSwgYml0cywgc2lnbmVkLCBmb3JjZUJpZ0VuZGlhbikge1xuICAgIHZhciBiID0gbmV3IEJpbmFyeVBhcnNlckJ1ZmZlcih0aGlzLmJpZ0VuZGlhbiB8fCBmb3JjZUJpZ0VuZGlhbiwgZGF0YSksXG4gICAgICAgIHggPSBiLnJlYWRCaXRzKDAsIGJpdHMpLFxuICAgICAgICBtYXggPSBtYXhCaXRzW2JpdHNdOyAvL21heCA9IE1hdGgucG93KCAyLCBiaXRzICk7XG5cbiAgICByZXR1cm4gc2lnbmVkICYmIHggPj0gbWF4IC8gMiA/IHggLSBtYXggOiB4O1xufTtcblxuQmluYXJ5UGFyc2VyLmVuY29kZUZsb2F0ID0gZnVuY3Rpb24gKGRhdGEsIHByZWNpc2lvbkJpdHMsIGV4cG9uZW50Qml0cykge1xuICAgIHZhciBiaWFzID0gbWF4Qml0c1tleHBvbmVudEJpdHMgLSAxXSAtIDEsXG4gICAgICAgIG1pbkV4cCA9IC1iaWFzICsgMSxcbiAgICAgICAgbWF4RXhwID0gYmlhcyxcbiAgICAgICAgbWluVW5ub3JtRXhwID0gbWluRXhwIC0gcHJlY2lzaW9uQml0cyxcbiAgICAgICAgbiA9IHBhcnNlRmxvYXQoZGF0YSksXG4gICAgICAgIHN0YXR1cyA9IGlzTmFOKG4pIHx8IG4gPT0gLUluZmluaXR5IHx8IG4gPT0gK0luZmluaXR5ID8gbiA6IDAsXG4gICAgICAgIGV4cCA9IDAsXG4gICAgICAgIGxlbiA9IDIgKiBiaWFzICsgMSArIHByZWNpc2lvbkJpdHMgKyAzLFxuICAgICAgICBiaW4gPSBuZXcgQXJyYXkobGVuKSxcbiAgICAgICAgc2lnbmFsID0gKG4gPSBzdGF0dXMgIT09IDAgPyAwIDogbikgPCAwLFxuICAgICAgICBpbnRQYXJ0ID0gTWF0aC5mbG9vcihuID0gTWF0aC5hYnMobikpLFxuICAgICAgICBmbG9hdFBhcnQgPSBuIC0gaW50UGFydCxcbiAgICAgICAgbGFzdEJpdCxcbiAgICAgICAgcm91bmRlZCxcbiAgICAgICAgcmVzdWx0LFxuICAgICAgICBpLFxuICAgICAgICBqO1xuXG5cbiAgICBmb3IgKGkgPSBsZW47IGk7IGJpblstLWldID0gMCk7XG4gICAgXG4gICAgZm9yIChpID0gYmlhcyArIDI7IGludFBhcnQgJiYgaTsgYmluWy0taV0gPSBpbnRQYXJ0ICUgMiwgaW50UGFydCA9IE1hdGguZmxvb3IoaW50UGFydCAvIDIpKTtcbiAgICBcbiAgICBmb3IgKGkgPSBiaWFzICsgMTsgZmxvYXRQYXJ0ID4gMCAmJiBpOyAoYmluWysraV0gPSAoKGZsb2F0UGFydCAqPSAyKSA+PSAxKSAtIDAgKSAmJiAtLWZsb2F0UGFydCk7XG4gICAgXG4gICAgZm9yIChpID0gLTE7ICsraSA8IGxlbiAmJiAhYmluW2ldOyk7XG4gIFxuICAgIGlmIChiaW5bKGxhc3RCaXQgPSBwcmVjaXNpb25CaXRzIC0gMSArIChpID0gKGV4cCA9IGJpYXMgKyAxIC0gaSkgPj0gbWluRXhwICYmIGV4cCA8PSBtYXhFeHAgPyBpICsgMSA6IGJpYXMgKyAxIC0gKGV4cCA9IG1pbkV4cCAtIDEpKSkgKyAxXSkge1xuICAgICAgICBpZiAoIShyb3VuZGVkID0gYmluW2xhc3RCaXRdKSkge1xuICAgICAgICAgICAgZm9yIChqID0gbGFzdEJpdCArIDI7ICFyb3VuZGVkICYmIGogPCBsZW47IHJvdW5kZWQgPSBiaW5baisrXSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGZvciAoaiA9IGxhc3RCaXQgKyAxOyByb3VuZGVkICYmIC0taiA+PSAwOyAoYmluW2pdID0gIWJpbltqXSAtIDApICYmIChyb3VuZGVkID0gMCkpO1xuICAgIH1cbiAgXG4gICAgZm9yIChpID0gaSAtIDIgPCAwID8gLTEgOiBpIC0gMzsgKytpIDwgbGVuICYmICFiaW5baV07KTtcbiAgICBcbiAgICBpZiAoKGV4cCA9IGJpYXMgKyAxIC0gaSkgPj0gbWluRXhwICYmIGV4cCA8PSBtYXhFeHApIHtcbiAgICAgICAgKytpO1xuICAgIH0gZWxzZSBpZiAoZXhwIDwgbWluRXhwKSB7XG4gICAgICAgIGV4cCAhPSBiaWFzICsgMSAtIGxlbiAmJiBleHAgPCBtaW5Vbm5vcm1FeHAgJiYgY29uc29sZS53YXJuKFwiZW5jb2RlRmxvYXQ6OmZsb2F0IHVuZGVyZmxvd1wiKTsgICAgLy8gVE9ETyBsb2dnZXJcbiAgICAgICAgaSA9IGJpYXMgKyAxIC0gKGV4cCA9IG1pbkV4cCAtIDEpO1xuICAgIH1cbiAgICBcbiAgICBpZiAoaW50UGFydCB8fCBzdGF0dXMgIT09IDApIHtcbiAgICAgICAgY29uc29sZS53YXJuKGludFBhcnQgPyBcImVuY29kZUZsb2F0OjpmbG9hdCBvdmVyZmxvd1wiIDogXCJlbmNvZGVGbG9hdDo6XCIgKyBzdGF0dXMpOyAgICAvLyBUT0RPIGxvZ2dlclxuICAgICAgICBleHAgPSBtYXhFeHAgKyAxO1xuICAgICAgICBpID0gYmlhcyArIDI7XG4gICAgXG4gICAgICAgIGlmIChzdGF0dXMgPT0gLUluZmluaXR5KSB7XG4gICAgICAgICAgICBzaWduYWwgPSAxO1xuICAgICAgICB9IGVsc2UgaWYgKGlzTmFOKHN0YXR1cykpIHtcbiAgICAgICAgICAgIGJpbltpXSA9IDE7XG4gICAgICAgIH1cbiAgICB9XG4gIFxuICAgIGZvciAobiA9IE1hdGguYWJzKGV4cCArIGJpYXMpLCBqID0gZXhwb25lbnRCaXRzICsgMSwgcmVzdWx0ID0gXCJcIjsgLS1qOyByZXN1bHQgPSAobiAlIDIpICsgcmVzdWx0LCBuID0gbiA+Pj0gMSk7XG4gICAgXG4gICAgbGV0IHIgPSBbXTtcbiAgICBcbiAgICBmb3IgKG4gPSAwLCBqID0gMCwgaSA9IChyZXN1bHQgPSAoc2lnbmFsID8gXCIxXCIgOiBcIjBcIikgKyByZXN1bHQgKyBiaW4uc2xpY2UoaSwgaSArIHByZWNpc2lvbkJpdHMpLmpvaW4oXCJcIikpLmxlbmd0aCwgciA9IFtdOyBpOyBqID0gKGogKyAxKSAlIDgpIHtcbiAgICAgICAgbiArPSAoMSA8PCBqKSAqIHJlc3VsdC5jaGFyQXQoLS1pKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChqID09IDcpIHtcbiAgICAgICAgICAgIHJbci5sZW5ndGhdID0gU3RyaW5nLmZyb21DaGFyQ29kZShuKTtcbiAgICAgICAgICAgIG4gPSAwO1xuICAgICAgICB9XG4gICAgfVxuICBcbiAgICByW3IubGVuZ3RoXSA9IG4gPyBTdHJpbmcuZnJvbUNoYXJDb2RlKG4pIDogXCJcIjtcbiAgXG4gICAgcmV0dXJuICh0aGlzLmJpZ0VuZGlhbiA/IHIucmV2ZXJzZSgpIDogcikuam9pbihcIlwiKTtcbn07XG5cbkJpbmFyeVBhcnNlci5lbmNvZGVJbnQgPSBmdW5jdGlvbiAoZGF0YSwgYml0cywgc2lnbmVkLCBmb3JjZUJpZ0VuZGlhbikge1xuICAgIHZhciBtYXggPSBtYXhCaXRzW2JpdHNdO1xuICAgIFxuICAgIGlmIChkYXRhID49IG1heCB8fCBkYXRhIDwgLShtYXggLyAyKSkge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJlbmNvZGVJbnQ6Om92ZXJmbG93XCIpOyAgICAvLyBUT0RPIGxvZ2dlclxuICAgICAgICBkYXRhID0gMDtcbiAgICB9XG4gICAgXG4gICAgaWYgKGRhdGEgPCAwKSB7XG4gICAgICAgIGRhdGEgKz0gbWF4O1xuICAgIH1cbiAgICBcbiAgICBmb3IgKHZhciByID0gW107IGRhdGE7IHJbci5sZW5ndGhdID0gU3RyaW5nLmZyb21DaGFyQ29kZShkYXRhICUgMjU2KSwgZGF0YSA9IE1hdGguZmxvb3IoZGF0YSAvIDI1NikpO1xuICAgIFxuICAgIGZvciAoYml0cyA9IC0oLWJpdHMgPj4gMykgLSByLmxlbmd0aDsgYml0cy0tOyByW3IubGVuZ3RoXSA9IFwiXFwwXCIpO1xuICAgIFxuICAgIHJldHVybiAoKHRoaXMuYmlnRW5kaWFuIHx8IGZvcmNlQmlnRW5kaWFuKSA/IHIucmV2ZXJzZSgpIDogcikuam9pbihcIlwiKTtcbn07XG5cbkJpbmFyeVBhcnNlci50b1NtYWxsICAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZGVjb2RlSW50KCBkYXRhLCAgOCwgdHJ1ZSAgKTsgfTtcbkJpbmFyeVBhcnNlci5mcm9tU21hbGwgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlSW50KCBkYXRhLCAgOCwgdHJ1ZSAgKTsgfTtcbkJpbmFyeVBhcnNlci50b0J5dGUgICAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZGVjb2RlSW50KCBkYXRhLCAgOCwgZmFsc2UgKTsgfTtcbkJpbmFyeVBhcnNlci5mcm9tQnl0ZSAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlSW50KCBkYXRhLCAgOCwgZmFsc2UgKTsgfTtcbkJpbmFyeVBhcnNlci50b1Nob3J0ICAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZGVjb2RlSW50KCBkYXRhLCAxNiwgdHJ1ZSAgKTsgfTtcbkJpbmFyeVBhcnNlci5mcm9tU2hvcnQgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlSW50KCBkYXRhLCAxNiwgdHJ1ZSAgKTsgfTtcbkJpbmFyeVBhcnNlci50b1dvcmQgICAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZGVjb2RlSW50KCBkYXRhLCAxNiwgZmFsc2UgKTsgfTtcbkJpbmFyeVBhcnNlci5mcm9tV29yZCAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlSW50KCBkYXRhLCAxNiwgZmFsc2UgKTsgfTtcbkJpbmFyeVBhcnNlci50b0ludCAgICAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZGVjb2RlSW50KCBkYXRhLCAzMiwgdHJ1ZSAgKTsgfTtcbkJpbmFyeVBhcnNlci5mcm9tSW50ICAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlSW50KCBkYXRhLCAzMiwgdHJ1ZSAgKTsgfTtcbkJpbmFyeVBhcnNlci50b0xvbmcgICAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZGVjb2RlSW50KCBkYXRhLCA2NCwgdHJ1ZSAgKTsgfTtcbkJpbmFyeVBhcnNlci5mcm9tTG9uZyAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlSW50KCBkYXRhLCA2NCwgdHJ1ZSAgKTsgfTtcbkJpbmFyeVBhcnNlci50b0RXb3JkICAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZGVjb2RlSW50KCBkYXRhLCAzMiwgZmFsc2UgKTsgfTtcbkJpbmFyeVBhcnNlci5mcm9tRFdvcmQgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlSW50KCBkYXRhLCAzMiwgZmFsc2UgKTsgfTtcbkJpbmFyeVBhcnNlci50b1FXb3JkICAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZGVjb2RlSW50KCBkYXRhLCA2NCwgdHJ1ZSApOyB9O1xuQmluYXJ5UGFyc2VyLmZyb21RV29yZCAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVJbnQoIGRhdGEsIDY0LCB0cnVlICk7IH07XG5CaW5hcnlQYXJzZXIudG9GbG9hdCAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUZsb2F0KCBkYXRhLCAyMywgOCAgICk7IH07XG5CaW5hcnlQYXJzZXIuZnJvbUZsb2F0ICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUZsb2F0KCBkYXRhLCAyMywgOCAgICk7IH07XG5CaW5hcnlQYXJzZXIudG9Eb3VibGUgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUZsb2F0KCBkYXRhLCA1MiwgMTEgICk7IH07XG5CaW5hcnlQYXJzZXIuZnJvbURvdWJsZSA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUZsb2F0KCBkYXRhLCA1MiwgMTEgICk7IH07XG5cbi8vIEZhY3RvciBvdXQgdGhlIGVuY29kZSBzbyBpdCBjYW4gYmUgc2hhcmVkIGJ5IGFkZF9oZWFkZXIgYW5kIHB1c2hfaW50MzJcbkJpbmFyeVBhcnNlci5lbmNvZGVfaW50MzIgPSBmdW5jdGlvbiAobnVtYmVyLCBhc0FycmF5KSB7XG4gICAgdmFyIGEsIGIsIGMsIGQsIHVuc2lnbmVkO1xuICAgIFxuICAgIHVuc2lnbmVkID0gKG51bWJlciA8IDApID8gKG51bWJlciArIDB4MTAwMDAwMDAwKSA6IG51bWJlcjtcbiAgICBhID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmZmZmZmKTtcbiAgICBcbiAgICB1bnNpZ25lZCAmPSAweGZmZmZmZjtcbiAgICBiID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmZmZik7XG4gICAgXG4gICAgdW5zaWduZWQgJj0gMHhmZmZmO1xuICAgIGMgPSBNYXRoLmZsb29yKHVuc2lnbmVkIC8gMHhmZik7XG4gICAgXG4gICAgdW5zaWduZWQgJj0gMHhmZjtcbiAgICBkID0gTWF0aC5mbG9vcih1bnNpZ25lZCk7XG4gICAgXG4gICAgcmV0dXJuIGFzQXJyYXkgPyBbY2hyKGEpLCBjaHIoYiksIGNocihjKSwgY2hyKGQpXSA6IGNocihhKSArIGNocihiKSArIGNocihjKSArIGNocihkKTtcbn07XG5cbkJpbmFyeVBhcnNlci5lbmNvZGVfaW50NjQgPSBmdW5jdGlvbiAobnVtYmVyKSB7XG4gICAgdmFyIGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgsIHVuc2lnbmVkO1xuICAgIFxuICAgIHVuc2lnbmVkID0gKG51bWJlciA8IDApID8gKG51bWJlciArIDB4MTAwMDAwMDAwMDAwMDAwMDApIDogbnVtYmVyO1xuICAgIGEgPSBNYXRoLmZsb29yKHVuc2lnbmVkIC8gMHhmZmZmZmZmZmZmZmZmZik7XG4gICAgXG4gICAgdW5zaWduZWQgJj0gMHhmZmZmZmZmZmZmZmZmZjtcbiAgICBiID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmZmZmZmZmZmZmZmKTtcbiAgICBcbiAgICB1bnNpZ25lZCAmPSAweGZmZmZmZmZmZmZmZjtcbiAgICBjID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmZmZmZmZmZmZik7XG4gICAgXG4gICAgdW5zaWduZWQgJj0gMHhmZmZmZmZmZmZmO1xuICAgIGQgPSBNYXRoLmZsb29yKHVuc2lnbmVkIC8gMHhmZmZmZmZmZik7XG4gICAgXG4gICAgdW5zaWduZWQgJj0gMHhmZmZmZmZmZjtcbiAgICBlID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmZmZmZmKTtcbiAgICBcbiAgICB1bnNpZ25lZCAmPSAweGZmZmZmZjtcbiAgICBmID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmZmZik7XG4gICAgXG4gICAgdW5zaWduZWQgJj0gMHhmZmZmO1xuICAgIGcgPSBNYXRoLmZsb29yKHVuc2lnbmVkIC8gMHhmZik7XG4gICAgXG4gICAgdW5zaWduZWQgJj0gMHhmZjtcbiAgICBoID0gTWF0aC5mbG9vcih1bnNpZ25lZCk7XG4gICAgXG4gICAgcmV0dXJuIGNocihhKSArIGNocihiKSArIGNocihjKSArIGNocihkKSArIGNocihlKSArIGNocihmKSArIGNocihnKSArIGNocihoKTtcbn07XG5cbi8qKlxuICogVVRGOCBtZXRob2RzXG4gKi9cblxuLy8gVGFrZSBhIHJhdyBiaW5hcnkgc3RyaW5nIGFuZCByZXR1cm4gYSB1dGY4IHN0cmluZ1xuQmluYXJ5UGFyc2VyLmRlY29kZV91dGY4ID0gZnVuY3Rpb24gKGJpbmFyeVN0cikge1xuICAgIHZhciBsZW4gPSBiaW5hcnlTdHIubGVuZ3RoLFxuICAgICAgICBkZWNvZGVkID0gJycsXG4gICAgICAgIGkgPSAwLFxuICAgICAgICBjID0gMCxcbiAgICAgICAgYzEgPSAwLFxuICAgICAgICBjMiA9IDAsXG4gICAgICAgIGMzO1xuICAgIFxuICAgIHdoaWxlIChpIDwgbGVuKSB7XG4gICAgICAgIGMgPSBiaW5hcnlTdHIuY2hhckNvZGVBdChpKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChjIDwgMTI4KSB7XG4gICAgICAgICAgICBkZWNvZGVkICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGkrKztcbiAgICAgICAgfSBlbHNlIGlmICgoYyA+IDE5MSkgJiYgKGMgPCAyMjQpKSB7XG4gICAgICAgICAgICBjMiA9IGJpbmFyeVN0ci5jaGFyQ29kZUF0KGkrMSk7XG4gICAgICAgICAgICBkZWNvZGVkICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKChjICYgMzEpIDw8IDYpIHwgKGMyICYgNjMpKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaSArPSAyO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYzIgPSBiaW5hcnlTdHIuY2hhckNvZGVBdChpKzEpO1xuICAgICAgICAgICAgYzMgPSBiaW5hcnlTdHIuY2hhckNvZGVBdChpKzIpO1xuICAgICAgICAgICAgZGVjb2RlZCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYyAmIDE1KSA8PCAxMikgfCAoKGMyICYgNjMpIDw8IDYpIHwgKGMzICYgNjMpKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaSArPSAzO1xuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBkZWNvZGVkO1xufTtcblxuLy8gRW5jb2RlIGEgY3N0cmluZ1xuQmluYXJ5UGFyc2VyLmVuY29kZV9jc3RyaW5nID0gZnVuY3Rpb24gKHMpIHtcbiAgICByZXR1cm4gdW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHMpKSArIEJpbmFyeVBhcnNlci5mcm9tQnl0ZSgwKTtcbn07XG5cbi8vIFRha2UgYSB1dGY4IHN0cmluZyBhbmQgcmV0dXJuIGEgYmluYXJ5IHN0cmluZ1xuQmluYXJ5UGFyc2VyLmVuY29kZV91dGY4ID0gZnVuY3Rpb24gZW5jb2RlX3V0ZjggKHMpIHtcbiAgICB2YXIgYSA9IFwiXCIsXG4gICAgICAgIGM7XG5cbiAgICBmb3IgKHZhciBuID0gMCwgbGVuID0gcy5sZW5ndGg7IG4gPCBsZW47IG4rKykge1xuICAgICAgICBjID0gcy5jaGFyQ29kZUF0KG4pO1xuXG4gICAgICAgIGlmIChjIDwgMTI4KSB7XG4gICAgICAgICAgICBhICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYyk7XG4gICAgICAgIH0gZWxzZSBpZiAoKGMgPiAxMjcpICYmIChjIDwgMjA0OCkpIHtcbiAgICAgICAgICAgIGEgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYz4+NikgfCAxOTIpIDtcbiAgICAgICAgICAgIGEgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyY2MykgfCAxMjgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjPj4xMikgfCAyMjQpO1xuICAgICAgICAgICAgYSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYz4+NikgJiA2MykgfCAxMjgpO1xuICAgICAgICAgICAgYSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjJjYzKSB8IDEyOCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gYTtcbn07XG5cbkJpbmFyeVBhcnNlci5ocHJpbnQgPSBmdW5jdGlvbiAocykge1xuICAgIHZhciBudW1iZXI7XG5cbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICBpZiAocy5jaGFyQ29kZUF0KGkpIDwgMzIpIHtcbiAgICAgICAgICAgIG51bWJlciA9IHMuY2hhckNvZGVBdChpKSA8PSAxNSA/IFwiMFwiICsgcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDE2KSA6IHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxNik7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKG51bWJlciArIFwiIFwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG51bWJlciA9IHMuY2hhckNvZGVBdChpKSA8PSAxNSA/IFwiMFwiICsgcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDE2KSA6IHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxNik7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKG51bWJlciArIFwiIFwiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShcIlxcblxcblwiKTtcbn07XG5cbkJpbmFyeVBhcnNlci5pbHByaW50ID0gZnVuY3Rpb24gKHMpIHtcbiAgICB2YXIgbnVtYmVyO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgaWYgKHMuY2hhckNvZGVBdChpKSA8IDMyKSB7XG4gICAgICAgICAgICBudW1iZXIgPSBzLmNoYXJDb2RlQXQoaSkgPD0gMTUgPyBcIjBcIiArIHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxMCkgOiBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbnVtYmVyID0gcy5jaGFyQ29kZUF0KGkpIDw9IDE1ID8gXCIwXCIgKyBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTApIDogcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDEwKTtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbkJpbmFyeVBhcnNlci5obHByaW50ID0gZnVuY3Rpb24gKHMpIHtcbiAgICB2YXIgbnVtYmVyO1xuICAgIFxuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIGlmIChzLmNoYXJDb2RlQXQoaSkgPCAzMikge1xuICAgICAgICAgICAgbnVtYmVyID0gcy5jaGFyQ29kZUF0KGkpIDw9IDE1ID8gXCIwXCIgKyBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpIDogcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDE2KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG51bWJlciA9IHMuY2hhckNvZGVBdChpKSA8PSAxNSA/IFwiMFwiICsgcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDE2KSA6IHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxNik7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJpbmFyeVBhcnNlcjsiXX0=
