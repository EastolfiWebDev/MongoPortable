"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * @file BinaryParser.js - based on ({@link http://jsfromhell.com/classes/binary-parser Binary Parser}) by Jonas Raoni Soares Silva
 * @version 1.0.0
 * @ignore
 * 
 * @author Eduardo Astolfi <eastolfi91@gmail.com>
 * @copyright 2016 Eduardo Astolfi <eastolfi91@gmail.com>
 * @license MIT Licensed
 */

var logger = null;

// Shorcut for String.fromCharCode
var chr = String.fromCharCode;

var maxBits = [];
for (var i = 0; i < 64; i++) {
    maxBits[i] = Math.pow(2, i);
}

module.exports = function (BinaryParserBuffer, Logger) {
    logger = Logger.instance;

    /**
     * BinaryParser
     * @ignore
     * 
     * @module Cursor
     * @constructor
     * @since 0.0.1
     * 
     * @classdesc Cursor class that maps a MongoDB-like cursor
     * 
     * @param {MongoPortable} db - Additional options
     * @param {Collection} collection - The collection instance
     * @param {Object|Array|String} [selection={}] - The selection for matching documents
     * @param {Object|Array|String} [fields={}] - The fields of the document to show
     * @param {Object} [options] - Database object
     * 
     * @param {Object} [options.pkFactory=null] - Object overriding the basic "ObjectId" primary key generation.
     * 
     */

    var BinaryParser = function BinaryParser(bigEndian, allowExceptions) {
        _classCallCheck(this, BinaryParser);

        logger = Logger.instance;

        this.bigEndian = bigEndian;
        this.allowExceptions = allowExceptions;
    };

    BinaryParser.decodeFloat = function (data, precisionBits, exponentBits) {
        var b = new BinaryParserBuffer(this.bigEndian, data);

        b.checkBuffer(precisionBits + exponentBits + 1);

        var bias = maxBits[exponentBits - 1] - 1,
            signal = b.readBits(precisionBits + exponentBits, 1),
            exponent = b.readBits(precisionBits, exponentBits),
            significand = 0,
            divisor = 2,
            curByte = b.buffer.length + (-precisionBits >> 3) - 1;

        do {
            for (var byteValue = b.buffer[++curByte], startBit = precisionBits % 8 || 8, mask = 1 << startBit; mask >>= 1; byteValue & mask && (significand += 1 / divisor), divisor *= 2) {}
        } while (precisionBits -= startBit);

        if (exponent == (bias << 1) + 1) {
            if (significand) {
                return NaN;
            } else {
                if (signal) {
                    return -Infinity;
                } else {
                    return +Infinity;
                }
            }
        } else {
            var _mod = 0;

            if (exponent || significand) {
                _mod = exponent ? Math.pow(2, exponent - bias) * (1 + significand) : Math.pow(2, -bias + 1) * significand;
            }

            return (1 + signal * -2) * _mod;
        }

        // return exponent == ( bias << 1 ) + 1 ? significand ? NaN : signal ? -Infinity : +Infinity : ( 1 + signal * -2 ) * ( exponent || significand ? !exponent ? Math.pow( 2, -bias + 1 ) * significand : Math.pow( 2, exponent - bias ) * ( 1 + significand ) : 0 );
    };

    BinaryParser.decodeInt = function (data, bits, signed, forceBigEndian) {
        var b = new BinaryParserBuffer(this.bigEndian || forceBigEndian, data),
            x = b.readBits(0, bits),
            max = maxBits[bits]; //max = Math.pow( 2, bits );

        return signed && x >= max / 2 ? x - max : x;
    };

    BinaryParser.encodeFloat = function (data, precisionBits, exponentBits) {
        var bias = maxBits[exponentBits - 1] - 1,
            minExp = -bias + 1,
            maxExp = bias,
            minUnnormExp = minExp - precisionBits,
            n = parseFloat(data),
            status = isNaN(n) || n == -Infinity || n == +Infinity ? n : 0,
            exp = 0,
            len = 2 * bias + 1 + precisionBits + 3,
            bin = new Array(len),
            signal = (n = status !== 0 ? 0 : n) < 0,
            intPart = Math.floor(n = Math.abs(n)),
            floatPart = n - intPart,
            lastBit,
            rounded,
            result,
            i,
            j;

        for (i = len; i; bin[--i] = 0) {}

        for (i = bias + 2; intPart && i; bin[--i] = intPart % 2, intPart = Math.floor(intPart / 2)) {}

        for (i = bias + 1; floatPart > 0 && i; (bin[++i] = ((floatPart *= 2) >= 1) - 0) && --floatPart) {}

        for (i = -1; ++i < len && !bin[i];) {}

        if (bin[(lastBit = precisionBits - 1 + (i = (exp = bias + 1 - i) >= minExp && exp <= maxExp ? i + 1 : bias + 1 - (exp = minExp - 1))) + 1]) {
            if (!(rounded = bin[lastBit])) {
                for (j = lastBit + 2; !rounded && j < len; rounded = bin[j++]) {}
            }

            for (j = lastBit + 1; rounded && --j >= 0; (bin[j] = !bin[j] - 0) && (rounded = 0)) {}
        }

        for (i = i - 2 < 0 ? -1 : i - 3; ++i < len && !bin[i];) {}

        if ((exp = bias + 1 - i) >= minExp && exp <= maxExp) {
            ++i;
        } else if (exp < minExp) {
            exp != bias + 1 - len && exp < minUnnormExp && logger.warn("encodeFloat::float underflow");
            i = bias + 1 - (exp = minExp - 1);
        }

        if (intPart || status !== 0) {
            logger.warn(intPart ? "encodeFloat::float overflow" : "encodeFloat::" + status);
            exp = maxExp + 1;
            i = bias + 2;

            if (status == -Infinity) {
                signal = 1;
            } else if (isNaN(status)) {
                bin[i] = 1;
            }
        }

        for (n = Math.abs(exp + bias), j = exponentBits + 1, result = ""; --j; result = n % 2 + result, n = n >>= 1) {}

        var r = [];

        for (n = 0, j = 0, i = (result = (signal ? "1" : "0") + result + bin.slice(i, i + precisionBits).join("")).length, r = []; i; j = (j + 1) % 8) {
            n += (1 << j) * result.charAt(--i);

            if (j == 7) {
                r[r.length] = String.fromCharCode(n);
                n = 0;
            }
        }

        r[r.length] = n ? String.fromCharCode(n) : "";

        return (this.bigEndian ? r.reverse() : r).join("");
    };

    BinaryParser.encodeInt = function (data, bits, signed, forceBigEndian) {
        var max = maxBits[bits];

        if (data >= max || data < -(max / 2)) {
            logger.warn("encodeInt::overflow");
            data = 0;
        }

        if (data < 0) {
            data += max;
        }

        for (var r = []; data; r[r.length] = String.fromCharCode(data % 256), data = Math.floor(data / 256)) {}

        for (bits = -(-bits >> 3) - r.length; bits--; r[r.length] = "\0") {}

        return (this.bigEndian || forceBigEndian ? r.reverse() : r).join("");
    };

    BinaryParser.toSmall = function (data) {
        return this.decodeInt(data, 8, true);
    };
    BinaryParser.fromSmall = function (data) {
        return this.encodeInt(data, 8, true);
    };
    BinaryParser.toByte = function (data) {
        return this.decodeInt(data, 8, false);
    };
    BinaryParser.fromByte = function (data) {
        return this.encodeInt(data, 8, false);
    };
    BinaryParser.toShort = function (data) {
        return this.decodeInt(data, 16, true);
    };
    BinaryParser.fromShort = function (data) {
        return this.encodeInt(data, 16, true);
    };
    BinaryParser.toWord = function (data) {
        return this.decodeInt(data, 16, false);
    };
    BinaryParser.fromWord = function (data) {
        return this.encodeInt(data, 16, false);
    };
    BinaryParser.toInt = function (data) {
        return this.decodeInt(data, 32, true);
    };
    BinaryParser.fromInt = function (data) {
        return this.encodeInt(data, 32, true);
    };
    BinaryParser.toLong = function (data) {
        return this.decodeInt(data, 64, true);
    };
    BinaryParser.fromLong = function (data) {
        return this.encodeInt(data, 64, true);
    };
    BinaryParser.toDWord = function (data) {
        return this.decodeInt(data, 32, false);
    };
    BinaryParser.fromDWord = function (data) {
        return this.encodeInt(data, 32, false);
    };
    BinaryParser.toQWord = function (data) {
        return this.decodeInt(data, 64, true);
    };
    BinaryParser.fromQWord = function (data) {
        return this.encodeInt(data, 64, true);
    };
    BinaryParser.toFloat = function (data) {
        return this.decodeFloat(data, 23, 8);
    };
    BinaryParser.fromFloat = function (data) {
        return this.encodeFloat(data, 23, 8);
    };
    BinaryParser.toDouble = function (data) {
        return this.decodeFloat(data, 52, 11);
    };
    BinaryParser.fromDouble = function (data) {
        return this.encodeFloat(data, 52, 11);
    };

    // Factor out the encode so it can be shared by add_header and push_int32
    BinaryParser.encode_int32 = function (number, asArray) {
        var a, b, c, d, unsigned;

        unsigned = number < 0 ? number + 0x100000000 : number;
        a = Math.floor(unsigned / 0xffffff);

        unsigned &= 0xffffff;
        b = Math.floor(unsigned / 0xffff);

        unsigned &= 0xffff;
        c = Math.floor(unsigned / 0xff);

        unsigned &= 0xff;
        d = Math.floor(unsigned);

        return asArray ? [chr(a), chr(b), chr(c), chr(d)] : chr(a) + chr(b) + chr(c) + chr(d);
    };

    BinaryParser.encode_int64 = function (number) {
        var a, b, c, d, e, f, g, h, unsigned;

        unsigned = number < 0 ? number + 0x10000000000000000 : number;
        a = Math.floor(unsigned / 0xffffffffffffff);

        unsigned &= 0xffffffffffffff;
        b = Math.floor(unsigned / 0xffffffffffff);

        unsigned &= 0xffffffffffff;
        c = Math.floor(unsigned / 0xffffffffff);

        unsigned &= 0xffffffffff;
        d = Math.floor(unsigned / 0xffffffff);

        unsigned &= 0xffffffff;
        e = Math.floor(unsigned / 0xffffff);

        unsigned &= 0xffffff;
        f = Math.floor(unsigned / 0xffff);

        unsigned &= 0xffff;
        g = Math.floor(unsigned / 0xff);

        unsigned &= 0xff;
        h = Math.floor(unsigned);

        return chr(a) + chr(b) + chr(c) + chr(d) + chr(e) + chr(f) + chr(g) + chr(h);
    };

    /**
     * UTF8 methods
     */

    // Take a raw binary string and return a utf8 string
    BinaryParser.decode_utf8 = function (binaryStr) {
        var len = binaryStr.length,
            decoded = '',
            i = 0,
            c = 0,
            c1 = 0,
            c2 = 0,
            c3;

        while (i < len) {
            c = binaryStr.charCodeAt(i);

            if (c < 128) {
                decoded += String.fromCharCode(c);

                i++;
            } else if (c > 191 && c < 224) {
                c2 = binaryStr.charCodeAt(i + 1);
                decoded += String.fromCharCode((c & 31) << 6 | c2 & 63);

                i += 2;
            } else {
                c2 = binaryStr.charCodeAt(i + 1);
                c3 = binaryStr.charCodeAt(i + 2);
                decoded += String.fromCharCode((c & 15) << 12 | (c2 & 63) << 6 | c3 & 63);

                i += 3;
            }
        }

        return decoded;
    };

    // Encode a cstring
    BinaryParser.encode_cstring = function (s) {
        return unescape(encodeURIComponent(s)) + BinaryParser.fromByte(0);
    };

    // Take a utf8 string and return a binary string
    BinaryParser.encode_utf8 = function encode_utf8(s) {
        var a = "",
            c;

        for (var n = 0, len = s.length; n < len; n++) {
            c = s.charCodeAt(n);

            if (c < 128) {
                a += String.fromCharCode(c);
            } else if (c > 127 && c < 2048) {
                a += String.fromCharCode(c >> 6 | 192);
                a += String.fromCharCode(c & 63 | 128);
            } else {
                a += String.fromCharCode(c >> 12 | 224);
                a += String.fromCharCode(c >> 6 & 63 | 128);
                a += String.fromCharCode(c & 63 | 128);
            }
        }

        return a;
    };

    BinaryParser.hprint = function (s) {
        var number;

        for (var i = 0, len = s.length; i < len; i++) {
            if (s.charCodeAt(i) < 32) {
                number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

                logger.silly(number + " ");
            } else {
                number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

                logger.silly(number + " ");
            }
        }

        logger.silly("\n\n");

        return number;
    };

    BinaryParser.ilprint = function (s) {
        var number;

        for (var i = 0, len = s.length; i < len; i++) {
            if (s.charCodeAt(i) < 32) {
                number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(10) : s.charCodeAt(i).toString(10);

                logger.silly(number + " ");
            } else {
                number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(10) : s.charCodeAt(i).toString(10);

                logger.silly(number + " ");
            }
        }

        logger.silly("\n\n");

        return number;
    };

    BinaryParser.hlprint = function (s) {
        var number;

        for (var i = 0, len = s.length; i < len; i++) {
            if (s.charCodeAt(i) < 32) {
                number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

                logger.silly(number + " ");
            } else {
                number = s.charCodeAt(i) <= 15 ? "0" + s.charCodeAt(i).toString(16) : s.charCodeAt(i).toString(16);

                logger.silly(number + " ");
            }
        }

        logger.silly("\n\n");

        return number;
    };

    return BinaryParser;
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkJpbmFyeVBhcnNlci5qcyJdLCJuYW1lcyI6WyJsb2dnZXIiLCJjaHIiLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJtYXhCaXRzIiwiaSIsIk1hdGgiLCJwb3ciLCJtb2R1bGUiLCJleHBvcnRzIiwiQmluYXJ5UGFyc2VyQnVmZmVyIiwiTG9nZ2VyIiwiaW5zdGFuY2UiLCJCaW5hcnlQYXJzZXIiLCJiaWdFbmRpYW4iLCJhbGxvd0V4Y2VwdGlvbnMiLCJkZWNvZGVGbG9hdCIsImRhdGEiLCJwcmVjaXNpb25CaXRzIiwiZXhwb25lbnRCaXRzIiwiYiIsImNoZWNrQnVmZmVyIiwiYmlhcyIsInNpZ25hbCIsInJlYWRCaXRzIiwiZXhwb25lbnQiLCJzaWduaWZpY2FuZCIsImRpdmlzb3IiLCJjdXJCeXRlIiwiYnVmZmVyIiwibGVuZ3RoIiwiYnl0ZVZhbHVlIiwic3RhcnRCaXQiLCJtYXNrIiwiTmFOIiwiSW5maW5pdHkiLCJfbW9kIiwiZGVjb2RlSW50IiwiYml0cyIsInNpZ25lZCIsImZvcmNlQmlnRW5kaWFuIiwieCIsIm1heCIsImVuY29kZUZsb2F0IiwibWluRXhwIiwibWF4RXhwIiwibWluVW5ub3JtRXhwIiwibiIsInBhcnNlRmxvYXQiLCJzdGF0dXMiLCJpc05hTiIsImV4cCIsImxlbiIsImJpbiIsIkFycmF5IiwiaW50UGFydCIsImZsb29yIiwiYWJzIiwiZmxvYXRQYXJ0IiwibGFzdEJpdCIsInJvdW5kZWQiLCJyZXN1bHQiLCJqIiwid2FybiIsInIiLCJzbGljZSIsImpvaW4iLCJjaGFyQXQiLCJyZXZlcnNlIiwiZW5jb2RlSW50IiwidG9TbWFsbCIsImZyb21TbWFsbCIsInRvQnl0ZSIsImZyb21CeXRlIiwidG9TaG9ydCIsImZyb21TaG9ydCIsInRvV29yZCIsImZyb21Xb3JkIiwidG9JbnQiLCJmcm9tSW50IiwidG9Mb25nIiwiZnJvbUxvbmciLCJ0b0RXb3JkIiwiZnJvbURXb3JkIiwidG9RV29yZCIsImZyb21RV29yZCIsInRvRmxvYXQiLCJmcm9tRmxvYXQiLCJ0b0RvdWJsZSIsImZyb21Eb3VibGUiLCJlbmNvZGVfaW50MzIiLCJudW1iZXIiLCJhc0FycmF5IiwiYSIsImMiLCJkIiwidW5zaWduZWQiLCJlbmNvZGVfaW50NjQiLCJlIiwiZiIsImciLCJoIiwiZGVjb2RlX3V0ZjgiLCJiaW5hcnlTdHIiLCJkZWNvZGVkIiwiYzEiLCJjMiIsImMzIiwiY2hhckNvZGVBdCIsImVuY29kZV9jc3RyaW5nIiwicyIsInVuZXNjYXBlIiwiZW5jb2RlVVJJQ29tcG9uZW50IiwiZW5jb2RlX3V0ZjgiLCJocHJpbnQiLCJ0b1N0cmluZyIsInNpbGx5IiwiaWxwcmludCIsImhscHJpbnQiXSwibWFwcGluZ3MiOiI7Ozs7QUFBQTs7Ozs7Ozs7OztBQVVBLElBQUlBLFNBQVMsSUFBYjs7QUFFQTtBQUNBLElBQUlDLE1BQU1DLE9BQU9DLFlBQWpCOztBQUVBLElBQUlDLFVBQVUsRUFBZDtBQUNBLEtBQUssSUFBSUMsSUFBSSxDQUFiLEVBQWdCQSxJQUFJLEVBQXBCLEVBQXdCQSxHQUF4QixFQUE2QjtBQUN6QkQsWUFBUUMsQ0FBUixJQUFhQyxLQUFLQyxHQUFMLENBQVMsQ0FBVCxFQUFZRixDQUFaLENBQWI7QUFDSDs7QUFFREcsT0FBT0MsT0FBUCxHQUFpQixVQUFTQyxrQkFBVCxFQUE2QkMsTUFBN0IsRUFBcUM7QUFDbERYLGFBQVNXLE9BQU9DLFFBQWhCOztBQUVBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUhrRCxRQXNCNUNDLFlBdEI0QyxHQXVCOUMsc0JBQVlDLFNBQVosRUFBdUJDLGVBQXZCLEVBQXdDO0FBQUE7O0FBQ3BDZixpQkFBU1csT0FBT0MsUUFBaEI7O0FBRUEsYUFBS0UsU0FBTCxHQUFpQkEsU0FBakI7QUFDQSxhQUFLQyxlQUFMLEdBQXVCQSxlQUF2QjtBQUNILEtBNUI2Qzs7QUFpQ2xERixpQkFBYUcsV0FBYixHQUEyQixVQUFVQyxJQUFWLEVBQWdCQyxhQUFoQixFQUErQkMsWUFBL0IsRUFBNkM7QUFDcEUsWUFBSUMsSUFBSSxJQUFJ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QUFFQSxlQUFPekIsTUFBUDtBQUNILEtBbEJEOztBQW9CQTlFLGlCQUFheUcsT0FBYixHQUF1QixVQUFVUixDQUFWLEVBQWE7QUFDaEMsWUFBSW5CLE1BQUo7O0FBRUEsYUFBSyxJQUFJdEYsSUFBSSxDQUFSLEVBQVcrQyxNQUFNMEQsRUFBRWhGLE1BQXhCLEVBQWdDekIsSUFBSStDLEdBQXBDLEVBQXlDL0MsR0FBekMsRUFBOEM7QUFDMUMsZ0JBQUl5RyxFQUFFRixVQUFGLENBQWF2RyxDQUFiLElBQWtCLEVBQXRCLEVBQTBCO0FBQ3RCc0YseUJBQVNtQixFQUFFRixVQUFGLENBQWF2RyxDQUFiLEtBQW1CLEVBQW5CLEdBQXdCLE1BQU15RyxFQUFFRixVQUFGLENBQWF2RyxDQUFiLEVBQWdCOEcsUUFBaEIsQ0FBeUIsRUFBekIsQ0FBOUIsR0FBNkRMLEVBQUVGLFVBQUYsQ0FBYXZHLENBQWIsRUFBZ0I4RyxRQUFoQixDQUF5QixFQUF6QixDQUF0RTs7QUFFQW5ILHVCQUFPb0gsS0FBUCxDQUFhekIsU0FBUyxHQUF0QjtBQUNILGFBSkQsTUFJTztBQUNIQSx5QkFBU21CLEVBQUVGLFVBQUYsQ0FBYXZHLENBQWIsS0FBbUIsRUFBbkIsR0FBd0IsTUFBTXlHLEVBQUVGLFVBQUYsQ0FBYXZHLENBQWIsRUFBZ0I4RyxRQUFoQixDQUF5QixFQUF6QixDQUE5QixHQUE2REwsRUFBRUYsVUFBRixDQUFhdkcsQ0FBYixFQUFnQjhHLFFBQWhCLENBQXlCLEVBQXpCLENBQXRFOztBQUVBbkgsdUJBQU9vSCxLQUFQLENBQWF6QixTQUFTLEdBQXRCO0FBQ0g7QUFDSjs7QUFFRDNGLGVBQU9vSCxLQUFQLENBQWEsTUFBYjs7QUFFQSxlQUFPekIsTUFBUDtBQUNILEtBbEJEOztBQW9CQSxXQUFPOUUsWUFBUDtBQUNILENBMVhEIiwiZmlsZSI6IkJpbmFyeVBhcnNlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgQmluYXJ5UGFyc2VyLmpzIC0gYmFzZWQgb24gKHtAbGluayBodHRwOi8vanNmcm9taGVsbC5jb20vY2xhc3Nlcy9iaW5hcnktcGFyc2VyIEJpbmFyeSBQYXJzZXJ9KSBieSBKb25hcyBSYW9uaSBTb2FyZXMgU2lsdmFcbiAqIEB2ZXJzaW9uIDEuMC4wXG4gKiBAaWdub3JlXG4gKiBcbiAqIEBhdXRob3IgRWR1YXJkbyBBc3RvbGZpIDxlYXN0b2xmaTkxQGdtYWlsLmNvbT5cbiAqIEBjb3B5cmlnaHQgMjAxNiBFZHVhcmRvIEFzdG9sZmkgPGVhc3RvbGZpOTFAZ21haWwuY29tPlxuICogQGxpY2Vuc2UgTUlUIExpY2Vuc2VkXG4gKi9cbiBcbnZhciBsb2dnZXIgPSBudWxsO1xuXG4vLyBTaG9yY3V0IGZvciBTdHJpbmcuZnJvbUNoYXJDb2RlXG52YXIgY2hyID0gU3RyaW5nLmZyb21DaGFyQ29kZTtcblxudmFyIG1heEJpdHMgPSBbXTtcbmZvciAodmFyIGkgPSAwOyBpIDwgNjQ7IGkrKykge1xuICAgIG1heEJpdHNbaV0gPSBNYXRoLnBvdygyLCBpKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihCaW5hcnlQYXJzZXJCdWZmZXIsIExvZ2dlcikge1xuICAgIGxvZ2dlciA9IExvZ2dlci5pbnN0YW5jZTtcblxuICAgIC8qKlxuICAgICAqIEJpbmFyeVBhcnNlclxuICAgICAqIEBpZ25vcmVcbiAgICAgKiBcbiAgICAgKiBAbW9kdWxlIEN1cnNvclxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBzaW5jZSAwLjAuMVxuICAgICAqIFxuICAgICAqIEBjbGFzc2Rlc2MgQ3Vyc29yIGNsYXNzIHRoYXQgbWFwcyBhIE1vbmdvREItbGlrZSBjdXJzb3JcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge01vbmdvUG9ydGFibGV9IGRiIC0gQWRkaXRpb25hbCBvcHRpb25zXG4gICAgICogQHBhcmFtIHtDb2xsZWN0aW9ufSBjb2xsZWN0aW9uIC0gVGhlIGNvbGxlY3Rpb24gaW5zdGFuY2VcbiAgICAgKiBAcGFyYW0ge09iamVjdHxBcnJheXxTdHJpbmd9IFtzZWxlY3Rpb249e31dIC0gVGhlIHNlbGVjdGlvbiBmb3IgbWF0Y2hpbmcgZG9jdW1lbnRzXG4gICAgICogQHBhcmFtIHtPYmplY3R8QXJyYXl8U3RyaW5nfSBbZmllbGRzPXt9XSAtIFRoZSBmaWVsZHMgb2YgdGhlIGRvY3VtZW50IHRvIHNob3dcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIC0gRGF0YWJhc2Ugb2JqZWN0XG4gICAgICogXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zLnBrRmFjdG9yeT1udWxsXSAtIE9iamVjdCBvdmVycmlkaW5nIHRoZSBiYXNpYyBcIk9iamVjdElkXCIgcHJpbWFyeSBrZXkgZ2VuZXJhdGlvbi5cbiAgICAgKiBcbiAgICAgKi9cbiAgICBjbGFzcyBCaW5hcnlQYXJzZXIge1xuICAgICAgICBjb25zdHJ1Y3RvcihiaWdFbmRpYW4sIGFsbG93RXhjZXB0aW9ucykge1xuICAgICAgICAgICAgbG9nZ2VyID0gTG9nZ2VyLmluc3RhbmNlO1xuICAgICAgICBcbiAgICAgICAgICAgIHRoaXMuYmlnRW5kaWFuID0gYmlnRW5kaWFuO1xuICAgICAgICAgICAgdGhpcy5hbGxvd0V4Y2VwdGlvbnMgPSBhbGxvd0V4Y2VwdGlvbnM7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIFxuICAgIH1cbiAgICBcbiAgICBCaW5hcnlQYXJzZXIuZGVjb2RlRmxvYXQgPSBmdW5jdGlvbiAoZGF0YSwgcHJlY2lzaW9uQml0cywgZXhwb25lbnRCaXRzKSB7XG4gICAgICAgIHZhciBiID0gbmV3IEJpbmFyeVBhcnNlckJ1ZmZlcih0aGlzLmJpZ0VuZGlhbiwgZGF0YSk7XG4gICAgXG4gICAgICAgIGIuY2hlY2tCdWZmZXIocHJlY2lzaW9uQml0cyArIGV4cG9uZW50Qml0cyArIDEpO1xuICAgIFxuICAgICAgICB2YXIgYmlhcyA9IG1heEJpdHNbZXhwb25lbnRCaXRzIC0gMV0gLSAxLFxuICAgICAgICAgICAgc2lnbmFsID0gYi5yZWFkQml0cyhwcmVjaXNpb25CaXRzICsgZXhwb25lbnRCaXRzLCAxKSxcbiAgICAgICAgICAgIGV4cG9uZW50ID0gYi5yZWFkQml0cyhwcmVjaXNpb25CaXRzLCBleHBvbmVudEJpdHMpLFxuICAgICAgICAgICAgc2lnbmlmaWNhbmQgPSAwLFxuICAgICAgICAgICAgZGl2aXNvciA9IDIsXG4gICAgICAgICAgICBjdXJCeXRlID0gYi5idWZmZXIubGVuZ3RoICsgKC1wcmVjaXNpb25CaXRzID4+IDMpIC0gMTtcbiAgICBcbiAgICAgICAgZG8ge1xuICAgICAgICAgICAgZm9yIChcbiAgICAgICAgICAgICAgICB2YXIgYnl0ZVZhbHVlID0gYi5idWZmZXJbICsrY3VyQnl0ZSBdLCBzdGFydEJpdCA9IHByZWNpc2lvbkJpdHMgJSA4IHx8IDgsIG1hc2sgPSAxIDw8IHN0YXJ0Qml0O1xuICAgICAgICAgICAgICAgIG1hc2sgPj49IDE7IFxuICAgICAgICAgICAgICAgICggYnl0ZVZhbHVlICYgbWFzayApICYmICggc2lnbmlmaWNhbmQgKz0gMSAvIGRpdmlzb3IgKSwgZGl2aXNvciAqPSAyIFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSB3aGlsZSAocHJlY2lzaW9uQml0cyAtPSBzdGFydEJpdCk7XG4gICAgICAgIFxuICAgICAgICBcbiAgICBcbiAgICAgICAgaWYgKCBleHBvbmVudCA9PSAoIGJpYXMgPDwgMSApICsgMSApIHtcbiAgICAgICAgXHRpZiAoc2lnbmlmaWNhbmQpIHtcbiAgICAgICAgXHRcdHJldHVybiBOYU47XG4gICAgICAgIFx0fSBlbHNlIHtcbiAgICAgICAgXHRcdGlmIChzaWduYWwpIHtcbiAgICAgICAgXHRcdFx0cmV0dXJuIC1JbmZpbml0eTtcbiAgICAgICAgXHRcdH0gZWxzZSB7XG4gICAgICAgIFx0XHRcdHJldHVybiArSW5maW5pdHk7XG4gICAgICAgIFx0XHR9XG4gICAgICAgIFx0fVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICBcdHZhciBfbW9kID0gMDtcbiAgICAgICAgXHRcbiAgICAgICAgXHRpZiAoZXhwb25lbnQgfHwgc2lnbmlmaWNhbmQpIHtcbiAgICAgICAgXHQgICAgX21vZCA9IGV4cG9uZW50ID8gTWF0aC5wb3coIDIsIGV4cG9uZW50IC0gYmlhcyApICogKCAxICsgc2lnbmlmaWNhbmQgKSA6IE1hdGgucG93KCAyLCAtYmlhcyArIDEgKSAqIHNpZ25pZmljYW5kO1xuICAgICAgICBcdH1cbiAgICAgICAgXHRcbiAgICAgICAgXHRyZXR1cm4gKCAxICsgc2lnbmFsICogLTIgKSAqIChfbW9kKTtcbiAgICAgICAgfVxuICAgIFxuICAgIFxuICAgICAgICAvLyByZXR1cm4gZXhwb25lbnQgPT0gKCBiaWFzIDw8IDEgKSArIDEgPyBzaWduaWZpY2FuZCA/IE5hTiA6IHNpZ25hbCA/IC1JbmZpbml0eSA6ICtJbmZpbml0eSA6ICggMSArIHNpZ25hbCAqIC0yICkgKiAoIGV4cG9uZW50IHx8IHNpZ25pZmljYW5kID8gIWV4cG9uZW50ID8gTWF0aC5wb3coIDIsIC1iaWFzICsgMSApICogc2lnbmlmaWNhbmQgOiBNYXRoLnBvdyggMiwgZXhwb25lbnQgLSBiaWFzICkgKiAoIDEgKyBzaWduaWZpY2FuZCApIDogMCApO1xuICAgIH07XG4gICAgXG4gICAgQmluYXJ5UGFyc2VyLmRlY29kZUludCA9IGZ1bmN0aW9uIChkYXRhLCBiaXRzLCBzaWduZWQsIGZvcmNlQmlnRW5kaWFuKSB7XG4gICAgICAgIHZhciBiID0gbmV3IEJpbmFyeVBhcnNlckJ1ZmZlcih0aGlzLmJpZ0VuZGlhbiB8fCBmb3JjZUJpZ0VuZGlhbiwgZGF0YSksXG4gICAgICAgICAgICB4ID0gYi5yZWFkQml0cygwLCBiaXRzKSxcbiAgICAgICAgICAgIG1heCA9IG1heEJpdHNbYml0c107IC8vbWF4ID0gTWF0aC5wb3coIDIsIGJpdHMgKTtcbiAgICBcbiAgICAgICAgcmV0dXJuIHNpZ25lZCAmJiB4ID49IG1heCAvIDIgPyB4IC0gbWF4IDogeDtcbiAgICB9O1xuICAgIFxuICAgIEJpbmFyeVBhcnNlci5lbmNvZGVGbG9hdCA9IGZ1bmN0aW9uIChkYXRhLCBwcmVjaXNpb25CaXRzLCBleHBvbmVudEJpdHMpIHtcbiAgICAgICAgdmFyIGJpYXMgPSBtYXhCaXRzW2V4cG9uZW50Qml0cyAtIDFdIC0gMSxcbiAgICAgICAgICAgIG1pbkV4cCA9IC1iaWFzICsgMSxcbiAgICAgICAgICAgIG1heEV4cCA9IGJpYXMsXG4gICAgICAgICAgICBtaW5Vbm5vcm1FeHAgPSBtaW5FeHAgLSBwcmVjaXNpb25CaXRzLFxuICAgICAgICAgICAgbiA9IHBhcnNlRmxvYXQoZGF0YSksXG4gICAgICAgICAgICBzdGF0dXMgPSBpc05hTihuKSB8fCBuID09IC1JbmZpbml0eSB8fCBuID09ICtJbmZpbml0eSA/IG4gOiAwLFxuICAgICAgICAgICAgZXhwID0gMCxcbiAgICAgICAgICAgIGxlbiA9IDIgKiBiaWFzICsgMSArIHByZWNpc2lvbkJpdHMgKyAzLFxuICAgICAgICAgICAgYmluID0gbmV3IEFycmF5KGxlbiksXG4gICAgICAgICAgICBzaWduYWwgPSAobiA9IHN0YXR1cyAhPT0gMCA/IDAgOiBuKSA8IDAsXG4gICAgICAgICAgICBpbnRQYXJ0ID0gTWF0aC5mbG9vcihuID0gTWF0aC5hYnMobikpLFxuICAgICAgICAgICAgZmxvYXRQYXJ0ID0gbiAtIGludFBhcnQsXG4gICAgICAgICAgICBsYXN0Qml0LFxuICAgICAgICAgICAgcm91bmRlZCxcbiAgICAgICAgICAgIHJlc3VsdCxcbiAgICAgICAgICAgIGksXG4gICAgICAgICAgICBqO1xuICAgIFxuICAgIFxuICAgICAgICBmb3IgKGkgPSBsZW47IGk7IGJpblstLWldID0gMCk7XG4gICAgICAgIFxuICAgICAgICBmb3IgKGkgPSBiaWFzICsgMjsgaW50UGFydCAmJiBpOyBiaW5bLS1pXSA9IGludFBhcnQgJSAyLCBpbnRQYXJ0ID0gTWF0aC5mbG9vcihpbnRQYXJ0IC8gMikpO1xuICAgICAgICBcbiAgICAgICAgZm9yIChpID0gYmlhcyArIDE7IGZsb2F0UGFydCA+IDAgJiYgaTsgKGJpblsrK2ldID0gKChmbG9hdFBhcnQgKj0gMikgPj0gMSkgLSAwICkgJiYgLS1mbG9hdFBhcnQpO1xuICAgICAgICBcbiAgICAgICAgZm9yIChpID0gLTE7ICsraSA8IGxlbiAmJiAhYmluW2ldOyk7XG4gICAgICBcbiAgICAgICAgaWYgKGJpblsobGFzdEJpdCA9IHByZWNpc2lvbkJpdHMgLSAxICsgKGkgPSAoZXhwID0gYmlhcyArIDEgLSBpKSA+PSBtaW5FeHAgJiYgZXhwIDw9IG1heEV4cCA/IGkgKyAxIDogYmlhcyArIDEgLSAoZXhwID0gbWluRXhwIC0gMSkpKSArIDFdKSB7XG4gICAgICAgICAgICBpZiAoIShyb3VuZGVkID0gYmluW2xhc3RCaXRdKSkge1xuICAgICAgICAgICAgICAgIGZvciAoaiA9IGxhc3RCaXQgKyAyOyAhcm91bmRlZCAmJiBqIDwgbGVuOyByb3VuZGVkID0gYmluW2orK10pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBmb3IgKGogPSBsYXN0Qml0ICsgMTsgcm91bmRlZCAmJiAtLWogPj0gMDsgKGJpbltqXSA9ICFiaW5bal0gLSAwKSAmJiAocm91bmRlZCA9IDApKTtcbiAgICAgICAgfVxuICAgICAgXG4gICAgICAgIGZvciAoaSA9IGkgLSAyIDwgMCA/IC0xIDogaSAtIDM7ICsraSA8IGxlbiAmJiAhYmluW2ldOyk7XG4gICAgICAgIFxuICAgICAgICBpZiAoKGV4cCA9IGJpYXMgKyAxIC0gaSkgPj0gbWluRXhwICYmIGV4cCA8PSBtYXhFeHApIHtcbiAgICAgICAgICAgICsraTtcbiAgICAgICAgfSBlbHNlIGlmIChleHAgPCBtaW5FeHApIHtcbiAgICAgICAgICAgIGV4cCAhPSBiaWFzICsgMSAtIGxlbiAmJiBleHAgPCBtaW5Vbm5vcm1FeHAgJiYgbG9nZ2VyLndhcm4oXCJlbmNvZGVGbG9hdDo6ZmxvYXQgdW5kZXJmbG93XCIpO1xuICAgICAgICAgICAgaSA9IGJpYXMgKyAxIC0gKGV4cCA9IG1pbkV4cCAtIDEpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAoaW50UGFydCB8fCBzdGF0dXMgIT09IDApIHtcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKGludFBhcnQgPyBcImVuY29kZUZsb2F0OjpmbG9hdCBvdmVyZmxvd1wiIDogXCJlbmNvZGVGbG9hdDo6XCIgKyBzdGF0dXMpO1xuICAgICAgICAgICAgZXhwID0gbWF4RXhwICsgMTtcbiAgICAgICAgICAgIGkgPSBiaWFzICsgMjtcbiAgICAgICAgXG4gICAgICAgICAgICBpZiAoc3RhdHVzID09IC1JbmZpbml0eSkge1xuICAgICAgICAgICAgICAgIHNpZ25hbCA9IDE7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzTmFOKHN0YXR1cykpIHtcbiAgICAgICAgICAgICAgICBiaW5baV0gPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICBcbiAgICAgICAgZm9yIChuID0gTWF0aC5hYnMoZXhwICsgYmlhcyksIGogPSBleHBvbmVudEJpdHMgKyAxLCByZXN1bHQgPSBcIlwiOyAtLWo7IHJlc3VsdCA9IChuICUgMikgKyByZXN1bHQsIG4gPSBuID4+PSAxKTtcbiAgICAgICAgXG4gICAgICAgIGxldCByID0gW107XG4gICAgICAgIFxuICAgICAgICBmb3IgKG4gPSAwLCBqID0gMCwgaSA9IChyZXN1bHQgPSAoc2lnbmFsID8gXCIxXCIgOiBcIjBcIikgKyByZXN1bHQgKyBiaW4uc2xpY2UoaSwgaSArIHByZWNpc2lvbkJpdHMpLmpvaW4oXCJcIikpLmxlbmd0aCwgciA9IFtdOyBpOyBqID0gKGogKyAxKSAlIDgpIHtcbiAgICAgICAgICAgIG4gKz0gKDEgPDwgaikgKiByZXN1bHQuY2hhckF0KC0taSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChqID09IDcpIHtcbiAgICAgICAgICAgICAgICByW3IubGVuZ3RoXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUobik7XG4gICAgICAgICAgICAgICAgbiA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIFxuICAgICAgICByW3IubGVuZ3RoXSA9IG4gPyBTdHJpbmcuZnJvbUNoYXJDb2RlKG4pIDogXCJcIjtcbiAgICAgIFxuICAgICAgICByZXR1cm4gKHRoaXMuYmlnRW5kaWFuID8gci5yZXZlcnNlKCkgOiByKS5qb2luKFwiXCIpO1xuICAgIH07XG4gICAgXG4gICAgQmluYXJ5UGFyc2VyLmVuY29kZUludCA9IGZ1bmN0aW9uIChkYXRhLCBiaXRzLCBzaWduZWQsIGZvcmNlQmlnRW5kaWFuKSB7XG4gICAgICAgIHZhciBtYXggPSBtYXhCaXRzW2JpdHNdO1xuICAgICAgICBcbiAgICAgICAgaWYgKGRhdGEgPj0gbWF4IHx8IGRhdGEgPCAtKG1heCAvIDIpKSB7XG4gICAgICAgICAgICBsb2dnZXIud2FybihcImVuY29kZUludDo6b3ZlcmZsb3dcIik7XG4gICAgICAgICAgICBkYXRhID0gMDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYgKGRhdGEgPCAwKSB7XG4gICAgICAgICAgICBkYXRhICs9IG1heDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgZm9yICh2YXIgciA9IFtdOyBkYXRhOyByW3IubGVuZ3RoXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoZGF0YSAlIDI1NiksIGRhdGEgPSBNYXRoLmZsb29yKGRhdGEgLyAyNTYpKTtcbiAgICAgICAgXG4gICAgICAgIGZvciAoYml0cyA9IC0oLWJpdHMgPj4gMykgLSByLmxlbmd0aDsgYml0cy0tOyByW3IubGVuZ3RoXSA9IFwiXFwwXCIpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuICgodGhpcy5iaWdFbmRpYW4gfHwgZm9yY2VCaWdFbmRpYW4pID8gci5yZXZlcnNlKCkgOiByKS5qb2luKFwiXCIpO1xuICAgIH07XG4gICAgXG4gICAgQmluYXJ5UGFyc2VyLnRvU21hbGwgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVJbnQoIGRhdGEsICA4LCB0cnVlICApOyB9O1xuICAgIEJpbmFyeVBhcnNlci5mcm9tU21hbGwgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlSW50KCBkYXRhLCAgOCwgdHJ1ZSAgKTsgfTtcbiAgICBCaW5hcnlQYXJzZXIudG9CeXRlICAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgIDgsIGZhbHNlICk7IH07XG4gICAgQmluYXJ5UGFyc2VyLmZyb21CeXRlICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVJbnQoIGRhdGEsICA4LCBmYWxzZSApOyB9O1xuICAgIEJpbmFyeVBhcnNlci50b1Nob3J0ICAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZGVjb2RlSW50KCBkYXRhLCAxNiwgdHJ1ZSAgKTsgfTtcbiAgICBCaW5hcnlQYXJzZXIuZnJvbVNob3J0ICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgMTYsIHRydWUgICk7IH07XG4gICAgQmluYXJ5UGFyc2VyLnRvV29yZCAgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVJbnQoIGRhdGEsIDE2LCBmYWxzZSApOyB9O1xuICAgIEJpbmFyeVBhcnNlci5mcm9tV29yZCAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlSW50KCBkYXRhLCAxNiwgZmFsc2UgKTsgfTtcbiAgICBCaW5hcnlQYXJzZXIudG9JbnQgICAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgMzIsIHRydWUgICk7IH07XG4gICAgQmluYXJ5UGFyc2VyLmZyb21JbnQgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVJbnQoIGRhdGEsIDMyLCB0cnVlICApOyB9O1xuICAgIEJpbmFyeVBhcnNlci50b0xvbmcgICAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZGVjb2RlSW50KCBkYXRhLCA2NCwgdHJ1ZSAgKTsgfTtcbiAgICBCaW5hcnlQYXJzZXIuZnJvbUxvbmcgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgNjQsIHRydWUgICk7IH07XG4gICAgQmluYXJ5UGFyc2VyLnRvRFdvcmQgICAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5kZWNvZGVJbnQoIGRhdGEsIDMyLCBmYWxzZSApOyB9O1xuICAgIEJpbmFyeVBhcnNlci5mcm9tRFdvcmQgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZW5jb2RlSW50KCBkYXRhLCAzMiwgZmFsc2UgKTsgfTtcbiAgICBCaW5hcnlQYXJzZXIudG9RV29yZCAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUludCggZGF0YSwgNjQsIHRydWUgKTsgfTtcbiAgICBCaW5hcnlQYXJzZXIuZnJvbVFXb3JkICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUludCggZGF0YSwgNjQsIHRydWUgKTsgfTtcbiAgICBCaW5hcnlQYXJzZXIudG9GbG9hdCAgICA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmRlY29kZUZsb2F0KCBkYXRhLCAyMywgOCAgICk7IH07XG4gICAgQmluYXJ5UGFyc2VyLmZyb21GbG9hdCAgPSBmdW5jdGlvbiggZGF0YSApeyByZXR1cm4gdGhpcy5lbmNvZGVGbG9hdCggZGF0YSwgMjMsIDggICApOyB9O1xuICAgIEJpbmFyeVBhcnNlci50b0RvdWJsZSAgID0gZnVuY3Rpb24oIGRhdGEgKXsgcmV0dXJuIHRoaXMuZGVjb2RlRmxvYXQoIGRhdGEsIDUyLCAxMSAgKTsgfTtcbiAgICBCaW5hcnlQYXJzZXIuZnJvbURvdWJsZSA9IGZ1bmN0aW9uKCBkYXRhICl7IHJldHVybiB0aGlzLmVuY29kZUZsb2F0KCBkYXRhLCA1MiwgMTEgICk7IH07XG4gICAgXG4gICAgLy8gRmFjdG9yIG91dCB0aGUgZW5jb2RlIHNvIGl0IGNhbiBiZSBzaGFyZWQgYnkgYWRkX2hlYWRlciBhbmQgcHVzaF9pbnQzMlxuICAgIEJpbmFyeVBhcnNlci5lbmNvZGVfaW50MzIgPSBmdW5jdGlvbiAobnVtYmVyLCBhc0FycmF5KSB7XG4gICAgICAgIHZhciBhLCBiLCBjLCBkLCB1bnNpZ25lZDtcbiAgICAgICAgXG4gICAgICAgIHVuc2lnbmVkID0gKG51bWJlciA8IDApID8gKG51bWJlciArIDB4MTAwMDAwMDAwKSA6IG51bWJlcjtcbiAgICAgICAgYSA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmZmZik7XG4gICAgICAgIFxuICAgICAgICB1bnNpZ25lZCAmPSAweGZmZmZmZjtcbiAgICAgICAgYiA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmYpO1xuICAgICAgICBcbiAgICAgICAgdW5zaWduZWQgJj0gMHhmZmZmO1xuICAgICAgICBjID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmYpO1xuICAgICAgICBcbiAgICAgICAgdW5zaWduZWQgJj0gMHhmZjtcbiAgICAgICAgZCA9IE1hdGguZmxvb3IodW5zaWduZWQpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGFzQXJyYXkgPyBbY2hyKGEpLCBjaHIoYiksIGNocihjKSwgY2hyKGQpXSA6IGNocihhKSArIGNocihiKSArIGNocihjKSArIGNocihkKTtcbiAgICB9O1xuICAgIFxuICAgIEJpbmFyeVBhcnNlci5lbmNvZGVfaW50NjQgPSBmdW5jdGlvbiAobnVtYmVyKSB7XG4gICAgICAgIHZhciBhLCBiLCBjLCBkLCBlLCBmLCBnLCBoLCB1bnNpZ25lZDtcbiAgICAgICAgXG4gICAgICAgIHVuc2lnbmVkID0gKG51bWJlciA8IDApID8gKG51bWJlciArIDB4MTAwMDAwMDAwMDAwMDAwMDApIDogbnVtYmVyO1xuICAgICAgICBhID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmZmZmZmZmZmZmZmZmYpO1xuICAgICAgICBcbiAgICAgICAgdW5zaWduZWQgJj0gMHhmZmZmZmZmZmZmZmZmZjtcbiAgICAgICAgYiA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmZmZmZmZmZmZik7XG4gICAgICAgIFxuICAgICAgICB1bnNpZ25lZCAmPSAweGZmZmZmZmZmZmZmZjtcbiAgICAgICAgYyA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmZmZmZmZmYpO1xuICAgICAgICBcbiAgICAgICAgdW5zaWduZWQgJj0gMHhmZmZmZmZmZmZmO1xuICAgICAgICBkID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmZmZmZmZmYpO1xuICAgICAgICBcbiAgICAgICAgdW5zaWduZWQgJj0gMHhmZmZmZmZmZjtcbiAgICAgICAgZSA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmZmZik7XG4gICAgICAgIFxuICAgICAgICB1bnNpZ25lZCAmPSAweGZmZmZmZjtcbiAgICAgICAgZiA9IE1hdGguZmxvb3IodW5zaWduZWQgLyAweGZmZmYpO1xuICAgICAgICBcbiAgICAgICAgdW5zaWduZWQgJj0gMHhmZmZmO1xuICAgICAgICBnID0gTWF0aC5mbG9vcih1bnNpZ25lZCAvIDB4ZmYpO1xuICAgICAgICBcbiAgICAgICAgdW5zaWduZWQgJj0gMHhmZjtcbiAgICAgICAgaCA9IE1hdGguZmxvb3IodW5zaWduZWQpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGNocihhKSArIGNocihiKSArIGNocihjKSArIGNocihkKSArIGNocihlKSArIGNocihmKSArIGNocihnKSArIGNocihoKTtcbiAgICB9O1xuICAgIFxuICAgIC8qKlxuICAgICAqIFVURjggbWV0aG9kc1xuICAgICAqL1xuICAgIFxuICAgIC8vIFRha2UgYSByYXcgYmluYXJ5IHN0cmluZyBhbmQgcmV0dXJuIGEgdXRmOCBzdHJpbmdcbiAgICBCaW5hcnlQYXJzZXIuZGVjb2RlX3V0ZjggPSBmdW5jdGlvbiAoYmluYXJ5U3RyKSB7XG4gICAgICAgIHZhciBsZW4gPSBiaW5hcnlTdHIubGVuZ3RoLFxuICAgICAgICAgICAgZGVjb2RlZCA9ICcnLFxuICAgICAgICAgICAgaSA9IDAsXG4gICAgICAgICAgICBjID0gMCxcbiAgICAgICAgICAgIGMxID0gMCxcbiAgICAgICAgICAgIGMyID0gMCxcbiAgICAgICAgICAgIGMzO1xuICAgICAgICBcbiAgICAgICAgd2hpbGUgKGkgPCBsZW4pIHtcbiAgICAgICAgICAgIGMgPSBiaW5hcnlTdHIuY2hhckNvZGVBdChpKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGMgPCAxMjgpIHtcbiAgICAgICAgICAgICAgICBkZWNvZGVkICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYyk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgfSBlbHNlIGlmICgoYyA+IDE5MSkgJiYgKGMgPCAyMjQpKSB7XG4gICAgICAgICAgICAgICAgYzIgPSBiaW5hcnlTdHIuY2hhckNvZGVBdChpKzEpO1xuICAgICAgICAgICAgICAgIGRlY29kZWQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgJiAzMSkgPDwgNikgfCAoYzIgJiA2MykpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGkgKz0gMjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYzIgPSBiaW5hcnlTdHIuY2hhckNvZGVBdChpKzEpO1xuICAgICAgICAgICAgICAgIGMzID0gYmluYXJ5U3RyLmNoYXJDb2RlQXQoaSsyKTtcbiAgICAgICAgICAgICAgICBkZWNvZGVkICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKChjICYgMTUpIDw8IDEyKSB8ICgoYzIgJiA2MykgPDwgNikgfCAoYzMgJiA2MykpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGkgKz0gMztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGRlY29kZWQ7XG4gICAgfTtcbiAgICBcbiAgICAvLyBFbmNvZGUgYSBjc3RyaW5nXG4gICAgQmluYXJ5UGFyc2VyLmVuY29kZV9jc3RyaW5nID0gZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgcmV0dXJuIHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChzKSkgKyBCaW5hcnlQYXJzZXIuZnJvbUJ5dGUoMCk7XG4gICAgfTtcbiAgICBcbiAgICAvLyBUYWtlIGEgdXRmOCBzdHJpbmcgYW5kIHJldHVybiBhIGJpbmFyeSBzdHJpbmdcbiAgICBCaW5hcnlQYXJzZXIuZW5jb2RlX3V0ZjggPSBmdW5jdGlvbiBlbmNvZGVfdXRmOCAocykge1xuICAgICAgICB2YXIgYSA9IFwiXCIsXG4gICAgICAgICAgICBjO1xuICAgIFxuICAgICAgICBmb3IgKHZhciBuID0gMCwgbGVuID0gcy5sZW5ndGg7IG4gPCBsZW47IG4rKykge1xuICAgICAgICAgICAgYyA9IHMuY2hhckNvZGVBdChuKTtcbiAgICBcbiAgICAgICAgICAgIGlmIChjIDwgMTI4KSB7XG4gICAgICAgICAgICAgICAgYSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGMpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICgoYyA+IDEyNykgJiYgKGMgPCAyMDQ4KSkge1xuICAgICAgICAgICAgICAgIGEgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYz4+NikgfCAxOTIpIDtcbiAgICAgICAgICAgICAgICBhICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGMmNjMpIHwgMTI4KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjPj4xMikgfCAyMjQpO1xuICAgICAgICAgICAgICAgIGEgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGM+PjYpICYgNjMpIHwgMTI4KTtcbiAgICAgICAgICAgICAgICBhICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGMmNjMpIHwgMTI4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIFxuICAgICAgICByZXR1cm4gYTtcbiAgICB9O1xuICAgIFxuICAgIEJpbmFyeVBhcnNlci5ocHJpbnQgPSBmdW5jdGlvbiAocykge1xuICAgICAgICB2YXIgbnVtYmVyO1xuICAgIFxuICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgaWYgKHMuY2hhckNvZGVBdChpKSA8IDMyKSB7XG4gICAgICAgICAgICAgICAgbnVtYmVyID0gcy5jaGFyQ29kZUF0KGkpIDw9IDE1ID8gXCIwXCIgKyBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpIDogcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDE2KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBsb2dnZXIuc2lsbHkobnVtYmVyICsgXCIgXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBudW1iZXIgPSBzLmNoYXJDb2RlQXQoaSkgPD0gMTUgPyBcIjBcIiArIHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxNikgOiBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGxvZ2dlci5zaWxseShudW1iZXIgKyBcIiBcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGxvZ2dlci5zaWxseShcIlxcblxcblwiKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBudW1iZXI7XG4gICAgfTtcbiAgICBcbiAgICBCaW5hcnlQYXJzZXIuaWxwcmludCA9IGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHZhciBudW1iZXI7XG4gICAgXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBpZiAocy5jaGFyQ29kZUF0KGkpIDwgMzIpIHtcbiAgICAgICAgICAgICAgICBudW1iZXIgPSBzLmNoYXJDb2RlQXQoaSkgPD0gMTUgPyBcIjBcIiArIHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxMCkgOiBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTApO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGxvZ2dlci5zaWxseShudW1iZXIgKyBcIiBcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG51bWJlciA9IHMuY2hhckNvZGVBdChpKSA8PSAxNSA/IFwiMFwiICsgcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDEwKSA6IHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxMCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgbG9nZ2VyLnNpbGx5KG51bWJlciArIFwiIFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgbG9nZ2VyLnNpbGx5KFwiXFxuXFxuXCIpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIG51bWJlcjtcbiAgICB9O1xuICAgIFxuICAgIEJpbmFyeVBhcnNlci5obHByaW50ID0gZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgdmFyIG51bWJlcjtcbiAgICAgICAgXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBpZiAocy5jaGFyQ29kZUF0KGkpIDwgMzIpIHtcbiAgICAgICAgICAgICAgICBudW1iZXIgPSBzLmNoYXJDb2RlQXQoaSkgPD0gMTUgPyBcIjBcIiArIHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxNikgOiBzLmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGxvZ2dlci5zaWxseShudW1iZXIgKyBcIiBcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG51bWJlciA9IHMuY2hhckNvZGVBdChpKSA8PSAxNSA/IFwiMFwiICsgcy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDE2KSA6IHMuY2hhckNvZGVBdChpKS50b1N0cmluZygxNik7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgbG9nZ2VyLnNpbGx5KG51bWJlciArIFwiIFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgbG9nZ2VyLnNpbGx5KFwiXFxuXFxuXCIpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIG51bWJlcjtcbiAgICB9O1xuICAgIFxuICAgIHJldHVybiBCaW5hcnlQYXJzZXI7XG59OyJdfQ==
